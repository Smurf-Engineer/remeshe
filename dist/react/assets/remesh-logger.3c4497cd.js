var Rn=Object.defineProperty,Dn=Object.defineProperties;var xn=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var Be=Object.prototype.hasOwnProperty,Ze=Object.prototype.propertyIsEnumerable;var Xe=(e,n,t)=>n in e?Rn(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,D=(e,n)=>{for(var t in n||(n={}))Be.call(n,t)&&Xe(e,t,n[t]);if(q)for(var t of q(n))Ze.call(n,t)&&Xe(e,t,n[t]);return e},M=(e,n)=>Dn(e,xn(n));var et=(e,n)=>{var t={};for(var o in e)Be.call(e,o)&&n.indexOf(o)<0&&(t[o]=e[o]);if(e!=null&&q)for(var o of q(e))n.indexOf(o)<0&&Ze.call(e,o)&&(t[o]=e[o]);return t};import{r as C,a as In}from"./jsx-runtime.a8396eb8.js";var tt=function(n,t,o,s){var a=o?o.call(s,n,t):void 0;if(a!==void 0)return!!a;if(n===t)return!0;if(typeof n!="object"||!n||typeof t!="object"||!t)return!1;var c=Object.keys(n),m=Object.keys(t);if(c.length!==m.length)return!1;for(var v=Object.prototype.hasOwnProperty.bind(t),d=0;d<c.length;d++){var f=c[d];if(!v(f))return!1;var l=n[f],y=t[f];if(a=o?o.call(s,l,y,f):void 0,a===!1||a===void 0&&l!==y)return!1}return!0};/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function nt(e){return Object.prototype.toString.call(e)==="[object Object]"}function rt(e){var n,t;return nt(e)===!1?!1:(n=e.constructor,n===void 0?!0:(t=n.prototype,!(nt(t)===!1||t.hasOwnProperty("isPrototypeOf")===!1)))}let kn=0;function ft(e){var o;const n=kn++,t=s=>({type:"RemeshEventAction",arg:s,Event:t});return t.type="RemeshEvent",t.eventId=n,t.eventName=e.name,t.owner=K(),t.inspectable="inspectable"in e&&(o=e.inspectable)!=null?o:!0,t.toSubscribeOnlyEvent=()=>Cn(t),"impl"in e&&(t.impl=e.impl),t}const ot=new WeakMap,lt=new WeakMap,Cn=e=>{const n=ot.get(e);if(n)return n;const t={type:"RemeshSubscribeOnlyEvent",eventId:e.eventId,eventName:e.eventName};return ot.set(e,t),lt.set(t,e),t},st=e=>{const n=lt.get(e);if(n)return n;throw new Error(`SubscribeOnlyEvent ${e.eventName} does not have an associated Event`)};let Mn=0;const Se=(e,n)=>rt(e)&&rt(n)||Array.isArray(e)&&Array.isArray(n)?tt(e,n):e===n,dt=e=>{var s,a;const n=Mn++;let t=null;const o=c=>{if(c===void 0&&t)return t;const m={type:"RemeshStateItem",key:c,State:o,new:v=>({type:"RemeshStateItemUpdatePayload",key:c,value:v,stateItem:m})};return c===void 0&&(t=m),m};return o.type="RemeshState",o.stateId=n,o.stateName=e.name,o.default=e.default,o.compare=(s=e.compare)!=null?s:Se,o.owner=K(),o.inspectable=(a=e.inspectable)!=null?a:!0,o};let Nn=0;const mt=e=>{var s,a;const n=Nn++;let t=null;const o=c=>{if(c===void 0&&t)return t;const m={type:"RemeshEntityItem",key:`${c}`,Entity:o,new:v=>({type:"RemeshEntityItemUpdatePayload",key:c,value:v,entityItem:m})};return c===void 0&&(t=m),m};return o.type="RemeshEntity",o.entityId=n,o.entityName=e.name,o.key=e.key,o.injectEntities=e.injectEntities,o.owner=K(),o.inspectable=(s=e.inspectable)!=null?s:!0,o.compare=(a=e.compare)!=null?a:Se,o};let Qn=0;const pt=e=>{var s,a;const n=Qn++;let t=null;const o=c=>{if(c===void 0&&t)return t;const m={type:"RemeshQueryAction",Query:o,arg:c};return c===void 0&&(t=m),m};return o.type="RemeshQuery",o.queryId=n,o.queryName=e.name,o.impl=e.impl,o.compare=(s=e.compare)!=null?s:Se,o.owner=K(),o.inspectable=(a=e.inspectable)!=null?a:!0,o};let On=0;const yt=e=>{var o;const n=On++,t=s=>({type:"RemeshCommandAction",arg:s,Command:t});return t.type="RemeshCommand",t.commandId=n,t.commandName=e.name,t.impl=e.impl,t.owner=K(),t.inspectable=(o=e.inspectable)!=null?o:!0,t};let _n=0;const $n=e=>{const n={type:"RemeshExtern",externId:_n++,default:e.default,impl:t=>({type:"RemeshExternImpl",Extern:n,value:t})};return n},ht=e=>{const n={};return e.event&&(n.event=e.event),e.query&&(n.query=e.query),e.command&&(n.command=e.command),n},Pn=e=>ht(e);let Un=0;const ge=e=>{var o;let n=null;const t=s=>{if(s===void 0&&n)return n;const a={type:"RemeshDomainAction",Domain:t,arg:s};return s===void 0&&(n=a),a};return t.type="RemeshDomain",t.domainId=Un++,t.domainName=e.name,t.impl=e.impl,t.inspectable=(o=e.inspectable)!=null?o:!0,t},K=ge({name:"DefaultDomain",impl:()=>({})});/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var ye=function(e,n){return ye=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(t[s]=o[s])},ye(e,n)};function z(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");ye(e,n);function t(){this.constructor=e}e.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}function jn(e,n,t,o){function s(a){return a instanceof t?a:new t(function(c){c(a)})}return new(t||(t=Promise))(function(a,c){function m(f){try{d(o.next(f))}catch(l){c(l)}}function v(f){try{d(o.throw(f))}catch(l){c(l)}}function d(f){f.done?a(f.value):s(f.value).then(m,v)}d((o=o.apply(e,n||[])).next())})}function vt(e,n){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},o,s,a,c;return c={next:m(0),throw:m(1),return:m(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function m(d){return function(f){return v([d,f])}}function v(d){if(o)throw new TypeError("Generator is already executing.");for(;t;)try{if(o=1,s&&(a=d[0]&2?s.return:d[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,d[1])).done)return a;switch(s=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,s=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){t.label=d[1];break}if(d[0]===6&&t.label<a[1]){t.label=a[1],a=d;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(d);break}a[2]&&t.ops.pop(),t.trys.pop();continue}d=n.call(e,t)}catch(f){d=[6,f],s=0}finally{o=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function A(e){var n=typeof Symbol=="function"&&Symbol.iterator,t=n&&e[n],o=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function B(e,n){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var o=t.call(e),s,a=[],c;try{for(;(n===void 0||n-- >0)&&!(s=o.next()).done;)a.push(s.value)}catch(m){c={error:m}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(c)throw c.error}}return a}function Z(e,n,t){if(t||arguments.length===2)for(var o=0,s=n.length,a;o<s;o++)(a||!(o in n))&&(a||(a=Array.prototype.slice.call(n,0,o)),a[o]=n[o]);return e.concat(a||Array.prototype.slice.call(n))}function V(e){return this instanceof V?(this.v=e,this):new V(e)}function Tn(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=t.apply(e,n||[]),s,a=[];return s={},c("next"),c("throw"),c("return"),s[Symbol.asyncIterator]=function(){return this},s;function c(y){o[y]&&(s[y]=function(b){return new Promise(function(O,k){a.push([y,b,O,k])>1||m(y,b)})})}function m(y,b){try{v(o[y](b))}catch(O){l(a[0][3],O)}}function v(y){y.value instanceof V?Promise.resolve(y.value.v).then(d,f):l(a[0][2],y)}function d(y){m("next",y)}function f(y){m("throw",y)}function l(y,b){y(b),a.shift(),a.length&&m(a[0][0],a[0][1])}}function Vn(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e[Symbol.asyncIterator],t;return n?n.call(e):(e=typeof A=="function"?A(e):e[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(a){t[a]=e[a]&&function(c){return new Promise(function(m,v){c=e[a](c),s(m,v,c.done,c.value)})}}function s(a,c,m,v){Promise.resolve(v).then(function(d){a({value:d,done:m})},c)}}function I(e){return typeof e=="function"}function St(e){var n=function(o){Error.call(o),o.stack=new Error().stack},t=e(n);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var le=St(function(e){return function(t){e(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(o,s){return s+1+") "+o.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function he(e,n){if(e){var t=e.indexOf(n);0<=t&&e.splice(t,1)}}var te=function(){function e(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var n,t,o,s,a;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var m=A(c),v=m.next();!v.done;v=m.next()){var d=v.value;d.remove(this)}}catch(k){n={error:k}}finally{try{v&&!v.done&&(t=m.return)&&t.call(m)}finally{if(n)throw n.error}}else c.remove(this);var f=this.initialTeardown;if(I(f))try{f()}catch(k){a=k instanceof le?k.errors:[k]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var y=A(l),b=y.next();!b.done;b=y.next()){var O=b.value;try{at(O)}catch(k){a=a!=null?a:[],k instanceof le?a=Z(Z([],B(a)),B(k.errors)):a.push(k)}}}catch(k){o={error:k}}finally{try{b&&!b.done&&(s=y.return)&&s.call(y)}finally{if(o)throw o.error}}}if(a)throw new le(a)}},e.prototype.add=function(n){var t;if(n&&n!==this)if(this.closed)at(n);else{if(n instanceof e){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(n)}},e.prototype._hasParent=function(n){var t=this._parentage;return t===n||Array.isArray(t)&&t.includes(n)},e.prototype._addParent=function(n){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(n),t):t?[t,n]:n},e.prototype._removeParent=function(n){var t=this._parentage;t===n?this._parentage=null:Array.isArray(t)&&he(t,n)},e.prototype.remove=function(n){var t=this._finalizers;t&&he(t,n),n instanceof e&&n._removeParent(this)},e.EMPTY=function(){var n=new e;return n.closed=!0,n}(),e}(),gt=te.EMPTY;function bt(e){return e instanceof te||e&&"closed"in e&&I(e.remove)&&I(e.add)&&I(e.unsubscribe)}function at(e){I(e)?e():e.unsubscribe()}var ne={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ee={setTimeout:function(e,n){for(var t=[],o=2;o<arguments.length;o++)t[o-2]=arguments[o];var s=ee.delegate;return s!=null&&s.setTimeout?s.setTimeout.apply(s,Z([e,n],B(t))):setTimeout.apply(void 0,Z([e,n],B(t)))},clearTimeout:function(e){var n=ee.delegate;return((n==null?void 0:n.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Et(e){ee.setTimeout(function(){var n=ne.onUnhandledError;if(n)n(e);else throw e})}function it(){}var An=function(){return be("C",void 0,void 0)}();function Ln(e){return be("E",void 0,e)}function Wn(e){return be("N",e,void 0)}function be(e,n,t){return{kind:e,value:n,error:t}}function X(e){e()}var Ee=function(e){z(n,e);function n(t){var o=e.call(this)||this;return o.isStopped=!1,t?(o.destination=t,bt(t)&&t.add(o)):o.destination=Yn,o}return n.create=function(t,o,s){return new ve(t,o,s)},n.prototype.next=function(t){this.isStopped?me(Wn(t),this):this._next(t)},n.prototype.error=function(t){this.isStopped?me(Ln(t),this):(this.isStopped=!0,this._error(t))},n.prototype.complete=function(){this.isStopped?me(An,this):(this.isStopped=!0,this._complete())},n.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},n.prototype._next=function(t){this.destination.next(t)},n.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},n.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},n}(te),Fn=Function.prototype.bind;function de(e,n){return Fn.call(e,n)}var Kn=function(){function e(n){this.partialObserver=n}return e.prototype.next=function(n){var t=this.partialObserver;if(t.next)try{t.next(n)}catch(o){J(o)}},e.prototype.error=function(n){var t=this.partialObserver;if(t.error)try{t.error(n)}catch(o){J(o)}else J(n)},e.prototype.complete=function(){var n=this.partialObserver;if(n.complete)try{n.complete()}catch(t){J(t)}},e}(),ve=function(e){z(n,e);function n(t,o,s){var a=e.call(this)||this,c;if(I(t)||!t)c={next:t!=null?t:void 0,error:o!=null?o:void 0,complete:s!=null?s:void 0};else{var m;a&&ne.useDeprecatedNextContext?(m=Object.create(t),m.unsubscribe=function(){return a.unsubscribe()},c={next:t.next&&de(t.next,m),error:t.error&&de(t.error,m),complete:t.complete&&de(t.complete,m)}):c=t}return a.destination=new Kn(c),a}return n}(Ee);function J(e){Et(e)}function zn(e){throw e}function me(e,n){var t=ne.onStoppedNotification;t&&ee.setTimeout(function(){return t(e,n)})}var Yn={closed:!0,next:it,error:zn,complete:it},we=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Hn(e){return e}function Gn(e){return e.length===0?Hn:e.length===1?e[0]:function(t){return e.reduce(function(o,s){return s(o)},t)}}var N=function(){function e(n){n&&(this._subscribe=n)}return e.prototype.lift=function(n){var t=new e;return t.source=this,t.operator=n,t},e.prototype.subscribe=function(n,t,o){var s=this,a=Jn(n)?n:new ve(n,t,o);return X(function(){var c=s,m=c.operator,v=c.source;a.add(m?m.call(a,v):v?s._subscribe(a):s._trySubscribe(a))}),a},e.prototype._trySubscribe=function(n){try{return this._subscribe(n)}catch(t){n.error(t)}},e.prototype.forEach=function(n,t){var o=this;return t=ct(t),new t(function(s,a){var c=new ve({next:function(m){try{n(m)}catch(v){a(v),c.unsubscribe()}},error:a,complete:s});o.subscribe(c)})},e.prototype._subscribe=function(n){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(n)},e.prototype[we]=function(){return this},e.prototype.pipe=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return Gn(n)(this)},e.prototype.toPromise=function(n){var t=this;return n=ct(n),new n(function(o,s){var a;t.subscribe(function(c){return a=c},function(c){return s(c)},function(){return o(a)})})},e.create=function(n){return new e(n)},e}();function ct(e){var n;return(n=e!=null?e:ne.Promise)!==null&&n!==void 0?n:Promise}function qn(e){return e&&I(e.next)&&I(e.error)&&I(e.complete)}function Jn(e){return e&&e instanceof Ee||qn(e)&&bt(e)}function Xn(e){return I(e==null?void 0:e.lift)}function Re(e){return function(n){if(Xn(n))return n.lift(function(t){try{return e(t,this)}catch(o){this.error(o)}});throw new TypeError("Unable to lift unknown Observable type")}}function wt(e,n,t,o,s){return new Bn(e,n,t,o,s)}var Bn=function(e){z(n,e);function n(t,o,s,a,c,m){var v=e.call(this,t)||this;return v.onFinalize=c,v.shouldUnsubscribe=m,v._next=o?function(d){try{o(d)}catch(f){t.error(f)}}:e.prototype._next,v._error=a?function(d){try{a(d)}catch(f){t.error(f)}finally{this.unsubscribe()}}:e.prototype._error,v._complete=s?function(){try{s()}catch(d){t.error(d)}finally{this.unsubscribe()}}:e.prototype._complete,v}return n.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var o=this.closed;e.prototype.unsubscribe.call(this),!o&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},n}(Ee),Zn=St(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),F=function(e){z(n,e);function n(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return n.prototype.lift=function(t){var o=new ut(this,this);return o.operator=t,o},n.prototype._throwIfClosed=function(){if(this.closed)throw new Zn},n.prototype.next=function(t){var o=this;X(function(){var s,a;if(o._throwIfClosed(),!o.isStopped){o.currentObservers||(o.currentObservers=Array.from(o.observers));try{for(var c=A(o.currentObservers),m=c.next();!m.done;m=c.next()){var v=m.value;v.next(t)}}catch(d){s={error:d}}finally{try{m&&!m.done&&(a=c.return)&&a.call(c)}finally{if(s)throw s.error}}}})},n.prototype.error=function(t){var o=this;X(function(){if(o._throwIfClosed(),!o.isStopped){o.hasError=o.isStopped=!0,o.thrownError=t;for(var s=o.observers;s.length;)s.shift().error(t)}})},n.prototype.complete=function(){var t=this;X(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var o=t.observers;o.length;)o.shift().complete()}})},n.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(n.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),n.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},n.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},n.prototype._innerSubscribe=function(t){var o=this,s=this,a=s.hasError,c=s.isStopped,m=s.observers;return a||c?gt:(this.currentObservers=null,m.push(t),new te(function(){o.currentObservers=null,he(m,t)}))},n.prototype._checkFinalizedStatuses=function(t){var o=this,s=o.hasError,a=o.thrownError,c=o.isStopped;s?t.error(a):c&&t.complete()},n.prototype.asObservable=function(){var t=new N;return t.source=this,t},n.create=function(t,o){return new ut(t,o)},n}(N),ut=function(e){z(n,e);function n(t,o){var s=e.call(this)||this;return s.destination=t,s.source=o,s}return n.prototype.next=function(t){var o,s;(s=(o=this.destination)===null||o===void 0?void 0:o.next)===null||s===void 0||s.call(o,t)},n.prototype.error=function(t){var o,s;(s=(o=this.destination)===null||o===void 0?void 0:o.error)===null||s===void 0||s.call(o,t)},n.prototype.complete=function(){var t,o;(o=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||o===void 0||o.call(t)},n.prototype._subscribe=function(t){var o,s;return(s=(o=this.source)===null||o===void 0?void 0:o.subscribe(t))!==null&&s!==void 0?s:gt},n}(F),Rt=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function Dt(e){return I(e==null?void 0:e.then)}function xt(e){return I(e[we])}function It(e){return Symbol.asyncIterator&&I(e==null?void 0:e[Symbol.asyncIterator])}function kt(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function er(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Ct=er();function Mt(e){return I(e==null?void 0:e[Ct])}function Nt(e){return Tn(this,arguments,function(){var t,o,s,a;return vt(this,function(c){switch(c.label){case 0:t=e.getReader(),c.label=1;case 1:c.trys.push([1,,9,10]),c.label=2;case 2:return[4,V(t.read())];case 3:return o=c.sent(),s=o.value,a=o.done,a?[4,V(void 0)]:[3,5];case 4:return[2,c.sent()];case 5:return[4,V(s)];case 6:return[4,c.sent()];case 7:return c.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function Qt(e){return I(e==null?void 0:e.getReader)}function De(e){if(e instanceof N)return e;if(e!=null){if(xt(e))return tr(e);if(Rt(e))return nr(e);if(Dt(e))return rr(e);if(It(e))return Ot(e);if(Mt(e))return or(e);if(Qt(e))return sr(e)}throw kt(e)}function tr(e){return new N(function(n){var t=e[we]();if(I(t.subscribe))return t.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function nr(e){return new N(function(n){for(var t=0;t<e.length&&!n.closed;t++)n.next(e[t]);n.complete()})}function rr(e){return new N(function(n){e.then(function(t){n.closed||(n.next(t),n.complete())},function(t){return n.error(t)}).then(null,Et)})}function or(e){return new N(function(n){var t,o;try{for(var s=A(e),a=s.next();!a.done;a=s.next()){var c=a.value;if(n.next(c),n.closed)return}}catch(m){t={error:m}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(t)throw t.error}}n.complete()})}function Ot(e){return new N(function(n){ar(e,n).catch(function(t){return n.error(t)})})}function sr(e){return Ot(Nt(e))}function ar(e,n){var t,o,s,a;return jn(this,void 0,void 0,function(){var c,m;return vt(this,function(v){switch(v.label){case 0:v.trys.push([0,5,6,11]),t=Vn(e),v.label=1;case 1:return[4,t.next()];case 2:if(o=v.sent(),!!o.done)return[3,4];if(c=o.value,n.next(c),n.closed)return[2];v.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return m=v.sent(),s={error:m},[3,11];case 6:return v.trys.push([6,,9,10]),o&&!o.done&&(a=t.return)?[4,a.call(t)]:[3,8];case 7:v.sent(),v.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return n.complete(),[2]}})})}function U(e,n,t,o,s){o===void 0&&(o=0),s===void 0&&(s=!1);var a=n.schedule(function(){t(),s?e.add(this.schedule(null,o)):this.unsubscribe()},o);if(e.add(a),!s)return a}function _t(e,n){return n===void 0&&(n=0),Re(function(t,o){t.subscribe(wt(o,function(s){return U(o,e,function(){return o.next(s)},n)},function(){return U(o,e,function(){return o.complete()},n)},function(s){return U(o,e,function(){return o.error(s)},n)}))})}function $t(e,n){return n===void 0&&(n=0),Re(function(t,o){o.add(e.schedule(function(){return t.subscribe(o)},n))})}function ir(e,n){return De(e).pipe($t(n),_t(n))}function cr(e,n){return De(e).pipe($t(n),_t(n))}function ur(e,n){return new N(function(t){var o=0;return n.schedule(function(){o===e.length?t.complete():(t.next(e[o++]),t.closed||this.schedule())})})}function fr(e,n){return new N(function(t){var o;return U(t,n,function(){o=e[Ct](),U(t,n,function(){var s,a,c;try{s=o.next(),a=s.value,c=s.done}catch(m){t.error(m);return}c?t.complete():t.next(a)},0,!0)}),function(){return I(o==null?void 0:o.return)&&o.return()}})}function Pt(e,n){if(!e)throw new Error("Iterable cannot be null");return new N(function(t){U(t,n,function(){var o=e[Symbol.asyncIterator]();U(t,n,function(){o.next().then(function(s){s.done?t.complete():t.next(s.value)})},0,!0)})})}function lr(e,n){return Pt(Nt(e),n)}function dr(e,n){if(e!=null){if(xt(e))return ir(e,n);if(Rt(e))return ur(e,n);if(Dt(e))return cr(e,n);if(It(e))return Pt(e,n);if(Mt(e))return fr(e,n);if(Qt(e))return lr(e,n)}throw kt(e)}function mr(e,n){return n?dr(e,n):De(e)}function pr(e,n){return Re(function(t,o){var s=0;t.subscribe(wt(o,function(a){o.next(e.call(n,a,s++))}))})}const x={DomainCreated:"Domain::Created",DomainDiscarded:"Domain::Discarded",DomainReused:"Domain::Reused",StateCreated:"State::Created",StateUpdated:"State::Updated",StateDiscarded:"State::Discarded",StateReused:"State::Reused",EntityCreated:"Entity::Created",EntityUpdated:"Entity::Updated",EntityDiscarded:"Entity::Discarded",EntityReused:"Entity::Reused",QueryCreated:"Query::Created",QueryUpdated:"Query::Updated",QueryDiscarded:"Query::Discarded",QueryReused:"Query::Reused",EventEmitted:"Event::Emitted",CommandReceived:"Command::Received"},$=ge({name:"RemeshInspectorDomain",impl:e=>{const n=e.event({name:"RemeshDomainStorageEvent"}),t=e.event({name:"RemeshStateStorageEvent"}),o=e.event({name:"RemeshQueryStorageEvent"}),s=e.event({name:"RemeshEventEmittedEvent"}),a=e.event({name:"RemeshCommandReceivedEvent"}),c=e.event({name:"RemeshEntityStorageEvent"});return{event:{RemeshDomainStorageEvent:n,RemeshStateStorageEvent:t,RemeshQueryStorageEvent:o,RemeshEventEmittedEvent:s,RemeshCommandReceivedEvent:a,RemeshEntityStorageEvent:c}}}}),T=e=>e.owner?e.owner.Domain.inspectable&&e.inspectable:e.inspectable,yr=e=>{var n;return((n=e.inspectors)!=null?n:[]).filter(t=>!!t).map(t=>{const a=e,{inspectors:o}=a,s=et(a,["inspectors"]);return t(s)})},hr=e=>{let n=null;const t=()=>(n||(n=yr(e)),n);return{destroyInspectors:()=>{if(n){for(const f of n)f.discard();n=null}},inspectDomainStorage:(f,l)=>{if(T(l.Domain))for(const y of t()){const b=y.getDomain($());y.send(b.event.RemeshDomainStorageEvent({type:f,storage:l}))}},inspectStateStorage:(f,l)=>{if(T(l.State))for(const y of t()){const b=y.getDomain($());y.send(b.event.RemeshStateStorageEvent({type:f,storage:l}))}},inspectQueryStorage:(f,l)=>{if(T(l.Query))for(const y of t()){const b=y.getDomain($());y.send(b.event.RemeshQueryStorageEvent({type:f,storage:l}))}},inspectEntityStorage:(f,l)=>{if(T(l.Entity))for(const y of t()){const b=y.getDomain($());y.send(b.event.RemeshEntityStorageEvent({type:f,storage:l}))}},inspectEventEmitted:(f,l)=>{if(T(l.Event))for(const y of t()){const b=y.getDomain($());y.send(b.event.RemeshEventEmittedEvent({type:f,action:l}))}},inspectCommandReceived:(f,l)=>{if(T(l.Command))for(const y of t()){const b=y.getDomain($());y.send(b.event.RemeshCommandReceivedEvent({type:f,action:l}))}}}};let P=0;const Ut=e=>{const n=D({},e),t=hr(n),o=new Set,s=new Set,a=new Set,c=new Map,m=new WeakMap,v=r=>{var i;for(const u of(i=n.externs)!=null?i:[])if(u.Extern===r)return u.value;return r.default},d=r=>{const i=m.get(r);if(i)return i;const u=v(r),p={id:P++,type:"RemeshExternStorage",Extern:r,currentValue:u};return m.set(r,p),p},f=r=>d(r).currentValue,l=new WeakMap,y=r=>{var h;const i=l.get(r);if(i)return i;const u=r.State.stateName,p=`State/${r.State.stateId}/${u}:${(h=r.key)!=null?h:""}`;return l.set(r,p),p},b=r=>{var w;const i=l.get(r);if(i)return i;const u=r.Query.queryName,p=(w=JSON.stringify(r.arg))!=null?w:"",h=`Query/${r.Query.queryId}/${u}:${p}`;return l.set(r,h),h},O=r=>{var w;const i=l.get(r);if(i)return i;const u=r.Domain.domainName,p=(w=JSON.stringify(r.arg))!=null?w:"",h=`Domain/${r.Domain.domainId}/${u}:${p}`;return l.set(r,h),h},k=r=>{const i=l.get(r);if(i)return i;const u=r.Entity.entityName,p=`Entity/${r.Entity.entityId}/${u}:${r.key}`;return l.set(r,p),p},oe=r=>r.type==="RemeshStateItem"?y(r):r.type==="RemeshQueryAction"?b(r):r.type==="RemeshEntityItem"?k(r):O(r),xe=new WeakMap,Ie=r=>typeof r.default=="function"?r.default():r.default,Wt=r=>{const i=E(r.State.owner),u=y(r),p=Ie(r.State),h={id:P++,type:"RemeshStateStorage",State:r.State,key:u,currentState:p,downstreamSet:new Set};return i.stateMap.set(u,h),xe.set(r,h),t.inspectStateStorage(x.StateCreated,h),h},ke=r=>{const i=E(r.State.owner);i.stateMap.has(r.key)||(r.currentState=Ie(r.State),i.stateMap.set(r.key,r),t.inspectStateStorage(x.StateReused,r))},Y=r=>{const i=E(r.State.owner),u=y(r),p=i.stateMap.get(u);if(p)return p;const h=xe.get(r);return h?(ke(h),h):Wt(r)},Ce=new WeakMap,Me=new WeakMap,Ft=r=>{if(!Me.get(r)&&(Me.set(r,!0),r.injectEntities))for(const i of r.injectEntities)Ge(r(r.key(i)),i)},Kt=r=>{const i=E(r.Entity.owner),u=oe(r),p={id:P++,type:"RemeshEntityStorage",Entity:r.Entity,key:u,currentEntity:null,downstreamSet:new Set};return i.entityMap.set(u,p),Ce.set(r,p),Ft(r.Entity),t.inspectEntityStorage(x.EntityCreated,p),p},Ne=r=>{const i=E(r.Entity.owner);i.entityMap.has(r.key)||(r.currentEntity=null,i.entityMap.set(r.key,r),t.inspectEntityStorage(x.EntityReused,r))},H=r=>{const i=E(r.Entity.owner),u=oe(r),p=i.entityMap.get(u);if(p)return p;const h=Ce.get(r);return h?(Ne(h),h):Kt(r)},Qe=new WeakMap,zt=r=>{const i=E(r.owner),u={get:R.get},p=new F,h=p.pipe(pr(g=>r.impl?r.impl(u,g):g)),w=Qe.get(r),S=Object.assign(w!=null?w:{},{id:P++,type:"RemeshEventStorage",Event:r,subject:p,observable:h,refCount:0});return i.eventMap.set(r,S),Qe.set(r,S),S},G=r=>{var p;return(p=E(r.owner).eventMap.get(r))!=null?p:zt(r)},Oe=new WeakMap,Yt=r=>{const i=E(r.Query.owner),u=b(r),p=new F,h=p.asObservable(),w=new Set,S={id:P++,type:"RemeshQueryStorage",Query:r.Query,arg:r.arg,key:u,upstreamSet:w,downstreamSet:new Set,subject:p,observable:h,refCount:0,status:"default",wipUpstreamSet:new Set},{Query:g}=r,En={get:Q=>{if(S.upstreamSet!==w)return R.get(Q);if(Q.type==="RemeshStateItem"){const _=Y(Q);return S.upstreamSet.add(_),_.downstreamSet.add(S),R.get(Q)}if(Q.type==="RemeshEntityItem"){const _=H(Q);return S.upstreamSet.add(_),_.downstreamSet.add(S),R.get(Q)}if(Q.type==="RemeshQueryAction"){const _=W(Q);return S.upstreamSet.add(_),_.downstreamSet.add(S),R.get(Q)}return R.get(Q)}},wn=g.impl(En,r.arg);return S.currentValue=wn,i.queryMap.set(u,S),Oe.set(r,S),t.inspectQueryStorage(x.QueryCreated,S),S},_e=r=>{const i=E(r.Query.owner);if(i.queryMap.has(r.key))return;const u=new F,p=u.asObservable();r.status="default",r.subject=u,r.observable=p,i.queryMap.set(r.key,r);for(const h of r.upstreamSet)if(h.downstreamSet.add(r),h.type==="RemeshQueryStorage")_e(h);else if(h.type==="RemeshEntityStorage")Ne(h);else if(h.type==="RemeshStateStorage")ke(h);else throw new Error(`Unknown upstream: ${h}`);Fe(r),t.inspectQueryStorage(x.QueryReused,r)},W=r=>{const i=E(r.Query.owner),u=b(r),p=i.queryMap.get(u);if(p)return p;const h=Oe.get(r);return h?(_e(h),h):Yt(r)},Ht=r=>{const i=E(r.owner),u=new F,p=u.asObservable(),h={id:P++,type:"RemeshCommandStorage",Command:r,subject:u,observable:p};return i.commandMap.set(r,h),h},$e=r=>{const i=E(r.owner);return i.commandMap.has(r)?i.commandMap.get(r):Ht(r)},Pe=new WeakMap,Gt=r=>{const i=O(r),u=new Set,p={state:S=>{const g=dt(S);return g.owner=r,g},entity:S=>{const g=mt(S);return g.owner=r,g},query:S=>{const g=pt(S);return g.owner=r,g},event:S=>{const g=ft(S);return g.owner=r,g},command:S=>{const g=yt(S);return g.owner=r,g},effect:S=>{h.ignited||h.effectList.push(S)},preload:S=>{h.ignited||h.preloadOptionsList.push(S)},getDomain:S=>{const g=E(S);return u.add(g),g.downstreamSet.add(h),h.ignited&&fe(S),g.domain},getExtern:S=>f(S)},h={id:P++,type:"RemeshDomainStorage",Domain:r.Domain,get domain(){return w},arg:r.arg,domainContext:p,domainAction:r,key:i,upstreamSet:u,downstreamSet:new Set,effectList:[],stateMap:new Map,entityMap:new Map,queryMap:new Map,eventMap:new Map,effectMap:new Map,commandMap:new Map,preloadOptionsList:[],preloadedState:{},ignited:!1,hasBeenPreloaded:!1,isDiscarding:!1},w=ht(r.Domain.impl(p,r.arg));return c.set(i,h),Pe.set(r,h),t.inspectDomainStorage(x.DomainCreated,h),qt(h),h},qt=r=>{if(!(e!=null&&e.preloadedState))return;const i={get:R.get};for(const u of r.preloadOptionsList)if(Object.prototype.hasOwnProperty.call(e.preloadedState,u.key)){const p=e.preloadedState[u.key];j(u.command(i,p))}},E=r=>{const i=O(r),u=c.get(i);if(u)return u;const p=Pe.get(r);if(p){p.ignited=!1,p.isDiscarding=!1,c.set(p.key,p);for(const h of p.upstreamSet)h.downstreamSet.add(p);return t.inspectDomainStorage(x.DomainReused,p),p}return Gt(r)},Ue=r=>{const i=E(r.Query.owner);if(!!i.queryMap.has(r.key)){i.queryMap.delete(r.key),r.subject.complete(),t.inspectQueryStorage(x.QueryDiscarded,r);for(const u of r.upstreamSet)!u.downstreamSet.has(r)||(u.downstreamSet.delete(r),u.type==="RemeshQueryStorage"?se(u):u.type==="RemeshEntityStorage"?Ve(u):Te(u));ie(i)}},Jt=r=>!(r.refCount>0||r.downstreamSet.size!==0),se=r=>{Jt(r)&&Ue(r)},je=r=>{const i=E(r.State.owner);!i.stateMap.has(r.key)||(i.stateMap.delete(r.key),r.downstreamSet.clear(),t.inspectStateStorage(x.StateDiscarded,r))},Xt=r=>r.downstreamSet.size===0,Te=r=>{Xt(r)&&je(r)},Bt=r=>r.downstreamSet.size===0,Ve=r=>{Bt(r)&&Ae(r)},Ae=r=>{const i=E(r.Entity.owner);!i.entityMap.has(r.key)||(i.entityMap.delete(r.key),r.downstreamSet.clear(),r.currentEntity=null,t.inspectEntityStorage(x.EntityDiscarded,r))},Le=r=>{const i=E(r.Event.owner);r.subject.complete(),i.eventMap.delete(r.Event),ie(i)},Zt=r=>!(r.refCount>0),en=r=>{Zt(r)&&Le(r)},ae=r=>{if(!r.isDiscarding){r.isDiscarding=!0,r.ignited=!1;for(const i of r.effectMap.values())i.unsubscribe();for(const i of r.eventMap.values())Le(i);for(const i of r.queryMap.values())Ue(i);for(const i of r.stateMap.values())je(i);for(const i of r.entityMap.values())Ae(i);r.downstreamSet.clear(),r.stateMap.clear(),r.queryMap.clear(),r.eventMap.clear(),r.effectMap.clear(),r.commandMap.clear(),c.delete(r.key),t.inspectDomainStorage(x.DomainDiscarded,r);for(const i of r.upstreamSet)!i.downstreamSet.has(r)||(i.downstreamSet.delete(r),ie(i))}},tn=r=>{if(r.isDiscarding||r.downstreamSet.size!==0)return!1;for(const i of r.queryMap.values())if(i.refCount>0)return!1;for(const i of r.eventMap.values())if(i.refCount>0)return!1;return!0},ie=r=>{tn(r)&&ae(r)},nn=r=>Y(r).currentState,We=r=>{const i=W(r);return ce(i),i.currentValue},rn=r=>{const i=H(r);if(i.currentEntity===null)throw new Error(`The ${i.key} of ${r.Entity.entityName} is not created yet.`);return i.currentEntity},R={get:r=>{if(r.type==="RemeshStateItem")return nn(r);if(r.type==="RemeshQueryAction")return We(r);if(r.type==="RemeshEntityItem")return rn(r);throw new Error(`Unexpected input in ctx.get(..): ${r}`)},fromEvent:r=>{if(r.type==="RemeshEvent")return G(r).observable;if(r.type==="RemeshSubscribeOnlyEvent"){const i=st(r);return G(i).observable}throw new Error(`Unexpected input in fromEvent(..): ${r}`)},fromQuery:r=>W(r).observable,fromCommand:r=>$e(r).observable},ce=r=>{if(r.status!=="wip")return;if(r.wipUpstreamSet.size!==0){let u=!1;for(const p of r.wipUpstreamSet)if(p.type==="RemeshStateStorage")u=!0;else if(p.type==="RemeshEntityStorage")u=!0;else if(p.type==="RemeshQueryStorage")p.status==="wip"&&ce(p),p.status==="updated"&&(u=!0);else throw new Error(`Unexpected upstream: ${p}`);if(r.wipUpstreamSet.clear(),!u){r.status="default";return}}Fe(r)?r.status="updated":r.status="default"},Fe=r=>{const{Query:i}=r;for(const S of r.upstreamSet)!S.downstreamSet.has(r)||(S.downstreamSet.delete(r),S.downstreamSet.size===0&&a.add(S));const u=new Set;r.upstreamSet=u;const p={get:S=>{if(r.upstreamSet!==u)return R.get(S);if(S.type==="RemeshStateItem"){const g=Y(S);return r.upstreamSet.add(g),g.downstreamSet.add(r),R.get(S)}if(S.type==="RemeshEntityItem"){const g=H(S);return r.upstreamSet.add(g),g.downstreamSet.add(r),R.get(S)}if(S.type==="RemeshQueryAction"){const g=W(S);return r.upstreamSet.add(g),g.downstreamSet.add(r),R.get(S)}return R.get(S)}},h=i.impl(p,r.arg);return i.compare(r.currentValue,h)?!1:(r.currentValue=h,o.add(r),t.inspectQueryStorage(x.QueryUpdated,r),!0)},Ke=()=>{if(a.size===0)return;const r=[...a];a.clear();for(const i of r)i.type==="RemeshQueryStorage"?se(i):i.type==="RemeshStateStorage"?Te(i):Ve(i);Ke()},ze=()=>{if(o.size===0)return;const r=[...o];o.clear();for(const i of r)o.has(i)||(i.type==="RemeshQueryStorage"?i.subject.next(i.currentValue):i.type==="RemeshEventAction"?sn(i):i.type==="RemeshCommandAction"&&$e(i.Command).subject.next(i.arg));ze()},ue=r=>{if(r.status="wip",r.downstreamSet.size>0)for(const i of r.downstreamSet)i.wipUpstreamSet.has(r)||(i.wipUpstreamSet.add(r),ue(i));else s.add(r)},Ye=()=>{if(s.size===0)return;const r=[...s];s.clear();for(const i of r)ce(i);Ye()},He=()=>{Ye(),Ke(),ze()},on=(r,i)=>{const u=Y(r);if(!r.State.compare(u.currentState,i)){u.currentState=i,t.inspectStateStorage(x.StateUpdated,u);for(const h of u.downstreamSet)h.wipUpstreamSet.add(u),ue(h)}},Ge=(r,i)=>{const u=H(r),h=r.Entity.key(i);if(h!==r.key)throw new Error(`Entity key mismatch: ${r.key} !== ${h}`);if(u.currentEntity===null){u.currentEntity=i;return}if(!r.Entity.compare(u.currentEntity,i)){u.currentEntity=i,t.inspectEntityStorage(x.EntityUpdated,u);for(const S of u.downstreamSet)S.wipUpstreamSet.add(u),ue(S)}},sn=r=>{const{Event:i,arg:u}=r,p=G(i);t.inspectEventEmitted(x.EventEmitted,r),p.subject.next(u)},an={get:R.get},cn=r=>{t.inspectCommandReceived(x.CommandReceived,r);const{Command:i,arg:u}=r,p=i.impl;o.add(r),j(p(an,u))},j=r=>{if(!!r)if(Array.isArray(r))for(const i of r)j(i);else r.type==="RemeshCommandAction"?cn(r):r.type==="RemeshStateItemUpdatePayload"?on(r.stateItem,r.value):r.type==="RemeshEntityItemUpdatePayload"?Ge(r.entityItem,r.value):r.type==="RemeshEventAction"&&o.add(r)},un=(r,i)=>{const u=W(r),p=new N(h=>{const w=u.subject.subscribe(h);return u.refCount+=1,()=>{u.refCount-=1,w.unsubscribe(),u.refCount===0&&se(u)}});return p.subscribe(i)},qe=(r,i)=>{if(r.type==="RemeshEvent"){const u=G(r);return new N(w=>{const S=u.observable.subscribe(w);return u.refCount+=1,()=>{u.refCount-=1,S.unsubscribe(),u.refCount===0&&en(u)}}).subscribe(i)}else if(r.type==="RemeshSubscribeOnlyEvent"){const u=st(r);return qe(u,i)}throw new Error(`Unknown event type of ${r}`)},fn=r=>E(r).domain,ln={get:R.get,fromEvent:R.fromEvent,fromQuery:R.fromQuery,fromCommand:R.fromCommand},dn=r=>{j(r),He()},fe=r=>{const i=E(r);if(!i.ignited){i.ignited=!0;for(const u of i.upstreamSet)fe(u.domainAction);for(const u of i.effectList){const p=mr(u.impl(ln)).subscribe(dn);i.effectMap.set(u,p)}}},mn=r=>{const i=E(r);ae(i)},pn=()=>{t.destroyInspectors();for(const r of c.values())ae(r);c.clear(),o.clear()},Je=r=>{const i=E(r);if(i.ignited)throw new Error(`Domain ${r.Domain.domainName} was ignited before preloading`);if(i.preloadedPromise)return i.preloadedPromise;const u=vn(r);return i.preloadedPromise=u,u},yn={get:R.get},hn={get:R.get},vn=async r=>{const i=E(r);i.hasBeenPreloaded||(i.hasBeenPreloaded=!0,await Promise.all(Array.from(i.upstreamSet).map(u=>Je(u.domainAction))),await Promise.all(i.preloadOptionsList.map(async u=>{const p=await u.query(hn);if(Object.prototype.hasOwnProperty.call(i.preloadedState,u.key))throw new Error(`Duplicate key ${u.key}`);i.preloadedState[u.key]=p;const h=u.command(yn,p);j(h)})))},Sn=()=>{const r={};for(const i of c.values())Object.assign(r,i.preloadedState);return r},gn=r=>E(r).preloadedState,bn=r=>{j(r),He()};return{name:n.name,getDomain:fn,igniteDomain:fe,discardDomain:mn,query:We,send:bn,discard:pn,preload:Je,getPreloadedState:Sn,getDomainPreloadedState:gn,subscribeQuery:un,subscribeEvent:qe,getKey:oe}},jt={domain:ge,extern:$n,store:Ut,state:dt,entity:mt,query:pt,command:yt,event:ft,module:Pn};var Tt={exports:{}},Vt={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var L=C.exports;function vr(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var Sr=typeof Object.is=="function"?Object.is:vr,gr=L.useState,br=L.useEffect,Er=L.useLayoutEffect,wr=L.useDebugValue;function Rr(e,n){var t=n(),o=gr({inst:{value:t,getSnapshot:n}}),s=o[0].inst,a=o[1];return Er(function(){s.value=t,s.getSnapshot=n,pe(s)&&a({inst:s})},[e,t,n]),br(function(){return pe(s)&&a({inst:s}),e(function(){pe(s)&&a({inst:s})})},[e]),wr(t),t}function pe(e){var n=e.getSnapshot;e=e.value;try{var t=n();return!Sr(e,t)}catch{return!0}}function Dr(e,n){return n()}var xr=typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"?Dr:Rr;Vt.useSyncExternalStore=L.useSyncExternalStore!==void 0?L.useSyncExternalStore:xr;Tt.exports=Vt;const At=C.exports.createContext(null),Ir=()=>{const e=C.exports.useContext(At);if(e===null)throw new Error("You may forget to add <RemeshRoot />");return e},re=()=>Ir().remeshStore,_r=e=>{const n=C.exports.useRef(e.store);n.current||(n.current=Ut("options"in e?e.options:{}));const t=n.current,o=C.exports.useMemo(()=>({remeshStore:t}),[t]);return In(At.Provider,{value:o,children:e.children})},$r=function(e){const n=re(),t=C.exports.useRef(null),o=C.exports.useCallback(v=>(t.current=v,()=>{t.current=null}),[]),s=C.exports.useCallback(()=>n.query(e),[n,e]),a=Tt.exports.useSyncExternalStore(o,s,s),c=C.exports.useRef(null),m=n.getKey(e);return C.exports.useEffect(()=>()=>{var v;(v=c.current)==null||v.unsubscribe(),c.current=null},[n,m]),C.exports.useEffect(()=>{c.current===null&&(c.current=n.subscribeQuery(e,()=>{var v;(v=t.current)==null||v.call(t)}))},[n,e]),a},Pr=function(e,n){const t=re(),o=C.exports.useRef(n);C.exports.useEffect(()=>{o.current=n}),C.exports.useEffect(()=>{const s=t.subscribeEvent(e,a=>{o.current(a)});return()=>{s.unsubscribe()}},[e,t])},Ur=function(){return re().send},jr=function(e){const n=re(),t=n.getDomain(e);return C.exports.useEffect(()=>{n.igniteDomain(e)},[n,e]),t},kr=e=>{const n=e.getHours().toString().padStart(2,"0"),t=e.getMinutes().toString().padStart(2,"0"),o=e.getSeconds().toString().padStart(2,"0"),s=e.getMilliseconds().toString().padStart(3,"0");return`${n}:${t}:${o}.${s}`},Cr=()=>{const e=new Date;return kr(e)},Lt=e=>{const n=D({include:["state","domain","query","event","command","entity"]},e);return{onActive:(o,s)=>{var a;(a=n.exclude)!=null&&a.includes(o)||(n.include?n.include.includes(o)&&s():s())}}},Mr=()=>{if(typeof window!="undefined")return window.__REDUX_DEVTOOLS_EXTENSION__},Tr=e=>{const n=Mr();if(!!n)return t=>{var d;const o=Lt(e),s=n.connect({name:t==null?void 0:t.name,features:{pause:!1,lock:!1,persist:!1,export:!1,import:!1,jump:!1,skip:!1,reorder:!1,dispatch:!1,test:!1}}),a=(f,l)=>{s.send(l,null)},c=jt.store({name:`RemeshReduxDevtools(${(d=t==null?void 0:t.name)!=null?d:""})`}),m=c.getDomain($()),v=f=>{const l={domainId:f.Domain.domainId,domainName:f.Domain.domainName};return f.arg!==void 0?M(D({},l),{domainArg:f.arg}):l};return o.onActive("domain",()=>{c.subscribeEvent(m.event.RemeshDomainStorageEvent,f=>{const l=f.storage.Domain,y={type:`${f.type}::${l.domainName}`,domainId:l.domainId,domainName:l.domainName};f.storage.arg!==void 0?a(y.type,M(D({},y),{domainArg:f.storage.arg})):a(y.type,y)})}),o.onActive("state",()=>{c.subscribeEvent(m.event.RemeshStateStorageEvent,f=>{const l=f.storage.State,y={type:`${f.type}::${l.stateName}`,owner:v(l.owner),stateId:l.stateId,stateName:l.stateName,stateValue:f.storage.currentState};f.storage.key!==void 0?a(y.type,M(D({},y),{stateArg:f.storage.key})):a(y.type,y)})}),o.onActive("entity",()=>{c.subscribeEvent(m.event.RemeshEntityStorageEvent,f=>{const l=f.storage.Entity,y={type:`${f.type}::${l.entityName}`,owner:v(l.owner),entityId:l.entityId,entityName:l.entityName,entityValue:f.storage.currentEntity,entityKey:f.storage.key};a(y.type,y)})}),o.onActive("query",()=>{c.subscribeEvent(m.event.RemeshQueryStorageEvent,f=>{const l=f.storage.Query,y={type:`${f.type}::${l.queryName}`,owner:v(l.owner),queryId:l.queryId,queryName:l.queryName};f.storage.arg!==void 0?a(y.type,M(D({},y),{queryArg:f.storage.arg})):a(y.type,y)})}),o.onActive("command",()=>{c.subscribeEvent(m.event.RemeshCommandReceivedEvent,f=>{const l=f.action.Command,y={type:`${f.type}::${l.commandName}`,owner:v(l.owner),commandId:l.commandId,commandName:l.commandName};f.action.arg!==void 0?a(y.type,M(D({},y),{commandArg:f.action.arg})):a(y.type,y)})}),o.onActive("event",()=>{c.subscribeEvent(m.event.RemeshEventEmittedEvent,f=>{const l=f.action.Event,y={type:`${f.type}::${l.eventName}`,owner:v(l.owner),eventId:l.eventId,eventName:l.eventName};f.action.arg!==void 0?a(y.type,M(D({},y),{eventArg:f.action.arg})):a(y.type,y)})}),c}},Nr={domain:"#bfb1cc",event:"#aec6d4",state:"#adc7af",entity:"#d9bdc5",query:"#d6c9ad",command:"#debdb6"},Vr=e=>n=>{var v;const t=D({collapsed:!0,colors:Nr},e),o=Lt(t),s=(d,f,l)=>{t.collapsed&&console.groupCollapsed(`%c${d}%c @ ${Cr()}`,`background-color:${l}; color: #000; font-weight: bold`,"color:#9E9E9E; font-weight: lighter"),console.log(f),t.collapsed&&console.groupEnd()},a=jt.store(M(D({},n),{name:`RemeshLogger(${(v=n==null?void 0:n.name)!=null?v:""})`})),c=a.getDomain($()),m=d=>{const f={domainId:d.Domain.domainId,domainName:d.Domain.domainName};return d.arg!==void 0?M(D({},f),{domainArg:d.arg}):f};return o.onActive("domain",()=>{a.subscribeEvent(c.event.RemeshDomainStorageEvent,d=>{const f=d.storage.Domain,l={type:`${d.type}::${f.domainName}`,domainId:f.domainId,domainName:f.domainName};d.storage.arg!==void 0?s(l.type,M(D({},l),{domainArg:d.storage.arg}),t.colors.domain):s(l.type,l,t.colors.domain)})}),o.onActive("state",()=>{a.subscribeEvent(c.event.RemeshStateStorageEvent,d=>{const f=d.storage.State,l={type:`${d.type}::${f.stateName}`,owner:m(f.owner),stateId:f.stateId,stateName:f.stateName,stateValue:d.storage.currentState};d.storage.key!==void 0?s(l.type,M(D({},l),{stateKey:d.storage.key}),t.colors.state):s(l.type,l,t.colors.state)})}),o.onActive("entity",()=>{a.subscribeEvent(c.event.RemeshEntityStorageEvent,d=>{const f=d.storage.Entity,l={type:`${d.type}::${f.entityName}`,owner:m(f.owner),entityId:f.entityId,entityName:f.entityName,entityValue:d.storage.currentEntity,entityKey:d.storage.key};s(l.type,l,t.colors.entity)})}),o.onActive("query",()=>{a.subscribeEvent(c.event.RemeshQueryStorageEvent,d=>{const f=d.storage.Query,l={type:`${d.type}::${f.queryName}`,owner:m(f.owner),queryId:f.queryId,queryName:f.queryName,queryValue:d.storage.currentValue};d.storage.arg!==void 0?s(l.type,M(D({},l),{queryArg:d.storage.arg}),t.colors.query):s(l.type,l,t.colors.query)})}),o.onActive("command",()=>{a.subscribeEvent(c.event.RemeshCommandReceivedEvent,d=>{const f=d.action.Command,l={type:`${d.type}::${f.commandName}`,owner:m(f.owner),commandId:f.commandId,commandName:f.commandName};d.action.arg!==void 0?s(l.type,M(D({},l),{commandArg:d.action.arg}),t.colors.command):s(l.type,l,t.colors.command)})}),o.onActive("event",()=>{a.subscribeEvent(c.event.RemeshEventEmittedEvent,d=>{const f=d.action.Event,l={type:`${d.type}::${f.eventName}`,owner:m(f.owner),eventId:f.eventId,eventName:f.eventName};d.action.arg!==void 0?s(l.type,M(D({},l),{eventArg:d.action.arg}),t.colors.event):s(l.type,l,t.colors.event)})}),a};export{N as O,jt as R,te as S,Z as _,B as a,jr as b,wt as c,$r as d,Tr as e,Vr as f,_r as g,De as h,Hn as i,mr as j,I as k,U as l,pr as m,it as n,Re as o,z as p,he as q,Pr as r,Ur as u};
//# sourceMappingURL=remesh-logger.3c4497cd.js.map
