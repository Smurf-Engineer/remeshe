import{R as Y,r as k,a as v,j as F,c as $}from"./jsx-runtime.cdcfec5f.js";import{o as B,c as P,n as I,m as W,R as q,u as L,b as O,d as j,l as R,e as N}from"./remesh-react.c6a64ae5.js";import{R as T,a as _}from"./remesh-logger.5a236b29.js";import{t as X,a as J}from"./timer.a3344934.js";import{c as K}from"./concat.68de6303.js";import{t as M}from"./take.9754715c.js";import{m as U}from"./mergeMap.f387db2b.js";import"./isScheduler.4d136c1c.js";import"./mergeAll.aec81fd1.js";function Z(t,e){return B(function(n,o){var r=0;n.subscribe(P(o,function(c){return t.call(e,c,r++)&&o.next(c)}))})}function V(){return B(function(t,e){t.subscribe(P(e,I))})}function tt(t){return W(function(){return t})}function D(t,e){return e?function(n){return K(e.pipe(M(1),V()),n.pipe(D(t)))}:U(function(n,o){return t(n,o).pipe(M(1),tt(n))})}function et(t,e){e===void 0&&(e=J);var n=X(t,e);return D(function(){return n})}const g=Y.createContext({left:0,top:0,gridSize:60,chessSize:40}),nt=t=>{const{left:e,top:n,gridSize:o}=t,r=e+o/2,c=n+o/2,s=(i,a,u,y)=>`M${r+i*o},${c+a*o} L${r+u*o},${c+y*o}`,d=(i,a)=>{const u=[];let p,x,S,m;return i!=0&&(p=i-.1,x=a-.1-.25,S=i-.1-.25,m=a-.1,u.push(s(p,x,p,m)),u.push(s(p,m,S,m)),x=a+.1+.25,m=a+.1,u.push(s(p,x,p,m)),u.push(s(p,m,S,m))),i!=8&&(p=i+.1,x=a-.1-.25,S=i+.1+.25,m=a-.1,u.push(s(p,x,p,m)),u.push(s(p,m,S,m)),x=a+.1+.25,m=a+.1,u.push(s(p,x,p,m)),u.push(s(p,m,S,m))),u};return[[1,2],[7,2],[1,7],[7,7],[0,3],[2,3],[4,3],[6,3],[8,3],[0,6],[2,6],[4,6],[6,6],[8,6]].map(([i,a])=>d(i,a)).reduce((i,a)=>i.concat(a),[]).concat(new Array(8).fill(0).map((i,a)=>s(0,a+1,8,a+1))).concat(new Array(7).fill(0).map((i,a)=>s(a+1,0,a+1,4))).concat(new Array(7).fill(0).map((i,a)=>s(a+1,5,a+1,9))).concat([s(3,0,5,2),s(5,0,3,2),s(3,7,5,9),s(3,9,5,7)])},ot=()=>{const t=k.exports.useContext(g),{left:e,top:n,gridSize:o,chessSize:r}=t,c=e+o/2,s=n+o/2,d=o*8,l=o*9,i=nt(t),a={position:"absolute",left:0,top:0,width:d+r,height:l+r};return v("svg",{xmlns:"http://www.w3.org/2000/svg",style:a,children:F("g",{children:[v("rect",{x:c,y:s,width:d,height:l,fill:"none",stroke:"#000000",strokeWidth:"3"}),i.map((u,y)=>v("path",{fill:"none",stroke:"#000000",d:u},y))]})})};var f=(t=>(t[t.General=100]="General",t[t.Chariot=50]="Chariot",t[t.Cannon=30]="Cannon",t[t.Horse=29]="Horse",t[t.Elephant=16]="Elephant",t[t.Guard=10]="Guard",t[t.Soldier=1]="Soldier",t))(f||{}),C=(t=>(t[t.Red=1]="Red",t[t.Black=-1]="Black",t))(C||{});const rt=(t,e)=>t.x===e.x&&t.y===e.y,it=(t,{x:e,y:n})=>{switch(t){case-1:return!(e<3||e>5||n>2&&n<7);case 1:return!(e<3||e>5||n>2&&n<7)}},at=(t,{x:e,y:n})=>{switch(t){case-1:return[[3,0],[3,2],[5,0],[5,2],[4,1]].find(([o,r])=>o===e&&r===n);case 1:return[[3,7],[3,9],[5,7],[5,9],[4,8]].find(([o,r])=>o===e&&r===n)}},st=(t,{x:e,y:n})=>{switch(t){case-1:return[[0,2],[2,0],[2,4],[4,2],[6,0],[6,4],[8,2]].find(([o,r])=>o===e&&r===n);case 1:return[[0,7],[2,5],[2,9],[4,7],[6,5],[6,9],[8,7]].find(([o,r])=>o===e&&r===n)}},ct=(t,{x:e,y:n})=>{switch(t){case-1:return!(n<3||n<5&&e%2===1);case 1:return!(n>6||n>4&&e%2===1)}},ut=t=>({position:e},{x:n,y:o})=>{if(e.x!==n&&e.y!==o)return!1;if(t.situation.find(r=>r.position.x===n&&r.position.y===o)){if(e.y===o)return t.situation.filter(r=>r.position.y===o&&(r.position.x-n)*(r.position.x-e.x)<0).length===1;if(e.x===n)return t.situation.filter(r=>r.position.x===n&&(r.position.y-o)*(r.position.y-e.y)<0).length===1}return!1},lt=()=>({position:t},{x:e,y:n})=>Math.abs(t.y-n)+Math.abs(t.x-e)===1,dt=()=>({position:t},{x:e,y:n})=>{const o=r=>r*r;return o(t.x-e)+o(t.y-n)===2},pt=t=>({position:e},{x:n,y:o})=>Math.abs(e.x-n)!==2||Math.abs(e.y-o)!==2?!1:!t.situation.find(r=>r.position.x===(e.x+n)/2&&r.position.y===(e.y+o)/2),mt=t=>({position:e},{x:n,y:o})=>{const r=e.x-n,c=e.y-o;return r*r+c*c===5&&!t.situation.find(s=>s.position.x===Math.round((2*e.x+n)/3)&&s.position.y===Math.round((2*e.y+o)/3))},E=t=>({position:e},{x:n,y:o})=>e.x!==n&&e.y!==o?!1:e.y===o?!t.situation.find(r=>r.position.y===o&&(r.position.x-n)*(r.position.x-e.x)<0):e.x===n?!t.situation.find(r=>r.position.x===n&&(r.position.y-o)*(r.position.y-e.y)<0):!1,ft=()=>({position:t,color:e},{x:n,y:o})=>{switch(e){case-1:return o>=t.y&&Math.abs(n-t.x)+Math.abs(o-t.y)===1;case 1:return o<=t.y&&Math.abs(n-t.x)+Math.abs(o-t.y)===1}},G=t=>(e,n)=>{const{color:o,value:r}=e;switch(r){case 100:return it(o,n)&&lt()(e,n);case 10:return at(o,n)&&dt()(e,n);case 16:return st(o,n)&&pt(t)(e,n);case 29:return mt(t)(e,n);case 50:return E(t)(e,n);case 30:return E(t)(e,n);case 1:return ct(o,n)&&ft()(e,n)}},Q=t=>(e,n)=>e.color===n.color?!1:e.value===30?ut(t)(e,n.position):t.situation.find(o=>rt(o.position,n.position))&&G(t)(e,n.position),vt=t=>({...t,selected:!0}),w=t=>({...t,selected:!1}),yt=t=>({...t,marked:!0}),b=t=>({...t,marked:!1}),H=t=>e=>({...e,position:t}),xt=t=>e=>{const{currentPlayer:n,situation:o}=e,{x:r,y:c}=t;let s;const d=o.map(i=>b(w(i))).map(i=>i.position.x===r&&i.position.y===c?(s=vt(i),s):i).map(i=>Q(e)(s,i)?yt(i):i),l=new Array(90).fill(null).map((i,a)=>{const u=a%9,y=(a-u)/9;return{x:u,y}}).filter(i=>G(e)(s,i));return{currentPlayer:n,selectedChess:s,situation:d,markers:l}},ht=t=>e=>{const{currentPlayer:n,situation:o,selectedChess:r}=e;if(r&&G(e)(r,t)){const{x:c,y:s}=r.position,d=o.map(l=>l.position.x===c&&l.position.y===s?H(t)(l):l).map(l=>b(w(l)));return{currentPlayer:-n,selectedChess:void 0,situation:d,markers:[]}}return e},St=t=>e=>{const{currentPlayer:n,situation:o,selectedChess:r}=e,c=o.find(s=>s.position.x===t.x&&s.position.y===t.y);if(r&&c&&Q(e)(r,c)){const{x:s,y:d}=r.position,l=o.map(i=>i.position.x===s&&i.position.y===d?H(t)(i):i.position.x===t.x&&i.position.y===t.y?null:i).filter(i=>!!i).map(i=>b(w(i)));return{currentPlayer:-n,selectedChess:void 0,situation:l,markers:[]}}return e},Ct=t=>t.some(o=>o.color===1&&o.value===100)?t.some(o=>o.color===-1&&o.value===100)?"playing":"red-win":"black-win",kt=[{color:-1,value:50,position:{x:0,y:0}},{color:-1,value:29,position:{x:1,y:0}},{color:-1,value:16,position:{x:2,y:0}},{color:-1,value:10,position:{x:3,y:0}},{color:-1,value:100,position:{x:4,y:0}},{color:-1,value:10,position:{x:5,y:0}},{color:-1,value:16,position:{x:6,y:0}},{color:-1,value:29,position:{x:7,y:0}},{color:-1,value:50,position:{x:8,y:0}},{color:-1,value:30,position:{x:1,y:2}},{color:-1,value:30,position:{x:7,y:2}},{color:-1,value:1,position:{x:0,y:3}},{color:-1,value:1,position:{x:2,y:3}},{color:-1,value:1,position:{x:4,y:3}},{color:-1,value:1,position:{x:6,y:3}},{color:-1,value:1,position:{x:8,y:3}},{color:1,value:1,position:{x:0,y:6}},{color:1,value:1,position:{x:2,y:6}},{color:1,value:1,position:{x:4,y:6}},{color:1,value:1,position:{x:6,y:6}},{color:1,value:1,position:{x:8,y:6}},{color:1,value:30,position:{x:1,y:7}},{color:1,value:30,position:{x:7,y:7}},{color:1,value:50,position:{x:0,y:9}},{color:1,value:29,position:{x:1,y:9}},{color:1,value:16,position:{x:2,y:9}},{color:1,value:10,position:{x:3,y:9}},{color:1,value:100,position:{x:4,y:9}},{color:1,value:10,position:{x:5,y:9}},{color:1,value:16,position:{x:6,y:9}},{color:1,value:29,position:{x:7,y:9}},{color:1,value:50,position:{x:8,y:9}}],gt=q.domain({name:"GameDomain",impl:t=>{const e={currentPlayer:1,selectedChess:void 0,situation:kt,markers:[]},n=t.state({name:"GameState",default:e}),o=t.query({name:"GameQuery",impl:({get:a})=>a(n())}),r=t.query({name:"GameStatusQuery",impl:({get:a})=>{const{situation:u}=a(o());return Ct(u)}}),c=t.event({name:"GameOverEvent"}),s=t.event({name:"NotYourMoveEvent"}),d=t.command({name:"ResetGameStateCommand",impl:()=>n().new(e)}),l=t.command({name:"SelectChessCommand",impl({get:a},u){if(a(r())!=="playing")return c();const h=a(n()),{currentPlayer:p,selectedChess:x}=h;return u.color===p?[n().new(xt(u.position)(h))]:x?[n().new(St(u.position)(h))]:[s()]}}),i=t.command({name:"MoveChessCommand",impl({get:a},u){if(a(r())!=="playing")return c();const h=a(n()),{selectedChess:p}=h;return p?[n().new(ht(u)(h))]:[s()]}});return t.effect({name:"CheckGameStatusEffect",impl:({fromQuery:a})=>a(r()).pipe(Z(u=>u!=="playing"),et(100),W(()=>c()))}),{query:{GameQuery:o,GameStatusQuery:r},command:{SelectChessCommand:l,MoveChessCommand:i,ResetGameStateCommand:d},event:{NotYourMoveEvent:s,GameOverEvent:c}}}}),z=t=>({[C.Red]:"red",[C.Black]:"black"})[t],Gt=(t,e)=>({[C.Red]:{[f.General]:"\u5E05",[f.Guard]:"\u4ED5",[f.Elephant]:"\u76F8",[f.Horse]:"\u99AC",[f.Chariot]:"\u8ECA",[f.Cannon]:"\u70AE",[f.Soldier]:"\u5175"},[C.Black]:{[f.General]:"\u5C06",[f.Guard]:"\u58EB",[f.Elephant]:"\u8C61",[f.Horse]:"\u9A6C",[f.Chariot]:"\u8F66",[f.Cannon]:"\u7832",[f.Soldier]:"\u5352"}})[t][e],wt=t=>{const{chess:e,onClick:n}=t,{color:o,value:r,position:{x:c,y:s},selected:d,marked:l}=e,{chessSize:i,gridSize:a,left:u,top:y}=k.exports.useContext(g),h={position:"absolute",zIndex:10,backgroundColor:"white",fontSize:26,textAlign:"center",borderWidth:2,width:i,height:i,cursor:"pointer",left:u+c*a+(a-i)/2-2,top:y+s*a+(a-i)/2-2,borderStyle:d?"dashed":"solid",borderColor:l?"aqua":z(o),borderRadius:i/2+1,color:z(o)};return v("div",{onClick:()=>n(e),style:h,children:Gt(o,r)})},bt=t=>{const{marker:e,onClick:n}=t,{x:o,y:r}=e,{chessSize:c,gridSize:s,left:d,top:l}=k.exports.useContext(g),i={position:"absolute",borderWidth:2,borderStyle:"dashed",borderColor:"green",backgroundColor:"white",width:c/2,height:c/2,left:d+o*s+c/4+(s-c)/2-2,top:l+r*s+c/4+(s-c)/2-2};return v("div",{onClick:()=>n(e),style:i})},Rt=()=>{const t=L(),{left:e,top:n,gridSize:o}=k.exports.useContext(g),r=O(gt()),c=j(r.query.GameQuery());R(r.event.NotYourMoveEvent,()=>{alert("\u4E0D\u8BE5\u4F60\u8D70")}),R(r.event.GameOverEvent,()=>{window.confirm("\u6E38\u620F\u7ED3\u675F\uFF0C\u662F\u5426\u91CD\u65B0\u5F00\u59CB\uFF1F")&&t(r.command.ResetGameStateCommand())});const s={width:e+9*o,height:n+10*o},{situation:d,markers:l}=c;return F("div",{style:s,children:[v(ot,{}),d.map((i,a)=>v(wt,{chess:i,onClick:()=>t(r.command.SelectChessCommand(i))},a)),l.map((i,a)=>v(bt,{marker:i,onClick:()=>t(r.command.MoveChessCommand(i))},a))]})},A=document.getElementById("root");if(A){const t=$(A),e=q.store({inspectors:[T(),_({include:["command","query","event","domain","command$","state"]})]});t.render(v(k.exports.StrictMode,{children:v(N,{store:e,children:v(g.Provider,{value:{left:0,top:0,gridSize:60,chessSize:40},children:v(Rt,{})})})}))}
//# sourceMappingURL=index.536720fe.js.map
