var z=Object.defineProperty,G=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var S=(e,t,o)=>t in e?z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,p=(e,t)=>{for(var o in t||(t={}))X.call(t,o)&&S(e,o,t[o]);if($)for(var o of $(t))Y.call(t,o)&&S(e,o,t[o]);return e},L=(e,t)=>G(e,J(t));import{r as T,j as h,a as d,c as Z}from"./jsx-runtime.cbb87597.js";import{l as R,t as b,u as ee,N as k,H as te,R as oe,a as H}from"./localforage.86066fb8.js";import{R as q,j as ne,m as B,u as j,d as Q,w as se,f as de,g as ae,h as le}from"./remesh-logger.3b445c02.js";import{m as re}from"./merge.7a5186e6.js";import"./mergeAll.77155404.js";const ce=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,o=e=="x"?t:t&3|8;return o.toString(16)}),A="todo-mvc-data",E=()=>R.getItem(A).then(e=>e!=null?e:[]),me=q.extern({name:"TodoRepoExtern",default:{async getTodoList(){return E()},async addTodo(e){let t=await E();await R.setItem(A,t.concat(e))},async removeTodoByIds(e){let t=await E();await R.setItem(A,t.filter(o=>!e.includes(o.id)))},async updateTodo(e){let t=await E();await R.setItem(A,t.map(o=>o.id===e.id?p(p({},o),e):o))},async toggleCompletedByIds(e,t){let o=await E();await R.setItem(A,o.map(r=>e.includes(r.id)?L(p({},r),{completed:t}):r))}}}),F=q.domain({name:"TodoDomain",impl:e=>{const t=e.getExtern(me),o=e.state({name:"TodoList",default:[]}),r=e.query({name:"TodoListQuery",impl({get:s},n){const m=s(o());return n==="active"?m.filter(a=>!a.completed):n==="completed"?m.filter(a=>a.completed):m}}),u=e.query({name:"HasCompletedQuery",impl({get:s}){return s(r("completed")).length>0}}),g=e.query({name:"ActiveTodoCountQuery",impl({get:s}){return s(r("active")).length}}),x=e.query({name:"AllCompletedQuery",impl({get:s}){return s(g())===0&&s(r()).length>0}}),C=e.event({name:"addTodoEvent"}),w=e.command({name:"setTodoList",impl(s,n){return o().new(n)}}),v=e.event({name:"AddTodoFailedEvent"}),N=e.command({name:"addTodo",impl({get:s},n){if(n.trim()==="")return[v("Cannot be empty, please enter the TODO name")];const m=s(o()),a={id:ce(),name:n,completed:!1};return[o().new([a,...m]),C(a)]}}),f=e.event({name:"removeTodoEvent"}),i=e.command({name:"removeTodo",impl({get:s},n){const a=s(o()).filter(l=>l.id!==n);return[o().new(a),f([n])]}}),D=e.event({name:"TodoUpdatedEvent"}),U=e.command({name:"updateTodo",impl({get:s},n){const m=s(o());if(n.name&&n.name.trim()==="")return i(n.id);const a=m.map(c=>c.id===n.id?L(p(p({},c),n),{id:c.id}):c),l=a.find(c=>c.id===n.id);return l?[o().new(a),D(l)]:null}}),I=e.event({name:"TodoCompletedChangedEvent"}),V=e.command({name:"toggleTodoCompleted",impl({get:s},n){const a=s(o()).map(y=>y.id===n?L(p({},y),{completed:!y.completed}):y),l=a.find(y=>y.id===n);if(!l)return null;const c={ids:[n],completed:l==null?void 0:l.completed};return[o().new(a),I(c)]}}),W=e.command({name:"toggleAllTodoCompleted",impl({get:s},n){const m=s(o());if(m.length===0)return null;const a=m.map(l=>L(p({},l),{completed:n}));return[o().new(a),I({ids:a.map(l=>l.id),completed:n})]}}),_=e.command({name:"clearCompleted",impl({get:s}){const n=s(o()),m=n.filter(l=>!l.completed),a=n.filter(l=>l.completed).map(l=>l.id);return[o().new(m),f(a)]}});return e.command$({name:"fromRepoToState",impl(){return ne(t.getTodoList()).pipe(B(s=>w(s)))}}),e.command$({name:"fromStateToRepo",impl:({fromEvent:s})=>{const n=s(C).pipe(b(c=>t.addTodo(c))),m=s(f).pipe(b(c=>t.removeTodoByIds(c))),a=s(D).pipe(b(c=>t.updateTodo(c))),l=s(I).pipe(b(c=>t.toggleCompletedByIds(c.ids,c.completed)));return re(n,m,a,l).pipe(B(()=>null))}}),{query:{TodoListQuery:r,ActiveTodoCountQuery:g,HasCompletedQuery:u,AllCompletedQuery:x},command:{addTodo:N,removeTodo:i,toggleTodoCompleted:V,toggleAllTodoCompleted:W,updateTodo:U,clearCompleted:_},event:{AddTodoFailedEvent:v}}}});function M(e){const[t,o]=T.exports.useState(e),r=T.exports.useCallback(u=>{o(u.target.value)},[]);return[t,r,o]}function O(e,t){const o=T.exports.useRef(t),r=T.exports.useCallback(u=>{u.key.toLocaleLowerCase()===e.toLocaleLowerCase()&&(u.preventDefault(),o.current(u))},[e]);return T.exports.useEffect(()=>{o.current=t}),r}function ie({todo:e}){const t=j(F()),[o,r]=T.exports.useState(!1),u=T.exports.useRef(null),[g,x]=M(e.name),C=O("Enter",()=>{t.command.updateTodo(L(p({},e),{name:g})),r(!1)}),w=()=>{r(!0)},v=()=>{t.command.toggleTodoCompleted(e.id)},N=()=>{t.command.removeTodo(e.id)};return T.exports.useEffect(()=>{var f;o&&((f=u.current)==null||f.focus())},[o]),h("li",{onDoubleClick:w,className:`${o?"editing":""} ${e.completed?"completed":""}`,children:[h("div",{className:"view",children:[d("input",{type:"checkbox",className:"toggle",checked:e.completed,onChange:v}),d("label",{children:e.name}),d("button",{className:"destroy",onClick:N})]}),o&&d("input",{ref:u,className:"edit",value:g,onChange:x,onKeyPress:C,onBlur:()=>{r(!1)}})]})}const P=()=>{const{filter:e}=ee(),t=j(F()),o=Q(t.query.TodoListQuery(e)),r=Q(t.query.ActiveTodoCountQuery()),u=Q(t.query.HasCompletedQuery()),g=Q(t.query.AllCompletedQuery()),[x,C,w]=M(""),v=O("Enter",()=>{t.command.addTodo(x),w("")}),N=()=>{t.command.toggleAllTodoCompleted(!g)},f=()=>{t.command.clearCompleted()};return se(t.event.AddTodoFailedEvent,i=>{alert(i)}),console.log("render list"),h("div",{className:"todoapp",children:[h("header",{className:"header",children:[d("h1",{children:"todos"}),d("input",{className:"new-todo",placeholder:"What needs to be done?",value:x,onChange:C,onKeyDown:v})]}),h("section",{className:"main",children:[d("input",{id:"toggle-all",type:"checkbox",className:"toggle-all",checked:g,onChange:N}),d("label",{htmlFor:"toggle-all"}),d("ul",{className:"todo-list",children:o.map(i=>d(ie,{todo:i},i.id))})]}),h("footer",{className:"footer",children:[h("span",{className:"todo-count",children:[d("strong",{children:r})," items left"]}),h("ul",{className:"filters",children:[d("li",{children:d(k,{to:"/",className:i=>i.isActive?"selected":"",children:"All"})}),d("li",{children:d(k,{to:"/active",className:i=>i.isActive?"selected":"",children:"Active"})}),d("li",{children:d(k,{to:"/completed",className:i=>i.isActive?"selected":"",children:"Completed"})})]}),u&&d("button",{className:"clear-completed",onClick:f,children:"Clear completed"})]})]})},K=document.getElementById("root");if(K){const e=Z(K),t=q.store({inspectors:[de(),ae({include:["command","query","event","domain","command$","state"]})]});e.render(d(T.exports.StrictMode,{children:d(le,{store:t,children:d(te,{basename:"/",children:h(oe,{children:[d(H,{path:"/",element:d(P,{})}),d(H,{path:"/:filter",element:d(P,{})})]})})})}))}
//# sourceMappingURL=index.e6313f01.js.map
