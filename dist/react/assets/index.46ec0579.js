var Z=Object.defineProperty,ee=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var _=(e,t,o)=>t in e?Z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,w=(e,t)=>{for(var o in t||(t={}))oe.call(t,o)&&_(e,o,t[o]);if(k)for(var o of k(t))ne.call(t,o)&&_(e,o,t[o]);return e},S=(e,t)=>ee(e,te(t));import{j as h,a as r,r as g,F as se,c as ae}from"./jsx-runtime.cbb87597.js";import{l as q,t as re,u as de,N as F,H as le,R as ce,a as O}from"./localforage.86066fb8.js";import{R as C,j as me,m as N,u as x,d as y,w as ie,f as ue,g as pe,h as Te}from"./remesh-logger.3b445c02.js";import{f as H}from"./filter.b510e523.js";import{L as he}from"./list.8772fbed.js";const U=C.extern({name:"Storage",default:{get:()=>{throw new Error("Not implemented")},set:()=>{throw new Error("Not implemented")},clear:()=>{throw new Error("Not implemented")}}}),ve=U({get:e=>q.getItem(e),set:async(e,t)=>{await q.setItem(e,t)},clear:e=>q.removeItem(e)}),ge=(e,t)=>{var i;const o=e.state({name:`${t.name}.TextState`,default:(i=t.default)!=null?i:""}),n=e.query({name:`${t.name}.TextQuery`,impl:({get:u})=>u(o())}),a=e.event({name:`${t.name}.TextChangedEvent`}),s=e.command({name:`${t.name}.setText`,impl:({get:u},T)=>{const v=u(o()),f=[o().new(T),a({previous:v,current:T})];return T===""?[...f,d({previous:v})]:f}}),d=e.event({name:`${t.name}.InputClearedEvent`}),c=e.command({name:`${t.name}.clearText`,impl:()=>s("")});return{query:{text:n},command:{setText:s,clearText:c},event:{TextChangedEvent:a,TextClearedEvent:d}}},ye=(e,t)=>({listenTo:o=>({saveData:n=>({readData:a=>t({storageKey:e,TriggerEvent:o,saveData:n,readData:a})}),readData:n=>t({storageKey:e,TriggerEvent:o,saveData:a=>a,readData:n})})}),xe=(e,t)=>{const o=e.getExtern(U);e.command$({name:"readStorage",impl:()=>me(o.get(t.storageKey)).pipe(H(n=>!!n),N(n=>t.readData(n)))}),e.command$({name:"writeStorage",impl:({fromEvent:n})=>n(t.TriggerEvent).pipe(re(a=>o.set(t.storageKey,t.saveData(a))),N(()=>null))})},R=(e,t)=>ye(t,o=>xe(e,o)),fe="remesh-example/todo-input",j=C.domain({name:"TodoInput",impl:e=>{const t=ge(e,{name:"TodoInput"}),o=t.query.text,n=t.event.TextChangedEvent,a=t.event.TextClearedEvent,s=t.command.setText,d=t.command.clearText;return R(e,fe).listenTo(n).saveData(c=>c.current).readData(c=>s(c)),{query:{todoInput:o},command:{setTodoInput:s,clearTodoInput:d},event:{TodoInputChangedEvent:n,TodoInputClearedEvent:a}}}}),Ce=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,o=e=="x"?t:t&3|8;return o.toString(16)}),Ee="remesh-example/todo-list",A=e=>e.id,I=C.domain({name:"TodoList",impl:e=>{const t=he(e,{name:"TodoList",key:A}),o=t.query.itemList,n=t.query.item,a=t.query.keyList,s=t.event.ListChangedEvent,d=t.event.ItemAddedEvent,c=t.event.ItemUpdatedEvent,i=t.event.ItemDeletedEvent,u=t.event.FailedToAddItemEvent,T=t.event.FailedToUpdateItemEvent,v=t.command.setList,f=e.command({name:"TodoList.addTodo",impl:(l,m)=>{if(m==="")return u({reason:"Title cannot be empty"});const p={id:Ce(),title:m,completed:!1};return t.command.addItem(p)}}),D=e.command({name:"TodoList.updateTodo",impl:(l,m)=>m.title===""?E(m.id):t.command.updateItem(m)}),E=t.command.deleteItem,$=e.query({name:"ActiveTodoListQuery",impl:({get:l})=>l(o()).filter(p=>!p.completed)}),K=e.query({name:"CompletedTodoListQuery",impl:({get:l})=>l(o()).filter(p=>p.completed)}),Q=e.query({name:"ActiveTodoCountQuery",impl:({get:l})=>l($()).length}),b=e.query({name:"CompletedTodoCountQuery",impl:({get:l})=>l(K()).length}),Y=e.query({name:"IsAllCompletedQuery",impl:({get:l})=>{const m=l(o());return m.length===0?!1:l(b())===m.length}}),V=e.command({name:"toggleTodo",impl:({get:l},m)=>{const p=l(n(m)),L=S(w({},p),{completed:!p.completed});return t.command.updateItem(L)}}),W=e.command({name:"toggleAllTodos",impl:({get:l})=>{const m=l(o());if(m.length===0)return null;const L=l(Q())>0,J=m.map(X=>S(w({},X),{completed:L}));return v(J)}}),z=e.command({name:"clearAllCompletedTodos",impl:({get:l})=>{const m=l(o());if(m.length===0)return null;const p=m.filter(L=>!L.completed);return v(p)}});return R(e,Ee).listenTo(s).saveData(l=>l.current).readData(l=>v(l)),{query:{todoState:n,todoKeyList:a,todoList:o,activeTodoList:$,completedTodoList:K,activeTodoCount:Q,completedTodoCount:b,isAllCompleted:Y},command:{setTodoList:v,addTodo:f,updateTodo:D,deleteTodo:E,toggleTodo:V,toggleAllTodos:W,clearAllCompletedTodos:z},event:{TodoItemAddedEvent:d,TodoItemUpdatedEvent:c,TodoItemDeletedEvent:i,FailedToAddTodoEvent:u,FailedToUpdateTodoEvent:T,TodoListChangedEvent:s}}}});function B(e,t){return n=>{const a=Array.isArray(e)?e:[e];for(const s of a)n.key.toLowerCase()===s.toLowerCase()&&(n.preventDefault(),t(n,s))}}const Le=()=>{const e=x(j()),t=x(I()),o=y(e.query.todoInput()),n=s=>{e.command.setTodoInput(s.target.value)},a=B("Enter",()=>{t.command.addTodo(o)});return ie(t.event.FailedToAddTodoEvent,s=>{alert(s.reason)}),h("header",{className:"header",children:[r("h1",{children:"todos"}),r("input",{className:"new-todo",placeholder:"What needs to be done?",value:o,onChange:n,onKeyDown:a})]})},Ie=(e,t)=>{const o=e.state({name:`${t.name}.SwitchState`,default:t.default}),n=e.query({name:`${t.name}.SwitchStateQuery`,impl:({get:d})=>d(o())}),a=e.event({name:`${t.name}.SwitchedEvent`}),s=e.command({name:`${t.name}.switchTo`,impl:({get:d},c)=>{const i=d(o());return[o().new(c),a({previous:i,current:c})]}});return{query:{switchState:n},command:{switchTo:s},event:{SwitchedEvent:a}}},De="remesh-example/todo-filter",we=e=>{if(e===void 0)return"all";switch(e){case"all":case"active":case"completed":return e;default:return"all"}},G=C.domain({name:"TodoFilter",impl:e=>{const t=Ie(e,{name:"TodoFilter",default:"all"}),o=t.query.switchState,n=t.event.SwitchedEvent,a=t.command.switchTo,s=e.command({name:"TodoFilter.setFilter",impl:(d,c)=>{const i=we(c);return a(i)}});return R(e,De).listenTo(n).saveData(d=>d.current).readData(d=>s(d)),{query:{todoFilter:o},command:{setFilter:s,switchFilter:a},event:{TodoFilterChangedEvent:n}}}}),Se=C.domain({name:"TodoApp",impl:e=>{const t=e.getDomain(j()),o=e.getDomain(I()),n=e.getDomain(G()),a=e.query({name:"FilteredTodoList",impl:({get:s})=>{const d=s(n.query.todoFilter());if(d==="all")return s(o.query.todoList()).map(A);if(d==="active")return s(o.query.activeTodoList()).map(A);if(d==="completed")return s(o.query.completedTodoList()).map(A);throw new Error(`Unknown filter: ${d}`)}});return e.command$({name:"clearTodoInputWhenSubmit",impl:({fromEvent:s,get:d})=>s(o.event.TodoItemAddedEvent).pipe(H(c=>d(t.query.todoInput())===c.item.title),N(()=>t.command.clearTodoInput()))}),{query:{FilteredTodoKeyListQuery:a},command:{},event:{}}}});function Ae(e){const[t,o]=g.exports.useState(e),n=g.exports.useCallback(a=>{o(a.target.value)},[]);return[t,n,o]}function qe(e){const t=x(I()),o=y(t.query.todoState(e.id)),[n,a]=g.exports.useState(!1),[s,d]=Ae(o.title),c=()=>{t.command.updateTodo(S(w({},o),{title:s})),a(!1)},i=B(["Enter","Escape"],()=>{c()}),u=()=>{a(!0)},T=()=>{t.command.toggleTodo(o.id)},v=()=>{t.command.deleteTodo(o.id)},f=()=>{c()},D=g.exports.useRef(null);return g.exports.useEffect(()=>{var E;n&&((E=D.current)==null||E.focus())},[n]),h("li",{className:`${n&&"editing"} ${o.completed&&"completed"}`,children:[h("div",{className:"view",children:[r("input",{type:"checkbox",className:"toggle",checked:o.completed,onChange:T}),r("label",{onDoubleClick:u,children:o.title}),r("button",{className:"destroy",onClick:v})]}),n&&r("input",{ref:D,className:"edit",value:s,onChange:d,onKeyDown:i,onBlur:f})]})}const Fe=()=>{const e=x(Se()),t=y(e.query.FilteredTodoKeyListQuery());return console.log("render list"),h("section",{className:"main",children:[r(Ne,{}),r("ul",{className:"todo-list",children:t.map(o=>r(qe,{id:o},o))})]})},Ne=()=>{const e=x(I()),t=y(e.query.isAllCompleted());return h(se,{children:[r("input",{id:"toggle-all",type:"checkbox",className:"toggle-all",checked:t,onChange:()=>{e.command.toggleAllTodos()}}),r("label",{htmlFor:"toggle-all"})]})},Re=()=>{const e=x(I()),t=x(G()),o=y(t.query.todoFilter()),n=y(e.query.activeTodoCount()),s=y(e.query.completedTodoCount())>0,d=()=>{e.command.clearAllCompletedTodos()},c=u=>u.isActive?"selected":"",i=de();return g.exports.useEffect(()=>{var T;const u=(T=i.filter)!=null?T:"all";u!==o&&t.command.setFilter(u)},[i,o]),h("footer",{className:"footer",children:[h("span",{className:"todo-count",children:[r("strong",{children:n})," item",n!==1&&"s"," left"]}),h("ul",{className:"filters",children:[r("li",{children:r(F,{to:"/",className:c,children:"All"})}),r("li",{children:r(F,{to:"/active",className:c,children:"Active"})}),r("li",{children:r(F,{to:"/completed",className:c,children:"Completed"})})]}),s&&r("button",{className:"clear-completed",onClick:d,children:"Clear completed"})]})},M=()=>h("div",{className:"todoapp",children:[r(Le,{}),r(Fe,{}),r(Re,{})]}),P=document.getElementById("root");if(P){const e=ae(P),t=C.store({externs:[ve],inspectors:[ue(),pe()]});e.render(r(g.exports.StrictMode,{children:r(Te,{store:t,children:r(le,{basename:"/",children:h(ce,{children:[r(O,{path:"/",element:r(M,{})}),r(O,{path:"/:filter",element:r(M,{})})]})})})}))}
//# sourceMappingURL=index.46ec0579.js.map
