import{r as g,j as v,a,c as z}from"./jsx-runtime.bdd3bf05.js";import{u as V,N as Q,l as R,H as W,R as G,a as k}from"./localforage.00e2d1c0.js";import{o as J,i as X,j as Y,c as Z,R as S,h as ee,m as q,u as F,b as H,d as A,l as oe,e as te}from"./remesh-react.691c86dd.js";import{R as ne,a as de}from"./remesh-logger.f172f3d4.js";import{m as se}from"./merge.b528929a.js";import"./mergeAll.8e6282bc.js";import"./isScheduler.98b3f195.js";import"./mergeMap.2dc77344.js";function b(e,n,o){var t=Y(e)||n||o?{next:e,error:n,complete:o}:e;return t?J(function(u,h){var C;(C=t.subscribe)===null||C===void 0||C.call(t);var f=!0;u.subscribe(Z(h,function(m){var c;(c=t.next)===null||c===void 0||c.call(t,m),h.next(m)},function(){var m;f=!1,(m=t.complete)===null||m===void 0||m.call(t),h.complete()},function(m){var c;f=!1,(c=t.error)===null||c===void 0||c.call(t,m),h.error(m)},function(){var m,c;f&&((m=t.unsubscribe)===null||m===void 0||m.call(t)),(c=t.finalize)===null||c===void 0||c.call(t)}))}):X}const ae=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=Math.random()*16|0,o=e=="x"?n:n&3|8;return o.toString(16)}),_=S.extern({name:"TodoRepoExtern",default:{async getTodoList(){throw new Error("Not implemented")},async addTodo(){throw new Error("Not implemented")},async removeTodoByIds(){throw new Error("Not implemented")},async updateTodo(){throw new Error("Not implemented")},async toggleCompletedByIds(){throw new Error("Not implemented")}}}),P=S.domain({name:"TodoDomain",impl:e=>{const n=e.getExtern(_),o=e.state({name:"TodoListState",default:[]}),t=e.query({name:"TodoListQuery",impl({get:s},d){const p=s(o());return d==="active"?p.filter(l=>!l.completed):d==="completed"?p.filter(l=>l.completed):p}}),u=e.query({name:"HasCompletedQuery",impl({get:s}){return s(t("completed")).length>0}}),h=e.query({name:"ActiveTodoCountQuery",impl({get:s}){return s(t("active")).length}}),C=e.query({name:"AllCompletedQuery",impl({get:s}){return s(h())===0&&s(t()).length>0}}),f=e.event({name:"TodoAddedEvent"}),m=e.command({name:"SetTodoListCommand",impl(s,d){return o().new(d)}}),c=e.event({name:"AddTodoFailedEvent"}),L=e.command({name:"AddTodoCommand",impl({get:s},d){if(d.trim()==="")return[c("Cannot be empty, please enter the TODO name")];const p=s(o()),l={id:ae(),name:d,completed:!1};return[o().new([...p,l]),f(l)]}}),x=e.event({name:"RemoveTodoEvent"}),y=e.command({name:"RemoveTodoCommand",impl({get:s},d){const l=s(o()).filter(r=>r.id!==d);return[o().new(l),x([d])]}}),T=e.event({name:"TodoUpdatedEvent"}),K=e.command({name:"UpdateTodoCommand",impl({get:s},d){const p=s(o());if(d.name&&d.name.trim()==="")return y(d.id);const l=p.map(i=>i.id===d.id?{...i,...d,id:i.id}:i),r=l.find(i=>i.id===d.id);return r?[o().new(l),T(r)]:null}}),I=e.event({name:"TodoCompletedChangedEvent"}),j=e.command({name:"ToggleTodoCompletedCommand",impl({get:s},d){const l=s(o()).map(w=>w.id===d?{...w,completed:!w.completed}:w),r=l.find(w=>w.id===d);if(!r)return null;const i={ids:[d],completed:r==null?void 0:r.completed};return[o().new(l),I(i)]}}),M=e.command({name:"ToggleAllTodoCompletedCommand",impl({get:s},d){const p=s(o());if(p.length===0)return null;const l=p.map(r=>({...r,completed:d}));return[o().new(l),I({ids:l.map(r=>r.id),completed:d})]}}),O=e.command({name:"ClearCompletedCommand",impl({get:s}){const d=s(o()),p=d.filter(r=>!r.completed),l=d.filter(r=>r.completed).map(r=>r.id);return[o().new(p),x(l)]}});return e.effect({name:"FromRepoToStateEffect",impl(){return ee(n.getTodoList()).pipe(q(s=>m(s)))}}),e.effect({name:"FromStateToRepoEffect",impl:({fromEvent:s})=>{const d=s(f).pipe(b(i=>n.addTodo(i))),p=s(x).pipe(b(i=>n.removeTodoByIds(i))),l=s(T).pipe(b(i=>n.updateTodo(i))),r=s(I).pipe(b(i=>n.toggleCompletedByIds(i.ids,i.completed)));return se(d,p,l,r).pipe(q(()=>null))}}),{query:{TodoListQuery:t,ActiveTodoCountQuery:h,HasCompletedQuery:u,AllCompletedQuery:C},command:{AddTodoCommand:L,RemoveTodoCommand:y,ToggleTodoCompletedCommand:j,ToggleAllTodoCompletedCommand:M,UpdateTodoCommand:K,ClearCompletedCommand:O},event:{AddTodoFailedEvent:c}}}});function U(e){const[n,o]=g.exports.useState(e),t=g.exports.useCallback(u=>{o(u.target.value)},[]);return[n,t,o]}function $(e,n){const o=g.exports.useRef(n),t=g.exports.useCallback(u=>{u.key.toLocaleLowerCase()===e.toLocaleLowerCase()&&(u.preventDefault(),o.current(u))},[e]);return g.exports.useEffect(()=>{o.current=n}),t}function le({todo:e}){const n=F(),o=H(P()),[t,u]=g.exports.useState(!1),h=g.exports.useRef(null),[C,f]=U(e.name),m=$("Enter",()=>{n(o.command.UpdateTodoCommand({...e,name:C})),u(!1)}),c=()=>{u(!0)},L=()=>{n(o.command.ToggleTodoCompletedCommand(e.id))},x=()=>{n(o.command.RemoveTodoCommand(e.id))};return g.exports.useEffect(()=>{var y;t&&((y=h.current)==null||y.focus())},[t]),v("li",{onDoubleClick:c,className:`${t?"editing":""} ${e.completed?"completed":""}`,children:[v("div",{className:"view",children:[a("input",{type:"checkbox",className:"toggle",checked:e.completed,onChange:L}),a("label",{children:e.name}),a("button",{className:"destroy",onClick:x})]}),t&&a("input",{ref:h,className:"edit",value:C,onChange:f,onKeyPress:m,onBlur:()=>{u(!1)}})]})}const D=()=>{const e=F(),{filter:n}=V(),o=H(P()),t=A(o.query.TodoListQuery(n)),u=A(o.query.ActiveTodoCountQuery()),h=A(o.query.HasCompletedQuery()),C=A(o.query.AllCompletedQuery()),[f,m,c]=U(""),L=$("Enter",()=>{e(o.command.AddTodoCommand(f)),c("")}),x=()=>{e(o.command.ToggleAllTodoCompletedCommand(!C))},y=()=>{e(o.command.ClearCompletedCommand())};return oe(o.event.AddTodoFailedEvent,T=>{alert(T)}),console.log("render list"),v("div",{className:"todoapp",children:[v("header",{className:"header",children:[a("h1",{children:"todos"}),a("input",{className:"new-todo",placeholder:"What needs to be done?",value:f,onChange:m,onKeyDown:L})]}),v("section",{className:"main",children:[a("input",{id:"toggle-all",type:"checkbox",className:"toggle-all",checked:C,onChange:x}),a("label",{htmlFor:"toggle-all"}),a("ul",{className:"todo-list",children:t.map(T=>a(le,{todo:T},T.id))})]}),v("footer",{className:"footer",children:[v("span",{className:"todo-count",children:[a("strong",{children:u})," items left"]}),v("ul",{className:"filters",children:[a("li",{children:a(Q,{to:"/",className:T=>T.isActive?"selected":"",children:"All"})}),a("li",{children:a(Q,{to:"/active",className:T=>T.isActive?"selected":"",children:"Active"})}),a("li",{children:a(Q,{to:"/completed",className:T=>T.isActive?"selected":"",children:"Completed"})})]}),h&&a("button",{className:"clear-completed",onClick:y,children:"Clear completed"})]})]})},N="todo-mvc-data",E=()=>R.getItem(N).then(e=>e!=null?e:[]),re=_.impl({async getTodoList(){return E()},async addTodo(e){let n=await E();await R.setItem(N,n.concat(e))},async removeTodoByIds(e){let n=await E();await R.setItem(N,n.filter(o=>!e.includes(o.id)))},async updateTodo(e){let n=await E();await R.setItem(N,n.map(o=>o.id===e.id?{...o,...e}:o))},async toggleCompletedByIds(e,n){let o=await E();await R.setItem(N,o.map(t=>e.includes(t.id)?{...t,completed:n}:t))}}),B=document.getElementById("root");if(B){const e=z(B),n=S.store({externs:[re],inspectors:[ne(),de()]});e.render(a(g.exports.StrictMode,{children:a(te,{store:n,children:a(W,{basename:"/",children:v(G,{children:[a(k,{path:"/",element:a(D,{})}),a(k,{path:"/:filter",element:a(D,{})})]})})})}))}
//# sourceMappingURL=index.44d6d55c.js.map
