var K=Object.defineProperty,U=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,tt=Object.prototype.propertyIsEnumerable;var z=(t,e,n)=>e in t?K(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,g=(t,e)=>{for(var n in e||(e={}))V.call(e,n)&&z(t,n,e[n]);if(I)for(var n of I(e))tt.call(e,n)&&z(t,n,e[n]);return t},S=(t,e)=>U(t,Z(e));import{R as et,r as b,a as y,j as $,c as nt}from"./jsx-runtime.a8396eb8.js";import{g as E,S as ot,_ as P,a as F,s as rt,O as it,n as st,R as H,u as at,b as ct,t as D,c as ut,d as lt,e as dt}from"./remesh-logger.2c0a612e.js";import{f as ft}from"./filter.44240442.js";import{m as pt,p as ht,i as vt,E as mt,b as yt}from"./mergeAll.37e67598.js";import{f as xt,o as L,c as j,m as O}from"./map.105726f2.js";var N={now:function(){return(N.delegate||Date).now()},delegate:void 0},gt=function(t){E(e,t);function e(n,o){return t.call(this)||this}return e.prototype.schedule=function(n,o){return this},e}(ot),A={setInterval:function(t,e){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];var r=A.delegate;return r!=null&&r.setInterval?r.setInterval.apply(r,P([t,e],F(n))):setInterval.apply(void 0,P([t,e],F(n)))},clearInterval:function(t){var e=A.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},St=function(t){E(e,t);function e(n,o){var r=t.call(this,n,o)||this;return r.scheduler=n,r.work=o,r.pending=!1,r}return e.prototype.schedule=function(n,o){if(o===void 0&&(o=0),this.closed)return this;this.state=n;var r=this.id,a=this.scheduler;return r!=null&&(this.id=this.recycleAsyncId(a,r,o)),this.pending=!0,this.delay=o,this.id=this.id||this.requestAsyncId(a,this.id,o),this},e.prototype.requestAsyncId=function(n,o,r){return r===void 0&&(r=0),A.setInterval(n.flush.bind(n,this),r)},e.prototype.recycleAsyncId=function(n,o,r){if(r===void 0&&(r=0),r!=null&&this.delay===r&&this.pending===!1)return o;A.clearInterval(o)},e.prototype.execute=function(n,o){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(n,o);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,o){var r=!1,a;try{this.work(n)}catch(s){r=!0,a=s||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),a},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,o=n.id,r=n.scheduler,a=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,rt(a,this),o!=null&&(this.id=this.recycleAsyncId(r,o,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(gt),_=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,o){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(o,n)},t.now=N.now,t}(),wt=function(t){E(e,t);function e(n,o){o===void 0&&(o=_.now);var r=t.call(this,n,o)||this;return r.actions=[],r._active=!1,r._scheduled=void 0,r}return e.prototype.flush=function(n){var o=this.actions;if(this._active){o.push(n);return}var r;this._active=!0;do if(r=n.execute(n.state,n.delay))break;while(n=o.shift());if(this._active=!1,r){for(;n=o.shift();)n.unsubscribe();throw r}},e}(_),Q=new wt(St),bt=Q;function kt(t){return t instanceof Date&&!isNaN(t)}function Ct(){return pt(1)}function At(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Ct()(xt(t,ht(t)))}function Et(t,e,n){t===void 0&&(t=0),n===void 0&&(n=bt);var o=-1;return e!=null&&(vt(e)?n=e:o=e),new it(function(r){var a=kt(t)?+t-n.now():t;a<0&&(a=0);var s=0;return n.schedule(function(){r.closed||(r.next(s++),0<=o?this.schedule(void 0,o):r.complete())},a)})}function B(t){return t<=0?function(){return mt}:L(function(e,n){var o=0;e.subscribe(j(n,function(r){++o<=t&&(n.next(r),t<=o&&n.complete())}))})}function Gt(){return L(function(t,e){t.subscribe(j(e,st))})}function Mt(t){return O(function(){return t})}function X(t,e){return e?function(n){return At(e.pipe(B(1),Gt()),n.pipe(X(t)))}:yt(function(n,o){return t(n,o).pipe(B(1),Mt(n))})}function Rt(t,e){e===void 0&&(e=Q);var n=Et(t,e);return X(function(){return n})}const k=et.createContext({left:0,top:0,gridSize:60,chessSize:40}),It=t=>{const{left:e,top:n,gridSize:o}=t,r=e+o/2,a=n+o/2,s=(i,c,u,p)=>`M${r+i*o},${a+c*o} L${r+u*o},${a+p*o}`,f=(i,c)=>{const u=[];let d,m,x,h;return i!=0&&(d=i-.1,m=c-.1-.25,x=i-.1-.25,h=c-.1,u.push(s(d,m,d,h)),u.push(s(d,h,x,h)),m=c+.1+.25,h=c+.1,u.push(s(d,m,d,h)),u.push(s(d,h,x,h))),i!=8&&(d=i+.1,m=c-.1-.25,x=i+.1+.25,h=c-.1,u.push(s(d,m,d,h)),u.push(s(d,h,x,h)),m=c+.1+.25,h=c+.1,u.push(s(d,m,d,h)),u.push(s(d,h,x,h))),u};return[[1,2],[7,2],[1,7],[7,7],[0,3],[2,3],[4,3],[6,3],[8,3],[0,6],[2,6],[4,6],[6,6],[8,6]].map(([i,c])=>f(i,c)).reduce((i,c)=>i.concat(c),[]).concat(new Array(8).fill(0).map((i,c)=>s(0,c+1,8,c+1))).concat(new Array(7).fill(0).map((i,c)=>s(c+1,0,c+1,4))).concat(new Array(7).fill(0).map((i,c)=>s(c+1,5,c+1,9))).concat([s(3,0,5,2),s(5,0,3,2),s(3,7,5,9),s(3,9,5,7)])},zt=()=>{const t=b.exports.useContext(k),{left:e,top:n,gridSize:o,chessSize:r}=t,a=e+o/2,s=n+o/2,f=o*8,l=o*9,i=It(t),c={position:"absolute",left:0,top:0,width:f+r,height:l+r};return y("svg",{xmlns:"http://www.w3.org/2000/svg",style:c,children:$("g",{children:[y("rect",{x:a,y:s,width:f,height:l,fill:"none",stroke:"#000000",strokeWidth:"3"}),i.map((u,p)=>y("path",{fill:"none",stroke:"#000000",d:u},p))]})})};var v=(t=>(t[t.General=100]="General",t[t.Chariot=50]="Chariot",t[t.Cannon=30]="Cannon",t[t.Horse=29]="Horse",t[t.Elephant=16]="Elephant",t[t.Guard=10]="Guard",t[t.Soldier=1]="Soldier",t))(v||{}),w=(t=>(t[t.Red=1]="Red",t[t.Black=-1]="Black",t))(w||{});const Pt=(t,e)=>t.x===e.x&&t.y===e.y,Ft=(t,{x:e,y:n})=>{switch(t){case-1:return!(e<3||e>5||n>2&&n<7);case 1:return!(e<3||e>5||n>2&&n<7)}},Dt=(t,{x:e,y:n})=>{switch(t){case-1:return[[3,0],[3,2],[5,0],[5,2],[4,1]].find(([o,r])=>o===e&&r===n);case 1:return[[3,7],[3,9],[5,7],[5,9],[4,8]].find(([o,r])=>o===e&&r===n)}},_t=(t,{x:e,y:n})=>{switch(t){case-1:return[[0,2],[2,0],[2,4],[4,2],[6,0],[6,4],[8,2]].find(([o,r])=>o===e&&r===n);case 1:return[[0,7],[2,5],[2,9],[4,7],[6,5],[6,9],[8,7]].find(([o,r])=>o===e&&r===n)}},Bt=(t,{x:e,y:n})=>{switch(t){case-1:return!(n<3||n<5&&e%2===1);case 1:return!(n>6||n>4&&e%2===1)}},qt=t=>({position:e},{x:n,y:o})=>{if(e.x!==n&&e.y!==o)return!1;if(t.situation.find(r=>r.position.x===n&&r.position.y===o)){if(e.y===o)return t.situation.filter(r=>r.position.y===o&&(r.position.x-n)*(r.position.x-e.x)<0).length===1;if(e.x===n)return t.situation.filter(r=>r.position.x===n&&(r.position.y-o)*(r.position.y-e.y)<0).length===1}return!1},Wt=()=>({position:t},{x:e,y:n})=>Math.abs(t.y-n)+Math.abs(t.x-e)===1,Yt=()=>({position:t},{x:e,y:n})=>{const o=r=>r*r;return o(t.x-e)+o(t.y-n)===2},$t=t=>({position:e},{x:n,y:o})=>Math.abs(e.x-n)!==2||Math.abs(e.y-o)!==2?!1:!t.situation.find(r=>r.position.x===(e.x+n)/2&&r.position.y===(e.y+o)/2),Ht=t=>({position:e},{x:n,y:o})=>{const r=e.x-n,a=e.y-o;return r*r+a*a===5&&!t.situation.find(s=>s.position.x===Math.round((2*e.x+n)/3)&&s.position.y===Math.round((2*e.y+o)/3))},q=t=>({position:e},{x:n,y:o})=>e.x!==n&&e.y!==o?!1:e.y===o?!t.situation.find(r=>r.position.y===o&&(r.position.x-n)*(r.position.x-e.x)<0):e.x===n?!t.situation.find(r=>r.position.x===n&&(r.position.y-o)*(r.position.y-e.y)<0):!1,Lt=()=>({position:t,color:e},{x:n,y:o})=>{switch(e){case-1:return o>=t.y&&Math.abs(n-t.x)+Math.abs(o-t.y)===1;case 1:return o<=t.y&&Math.abs(n-t.x)+Math.abs(o-t.y)===1}},G=t=>(e,n)=>{const{color:o,value:r}=e;switch(r){case 100:return Ft(o,n)&&Wt()(e,n);case 10:return Dt(o,n)&&Yt()(e,n);case 16:return _t(o,n)&&$t(t)(e,n);case 29:return Ht(t)(e,n);case 50:return q(t)(e,n);case 30:return q(t)(e,n);case 1:return Bt(o,n)&&Lt()(e,n)}},T=t=>(e,n)=>e.color===n.color?!1:e.value===30?qt(t)(e,n.position):t.situation.find(o=>Pt(o.position,n.position))&&G(t)(e,n.position),jt=t=>S(g({},t),{selected:!0}),M=t=>S(g({},t),{selected:!1}),Ot=t=>S(g({},t),{marked:!0}),R=t=>S(g({},t),{marked:!1}),J=t=>e=>S(g({},e),{position:t}),Nt=t=>e=>{const{currentPlayer:n,situation:o}=e,{x:r,y:a}=t;let s;const f=o.map(i=>R(M(i))).map(i=>i.position.x===r&&i.position.y===a?(s=jt(i),s):i).map(i=>T(e)(s,i)?Ot(i):i),l=new Array(90).fill(null).map((i,c)=>{const u=c%9,p=(c-u)/9;return{x:u,y:p}}).filter(i=>G(e)(s,i));return{currentPlayer:n,selectedChess:s,situation:f,markers:l}},Qt=t=>e=>{const{currentPlayer:n,situation:o,selectedChess:r}=e;if(r&&G(e)(r,t)){const{x:a,y:s}=r.position,f=o.map(l=>l.position.x===a&&l.position.y===s?J(t)(l):l).map(l=>R(M(l)));return{currentPlayer:-n,selectedChess:void 0,situation:f,markers:[]}}return e},Xt=t=>e=>{const{currentPlayer:n,situation:o,selectedChess:r}=e,a=o.find(s=>s.position.x===t.x&&s.position.y===t.y);if(r&&a&&T(e)(r,a)){const{x:s,y:f}=r.position,l=o.map(i=>i.position.x===s&&i.position.y===f?J(t)(i):i.position.x===t.x&&i.position.y===t.y?null:i).filter(i=>!!i).map(i=>R(M(i)));return{currentPlayer:-n,selectedChess:void 0,situation:l,markers:[]}}return e},Tt=t=>t.some(o=>o.color===1&&o.value===100)?t.some(o=>o.color===-1&&o.value===100)?"playing":"red-win":"black-win",Jt=[{color:-1,value:50,position:{x:0,y:0}},{color:-1,value:29,position:{x:1,y:0}},{color:-1,value:16,position:{x:2,y:0}},{color:-1,value:10,position:{x:3,y:0}},{color:-1,value:100,position:{x:4,y:0}},{color:-1,value:10,position:{x:5,y:0}},{color:-1,value:16,position:{x:6,y:0}},{color:-1,value:29,position:{x:7,y:0}},{color:-1,value:50,position:{x:8,y:0}},{color:-1,value:30,position:{x:1,y:2}},{color:-1,value:30,position:{x:7,y:2}},{color:-1,value:1,position:{x:0,y:3}},{color:-1,value:1,position:{x:2,y:3}},{color:-1,value:1,position:{x:4,y:3}},{color:-1,value:1,position:{x:6,y:3}},{color:-1,value:1,position:{x:8,y:3}},{color:1,value:1,position:{x:0,y:6}},{color:1,value:1,position:{x:2,y:6}},{color:1,value:1,position:{x:4,y:6}},{color:1,value:1,position:{x:6,y:6}},{color:1,value:1,position:{x:8,y:6}},{color:1,value:30,position:{x:1,y:7}},{color:1,value:30,position:{x:7,y:7}},{color:1,value:50,position:{x:0,y:9}},{color:1,value:29,position:{x:1,y:9}},{color:1,value:16,position:{x:2,y:9}},{color:1,value:10,position:{x:3,y:9}},{color:1,value:100,position:{x:4,y:9}},{color:1,value:10,position:{x:5,y:9}},{color:1,value:16,position:{x:6,y:9}},{color:1,value:29,position:{x:7,y:9}},{color:1,value:50,position:{x:8,y:9}}],Kt=H.domain({name:"GameDomain",impl:t=>{const e={currentPlayer:1,selectedChess:void 0,situation:Jt,markers:[]},n=t.state({name:"Game",default:e}),o=n.query,r=t.query({name:"gameStatus",impl:({get:u})=>{const{situation:p}=u(o());return Tt(p)}}),a=t.event({name:"gameOverEvent"}),s=t.event({name:"notYourMoveEvent"}),f=t.command({name:"resetGameState",impl:()=>n().new(e)}),l=t.command({name:"selectChess",impl({get:u},p){if(u(r())!=="playing")return a();const d=u(n()),{currentPlayer:m,selectedChess:x}=d;return p.color===m?[n().new(Nt(p.position)(d))]:x?[n().new(Xt(p.position)(d))]:[s()]}}),i=t.command({name:"moveChess",impl({get:u},p){if(u(r())!=="playing")return a();const d=u(n()),{selectedChess:m}=d;return m?[n().new(Qt(p)(d))]:[s()]}}),c=t.command$({name:"checkGameStatus",impl:({fromQuery:u})=>u(r()).pipe(ft(p=>p!=="playing"),Rt(100),O(()=>a()))});return t.ignite(()=>c()),{query:{gameState:o,gameStatus:r},command:{selectChess:l,moveChess:i,resetGameState:f},event:{notYourMoveEvent:s,gameOverEvent:a}}}}),W=t=>({[w.Red]:"red",[w.Black]:"black"})[t],Ut=(t,e)=>({[w.Red]:{[v.General]:"\u5E05",[v.Guard]:"\u4ED5",[v.Elephant]:"\u76F8",[v.Horse]:"\u99AC",[v.Chariot]:"\u8ECA",[v.Cannon]:"\u70AE",[v.Soldier]:"\u5175"},[w.Black]:{[v.General]:"\u5C06",[v.Guard]:"\u58EB",[v.Elephant]:"\u8C61",[v.Horse]:"\u9A6C",[v.Chariot]:"\u8F66",[v.Cannon]:"\u7832",[v.Soldier]:"\u5352"}})[t][e],Zt=t=>{const{chess:e,onClick:n}=t,{color:o,value:r,position:{x:a,y:s},selected:f,marked:l}=e,{chessSize:i,gridSize:c,left:u,top:p}=b.exports.useContext(k),C={position:"absolute",zIndex:10,backgroundColor:"white",fontSize:26,textAlign:"center",borderWidth:2,width:i,height:i,cursor:"pointer",left:u+a*c+(c-i)/2-2,top:p+s*c+(c-i)/2-2,borderStyle:f?"dashed":"solid",borderColor:l?"aqua":W(o),borderRadius:i/2+1,color:W(o)};return y("div",{onClick:()=>n(e),style:C,children:Ut(o,r)})},Vt=t=>{const{marker:e,onClick:n}=t,{x:o,y:r}=e,{chessSize:a,gridSize:s,left:f,top:l}=b.exports.useContext(k),i={position:"absolute",borderWidth:2,borderStyle:"dashed",borderColor:"green",backgroundColor:"white",width:a/2,height:a/2,left:f+o*s+a/4+(s-a)/2-2,top:l+r*s+a/4+(s-a)/2-2};return y("div",{onClick:()=>n(e),style:i})},te=()=>{const{left:t,top:e,gridSize:n}=b.exports.useContext(k),o=at(Kt()),r=ct(o.query.gameState());D(o.event.notYourMoveEvent,()=>{alert("\u4E0D\u8BE5\u4F60\u8D70")}),D(o.event.gameOverEvent,()=>{window.confirm("\u6E38\u620F\u7ED3\u675F\uFF0C\u662F\u5426\u91CD\u65B0\u5F00\u59CB\uFF1F")&&o.command.resetGameState()});const a={width:t+9*n,height:e+10*n},{situation:s,markers:f}=r;return $("div",{style:a,children:[y(zt,{}),s.map((l,i)=>y(Zt,{chess:l,onClick:()=>o.command.selectChess(l)},i)),f.map((l,i)=>y(Vt,{marker:l,onClick:()=>o.command.moveChess(l)},i))]})},Y=document.getElementById("root");if(Y){const t=nt(Y),e=H.store({inspectors:[ut(),lt({include:["command","query","event","domain","command$","state"]})]});t.render(y(b.exports.StrictMode,{children:y(dt,{store:e,children:y(k.Provider,{value:{left:0,top:0,gridSize:60,chessSize:40},children:y(te,{})})})}))}
//# sourceMappingURL=index.2a35d874.js.map
