import{r as oe,j as kt,a as J,F as ws,c as Pi}from"./jsx-runtime.bdd3bf05.js";import{l as Fn,u as qi,N as Bn,b as Vi,c as Rt,d as en,H as Hi,R as Wi,a as Hr}from"./localforage.00e2d1c0.js";import{o as bs,c as zn,g as $i,R as Tt,m as Be,O as Yi,u as Re,b as Lt,d as jt,l as _s,e as Qi}from"./remesh-react.691c86dd.js";import{m as Gi}from"./merge.b528929a.js";import{a as vs,t as Ki}from"./timer.c7f271a8.js";import{s as Ji}from"./startWith.dc14a779.js";import{L as zi}from"./list.a9b0e861.js";import"./mergeAll.8e6282bc.js";import"./isScheduler.98b3f195.js";import"./mergeMap.2dc77344.js";import"./concat.48218eca.js";function Xi(e,t){return t===void 0&&(t=vs),bs(function(n,r){var i=null,o=null,a=null,u=function(){if(i){i.unsubscribe(),i=null;var m=o;o=null,r.next(m)}};function c(){var m=a+e,w=t.now();if(w<m){i=this.schedule(void 0,m-w),r.add(i);return}u()}n.subscribe(zn(r,function(m){o=m,a=t.now(),i||(i=t.schedule(c,e),r.add(i))},function(){u(),r.complete()},void 0,function(){o=i=null}))})}var Cs={leading:!0,trailing:!1};function Zi(e,t){return t===void 0&&(t=Cs),bs(function(n,r){var i=t.leading,o=t.trailing,a=!1,u=null,c=null,m=!1,w=function(){c==null||c.unsubscribe(),c=null,o&&(g(),m&&r.complete())},h=function(){c=null,m&&r.complete()},p=function(f){return c=$i(e(f)).subscribe(zn(r,w,h))},g=function(){if(a){a=!1;var f=u;u=null,r.next(f),!m&&p(f)}};n.subscribe(zn(r,function(f){a=!0,u=f,!(c&&!c.closed)&&(i?g():p(f))},function(){m=!0,!(o&&a&&c&&!c.closed)&&r.complete()}))})}function to(e,t,n){t===void 0&&(t=vs),n===void 0&&(n=Cs);var r=Ki(e,t);return Zi(function(){return r},n)}const Es=Tt.extern({name:"StorageExtern",default:null}),eo=Es.impl({get:e=>Fn.getItem(e),set:async(e,t)=>{await Fn.setItem(e,t)},clear:e=>Fn.removeItem(e)}),Dt=()=>new Map,dn=e=>{const t=Dt();return e.forEach((n,r)=>{t.set(r,n)}),t},bt=(e,t,n)=>{let r=e.get(t);return r===void 0&&e.set(t,r=n()),r},no=(e,t)=>{const n=[];for(const[r,i]of e)n.push(t(i,r));return n},ro=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1},je=()=>new Set,jn=e=>e[e.length-1],so=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},Ss=Array.from,Hc=Array.isArray;class Rn{constructor(){this._observers=Dt()}on(t,n){bt(this._observers,t,je).add(n)}once(t,n){const r=(...i)=>{this.off(t,r),n(...i)};this.on(t,r)}off(t,n){const r=this._observers.get(t);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(t))}emit(t,n){return Ss((this._observers.get(t)||Dt()).values()).forEach(r=>r(...n))}destroy(){this._observers=Dt()}}const Ot=Math.floor,on=Math.abs,io=Math.log10,ar=(e,t)=>e<t?e:t,pe=(e,t)=>e>t?e:t,ks=e=>e!==0?e<0:1/e<0,oo=String.fromCharCode,lo=e=>e.toLowerCase(),ao=/^\s*/g,co=e=>e.replace(ao,""),uo=/([A-Z])/g,Wr=(e,t)=>co(e.replace(uo,n=>`${t}${lo(n)}`)),ho=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.codePointAt(i);return r},Pe=typeof TextEncoder!="undefined"?new TextEncoder:null,fo=e=>Pe.encode(e),Xn=Pe?fo:ho;let Ue=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Ue&&Ue.decode(new Uint8Array).length===1&&(Ue=null);const $r=e=>e===void 0?null:e;class po{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let Ts=new po,Rs=!0;try{typeof localStorage!="undefined"&&(Ts=localStorage,Rs=!1)}catch{}const As=Ts,go=e=>Rs||addEventListener("storage",e),mo=Object.keys,fn=e=>mo(e).length,yo=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},Ds=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),wo=(e,t)=>e===t||fn(e)===fn(t)&&yo(e,(n,r)=>(n!==void 0||Ds(t,r))&&t[r]===n),cr=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&cr(e,t,n+1)}},bo=()=>{},_o=(e,t)=>e===t,Fe=(e,t)=>{if(e==null||t==null)return _o(e,t);if(e.constructor!==t.constructor)return!1;if(e===t)return!0;switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:{if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break}case Set:{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;break}case Map:{if(e.size!==t.size)return!1;for(const n of e.keys())if(!t.has(n)||!Fe(e.get(n),t.get(n)))return!1;break}case Object:if(fn(e)!==fn(t))return!1;for(const n in e)if(!Ds(e,n)||!Fe(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Fe(e[n],t[n]))return!1;break;default:return!1}return!0},vo=(e,t)=>t.includes(e),ce=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name),Is=typeof window!="undefined"&&!ce;typeof navigator!="undefined"&&/Mac/.test(navigator.platform);let At;const Co=()=>{if(At===void 0)if(ce){At=Dt();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];r[0]==="-"?(t!==null&&At.set(t,""),t=r):t!==null&&(At.set(t,r),t=null)}t!==null&&At.set(t,"")}else typeof location=="object"?(At=Dt(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");At.set(`--${Wr(t,"-")}`,n),At.set(`-${Wr(t,"-")}`,n)}})):At=Dt();return At},Zn=e=>Co().has(e),pn=e=>$r(ce?process.env[e.toUpperCase()]:As.getItem(e)),Eo=e=>Zn("--"+e)||pn(e)!==null;Eo("production");const Yr=ce&&vo({}.FORCE_COLOR,["true","1","2"]),So=!Zn("no-colors")&&(!ce||process.stdout.isTTY||Yr)&&(!ce||Zn("color")||Yr||pn("COLORTERM")!==null||(pn("TERM")||"").includes("color")),Qr=1,Gr=2,Pn=4,qn=8,qe=32,Pt=64,mt=128,An=31,tr=63,le=127,ko=2147483647,xs=Number.MAX_SAFE_INTEGER,To=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&Ot(e)===e),ne=e=>new Error(e),It=()=>{throw ne("Method unimplemented")},Nt=()=>{throw ne("Unexpected case")},Ls=ne("Unexpected end of array"),Os=ne("Integer out of Range");class Dn{constructor(t){this.arr=t,this.pos=0}}const Ft=e=>new Dn(e),Ro=e=>e.pos!==e.arr.length,Ao=(e,t)=>{const n=dr(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},ct=e=>Ao(e,$(e)),ue=e=>e.arr[e.pos++],$=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const i=e.arr[e.pos++];if(t=t+(i&le)*n,n*=128,i<mt)return t;if(t>xs)throw Os}throw Ls},ur=e=>{let t=e.arr[e.pos++],n=t&tr,r=64;const i=(t&Pt)>0?-1:1;if((t&mt)===0)return i*n;const o=e.arr.length;for(;e.pos<o;){if(t=e.arr[e.pos++],n=n+(t&le)*r,r*=128,t<mt)return i*n;if(n>xs)throw Os}throw Ls},Do=e=>{let t=$(e);if(t===0)return"";{let n=String.fromCodePoint(ue(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(ue(e));else for(;t>0;){const r=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,i),t-=r}return decodeURIComponent(escape(n))}},Io=e=>Ue.decode(ct(e)),qt=Ue?Io:Do,hr=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},xo=e=>hr(e,4).getFloat32(0,!1),Lo=e=>hr(e,8).getFloat64(0,!1),Oo=e=>hr(e,8).getBigInt64(0,!1),No=[e=>{},e=>null,ur,xo,Lo,Oo,e=>!1,e=>!0,qt,e=>{const t=$(e),n={};for(let r=0;r<t;r++){const i=qt(e);n[i]=Ee(e)}return n},e=>{const t=$(e),n=[];for(let r=0;r<t;r++)n.push(Ee(e));return n},ct],Ee=e=>No[127-ue(e)](e);class Kr extends Dn{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Ro(this)?this.count=$(this)+1:this.count=-1),this.count--,this.s}}class ln extends Dn{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=ur(this);const t=ks(this.s);this.count=1,t&&(this.s=-this.s,this.count=$(this)+2)}return this.count--,this.s}}class Vn extends Dn{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=ur(this),n=t&1;this.diff=Ot(t/2),this.count=1,n&&(this.count=$(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Mo{constructor(t){this.decoder=new ln(t),this.str=qt(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const Ns=e=>new Uint8Array(e),dr=(e,t,n)=>new Uint8Array(e,t,n),Uo=e=>new Uint8Array(e),Fo=e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=oo(e[n]);return btoa(t)},Bo=e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),jo=e=>{const t=atob(e),n=Ns(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n},Po=e=>{const t=Buffer.from(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)},Ms=Is?Fo:Bo,Us=Is?jo:Po,qo=e=>{const t=Ns(e.byteLength);return t.set(e),t};class Ge{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const ut=()=>new Ge,Vo=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},nt=e=>{const t=new Uint8Array(Vo(e));let n=0;for(let r=0;r<e.bufs.length;r++){const i=e.bufs[r];t.set(i,n),n+=i.length}return t.set(dr(e.cbuf.buffer,0,e.cpos),n),t},Ho=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(dr(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(pe(n,t)*2),e.cpos=0)},at=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},Ve=at,V=(e,t)=>{for(;t>le;)at(e,mt|le&t),t=Ot(t/128);at(e,le&t)},fr=(e,t)=>{const n=ks(t);for(n&&(t=-t),at(e,(t>tr?mt:0)|(n?Pt:0)|tr&t),t=Ot(t/64);t>0;)at(e,(t>le?mt:0)|le&t),t=Ot(t/128)},er=new Uint8Array(3e4),Wo=er.length/3,$o=(e,t)=>{if(t.length<Wo){const n=Pe.encodeInto(t,er).written||0;V(e,n);for(let r=0;r<n;r++)at(e,er[r])}else st(e,Xn(t))},Yo=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;V(e,r);for(let i=0;i<r;i++)at(e,n.codePointAt(i))},xt=Pe&&Pe.encodeInto?$o:Yo,In=(e,t)=>{const n=e.cbuf.length,r=e.cpos,i=ar(n-r,t.length),o=t.length-i;e.cbuf.set(t.subarray(0,i),r),e.cpos+=i,o>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(pe(n*2,o)),e.cbuf.set(t.subarray(i)),e.cpos=o)},st=(e,t)=>{V(e,t.byteLength),In(e,t)},pr=(e,t)=>{Ho(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},Qo=(e,t)=>pr(e,4).setFloat32(0,t,!1),Go=(e,t)=>pr(e,8).setFloat64(0,t,!1),Ko=(e,t)=>pr(e,8).setBigInt64(0,t,!1),Jr=new DataView(new ArrayBuffer(4)),Jo=e=>(Jr.setFloat32(0,e),Jr.getFloat32(0)===e),Se=(e,t)=>{switch(typeof t){case"string":at(e,119),xt(e,t);break;case"number":To(t)&&on(t)<=ko?(at(e,125),fr(e,t)):Jo(t)?(at(e,124),Qo(e,t)):(at(e,123),Go(e,t));break;case"bigint":at(e,122),Ko(e,t);break;case"object":if(t===null)at(e,126);else if(t instanceof Array){at(e,117),V(e,t.length);for(let n=0;n<t.length;n++)Se(e,t[n])}else if(t instanceof Uint8Array)at(e,116),st(e,t);else{at(e,118);const n=Object.keys(t);V(e,n.length);for(let r=0;r<n.length;r++){const i=n[r];xt(e,i),Se(e,t[i])}}break;case"boolean":at(e,t?120:121);break;default:at(e,127)}};class zr extends Ge{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&V(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Xr=e=>{e.count>0&&(fr(e.encoder,e.count===1?e.s:-e.s),e.count>1&&V(e.encoder,e.count-2))};class an{constructor(){this.encoder=new Ge,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Xr(this),this.count=1,this.s=t)}toUint8Array(){return Xr(this),nt(this.encoder)}}const Zr=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);fr(e.encoder,t),e.count>1&&V(e.encoder,e.count-2)}};class Hn{constructor(){this.encoder=new Ge,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Zr(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Zr(this),nt(this.encoder)}}class zo{constructor(){this.sarr=[],this.s="",this.lensE=new an}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new Ge;return this.sarr.push(this.s),this.s="",xt(t,this.sarr.join("")),In(t,this.lensE.toUint8Array()),nt(t)}}const ts=typeof crypto=="undefined"?null:crypto,Xo=ts!==null?e=>{const t=new ArrayBuffer(e),n=new Uint8Array(t);return ts.getRandomValues(n),t}:e=>{const t=new ArrayBuffer(e),n=new Uint8Array(t);for(let r=0;r<e;r++)n[r]=Math.ceil(Math.random()*4294967295>>>0);return t},Zo=Math.random,Fs=()=>new Uint32Array(Xo(4))[0],tl=[1e7]+-1e3+-4e3+-8e3+-1e11,Bs=()=>tl.replace(/[018]/g,e=>(e^Fs()&15>>e/4).toString(16)),Ht=Date.now,el=e=>new Promise(e),nl=e=>Promise.reject(e),gr=e=>Promise.resolve(e),$t=Symbol;class rl{constructor(t,n){this.left=t,this.right=n}}const Bt=(e,t)=>new rl(e,t),ge=typeof document!="undefined"?document:{};typeof DOMParser!="undefined"&&new DOMParser;const sl=e=>no(e,(t,n)=>`${n}:${t};`).join("");ge.ELEMENT_NODE;ge.TEXT_NODE;ge.CDATA_SECTION_NODE;ge.COMMENT_NODE;ge.DOCUMENT_NODE;ge.DOCUMENT_TYPE_NODE;ge.DOCUMENT_FRAGMENT_NODE;const gt=$t(),te=$t(),mr=$t(),xn=$t(),yr=$t(),wr=$t(),br=$t(),Ln=$t(),Ke=$t(),il={[gt]:Bt("font-weight","bold"),[te]:Bt("font-weight","normal"),[mr]:Bt("color","blue"),[yr]:Bt("color","green"),[xn]:Bt("color","grey"),[wr]:Bt("color","red"),[br]:Bt("color","purple"),[Ln]:Bt("color","orange"),[Ke]:Bt("color","black")},js={[gt]:"\x1B[1m",[te]:"\x1B[2m",[mr]:"\x1B[34m",[yr]:"\x1B[32m",[xn]:"\x1B[37m",[wr]:"\x1B[31m",[br]:"\x1B[35m",[Ln]:"\x1B[38;5;208m",[Ke]:"\x1B[0m"},ol=e=>{const t=[],n=[],r=Dt();let i=[],o=0;for(;o<e.length;o++){const a=e[o],u=il[a];if(u!==void 0)r.set(u.left,u.right);else if(a.constructor===String||a.constructor===Number){const c=sl(r);o>0||c.length>0?(t.push("%c"+a),n.push(c)):t.push(a)}else break}for(o>0&&(i=n,i.unshift(t.join("")));o<e.length;o++){const a=e[o];a instanceof Symbol||i.push(a)}return i},ll=e=>{const t=[],n=[];let r=0;for(;r<e.length;r++){const i=e[r];if(js[i]===void 0)if(i.constructor===String||i.constructor===Number)t.push(i);else break}for(r>0&&n.push(t.join(""));r<e.length;r++){const i=e[r];i instanceof Symbol||(i.constructor===Object?n.push(JSON.stringify(i)):n.push(i))}return n},al=e=>{const t=[],n=[];let r=0;for(;r<e.length;r++){const i=e[r],o=js[i];if(o!==void 0)t.push(o);else if(i.constructor===String||i.constructor===Number)t.push(i);else break}for(r>0&&(t.push("\x1B[0m"),n.push(t.join("")));r<e.length;r++){const i=e[r];i instanceof Symbol||n.push(i)}return n},cl=So?ce?al:ol:ll,Ps=(...e)=>{console.log(...cl(e)),ul.forEach(t=>t.print(e))},ul=new Set,es=[yr,br,Ln,mr];let Wn=0,ns=Ht();const hl=e=>{const t=es[Wn],n=pn("log"),r=n!==null&&(n==="*"||n==="true"||new RegExp(n,"gi").test(e));return Wn=(Wn+1)%es.length,e+=": ",r?(...i)=>{const o=Ht(),a=o-ns;ns=o,Ps(t,e,Ke,...i.map(u=>typeof u=="string"||typeof u=="symbol"?u:JSON.stringify(u)),t," +"+a+"ms")}:bo},qs=e=>({[Symbol.iterator](){return this},next:e}),dl=(e,t)=>qs(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),$n=(e,t)=>qs(()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}});class _r{constructor(t,n){this.clock=t,this.len=n}}class Je{constructor(){this.clients=new Map}}const nr=(e,t,n)=>t.clients.forEach((r,i)=>{const o=e.doc.store.clients.get(i);for(let a=0;a<r.length;a++){const u=r[a];ei(e,o,u.clock,u.len,n)}}),fl=(e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const i=Ot((n+r)/2),o=e[i],a=o.clock;if(a<=t){if(t<a+o.len)return i;n=i+1}else r=i-1}return null},Vs=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&fl(n,t.clock)!==null},vr=e=>{e.clients.forEach(t=>{t.sort((i,o)=>i.clock-o.clock);let n,r;for(n=1,r=1;n<t.length;n++){const i=t[r-1],o=t[n];i.clock+i.len>=o.clock?i.len=pe(i.len,o.clock+o.len-i.clock):(r<n&&(t[r]=o),r++)}t.length=r})},pl=e=>{const t=new Je;for(let n=0;n<e.length;n++)e[n].clients.forEach((r,i)=>{if(!t.clients.has(i)){const o=r.slice();for(let a=n+1;a<e.length;a++)so(o,e[a].clients.get(i)||[]);t.clients.set(i,o)}});return vr(t),t},gn=(e,t,n,r)=>{bt(e.clients,t,()=>[]).push(new _r(n,r))},Hs=()=>new Je,gl=e=>{const t=Hs();return e.clients.forEach((n,r)=>{const i=[];for(let o=0;o<n.length;o++){const a=n[o];if(a.deleted){const u=a.id.clock;let c=a.length;if(o+1<n.length)for(let m=n[o+1];o+1<n.length&&m.deleted;m=n[++o+1])c+=m.length;i.push(new _r(u,c))}}i.length>0&&t.clients.set(r,i)}),t},Ae=(e,t)=>{V(e.restEncoder,t.clients.size),t.clients.forEach((n,r)=>{e.resetDsCurVal(),V(e.restEncoder,r);const i=n.length;V(e.restEncoder,i);for(let o=0;o<i;o++){const a=n[o];e.writeDsClock(a.clock),e.writeDsLen(a.len)}})},Cr=e=>{const t=new Je,n=$(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const i=$(e.restDecoder),o=$(e.restDecoder);if(o>0){const a=bt(t.clients,i,()=>[]);for(let u=0;u<o;u++)a.push(new _r(e.readDsClock(),e.readDsLen()))}}return t},rs=(e,t,n)=>{const r=new Je,i=$(e.restDecoder);for(let o=0;o<i;o++){e.resetDsCurVal();const a=$(e.restDecoder),u=$(e.restDecoder),c=n.clients.get(a)||[],m=ht(n,a);for(let w=0;w<u;w++){const h=e.readDsClock(),p=h+e.readDsLen();if(h<m){m<p&&gn(r,a,m,p-m);let g=Mt(c,h),f=c[g];for(!f.deleted&&f.id.clock<h&&(c.splice(g+1,0,Cn(t,f,h-f.id.clock)),g++);g<c.length&&(f=c[g++],f.id.clock<p);)f.deleted||(p<f.id.clock+f.length&&c.splice(g,0,Cn(t,f,p-f.id.clock)),f.delete(t))}else gn(r,a,h,p-h)}}if(r.clients.size>0){const o=new he;return V(o.restEncoder,0),Ae(o,r),o.toUint8Array()}return null},Ws=Fs;class De extends Rn{constructor({guid:t=Bs(),collectionid:n=null,gc:r=!0,gcFilter:i=()=>!0,meta:o=null,autoLoad:a=!1,shouldLoad:u=!0}={}){super(),this.gc=r,this.gcFilter=i,this.clientID=Ws(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new Zs,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=u,this.autoLoad=a,this.meta=o,this.isLoaded=!1,this.whenLoaded=el(c=>{this.on("load",()=>{this.isLoaded=!0,c(this)})})}load(){const t=this._item;t!==null&&!this.shouldLoad&&tt(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Array.from(this.subdocs).map(t=>t.guid))}transact(t,n=null){tt(this,t,n)}get(t,n=ft){const r=bt(this.share,t,()=>{const o=new n;return o._integrate(this,null),o}),i=r.constructor;if(n!==ft&&i!==n)if(i===ft){const o=new n;o._map=r._map,r._map.forEach(a=>{for(;a!==null;a=a.left)a.parent=o}),o._start=r._start;for(let a=o._start;a!==null;a=a.right)a.parent=o;return o._length=r._length,this.share.set(t,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return r}getArray(t=""){return this.get(t,Vt)}getText(t=""){return this.get(t,Te)}getMap(t=""){return this.get(t,Wt)}getXmlFragment(t=""){return this.get(t,de)}toJSON(){const t={};return this.share.forEach((n,r)=>{t[r]=n.toJSON()}),t}destroy(){Ss(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new De({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,tt(t.parent.doc,r=>{const i=n.doc;t.deleted||r.subdocsAdded.add(i),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(t,n){super.on(t,n)}off(t,n){super.off(t,n)}}class $s{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return $(this.restDecoder)}readDsLen(){return $(this.restDecoder)}}class Ys extends $s{readLeftID(){return z($(this.restDecoder),$(this.restDecoder))}readRightID(){return z($(this.restDecoder),$(this.restDecoder))}readClient(){return $(this.restDecoder)}readInfo(){return ue(this.restDecoder)}readString(){return qt(this.restDecoder)}readParentInfo(){return $(this.restDecoder)===1}readTypeRef(){return $(this.restDecoder)}readLen(){return $(this.restDecoder)}readAny(){return Ee(this.restDecoder)}readBuf(){return qo(ct(this.restDecoder))}readJSON(){return JSON.parse(qt(this.restDecoder))}readKey(){return qt(this.restDecoder)}}class ml{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=$(this.restDecoder),this.dsCurrVal}readDsLen(){const t=$(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class ke extends ml{constructor(t){super(t),this.keys=[],$(t),this.keyClockDecoder=new Vn(ct(t)),this.clientDecoder=new ln(ct(t)),this.leftClockDecoder=new Vn(ct(t)),this.rightClockDecoder=new Vn(ct(t)),this.infoDecoder=new Kr(ct(t),ue),this.stringDecoder=new Mo(ct(t)),this.parentInfoDecoder=new Kr(ct(t),ue),this.typeRefDecoder=new ln(ct(t)),this.lenDecoder=new ln(ct(t))}readLeftID(){return new ve(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new ve(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Ee(this.restDecoder)}readBuf(){return ct(this.restDecoder)}readJSON(){return Ee(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class Qs{constructor(){this.restEncoder=ut()}toUint8Array(){return nt(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){V(this.restEncoder,t)}writeDsLen(t){V(this.restEncoder,t)}}class ze extends Qs{writeLeftID(t){V(this.restEncoder,t.client),V(this.restEncoder,t.clock)}writeRightID(t){V(this.restEncoder,t.client),V(this.restEncoder,t.clock)}writeClient(t){V(this.restEncoder,t)}writeInfo(t){Ve(this.restEncoder,t)}writeString(t){xt(this.restEncoder,t)}writeParentInfo(t){V(this.restEncoder,t?1:0)}writeTypeRef(t){V(this.restEncoder,t)}writeLen(t){V(this.restEncoder,t)}writeAny(t){Se(this.restEncoder,t)}writeBuf(t){st(this.restEncoder,t)}writeJSON(t){xt(this.restEncoder,JSON.stringify(t))}writeKey(t){xt(this.restEncoder,t)}}class Gs{constructor(){this.restEncoder=ut(),this.dsCurrVal=0}toUint8Array(){return nt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,V(this.restEncoder,n)}writeDsLen(t){t===0&&Nt(),V(this.restEncoder,t-1),this.dsCurrVal+=t}}class he extends Gs{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Hn,this.clientEncoder=new an,this.leftClockEncoder=new Hn,this.rightClockEncoder=new Hn,this.infoEncoder=new zr(Ve),this.stringEncoder=new zo,this.parentInfoEncoder=new zr(Ve),this.typeRefEncoder=new an,this.lenEncoder=new an}toUint8Array(){const t=ut();return V(t,0),st(t,this.keyClockEncoder.toUint8Array()),st(t,this.clientEncoder.toUint8Array()),st(t,this.leftClockEncoder.toUint8Array()),st(t,this.rightClockEncoder.toUint8Array()),st(t,nt(this.infoEncoder)),st(t,this.stringEncoder.toUint8Array()),st(t,nt(this.parentInfoEncoder)),st(t,this.typeRefEncoder.toUint8Array()),st(t,this.lenEncoder.toUint8Array()),In(t,nt(this.restEncoder)),nt(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){Se(this.restEncoder,t)}writeBuf(t){st(this.restEncoder,t)}writeJSON(t){Se(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const yl=(e,t,n,r)=>{r=pe(r,t[0].id.clock);const i=Mt(t,r);V(e.restEncoder,t.length-i),e.writeClient(n),V(e.restEncoder,r);const o=t[i];o.write(e,r-o.id.clock);for(let a=i+1;a<t.length;a++)t[a].write(e,0)},Er=(e,t,n)=>{const r=new Map;n.forEach((i,o)=>{ht(t,o)>i&&r.set(o,i)}),On(t).forEach((i,o)=>{n.has(o)||r.set(o,0)}),V(e.restEncoder,r.size),Array.from(r.entries()).sort((i,o)=>o[0]-i[0]).forEach(([i,o])=>{yl(e,t.clients.get(i),i,o)})},wl=(e,t)=>{const n=Dt(),r=$(e.restDecoder);for(let i=0;i<r;i++){const o=$(e.restDecoder),a=new Array(o),u=e.readClient();let c=$(e.restDecoder);n.set(u,{i:0,refs:a});for(let m=0;m<o;m++){const w=e.readInfo();switch(An&w){case 0:{const h=e.readLen();a[m]=new yt(z(u,c),h),c+=h;break}case 10:{const h=$(e.restDecoder);a[m]=new wt(z(u,c),h),c+=h;break}default:{const h=(w&(Pt|mt))===0,p=new ot(z(u,c),null,(w&mt)===mt?e.readLeftID():null,null,(w&Pt)===Pt?e.readRightID():null,h?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,h&&(w&qe)===qe?e.readString():null,_i(e,w));a[m]=p,c+=p.length}}}}return n},bl=(e,t,n)=>{const r=[];let i=Array.from(n.keys()).sort((g,f)=>g-f);if(i.length===0)return null;const o=()=>{if(i.length===0)return null;let g=n.get(i[i.length-1]);for(;g.refs.length===g.i;)if(i.pop(),i.length>0)g=n.get(i[i.length-1]);else return null;return g};let a=o();if(a===null&&r.length===0)return null;const u=new Zs,c=new Map,m=(g,f)=>{const E=c.get(g);(E==null||E>f)&&c.set(g,f)};let w=a.refs[a.i++];const h=new Map,p=()=>{for(const g of r){const f=g.id.client,E=n.get(f);E?(E.i--,u.clients.set(f,E.refs.slice(E.i)),n.delete(f),E.i=0,E.refs=[]):u.clients.set(f,[g]),i=i.filter(L=>L!==f)}r.length=0};for(;;){if(w.constructor!==wt){const f=bt(h,w.id.client,()=>ht(t,w.id.client))-w.id.clock;if(f<0)r.push(w),m(w.id.client,w.id.clock-1),p();else{const E=w.getMissing(e,t);if(E!==null){r.push(w);const L=n.get(E)||{refs:[],i:0};if(L.refs.length===L.i)m(E,ht(t,E)),p();else{w=L.refs[L.i++];continue}}else(f===0||f<w.length)&&(w.integrate(e,f),h.set(w.id.client,w.id.clock+w.length))}}if(r.length>0)w=r.pop();else if(a!==null&&a.i<a.refs.length)w=a.refs[a.i++];else{if(a=o(),a===null)break;w=a.refs[a.i++]}}if(u.clients.size>0){const g=new he;return Er(g,u,new Map),V(g.restEncoder,0),{missing:c,update:g.toUint8Array()}}return null},_l=(e,t)=>Er(e,t.doc.store,t.beforeState),vl=(e,t,n,r=new ke(e))=>tt(t,i=>{i.local=!1;let o=!1;const a=i.doc,u=a.store,c=wl(r,a),m=bl(i,u,c),w=u.pendingStructs;if(w){for(const[p,g]of w.missing)if(g<ht(u,p)){o=!0;break}if(m){for(const[p,g]of m.missing){const f=w.missing.get(p);(f==null||f>g)&&w.missing.set(p,g)}w.update=mn([w.update,m.update])}}else u.pendingStructs=m;const h=rs(r,i,u);if(u.pendingDs){const p=new ke(Ft(u.pendingDs));$(p.restDecoder);const g=rs(p,i,u);h&&g?u.pendingDs=mn([h,g]):u.pendingDs=h||g}else u.pendingDs=h;if(o){const p=u.pendingStructs.update;u.pendingStructs=null,Ks(i.doc,p)}},n,!1),Ks=(e,t,n,r=ke)=>{const i=Ft(t);vl(i,e,n,new r(i))},Cl=(e,t,n)=>Ks(e,t,n,Ys),El=(e,t,n=new Map)=>{Er(e,t.store,n),Ae(e,gl(t.store))},Sl=(e,t=new Uint8Array([0]),n=new he)=>{const r=Js(t);El(n,e,r);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(Vl(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===ze)return Pl(i.map((o,a)=>a===0?o:Wl(o)));if(n.constructor===he)return mn(i)}return i[0]},kl=(e,t)=>Sl(e,t,new ze),Tl=e=>{const t=new Map,n=$(e.restDecoder);for(let r=0;r<n;r++){const i=$(e.restDecoder),o=$(e.restDecoder);t.set(i,o)}return t},Js=e=>Tl(new $s(Ft(e))),zs=(e,t)=>(V(e.restEncoder,t.size),Array.from(t.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{V(e.restEncoder,n),V(e.restEncoder,r)}),e),Rl=(e,t)=>zs(e,On(t.store)),Al=(e,t=new Gs)=>(e instanceof Map?zs(t,e):Rl(t,e),t.toUint8Array()),Dl=e=>Al(e,new Qs);class Il{constructor(){this.l=[]}}const ss=()=>new Il,is=(e,t)=>e.l.push(t),os=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter(i=>t!==i),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Xs=(e,t,n)=>cr(e.l,[t,n]);class ve{constructor(t,n){this.client=t,this.clock=n}}const nn=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,z=(e,t)=>new ve(e,t),xl=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Nt()};class Ll{constructor(t,n){this.ds=t,this.sv=n}}const Ol=(e,t)=>new Ll(e,t);Ol(Hs(),new Map);const Me=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!Vs(t.ds,e.id),cn=(e,t)=>{const n=bt(e.meta,cn,je),r=e.doc.store;n.has(t)||(t.sv.forEach((i,o)=>{i<ht(r,o)&&ee(e,z(o,i))}),nr(e,t.ds,i=>{}),n.add(t))};class Zs{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const On=e=>{const t=new Map;return e.clients.forEach((n,r)=>{const i=n[n.length-1];t.set(r,i.id.clock+i.length)}),t},ht=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},ti=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==t.id.clock)throw Nt()}n.push(t)},Mt=(e,t)=>{let n=0,r=e.length-1,i=e[r],o=i.id.clock;if(o===t)return r;let a=Ot(t/(o+i.length-1)*r);for(;n<=r;){if(i=e[a],o=i.id.clock,o<=t){if(t<o+i.length)return a;n=a+1}else r=a-1;a=Ot((n+r)/2)}throw Nt()},Nl=(e,t)=>{const n=e.clients.get(t.client);return n[Mt(n,t.clock)]},Yn=Nl,rr=(e,t,n)=>{const r=Mt(t,n),i=t[r];return i.id.clock<n&&i instanceof ot?(t.splice(r+1,0,Cn(e,i,n-i.id.clock)),r+1):r},ee=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[rr(e,n,t.clock)]},ls=(e,t,n)=>{const r=t.clients.get(n.client),i=Mt(r,n.clock),o=r[i];return n.clock!==o.id.clock+o.length-1&&o.constructor!==yt&&r.splice(i+1,0,Cn(e,o,n.clock-o.id.clock+1)),o},Ml=(e,t,n)=>{const r=e.clients.get(t.id.client);r[Mt(r,t.id.clock)]=n},ei=(e,t,n,r,i)=>{if(r===0)return;const o=n+r;let a=rr(e,t,n),u;do u=t[a++],o<u.id.clock+u.length&&rr(e,t,o),i(u);while(a<t.length&&t[a].id.clock<o)};class Ul{constructor(t,n,r){this.doc=t,this.deleteSet=new Je,this.beforeState=On(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set}}const as=(e,t)=>t.deleteSet.clients.size===0&&!ro(t.afterState,(n,r)=>t.beforeState.get(r)!==n)?!1:(vr(t.deleteSet),_l(e,t),Ae(e,t.deleteSet),!0),cs=(e,t,n)=>{const r=t._item;(r===null||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&bt(e.changed,t,je).add(n)},un=(e,t)=>{const n=e[t-1],r=e[t];n.deleted===r.deleted&&n.constructor===r.constructor&&n.mergeWith(r)&&(e.splice(t,1),r instanceof ot&&r.parentSub!==null&&r.parent._map.get(r.parentSub)===r&&r.parent._map.set(r.parentSub,n))},Fl=(e,t,n)=>{for(const[r,i]of e.clients.entries()){const o=t.clients.get(r);for(let a=i.length-1;a>=0;a--){const u=i[a],c=u.clock+u.len;for(let m=Mt(o,u.clock),w=o[m];m<o.length&&w.id.clock<c;w=o[++m]){const h=o[m];if(u.clock+u.len<=h.id.clock)break;h instanceof ot&&h.deleted&&!h.keep&&n(h)&&h.gc(t,!1)}}}},Bl=(e,t)=>{e.clients.forEach((n,r)=>{const i=t.clients.get(r);for(let o=n.length-1;o>=0;o--){const a=n[o],u=ar(i.length-1,1+Mt(i,a.clock+a.len-1));for(let c=u,m=i[c];c>0&&m.id.clock>=a.clock;m=i[--c])un(i,c)}})},ni=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,i=r.store,o=n.deleteSet,a=n._mergeStructs;try{vr(o),n.afterState=On(n.doc.store),r._transaction=null,r.emit("beforeObserverCalls",[n,r]);const u=[];n.changed.forEach((c,m)=>u.push(()=>{(m._item===null||!m._item.deleted)&&m._callObserver(n,c)})),u.push(()=>{n.changedParentTypes.forEach((c,m)=>u.push(()=>{(m._item===null||!m._item.deleted)&&(c=c.filter(w=>w.target._item===null||!w.target._item.deleted),c.forEach(w=>{w.currentTarget=m}),c.sort((w,h)=>w.path.length-h.path.length),Xs(m._dEH,c,n))})),u.push(()=>r.emit("afterTransaction",[n,r]))}),cr(u,[])}finally{r.gc&&Fl(o,i,r.gcFilter),Bl(o,i),n.afterState.forEach((w,h)=>{const p=n.beforeState.get(h)||0;if(p!==w){const g=i.clients.get(h),f=pe(Mt(g,p),1);for(let E=g.length-1;E>=f;E--)un(g,E)}});for(let w=0;w<a.length;w++){const{client:h,clock:p}=a[w].id,g=i.clients.get(h),f=Mt(g,p);f+1<g.length&&un(g,f+1),f>0&&un(g,f)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(Ps(Ln,gt,"[yjs] ",te,wr,"Changed the client-id because another client seems to be using it."),r.clientID=Ws()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const w=new ze;as(w,n)&&r.emit("update",[w.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const w=new he;as(w,n)&&r.emit("updateV2",[w.toUint8Array(),n.origin,r,n])}const{subdocsAdded:u,subdocsLoaded:c,subdocsRemoved:m}=n;(u.size>0||m.size>0||c.size>0)&&(u.forEach(w=>{w.clientID=r.clientID,w.collectionid==null&&(w.collectionid=r.collectionid),r.subdocs.add(w)}),m.forEach(w=>r.subdocs.delete(w)),r.emit("subdocs",[{loaded:c,added:u,removed:m},r,n]),m.forEach(w=>w.destroy())),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):ni(e,t+1)}}},tt=(e,t,n=null,r=!0)=>{const i=e._transactionCleanups;let o=!1;e._transaction===null&&(o=!0,e._transaction=new Ul(e,n,r),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{t(e._transaction)}finally{o&&i[0]===e._transaction&&ni(i,0)}};function*jl(e){const t=$(e.restDecoder);for(let n=0;n<t;n++){const r=$(e.restDecoder),i=e.readClient();let o=$(e.restDecoder);for(let a=0;a<r;a++){const u=e.readInfo();if(u===10){const c=$(e.restDecoder);yield new wt(z(i,o),c),o+=c}else if((An&u)!==0){const c=(u&(Pt|mt))===0,m=new ot(z(i,o),null,(u&mt)===mt?e.readLeftID():null,null,(u&Pt)===Pt?e.readRightID():null,c?e.readParentInfo()?e.readString():e.readLeftID():null,c&&(u&qe)===qe?e.readString():null,_i(e,u));yield m,o+=m.length}else{const c=e.readLen();yield new yt(z(i,o),c),o+=c}}}}class Sr{constructor(t,n){this.gen=jl(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===wt);return this.curr}}class kr{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const Pl=e=>mn(e,Ys,ze),ql=(e,t)=>{if(e.constructor===yt){const{client:n,clock:r}=e.id;return new yt(z(n,r+t),e.length-t)}else if(e.constructor===wt){const{client:n,clock:r}=e.id;return new wt(z(n,r+t),e.length-t)}else{const n=e,{client:r,clock:i}=n.id;return new ot(z(r,i+t),null,z(r,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},mn=(e,t=ke,n=he)=>{if(e.length===1)return e[0];const r=e.map(w=>new t(Ft(w)));let i=r.map(w=>new Sr(w,!0)),o=null;const a=new n,u=new kr(a);for(;i=i.filter(p=>p.curr!==null),i.sort((p,g)=>{if(p.curr.id.client===g.curr.id.client){const f=p.curr.id.clock-g.curr.id.clock;return f===0?p.curr.constructor===g.curr.constructor?0:p.curr.constructor===wt?1:-1:f}else return g.curr.id.client-p.curr.id.client}),i.length!==0;){const w=i[0],h=w.curr.id.client;if(o!==null){let p=w.curr,g=!1;for(;p!==null&&p.id.clock+p.length<=o.struct.id.clock+o.struct.length&&p.id.client>=o.struct.id.client;)p=w.next(),g=!0;if(p===null||p.id.client!==h||g&&p.id.clock>o.struct.id.clock+o.struct.length)continue;if(h!==o.struct.id.client)Xt(u,o.struct,o.offset),o={struct:p,offset:0},w.next();else if(o.struct.id.clock+o.struct.length<p.id.clock)if(o.struct.constructor===wt)o.struct.length=p.id.clock+p.length-o.struct.id.clock;else{Xt(u,o.struct,o.offset);const f=p.id.clock-o.struct.id.clock-o.struct.length;o={struct:new wt(z(h,o.struct.id.clock+o.struct.length),f),offset:0}}else{const f=o.struct.id.clock+o.struct.length-p.id.clock;f>0&&(o.struct.constructor===wt?o.struct.length-=f:p=ql(p,f)),o.struct.mergeWith(p)||(Xt(u,o.struct,o.offset),o={struct:p,offset:0},w.next())}}else o={struct:w.curr,offset:0},w.next();for(let p=w.curr;p!==null&&p.id.client===h&&p.id.clock===o.struct.id.clock+o.struct.length&&p.constructor!==wt;p=w.next())Xt(u,o.struct,o.offset),o={struct:p,offset:0}}o!==null&&(Xt(u,o.struct,o.offset),o=null),Tr(u);const c=r.map(w=>Cr(w)),m=pl(c);return Ae(a,m),a.toUint8Array()},Vl=(e,t,n=ke,r=he)=>{const i=Js(t),o=new r,a=new kr(o),u=new n(Ft(e)),c=new Sr(u,!1);for(;c.curr;){const w=c.curr,h=w.id.client,p=i.get(h)||0;if(c.curr.constructor===wt){c.next();continue}if(w.id.clock+w.length>p)for(Xt(a,w,pe(p-w.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)Xt(a,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=p;)c.next()}Tr(a);const m=Cr(u);return Ae(o,m),o.toUint8Array()},ri=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:nt(e.encoder.restEncoder)}),e.encoder.restEncoder=ut(),e.written=0)},Xt=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&ri(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),V(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Tr=e=>{ri(e);const t=e.encoder.restEncoder;V(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];V(t,r.written),In(t,r.restEncoder)}},Hl=(e,t,n)=>{const r=new t(Ft(e)),i=new Sr(r,!1),o=new n,a=new kr(o);for(let c=i.curr;c!==null;c=i.next())Xt(a,c,0);Tr(a);const u=Cr(r);return Ae(o,u),o.toUint8Array()},Wl=e=>Hl(e,ke,ze);class Nn{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null}get path(){return $l(this.currentTarget,this.target)}deletes(t){return Vs(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const o=n._map.get(i);let a,u;if(this.adds(o)){let c=o.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(o))if(c!==null&&this.deletes(c))a="delete",u=jn(c.content.getContent());else return;else c!==null&&this.deletes(c)?(a="update",u=jn(c.content.getContent())):(a="add",u=void 0)}else if(this.deletes(o))a="delete",u=jn(o.content.getContent());else return;t.set(i,{action:a,oldValue:u})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){const n=this.target,r=je(),i=je(),o=[];if(t={added:r,deleted:i,delta:o,keys:this.keys},this.transaction.changed.get(n).has(null)){let u=null;const c=()=>{u&&o.push(u)};for(let m=n._start;m!==null;m=m.right)m.deleted?this.deletes(m)&&!this.adds(m)&&((u===null||u.delete===void 0)&&(c(),u={delete:0}),u.delete+=m.length,i.add(m)):this.adds(m)?((u===null||u.insert===void 0)&&(c(),u={insert:[]}),u.insert=u.insert.concat(m.content.getContent()),r.add(m)):((u===null||u.retain===void 0)&&(c(),u={retain:0}),u.retain+=m.length);u!==null&&u.retain===void 0&&c()}this._changes=t}return t}}const $l=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let r=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)i.deleted||r++,i=i.right;n.unshift(r)}t=t._item.parent}return n},si=80;let Rr=0;class Yl{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Rr++}}const Ql=e=>{e.timestamp=Rr++},ii=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Rr++},Gl=(e,t,n)=>{if(e.length>=si){const r=e.reduce((i,o)=>i.timestamp<o.timestamp?i:o);return ii(r,t,n),r}else{const r=new Yl(t,n);return e.push(r),r}},Mn=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((o,a)=>on(t-o.index)<on(t-a.index)?o:a);let r=e._start,i=0;for(n!==null&&(r=n.p,i=n.index,Ql(n));r.right!==null&&i<t;){if(!r.deleted&&r.countable){if(t<i+r.length)break;i+=r.length}r=r.right}for(;r.left!==null&&i>t;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return n!==null&&on(n.index-i)<r.parent.length/si?(ii(n,r,i),n):Gl(e._searchMarker,r,i)},He=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const i=e[r];if(n>0){let o=i.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(i.index-=o.length);if(o===null||o.marker===!0){e.splice(r,1);continue}i.p=o,o.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=pe(t,i.index+n))}},Un=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;bt(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;Xs(r._eH,n,t)};class ft{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=ss(),this._dEH=ss(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw It()}clone(){throw It()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){is(this._eH,t)}observeDeep(t){is(this._dEH,t)}unobserve(t){os(this._eH,t)}unobserveDeep(t){os(this._dEH,t)}toJSON(){}}const oi=(e,t,n)=>{t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const i=[];let o=e._start;for(;o!==null&&r>0;){if(o.countable&&!o.deleted){const a=o.content.getContent();if(a.length<=t)t-=a.length;else{for(let u=t;u<a.length&&r>0;u++)i.push(a[u]),r--;t=0}}o=o.right}return i},li=e=>{const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let i=0;i<r.length;i++)t.push(r[i])}n=n.right}return t},We=(e,t)=>{let n=0,r=e._start;for(;r!==null;){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let o=0;o<i.length;o++)t(i[o],n++,e)}r=r.right}},ai=(e,t)=>{const n=[];return We(e,(r,i)=>{n.push(t(r,i,e))}),n},Kl=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const i=n[r++];return n.length<=r&&(n=null),{done:!1,value:i}}}},ci=(e,t)=>{const n=Mn(e,t);let r=e._start;for(n!==null&&(r=n.p,t-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},yn=(e,t,n,r)=>{let i=n;const o=e.doc,a=o.clientID,u=o.store,c=n===null?t._start:n.right;let m=[];const w=()=>{m.length>0&&(i=new ot(z(a,ht(u,a)),i,i&&i.lastId,c,c&&c.id,t,null,new fe(m)),i.integrate(e,0),m=[])};r.forEach(h=>{if(h===null)m.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:m.push(h);break;default:switch(w(),h.constructor){case Uint8Array:case ArrayBuffer:i=new ot(z(a,ht(u,a)),i,i&&i.lastId,c,c&&c.id,t,null,new Xe(new Uint8Array(h))),i.integrate(e,0);break;case De:i=new ot(z(a,ht(u,a)),i,i&&i.lastId,c,c&&c.id,t,null,new Ze(h)),i.integrate(e,0);break;default:if(h instanceof ft)i=new ot(z(a,ht(u,a)),i,i&&i.lastId,c,c&&c.id,t,null,new Yt(h)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),w()},ui=ne("Length exceeded!"),hi=(e,t,n,r)=>{if(n>t._length)throw ui;if(n===0)return t._searchMarker&&He(t._searchMarker,n,r.length),yn(e,t,null,r);const i=n,o=Mn(t,n);let a=t._start;for(o!==null&&(a=o.p,n-=o.index,n===0&&(a=a.prev,n+=a&&a.countable&&!a.deleted?a.length:0));a!==null;a=a.right)if(!a.deleted&&a.countable){if(n<=a.length){n<a.length&&ee(e,z(a.id.client,a.id.clock+n));break}n-=a.length}return t._searchMarker&&He(t._searchMarker,i,r.length),yn(e,t,a,r)},Jl=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((o,a)=>a.index>o.index?a:o,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return yn(e,t,i,n)},di=(e,t,n,r)=>{if(r===0)return;const i=n,o=r,a=Mn(t,n);let u=t._start;for(a!==null&&(u=a.p,n-=a.index);u!==null&&n>0;u=u.right)!u.deleted&&u.countable&&(n<u.length&&ee(e,z(u.id.client,u.id.clock+n)),n-=u.length);for(;r>0&&u!==null;)u.deleted||(r<u.length&&ee(e,z(u.id.client,u.id.clock+r)),u.delete(e),r-=u.length),u=u.right;if(r>0)throw ui;t._searchMarker&&He(t._searchMarker,i,-o+r)},wn=(e,t,n)=>{const r=t._map.get(n);r!==void 0&&r.delete(e)},Ar=(e,t,n,r)=>{const i=t._map.get(n)||null,o=e.doc,a=o.clientID;let u;if(r==null)u=new fe([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:u=new fe([r]);break;case Uint8Array:u=new Xe(r);break;case De:u=new Ze(r);break;default:if(r instanceof ft)u=new Yt(r);else throw new Error("Unexpected content type")}new ot(z(a,ht(o.store,a)),i,i&&i.lastId,null,null,t,n,u).integrate(e,0)},Dr=(e,t)=>{const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},fi=e=>{const t={};return e._map.forEach((n,r)=>{n.deleted||(t[r]=n.content.getContent()[n.length-1])}),t},pi=(e,t)=>{const n=e._map.get(t);return n!==void 0&&!n.deleted},rn=e=>dl(e.entries(),t=>!t[1].deleted);class zl extends Nn{constructor(t,n){super(t,n),this._transaction=n}}class Vt extends ft{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Vt;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Vt}clone(){const t=new Vt;return t.insert(0,this.toArray().map(n=>n instanceof ft?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,n){super._callObserver(t,n),Un(this,t,new zl(this,t))}insert(t,n){this.doc!==null?tt(this.doc,r=>{hi(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?tt(this.doc,n=>{Jl(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?tt(this.doc,r=>{di(r,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return ci(this,t)}toArray(){return li(this)}slice(t=0,n=this.length){return oi(this,t,n)}toJSON(){return this.map(t=>t instanceof ft?t.toJSON():t)}map(t){return ai(this,t)}forEach(t){We(this,t)}[Symbol.iterator](){return Kl(this)}_write(t){t.writeTypeRef(_a)}}const Xl=e=>new Vt;class Zl extends Nn{constructor(t,n,r){super(t,n),this.keysChanged=r}}class Wt extends ft{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((r,i)=>{this.set(i,r)}),this._prelimContent=null}_copy(){return new Wt}clone(){const t=new Wt;return this.forEach((n,r)=>{t.set(r,n instanceof ft?n.clone():n)}),t}_callObserver(t,n){Un(this,t,new Zl(this,t,n))}toJSON(){const t={};return this._map.forEach((n,r)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[r]=i instanceof ft?i.toJSON():i}}),t}get size(){return[...rn(this._map)].length}keys(){return $n(rn(this._map),t=>t[0])}values(){return $n(rn(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return $n(rn(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this._map.forEach((n,r)=>{n.deleted||t(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?tt(this.doc,n=>{wn(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?tt(this.doc,r=>{Ar(r,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Dr(this,t)}has(t){return pi(this,t)}clear(){this.doc!==null?tt(this.doc,t=>{this.forEach(function(n,r,i){wn(t,i,r)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(va)}}const ta=e=>new Wt,Zt=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&wo(e,t);class sr{constructor(t,n,r,i){this.left=t,this.right=n,this.index=r,this.currentAttributes=i}forward(){switch(this.right===null&&Nt(),this.right.content.constructor){case lt:this.right.deleted||Ie(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const us=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case lt:t.right.deleted||Ie(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&ee(e,z(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},sn=(e,t,n)=>{const r=new Map,i=Mn(t,n);if(i){const o=new sr(i.p.left,i.p,i.index,r);return us(e,o,n-i.index)}else{const o=new sr(null,t._start,0,r);return us(e,o,n)}},gi=(e,t,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===lt&&Zt(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const i=e.doc,o=i.clientID;r.forEach((a,u)=>{const c=n.left,m=n.right,w=new ot(z(o,ht(i.store,o)),c,c&&c.lastId,m,m&&m.id,t,null,new lt(u,a));w.integrate(e,0),n.right=w,n.forward()})},Ie=(e,t)=>{const{key:n,value:r}=t;r===null?e.delete(n):e.set(n,r)},mi=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===lt&&Zt(t[e.right.content.key]||null,e.right.content.value)))break;e.forward()}},yi=(e,t,n,r)=>{const i=e.doc,o=i.clientID,a=new Map;for(const u in r){const c=r[u],m=n.currentAttributes.get(u)||null;if(!Zt(m,c)){a.set(u,m);const{left:w,right:h}=n;n.right=new ot(z(o,ht(i.store,o)),w,w&&w.lastId,h,h&&h.id,t,null,new lt(u,c)),n.right.integrate(e,0),n.forward()}}return a},Qn=(e,t,n,r,i)=>{n.currentAttributes.forEach((p,g)=>{i[g]===void 0&&(i[g]=null)});const o=e.doc,a=o.clientID;mi(n,i);const u=yi(e,t,n,i),c=r.constructor===String?new Ut(r):r instanceof ft?new Yt(r):new me(r);let{left:m,right:w,index:h}=n;t._searchMarker&&He(t._searchMarker,n.index,c.getLength()),w=new ot(z(a,ht(o.store,a)),m,m&&m.lastId,w,w&&w.id,t,null,c),w.integrate(e,0),n.right=w,n.index=h,n.forward(),gi(e,t,n,u)},hs=(e,t,n,r,i)=>{const o=e.doc,a=o.clientID;mi(n,i);const u=yi(e,t,n,i);t:for(;n.right!==null&&(r>0||u.size>0&&(n.right.deleted||n.right.content.constructor===lt));){if(!n.right.deleted)switch(n.right.content.constructor){case lt:{const{key:c,value:m}=n.right.content,w=i[c];if(w!==void 0){if(Zt(w,m))u.delete(c);else{if(r===0)break t;u.set(c,m)}n.right.delete(e)}else n.currentAttributes.set(c,m);break}default:r<n.right.length&&ee(e,z(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new ot(z(a,ht(o.store,a)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Ut(c)),n.right.integrate(e,0),n.forward()}gi(e,t,n,u)},wi=(e,t,n,r,i)=>{let o=n;const a=dn(i);for(;o&&(!o.countable||o.deleted);)!o.deleted&&o.content.constructor===lt&&Ie(a,o.content),o=o.right;let u=0,c=!1;for(;t!==o;){if(n===t&&(c=!0),!t.deleted){const m=t.content;switch(m.constructor){case lt:{const{key:w,value:h}=m;((a.get(w)||null)!==h||(r.get(w)||null)===h)&&(t.delete(e),u++,!c&&(i.get(w)||null)===h&&(r.get(w)||null)!==h&&i.delete(w));break}}}t=t.right}return u},ea=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===lt){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},na=e=>{let t=0;return tt(e.doc,n=>{let r=e._start,i=e._start,o=Dt();const a=dn(o);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case lt:Ie(a,i.content);break;default:t+=wi(n,r,i,o,a),o=dn(a),r=i;break}i=i.right}}),t},ds=(e,t,n)=>{const r=n,i=dn(t.currentAttributes),o=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Yt:case me:case Ut:n<t.right.length&&ee(e,z(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}o&&wi(e,o,t.right,i,t.currentAttributes);const a=(t.left||t.right).parent;return a._searchMarker&&He(a._searchMarker,t.index,-r+n),t};class ra extends Nn{constructor(t,n,r){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];tt(t,r=>{const i=new Map,o=new Map;let a=this.target._start,u=null;const c={};let m="",w=0,h=0;const p=()=>{if(u!==null){let g;switch(u){case"delete":g={delete:h},h=0;break;case"insert":g={insert:m},i.size>0&&(g.attributes={},i.forEach((f,E)=>{f!==null&&(g.attributes[E]=f)})),m="";break;case"retain":if(g={retain:w},Object.keys(c).length>0){g.attributes={};for(const f in c)g.attributes[f]=c[f]}w=0;break}n.push(g),u=null}};for(;a!==null;){switch(a.content.constructor){case Yt:case me:this.adds(a)?this.deletes(a)||(p(),u="insert",m=a.content.getContent()[0],p()):this.deletes(a)?(u!=="delete"&&(p(),u="delete"),h+=1):a.deleted||(u!=="retain"&&(p(),u="retain"),w+=1);break;case Ut:this.adds(a)?this.deletes(a)||(u!=="insert"&&(p(),u="insert"),m+=a.content.str):this.deletes(a)?(u!=="delete"&&(p(),u="delete"),h+=a.length):a.deleted||(u!=="retain"&&(p(),u="retain"),w+=a.length);break;case lt:{const{key:g,value:f}=a.content;if(this.adds(a)){if(!this.deletes(a)){const E=i.get(g)||null;Zt(E,f)?f!==null&&a.delete(r):(u==="retain"&&p(),Zt(f,o.get(g)||null)?delete c[g]:c[g]=f)}}else if(this.deletes(a)){o.set(g,f);const E=i.get(g)||null;Zt(E,f)||(u==="retain"&&p(),c[g]=E)}else if(!a.deleted){o.set(g,f);const E=c[g];E!==void 0&&(Zt(E,f)?E!==null&&a.delete(r):(u==="retain"&&p(),f===null?delete c[g]:c[g]=f))}a.deleted||(u==="insert"&&p(),Ie(i,a.content));break}}a=a.right}for(p();n.length>0;){const g=n[n.length-1];if(g.retain!==void 0&&g.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Te extends ft{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[]}get length(){return this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new Te}clone(){const t=new Te;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const r=new ra(this,t,n),i=t.doc;if(Un(this,t,r),!t.local){let o=!1;for(const[a,u]of t.afterState.entries()){const c=t.beforeState.get(a)||0;if(u!==c&&(ei(t,i.store.clients.get(a),c,u,m=>{!m.deleted&&m.content.constructor===lt&&(o=!0)}),o))break}o||nr(t,t.deleteSet,a=>{a instanceof yt||o||a.parent===this&&a.content.constructor===lt&&(o=!0)}),tt(i,a=>{o?na(this):nr(a,a.deleteSet,u=>{u instanceof yt||u.parent===this&&ea(a,u)})})}}toString(){let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Ut&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?tt(this.doc,r=>{const i=new sr(null,this._start,0,new Map);for(let o=0;o<t.length;o++){const a=t[o];if(a.insert!==void 0){const u=!n&&typeof a.insert=="string"&&o===t.length-1&&i.right===null&&a.insert.slice(-1)===`
`?a.insert.slice(0,-1):a.insert;(typeof u!="string"||u.length>0)&&Qn(r,this,i,u,a.attributes||{})}else a.retain!==void 0?hs(r,this,i,a.retain,a.attributes||{}):a.delete!==void 0&&ds(r,i,a.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,r){const i=[],o=new Map,a=this.doc;let u="",c=this._start;function m(){if(u.length>0){const w={};let h=!1;o.forEach((g,f)=>{h=!0,w[f]=g});const p={insert:u};h&&(p.attributes=w),i.push(p),u=""}}return tt(a,w=>{for(t&&cn(w,t),n&&cn(w,n);c!==null;){if(Me(c,t)||n!==void 0&&Me(c,n))switch(c.content.constructor){case Ut:{const h=o.get("ychange");t!==void 0&&!Me(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(m(),o.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Me(c,n)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(m(),o.set("ychange",r?r("added",c.id):{type:"added"})):h!==void 0&&(m(),o.delete("ychange")),u+=c.content.str;break}case Yt:case me:{m();const h={insert:c.content.getContent()[0]};if(o.size>0){const p={};h.attributes=p,o.forEach((g,f)=>{p[f]=g})}i.push(h);break}case lt:Me(c,t)&&(m(),Ie(o,c.content));break}c=c.right}m()},cn),i}insert(t,n,r){if(n.length<=0)return;const i=this.doc;i!==null?tt(i,o=>{const a=sn(o,this,t);r||(r={},a.currentAttributes.forEach((u,c)=>{r[c]=u})),Qn(o,this,a,n,r)}):this._pending.push(()=>this.insert(t,n,r))}insertEmbed(t,n,r={}){const i=this.doc;i!==null?tt(i,o=>{const a=sn(o,this,t);Qn(o,this,a,n,r)}):this._pending.push(()=>this.insertEmbed(t,n,r))}delete(t,n){if(n===0)return;const r=this.doc;r!==null?tt(r,i=>{ds(i,sn(i,this,t),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,r){if(n===0)return;const i=this.doc;i!==null?tt(i,o=>{const a=sn(o,this,t);a.right!==null&&hs(o,this,a,n,r)}):this._pending.push(()=>this.format(t,n,r))}removeAttribute(t){this.doc!==null?tt(this.doc,n=>{wn(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?tt(this.doc,r=>{Ar(r,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Dr(this,t)}getAttributes(t){return fi(this)}_write(t){t.writeTypeRef(Ca)}}const sa=e=>new Te;class Gn{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===$e||n.constructor===de)&&n._start!==null)t=n._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class de extends ft{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new de}clone(){const t=new de;return t.insert(0,this.toArray().map(n=>n instanceof ft?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Gn(this,t)}querySelector(t){t=t.toUpperCase();const r=new Gn(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return r.done?null:r.value}querySelectorAll(t){return t=t.toUpperCase(),Array.from(new Gn(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){Un(this,t,new la(this,n,t))}toString(){return ai(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},r){const i=t.createDocumentFragment();return r!==void 0&&r._createAssociation(i,this),We(this,o=>{i.insertBefore(o.toDOM(t,n,r),null)}),i}insert(t,n){this.doc!==null?tt(this.doc,r=>{hi(r,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)tt(this.doc,r=>{const i=t&&t instanceof ft?t._item:t;yn(r,this,i,n)});else{const r=this._prelimContent,i=t===null?0:r.findIndex(o=>o===t)+1;if(i===0&&t!==null)throw ne("Reference item not found");r.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?tt(this.doc,r=>{di(r,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return li(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return ci(this,t)}slice(t=0,n=this.length){return oi(this,t,n)}forEach(t){We(this,t)}_write(t){t.writeTypeRef(Sa)}}const ia=e=>new de;class $e extends de{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((r,i)=>{this.setAttribute(i,r)}),this._prelimAttrs=null}_copy(){return new $e(this.nodeName)}clone(){const t=new $e(this.nodeName),n=this.getAttributes();for(const r in n)t.setAttribute(r,n[r]);return t.insert(0,this.toArray().map(r=>r instanceof ft?r.clone():r)),t}toString(){const t=this.getAttributes(),n=[],r=[];for(const u in t)r.push(u);r.sort();const i=r.length;for(let u=0;u<i;u++){const c=r[u];n.push(c+'="'+t[c]+'"')}const o=this.nodeName.toLocaleLowerCase(),a=n.length>0?" "+n.join(" "):"";return`<${o}${a}>${super.toString()}</${o}>`}removeAttribute(t){this.doc!==null?tt(this.doc,n=>{wn(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?tt(this.doc,r=>{Ar(r,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Dr(this,t)}hasAttribute(t){return pi(this,t)}getAttributes(t){return fi(this)}toDOM(t=document,n={},r){const i=t.createElement(this.nodeName),o=this.getAttributes();for(const a in o)i.setAttribute(a,o[a]);return We(this,a=>{i.appendChild(a.toDOM(t,n,r))}),r!==void 0&&r._createAssociation(i,this),i}_write(t){t.writeTypeRef(Ea),t.writeKey(this.nodeName)}}const oa=e=>new $e(e.readKey());class la extends Nn{constructor(t,n,r){super(t,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class bn extends Wt{constructor(t){super(),this.hookName=t}_copy(){return new bn(this.hookName)}clone(){const t=new bn(this.hookName);return this.forEach((n,r)=>{t.set(r,n)}),t}toDOM(t=document,n={},r){const i=n[this.hookName];let o;return i!==void 0?o=i.createDom(this):o=document.createElement(this.hookName),o.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(o,this),o}_write(t){t.writeTypeRef(ka),t.writeKey(this.hookName)}}const aa=e=>new bn(e.readKey());class _n extends Te{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new _n}clone(){const t=new _n;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,r){const i=t.createTextNode(this.toString());return r!==void 0&&r._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const o=[];for(const a in t.attributes[i])o.push({key:a,value:t.attributes[i][a]});o.sort((a,u)=>a.key<u.key?-1:1),n.push({nodeName:i,attrs:o})}n.sort((i,o)=>i.nodeName<o.nodeName?-1:1);let r="";for(let i=0;i<n.length;i++){const o=n[i];r+=`<${o.nodeName}`;for(let a=0;a<o.attrs.length;a++){const u=o.attrs[a];r+=` ${u.key}="${u.value}"`}r+=">"}r+=t.insert;for(let i=n.length-1;i>=0;i--)r+=`</${n[i].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Ta)}}const ca=e=>new _n;class Ir{constructor(t,n){this.id=t,this.length=n}get deleted(){throw It()}mergeWith(t){return!1}write(t,n,r){throw It()}integrate(t,n){throw It()}}const ua=0;class yt extends Ir{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),ti(t.doc.store,this)}write(t,n){t.writeInfo(ua),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Xe{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Xe(this.content)}splice(t){throw It()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const ha=e=>new Xe(e.readBuf());class Ye{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ye(this.len)}splice(t){const n=new Ye(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){gn(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const da=e=>new Ye(e.readLen()),bi=(e,t)=>new De({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Ze{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Ze(bi(this.doc.guid,this.opts))}splice(t){throw It()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const fa=e=>new Ze(bi(e.readString(),e.readAny()));class me{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new me(this.embed)}splice(t){throw It()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const pa=e=>new me(e.readJSON());class lt{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new lt(this.key,this.value)}splice(t){throw It()}mergeWith(t){return!1}integrate(t,n){n.parent._searchMarker=null}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const ga=e=>new lt(e.readKey(),e.readJSON());class vn{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new vn(this.arr)}splice(t){const n=new vn(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const o=this.arr[i];t.writeString(o===void 0?"undefined":JSON.stringify(o))}}getRef(){return 2}}const ma=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new vn(n)};class fe{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new fe(this.arr)}splice(t){const n=new fe(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const r=this.arr.length;t.writeLen(r-n);for(let i=n;i<r;i++){const o=this.arr[i];t.writeAny(o)}}getRef(){return 8}}const ya=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new fe(n)};class Ut{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Ut(this.str)}splice(t){const n=new Ut(this.str.slice(t));this.str=this.str.slice(0,t);const r=this.str.charCodeAt(t-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,t-1)+"\uFFFD",n.str="\uFFFD"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const wa=e=>new Ut(e.readString()),ba=[Xl,ta,sa,oa,ia,aa,ca],_a=0,va=1,Ca=2,Ea=3,Sa=4,ka=5,Ta=6;class Yt{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Yt(this.type._copy())}splice(t){throw It()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(r=>{r.deleted?t._mergeStructs.push(r):r.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(t,!0),r=r.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const Ra=e=>new Yt(ba[e.readTypeRef()](e));const Cn=(e,t,n)=>{const{client:r,clock:i}=t.id,o=new ot(z(r,i+n),t,z(r,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&o.markDeleted(),t.keep&&(o.keep=!0),t.redone!==null&&(o.redone=z(t.redone.client,t.redone.clock+n)),t.right=o,o.right!==null&&(o.right.left=o),e._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),t.length=n,o};class ot extends Ir{constructor(t,n,r,i,o,a,u,c){super(t,c.getLength()),this.origin=r,this.left=n,this.right=i,this.rightOrigin=o,this.parent=a,this.parentSub=u,this.redone=null,this.content=c,this.info=this.content.isCountable()?Gr:0}set marker(t){(this.info&qn)>0!==t&&(this.info^=qn)}get marker(){return(this.info&qn)>0}get keep(){return(this.info&Qr)>0}set keep(t){this.keep!==t&&(this.info^=Qr)}get countable(){return(this.info&Gr)>0}get deleted(){return(this.info&Pn)>0}set deleted(t){this.deleted!==t&&(this.info^=Pn)}markDeleted(){this.info|=Pn}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=ht(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=ht(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===ve&&this.id.client!==this.parent.client&&this.parent.clock>=ht(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=ls(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=ee(t,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===yt||this.right&&this.right.constructor===yt)&&(this.parent=null),!this.parent)this.left&&this.left.constructor===ot&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===ot&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===ve){const r=Yn(n,this.parent);r.constructor===yt?this.parent=null:this.parent=r.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=ls(t,t.doc.store,z(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,i;if(r!==null)i=r.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const o=new Set,a=new Set;for(;i!==null&&i!==this.right;){if(a.add(i),o.add(i),nn(this.origin,i.origin)){if(i.id.client<this.id.client)r=i,o.clear();else if(nn(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&a.has(Yn(t.doc.store,i.origin)))o.has(Yn(t.doc.store,i.origin))||(r=i,o.clear());else break;i=i.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),ti(t.doc.store,this),this.content.integrate(t,this),cs(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new yt(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:z(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&nn(t.origin,this.lastId)&&this.right===t&&nn(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===t&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),gn(t.deleteSet,this.id.client,this.id.clock,this.length),cs(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Nt();this.content.gc(t),n?Ml(t,this,new yt(this.id,this.length)):this.content=new Ye(this.length)}write(t,n){const r=n>0?z(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,o=this.parentSub,a=this.content.getRef()&An|(r===null?0:mt)|(i===null?0:Pt)|(o===null?0:qe);if(t.writeInfo(a),r!==null&&t.writeLeftID(r),i!==null&&t.writeRightID(i),r===null&&i===null){const u=this.parent;if(u._item!==void 0){const c=u._item;if(c===null){const m=xl(u);t.writeParentInfo(!0),t.writeString(m)}else t.writeParentInfo(!1),t.writeLeftID(c.id)}else u.constructor===String?(t.writeParentInfo(!0),t.writeString(u)):u.constructor===ve?(t.writeParentInfo(!1),t.writeLeftID(u)):Nt();o!==null&&t.writeString(o)}this.content.write(t,n)}}const _i=(e,t)=>Aa[t&An](e),Aa=[()=>{Nt()},da,ma,ha,wa,pa,ga,Ra,ya,fa,()=>{Nt()}],Da=10;class wt extends Ir{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Nt()}write(t,n){t.writeInfo(Da),V(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const vi=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},Ci="__ $YJS$ __";vi[Ci]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");vi[Ci]=!0;const Ei=e=>!!e&&(e.type==="object"||e.type==="array"||e.type==="changed"),fs=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Ia=(e,t,n)=>{const r=[],i=[],o=[];for(const[a,u]of Object.entries(t))if(!fs(e,a))r.push({type:"added",key:a,value:u});else if(e[a]!==u){const c=En(e[a],u,a);Ei(c)&&o.push(c)}for(const a of Object.keys(e))fs(t,a)||i.push({type:"deleted",key:a});return r.length===0&&i.length===0&&o.length===0?null:{type:"object",key:n,addedResults:r,deletedResults:i,updatedResults:o}},xa=(e,t,n)=>{const r=[],i=[],o=[];for(let a=0;a<t.length;a++)if(a>=e.length)r.push({type:"added",key:a,value:t[a]});else if(e[a]!==t[a]){const u=En(e[a],t[a],a);Ei(u)&&o.push(u)}for(let a=t.length;a<e.length;a++)i.push({type:"deleted",key:a});return r.length===0&&i.length===0&&o.length===0?null:{type:"array",key:n,addedResults:r,deletedResults:i,updatedResults:o}},En=(e,t,n)=>e===t?null:e===null||t===null?{type:"changed",key:n,value:t}:Array.isArray(e)&&Array.isArray(t)?xa(e,t,n):typeof e=="object"&&typeof t=="object"?Ia(e,t,n):{type:"changed",key:n,value:t},La=(e,t)=>{const n={...e};for(const r of t.addedResults){if(typeof r.key!="string")throw new Error(`Expected key to be a string, got ${r.key}`);n[r.key]=r.value}for(const r of t.updatedResults){if(typeof r.key!="string")throw new Error(`Expected key to be a string, got ${r.key}`);n[r.key]=xr(n[r.key],r)}for(const r of t.deletedResults){if(typeof r.key!="string")throw new Error(`Expected key to be a string, got ${r.key}`);delete n[r.key]}return n},Oa=(e,t)=>{const n=[...e];for(const r of t.updatedResults){if(typeof r.key!="number")throw new Error(`Expected key to be a number, got ${r.key}`);n[r.key]=xr(n[r.key],r)}for(let r=t.deletedResults.length-1;r>=0;r--){const i=t.deletedResults[r];if(typeof i.key!="number")throw new Error(`Expected key to be a number, got ${i.key}`);n.splice(i.key,1)}if(t.addedResults.length>0){const r=t.addedResults.map(i=>i.value);n.push(...r)}return n},xr=(e,t)=>{if(t===null)return e;if(t.type==="object")return La(e,t);if(t.type==="array")return Oa(e,t);if(t.type==="changed")return t.value;throw new Error(`Unknown diff result: ${t}`)},Na=(e,t)=>{const n=t!=null?t:new Vt;for(const r of e)n.push([tn(r)]);return n},Ma=(e,t)=>{const n=t!=null?t:new Wt;for(const[r,i]of Object.entries(e))n.set(r,tn(i));return n};function tn(e){if(Array.isArray(e))return Na(e);if(typeof e=="object"&&e!==null)return Ma(e);if(e===void 0)return null;if(typeof e=="string"||typeof e=="number"||typeof e=="boolean")return e;throw new Error(`Cannot convert ${e} to Yjs type`)}const Ua=(e,t)=>{for(const n of t.updatedResults){if(typeof n.key!="number")throw new Error(`Expected key to be a number, got ${n.key}`);const r=e.get(n.key),i=Lr(r,n);i!==r&&(e.delete(n.key,1),e.insert(n.key,[i]))}for(let n=t.deletedResults.length-1;n>=0;n--){const r=t.deletedResults[n];if(typeof r.key!="number")throw new Error(`Expected key to be a number, got ${r.key}`);e.delete(r.key,1)}if(t.addedResults.length>0){const n=t.addedResults.map(r=>tn(r.value));e.push(n)}},Fa=(e,t)=>{for(const n of t.addedResults){if(typeof n.key!="string")throw new Error(`Expected key to be a string, got ${n.key}`);e.set(n.key,tn(n.value))}for(const n of t.updatedResults){if(typeof n.key!="string")throw new Error(`Expected key to be a string, got ${n.key}`);const r=e.get(n.key),i=Lr(r,n);i!==r&&e.set(n.key,i)}for(const n of t.deletedResults){if(typeof n.key!="string")throw new Error(`Expected key to be a string, got ${n.key}`);e.delete(n.key)}},Lr=(e,t)=>{if(t===null)return e;if(t.type==="object"){if(e instanceof Wt)return Fa(e,t),e;throw new Error(`Expected value to be a Y.Map, got ${e}`)}if(t.type==="array"){if(e instanceof Vt)return Ua(e,t),e;throw new Error(`Expected value to be a Y.Array, got ${e}`)}if(t.type==="changed")return tn(t.value);throw new Error(`Unknown diff result: ${t}`)},Si="from-remesh-yjs",Ba=e=>new Yi(t=>{const n=(o,a)=>{if(a.origin!==Si){const u=e.toJSON();t.next(u)}},r=()=>{e.observeDeep(n)},i=()=>{e.unobserveDeep(n)};return r(),()=>{i()}}),ja=()=>Tt.extern({default:null}),ki=ja(),Pa=(e,t)=>{var p,g;const n=(p=t.inspectable)!=null?p:!1,r=e.getExtern((g=t.extern)!=null?g:ki);if(r===null)return;const{doc:i}=r;function o(f){if(!(Array.isArray(f)&&t.dataType==="array")&&!(f!==null&&typeof f=="object"&&t.dataType==="object"))throw new Error(`Expected value to be of type ${t.dataType}, got ${f}`)}const a=i.get(t.key,t.dataType==="object"?Wt:Vt),u=(f,E,L)=>{tt(i,()=>{Lr(a,f)},E,L)},c=Tt.event({name:"ReceivedEvent",inspectable:n}),m=Tt.event({name:"SendEvent",inspectable:n}),w=e.query({name:"DataForSyncQuery",inspectable:n,impl:t.onSend}),h=e.command({name:"SyncDataCommand",inspectable:n,impl:(f,E)=>[t.onReceive(f,E),c(E)]});e.effect({name:"YjsEffect",inspectable:n,impl:({get:f,fromQuery:E})=>{const L=E(w()).pipe(Be(U=>{o(U);const y=a.toJSON(),_=En(y,U);return _===null?null:(u(_,Si),m(U))})),x=Ba(a).pipe(Be(U=>{o(U);const y=f(w()),_=En(y,U);if(_===null)return null;const v=xr(y,_);return h(v)}));return Gi(L,x)}})},Ti=(e,t)=>{if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Or(e[n],t[n]))return!1;return!0},qa=(e,t)=>{if(e===null||t===null)return!1;const n=Object.keys(e),r=Object.keys(t);if(!Ti(n,r))return!1;for(const i of n)if(!Or(e[i],t[i]))return!1;return!0},Or=(e,t)=>e===t?!0:Array.isArray(e)&&Array.isArray(t)?Ti(e,t):typeof e=="object"&&typeof t=="object"?qa(e,t):e===t,Va=e=>{if(!e)return Be(t=>t);if(e.type==="debounce")return Xi(e.dueTime);if(e.type==="throttle")return to(e.duration,void 0,{leading:e.leading,trailing:e.trailing});throw new Error(`Unexpected timing: ${e}`)},Ha=(e,t)=>{var v;const n=(v=t.maxLength)!=null?v:20,r=S=>S.length>=n?S.slice(-n):S,i=e.state({name:"HistoryListState",default:t.default?r(t.default):[]}),o=e.state({name:"CurrentIndexState",default:null}),a=e.query({name:"CurrentIndexQuery",impl:({get:S})=>S(o())}),u=e.command({name:"SetCommand",impl:({get:S},C)=>{const R=r(C);return S(o())===null?i().new(R):[i().new(R),o().new(R.length-1)]}}),c=e.command({name:"AddCommand",impl:({get:S},C)=>{const R=S(w()),M=S(o());return M===null||M===R.length-1?u([...R,C]):u([...R.slice(0,M+1),C])}}),m=e.command({name:"ReplaceCommand",impl:({get:S},C)=>{const R=S(w()),M=S(o());return M===null||M===R.length-1?u([...R.slice(0,-1),C]):u([...R.slice(0,M),C])}}),w=e.query({name:"HistoryListQuery",impl:({get:S})=>S(i())}),h=e.query({name:"CurrentStateQuery",impl:({get:S})=>{var M;const C=S(i()),R=S(a());return R===null?null:(M=C[R])!=null?M:null}}),p=e.query({name:"CanBackQuery",impl:({get:S})=>{const C=S(i()),R=S(o());return(R===null||R>0)&&C.length>1}}),g=e.query({name:"CanForwardQuery",impl:({get:S})=>{const C=S(i()),R=S(a());return R===null?!1:C.length>1&&R<C.length-1}}),f=e.event({name:"GoEvent"}),E=e.event({name:"BackEvent"}),L=e.event({name:"ForwardEvent"}),x=e.command({name:"GoCommand",impl:({get:S},C)=>{var F;const R=S(w());if(R.length===0||C===0)return null;const T=((F=S(a()))!=null?F:R.length-1)+C;if(T<0||T>=R.length)return null;const D=R[T];return[o().new(T),t.command({get:S},D),f(C),C>0?L(C):E(C)]}}),U=e.command({name:"BackCommand",impl:({})=>x(-1)}),y=e.command({name:"ForwardCommand",impl:({})=>x(1)}),_=e.query({name:"InputQuery",impl:t.query});return e.effect({name:"HistoryEffect",impl:({fromQuery:S,get:C})=>S(_()).pipe(Va(t.timing),Ji(C(_())),Be(R=>{const M=C(h());return Or(M,R)?null:c(R)}))}),Tt.module({query:{HistoryListQuery:w,CanBackQuery:p,CanForwardQuery:g,CurrentIndexQuery:a,CurrentStateQuery:h},command:{GoCommand:x,AddCommand:c,SetCommand:u,ReplaceCommand:m,BackCommand:U,ForwardCommand:y},event:{BackEvent:E,ForwardEvent:L,GoEvent:f}})},Wa=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)}),$a=(e,t)=>({listenTo:n=>({get:r=>({set:i=>t({storageKey:e,TriggerEvent:n,get:r,set:i})}),set:r=>t({storageKey:e,TriggerEvent:n,get:i=>i,set:r})})}),Ya=(e,t)=>{const n=e.getExtern(Es);!n||(e.effect({name:"ReadStorageEffect",impl:async r=>{const i=await n.get(t.storageKey);return i?t.set(r,i):null}}),e.effect({name:"WriteStorageEffect",impl:({fromEvent:r})=>r(t.TriggerEvent).pipe(Be(i=>(n.set(t.storageKey,t.get(i)),null)))}))},Nr=(e,t)=>$a(t,n=>Ya(e,n)),Qa="remesh-example/todo-list",hn=e=>e.id,xe=Tt.domain({name:"TodoListDomain",impl:e=>{const t=zi(e,{name:"TodoListModule",key:hn}),n=t.query.ItemListQuery,r=t.query.ItemQuery,i=t.query.KeyListQuery,o=e.event({name:"TodoListChangedEvent",impl:({get:_})=>_(n())}),a=e.command({name:"SetTodoListCommand",impl:({},_)=>[t.command.SetListCommand(_),o()]}),u=e.event({name:"FailedToAddTodoEvent"}),c=e.event({name:"TodoItemAddedEvent"}),m=e.command({name:"AddTodoCommand",impl:({},_)=>{if(_==="")return u({reason:"Title cannot be empty"});const v={id:Wa(),title:_,completed:!1};return[t.command.AddItemCommand(v),c(v),o()]}}),w=e.command({name:"UpdateTodoCommand",impl:({},_)=>_.title===""?h(_.id):[t.command.UpdateItemCommand(_),o()]}),h=e.command({name:"DeleteTodoCommand",impl:({},_)=>[t.command.DeleteItemCommand(_),o()]}),p=e.query({name:"ActiveTodoListQuery",impl:({get:_})=>_(n()).filter(S=>!S.completed)}),g=e.query({name:"CompletedTodoListQuery",impl:({get:_})=>_(n()).filter(S=>S.completed)}),f=e.query({name:"ActiveTodoCountQuery",impl:({get:_})=>_(p()).length}),E=e.query({name:"CompletedTodoCountQuery",impl:({get:_})=>_(g()).length}),L=e.query({name:"IsAllCompletedQuery",impl:({get:_})=>{const v=_(n());return v.length===0?!1:_(E())===v.length}}),x=e.command({name:"ToggleTodoCommand",impl:({get:_},v)=>{const S=_(r(v)),C={...S,completed:!S.completed};return w(C)}}),U=e.command({name:"ToggleAllCommand",impl:({get:_})=>{const v=_(n());if(v.length===0)return null;const C=_(f())>0,R=v.map(M=>({...M,completed:C}));return a(R)}}),y=e.command({name:"ClearAllCompletedCommand",impl:({get:_})=>{const v=_(n());if(v.length===0)return null;const S=v.filter(C=>!C.completed);return a(S)}});return Nr(e,Qa).listenTo(o).set(({},_)=>a(_)),{query:{TodoQuery:r,TodoKeyListQuery:i,TodoListQuery:n,ActiveTodoListQuery:p,CompletedTodoListQuery:g,ActiveTodoCountQuery:f,CompletedTodoCountQuery:E,IsAllCompletedQuery:L},command:{SetTodoListCommand:a,AddTodoCommand:m,UpdateTodoCommand:w,DeleteTodoCommand:h,ToggleTodoCommand:x,ToggleAllCommand:U,ClearAllCompletedCommand:y},event:{FailedToAddTodoEvent:u,TodoListChangedEvent:o,TodoItemAddedEvent:c}}}}),Ga="remesh-example/todo-filter",Ka=e=>{if(e===void 0)return"all";switch(e){case"all":case"active":case"completed":return e;default:return"all"}},Mr=Tt.domain({name:"TodoFilterDomain",impl:e=>{const t=e.state({name:"TodoFilterState",default:"all"}),n=e.query({name:"TodoFilterQuery",impl:({get:o})=>o(t())}),r=e.event({name:"TodoFilterChangedEvent"}),i=e.command({name:"SetFilterCommand",impl:({},o)=>{const a=Ka(o);return[t().new(a),r(a)]}});return Nr(e,Ga).listenTo(r).set(({},o)=>i(o)),{query:{TodoFilterQuery:n},command:{SetFilterCommand:i},event:{TodoFilterChangedEvent:r}}}}),Ja=()=>{const e=Re(),t=Lt(xe()),n=Lt(Mr()),r=jt(n.query.TodoFilterQuery()),i=jt(t.query.ActiveTodoCountQuery()),a=jt(t.query.CompletedTodoCountQuery())>0,u=()=>{e(t.command.ClearAllCompletedCommand())},c=w=>w.isActive?"selected":"",m=qi();return oe.exports.useEffect(()=>{var h;const w=(h=m.filter)!=null?h:"all";w!==r&&e(n.command.SetFilterCommand(w))},[m,r]),kt("footer",{className:"footer",children:[kt("span",{className:"todo-count",children:[J("strong",{children:i})," item",i!==1&&"s"," left"]}),kt("ul",{className:"filters",children:[J("li",{children:J(Bn,{to:"/",className:c,children:"All"})}),J("li",{children:J(Bn,{to:"/active",className:c,children:"Active"})}),J("li",{children:J(Bn,{to:"/completed",className:c,children:"Completed"})})]}),a&&J("button",{className:"clear-completed",onClick:u,children:"Clear completed"})]})},za="remesh-example/todo-input",Ur=Tt.domain({name:"TodoInputDomain",impl:e=>{const t=e.state({name:"TodoTextState",default:""}),n=e.query({name:"TodoTextQuery",impl:({get:a})=>a(t())}),r=e.event({name:"TodoInputChangedEvent"}),i=e.command({name:"SetTodoInputCommand",impl:({},a)=>[t().new(a),r(a)]}),o=e.command({name:"ClearTodoInputCommand",impl:({get:a})=>[t().new(""),r("")]});return Nr(e,za).listenTo(r).set(({},a)=>i(a)),{query:{TodoInputQuery:n},command:{SetTodoInputCommand:i,ClearTodoInputCommand:o},event:{TodoInputChangedEvent:r}}}});function Ri(e,t){return r=>{const i=Array.isArray(e)?e:[e];for(const o of i)r.key.toLowerCase()===o.toLowerCase()&&(r.preventDefault(),t(r,o))}}const Xa=()=>{const e=Re(),t=Lt(Ur()),n=Lt(xe()),r=jt(t.query.TodoInputQuery()),i=a=>{e(t.command.SetTodoInputCommand(a.target.value))},o=Ri("Enter",()=>{e(n.command.AddTodoCommand(r))});return _s(n.event.FailedToAddTodoEvent,a=>{alert(a.reason)}),kt("header",{className:"header",children:[J("h1",{children:"todos"}),J("input",{className:"new-todo",placeholder:"What needs to be done?",value:r,onChange:i,onKeyDown:o})]})},Za=Tt.domain({name:"TodoAppDomain",impl:e=>{const t=e.getDomain(Ur()),n=e.getDomain(xe()),r=e.getDomain(Mr()),i=e.query({name:"FilteredTodoKeyListQuery",impl:({get:o})=>{const a=o(r.query.TodoFilterQuery());if(a==="all")return o(n.query.TodoListQuery()).map(hn);if(a==="active")return o(n.query.ActiveTodoListQuery()).map(hn);if(a==="completed")return o(n.query.CompletedTodoListQuery()).map(hn);throw new Error(`Unknown filter: ${a}`)}});return n.command.AddTodoCommand.after(({get:o},a)=>o(t.query.TodoInputQuery())===a?t.command.ClearTodoInputCommand():null),{query:{FilteredTodoKeyListQuery:i}}}});function tc(e){const[t,n]=oe.exports.useState(e),r=oe.exports.useCallback(i=>{n(i.target.value)},[]);return[t,r,n]}function ec(e){const t=Re(),n=Lt(xe()),r=jt(n.query.TodoQuery(e.id)),[i,o]=oe.exports.useState(!1),[a,u]=tc(r.title),c=()=>{t(n.command.UpdateTodoCommand({...r,title:a})),o(!1)},m=Ri(["Enter","Escape"],()=>{c()}),w=()=>{o(!0)},h=()=>{t(n.command.ToggleTodoCommand(r.id))},p=()=>{t(n.command.DeleteTodoCommand(r.id))},g=()=>{c()},f=oe.exports.useRef(null);return oe.exports.useEffect(()=>{var E;i&&((E=f.current)==null||E.focus())},[i]),kt("li",{className:`${i&&"editing"} ${r.completed&&"completed"}`,children:[kt("div",{className:"view",children:[J("input",{type:"checkbox",className:"toggle",checked:r.completed,onChange:h}),J("label",{onDoubleClick:w,children:r.title}),J("button",{className:"destroy",onClick:p})]}),i&&J("input",{ref:f,className:"edit",value:a,onChange:u,onKeyDown:m,onBlur:g})]})}const nc=()=>{const e=Lt(Za()),t=jt(e.query.FilteredTodoKeyListQuery());return console.log("render list"),kt("section",{className:"main",children:[J(rc,{}),J("ul",{className:"todo-list",children:t.map(n=>J(ec,{id:n},n))})]})},rc=()=>{const e=Re(),t=Lt(xe()),n=jt(t.query.IsAllCompletedQuery());return kt(ws,{children:[J("input",{id:"toggle-all",type:"checkbox",className:"toggle-all",checked:n,onChange:()=>{e(t.command.ToggleAllCommand())}}),J("label",{htmlFor:"toggle-all"})]})},Fr=Tt.domain({name:"TodoAppDomain",impl:e=>{const t=e.getDomain(xe()),n=e.getDomain(Mr()),r=e.getDomain(Ur()),i=e.event({name:"TodoFilterSyncEvent"}),o=e.query({name:"TodoAppStateQuery",impl:({get:c})=>{const m=c(t.query.TodoListQuery()),w=c(n.query.TodoFilterQuery()),h=c(r.query.TodoInputQuery());return{todos:m,filter:w,input:h}}}),a=e.command({name:"UpdateTodoAppStateCommand",impl:({get:c},m)=>{const w=c(n.query.TodoFilterQuery());return[t.command.SetTodoListCommand(m.todos),w!==m.filter?i(m.filter):null,r.command.SetTodoInputCommand(m.input)]}});Pa(e,{key:"todo-app",dataType:"object",onSend:({get:c})=>c(o()),onReceive:({},c)=>a(c)});const u=Ha(e,{name:"TodoAppHistoryModule",query:({get:c})=>c(o()),command:({},c)=>a(c)});return{event:{...u.event,TodoFilterSyncEvent:i},query:{...u.query},command:{...u.command}}}}),ps=()=>{const e=Lt(Fr()),t=Vi();return _s(e.event.TodoFilterSyncEvent,n=>{t(`/${n}`)}),kt(ws,{children:[kt("div",{className:"todoapp",children:[J(Xa,{}),J(nc,{}),J(Ja,{})]}),J(sc,{}),J(ic,{})]})},sc=()=>{const e=Re(),t=Lt(Fr()),n=jt(t.query.CanBackQuery());return J("svg",{style:{opacity:n?1:.5,cursor:n?"pointer":"",position:"fixed",top:0,left:0},width:"50px",height:"50px",viewBox:"0 0 500 500",xmlns:"http://www.w3.org/2000/svg",onClick:()=>{n&&e(t.command.BackCommand())},children:J("path",{d:"M448 384Q389 336 335 312 280 288 224 288L224 380 60 216 224 52 224 144Q320 166 374 222 428 277 448 384Z"})})},ic=()=>{const e=Re(),t=Lt(Fr()),n=jt(t.query.CanForwardQuery());return J("svg",{style:{opacity:n?1:.5,cursor:n?"pointer":"",position:"fixed",top:0,left:51},width:"50px",height:"50px",viewBox:"0 0 500 500",xmlns:"http://www.w3.org/2000/svg",onClick:()=>{n&&e(t.command.ForwardCommand())},children:J("path",{d:"M64 384Q84 277 138 222 192 166 288 144L288 52 452 216 288 380 288 288Q232 288 178 312 123 336 64 384Z"})})},oc=1200,lc=2500,Sn=3e4,ir=e=>{if(e.shouldConnect&&e.ws===null){const t=new WebSocket(e.url),n=e.binaryType;let r=null;n&&(t.binaryType=n),e.ws=t,e.connecting=!0,e.connected=!1,t.onmessage=a=>{e.lastMessageReceived=Ht();const u=a.data,c=typeof u=="string"?JSON.parse(u):u;c&&c.type==="pong"&&(clearTimeout(r),r=setTimeout(o,Sn/2)),e.emit("message",[c,e])};const i=a=>{e.ws!==null&&(e.ws=null,e.connecting=!1,e.connected?(e.connected=!1,e.emit("disconnect",[{type:"disconnect",error:a},e])):e.unsuccessfulReconnects++,setTimeout(ir,ar(io(e.unsuccessfulReconnects+1)*oc,lc),e)),clearTimeout(r)},o=()=>{e.ws===t&&e.send({type:"ping"})};t.onclose=()=>i(null),t.onerror=a=>i(a),t.onopen=()=>{e.lastMessageReceived=Ht(),e.connecting=!1,e.connected=!0,e.unsuccessfulReconnects=0,e.emit("connect",[{type:"connect"},e]),r=setTimeout(o,Sn/2)}}};class ac extends Rn{constructor(t,{binaryType:n}={}){super(),this.url=t,this.ws=null,this.binaryType=n||null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval(()=>{this.connected&&Sn<Ht()-this.lastMessageReceived&&this.ws.close()},Sn/2),ir(this)}send(t){this.ws&&this.ws.send(JSON.stringify(t))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.connected&&this.ws===null&&ir(this)}}const cc=new Map;class uc{constructor(t){this.room=t,this.onmessage=null,go(n=>n.key===t&&this.onmessage!==null&&this.onmessage({data:Us(n.newValue||"")}))}postMessage(t){As.setItem(this.room,Ms(Uo(t)))}}const hc=typeof BroadcastChannel=="undefined"?uc:BroadcastChannel,Br=e=>bt(cc,e,()=>{const t=new Set,n=new hc(e);return n.onmessage=r=>t.forEach(i=>i(r.data,"broadcastchannel")),{bc:n,subs:t}}),dc=(e,t)=>Br(e).subs.add(t),fc=(e,t)=>Br(e).subs.delete(t),pc=(e,t,n=null)=>{const r=Br(e);r.bc.postMessage(t),r.subs.forEach(i=>i(t,n))},gc=()=>{let e=!0;return(t,n)=>{if(e){e=!1;try{t()}finally{e=!0}}else n!==void 0&&n()}};var Ai={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){var n=Math.floor,r=Math.abs,i=Math.pow;return function(){function o(a,u,c){function m(p,g){if(!u[p]){if(!a[p]){var f=typeof en=="function"&&en;if(!g&&f)return f(p,!0);if(w)return w(p,!0);var E=new Error("Cannot find module '"+p+"'");throw E.code="MODULE_NOT_FOUND",E}var L=u[p]={exports:{}};a[p][0].call(L.exports,function(x){var U=a[p][1][x];return m(U||x)},L,L.exports,o,a,u,c)}return u[p].exports}for(var w=typeof en=="function"&&en,h=0;h<c.length;h++)m(c[h]);return m}return o}()({1:[function(o,a,u){function c(_){var v=_.length;if(0<v%4)throw new Error("Invalid string. Length must be a multiple of 4");var S=_.indexOf("=");S===-1&&(S=v);var C=S===v?0:4-S%4;return[S,C]}function m(_,v,S){return 3*(v+S)/4-S}function w(_){var v,S,C=c(_),R=C[0],M=C[1],T=new L(m(_,R,M)),D=0,F=0<M?R-4:R;for(S=0;S<F;S+=4)v=E[_.charCodeAt(S)]<<18|E[_.charCodeAt(S+1)]<<12|E[_.charCodeAt(S+2)]<<6|E[_.charCodeAt(S+3)],T[D++]=255&v>>16,T[D++]=255&v>>8,T[D++]=255&v;return M===2&&(v=E[_.charCodeAt(S)]<<2|E[_.charCodeAt(S+1)]>>4,T[D++]=255&v),M===1&&(v=E[_.charCodeAt(S)]<<10|E[_.charCodeAt(S+1)]<<4|E[_.charCodeAt(S+2)]>>2,T[D++]=255&v>>8,T[D++]=255&v),T}function h(_){return f[63&_>>18]+f[63&_>>12]+f[63&_>>6]+f[63&_]}function p(_,v,S){for(var C,R=[],M=v;M<S;M+=3)C=(16711680&_[M]<<16)+(65280&_[M+1]<<8)+(255&_[M+2]),R.push(h(C));return R.join("")}function g(_){for(var v,S=_.length,C=S%3,R=[],M=16383,T=0,D=S-C;T<D;T+=M)R.push(p(_,T,T+M>D?D:T+M));return C===1?(v=_[S-1],R.push(f[v>>2]+f[63&v<<4]+"==")):C===2&&(v=(_[S-2]<<8)+_[S-1],R.push(f[v>>10]+f[63&v>>4]+f[63&v<<2]+"=")),R.join("")}u.byteLength=function(_){var v=c(_),S=v[0],C=v[1];return 3*(S+C)/4-C},u.toByteArray=w,u.fromByteArray=g;for(var f=[],E=[],L=typeof Uint8Array=="undefined"?Array:Uint8Array,x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",U=0,y=x.length;U<y;++U)f[U]=x[U],E[x.charCodeAt(U)]=U;E[45]=62,E[95]=63},{}],2:[function(){},{}],3:[function(o,a,u){(function(){(function(){var c=String.fromCharCode,m=Math.min;function w(s){if(2147483647<s)throw new RangeError('The value "'+s+'" is invalid for option "size"');var l=new Uint8Array(s);return l.__proto__=h.prototype,l}function h(s,l,d){if(typeof s=="number"){if(typeof l=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return E(s)}return p(s,l,d)}function p(s,l,d){if(typeof s=="string")return L(s,l);if(ArrayBuffer.isView(s))return x(s);if(s==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s);if(I(s,ArrayBuffer)||s&&I(s.buffer,ArrayBuffer))return U(s,l,d);if(typeof s=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var k=s.valueOf&&s.valueOf();if(k!=null&&k!==s)return h.from(k,l,d);var A=y(s);if(A)return A;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof s[Symbol.toPrimitive]=="function")return h.from(s[Symbol.toPrimitive]("string"),l,d);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s)}function g(s){if(typeof s!="number")throw new TypeError('"size" argument must be of type number');if(0>s)throw new RangeError('The value "'+s+'" is invalid for option "size"')}function f(s,l,d){return g(s),0>=s||l===void 0?w(s):typeof d=="string"?w(s).fill(l,d):w(s).fill(l)}function E(s){return g(s),w(0>s?0:0|_(s))}function L(s,l){if((typeof l!="string"||l==="")&&(l="utf8"),!h.isEncoding(l))throw new TypeError("Unknown encoding: "+l);var d=0|v(s,l),k=w(d),A=k.write(s,l);return A!==d&&(k=k.slice(0,A)),k}function x(s){for(var l=0>s.length?0:0|_(s.length),d=w(l),k=0;k<l;k+=1)d[k]=255&s[k];return d}function U(s,l,d){if(0>l||s.byteLength<l)throw new RangeError('"offset" is outside of buffer bounds');if(s.byteLength<l+(d||0))throw new RangeError('"length" is outside of buffer bounds');var k;return k=l===void 0&&d===void 0?new Uint8Array(s):d===void 0?new Uint8Array(s,l):new Uint8Array(s,l,d),k.__proto__=h.prototype,k}function y(s){if(h.isBuffer(s)){var l=0|_(s.length),d=w(l);return d.length===0||s.copy(d,0,0,l),d}return s.length===void 0?s.type==="Buffer"&&Array.isArray(s.data)?x(s.data):void 0:typeof s.length!="number"||O(s.length)?w(0):x(s)}function _(s){if(s>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647 .toString(16)+" bytes");return 0|s}function v(s,l){if(h.isBuffer(s))return s.length;if(ArrayBuffer.isView(s)||I(s,ArrayBuffer))return s.byteLength;if(typeof s!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof s);var d=s.length,k=2<arguments.length&&arguments[2]===!0;if(!k&&d===0)return 0;for(var A=!1;;)switch(l){case"ascii":case"latin1":case"binary":return d;case"utf8":case"utf-8":return se(s).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*d;case"hex":return d>>>1;case"base64":return Ct(s).length;default:if(A)return k?-1:se(s).length;l=(""+l).toLowerCase(),A=!0}}function S(s,l,d){var k=!1;if((l===void 0||0>l)&&(l=0),l>this.length||((d===void 0||d>this.length)&&(d=this.length),0>=d)||(d>>>=0,l>>>=0,d<=l))return"";for(s||(s="utf8");;)switch(s){case"hex":return _t(this,l,d);case"utf8":case"utf-8":return it(this,l,d);case"ascii":return H(this,l,d);case"latin1":case"binary":return ye(this,l,d);case"base64":return X(this,l,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Qt(this,l,d);default:if(k)throw new TypeError("Unknown encoding: "+s);s=(s+"").toLowerCase(),k=!0}}function C(s,l,d){var k=s[l];s[l]=s[d],s[d]=k}function R(s,l,d,k,A){if(s.length===0)return-1;if(typeof d=="string"?(k=d,d=0):2147483647<d?d=2147483647:-2147483648>d&&(d=-2147483648),d=+d,O(d)&&(d=A?0:s.length-1),0>d&&(d=s.length+d),d>=s.length){if(A)return-1;d=s.length-1}else if(0>d)if(A)d=0;else return-1;if(typeof l=="string"&&(l=h.from(l,k)),h.isBuffer(l))return l.length===0?-1:M(s,l,d,k,A);if(typeof l=="number")return l&=255,typeof Uint8Array.prototype.indexOf=="function"?A?Uint8Array.prototype.indexOf.call(s,l,d):Uint8Array.prototype.lastIndexOf.call(s,l,d):M(s,[l],d,k,A);throw new TypeError("val must be string, number or Buffer")}function M(s,l,d,k,A){function N(we,Ne){return P===1?we[Ne]:we.readUInt16BE(Ne*P)}var P=1,G=s.length,et=l.length;if(k!==void 0&&(k=(k+"").toLowerCase(),k==="ucs2"||k==="ucs-2"||k==="utf16le"||k==="utf-16le")){if(2>s.length||2>l.length)return-1;P=2,G/=2,et/=2,d/=2}var K;if(A){var Q=-1;for(K=d;K<G;K++)if(N(s,K)!==N(l,Q===-1?0:K-Q))Q!==-1&&(K-=K-Q),Q=-1;else if(Q===-1&&(Q=K),K-Q+1===et)return Q*P}else for(d+et>G&&(d=G-et),K=d;0<=K;K--){for(var dt=!0,ie=0;ie<et;ie++)if(N(s,K+ie)!==N(l,ie)){dt=!1;break}if(dt)return K}return-1}function T(s,l,d,k){d=+d||0;var A=s.length-d;k?(k=+k,k>A&&(k=A)):k=A;var N=l.length;k>N/2&&(k=N/2);for(var P,G=0;G<k;++G){if(P=parseInt(l.substr(2*G,2),16),O(P))return G;s[d+G]=P}return G}function D(s,l,d,k){return Et(se(l,s.length-d),s,d,k)}function F(s,l,d,k){return Et(Oe(l),s,d,k)}function j(s,l,d,k){return F(s,l,d,k)}function W(s,l,d,k){return Et(Ct(l),s,d,k)}function Y(s,l,d,k){return Et(Jt(l,s.length-d),s,d,k)}function X(s,l,d){return l===0&&d===s.length?B.fromByteArray(s):B.fromByteArray(s.slice(l,d))}function it(s,l,d){d=m(s.length,d);for(var k=[],A=l;A<d;){var N=s[A],P=null,G=239<N?4:223<N?3:191<N?2:1;if(A+G<=d){var et,K,Q,dt;G===1?128>N&&(P=N):G===2?(et=s[A+1],(192&et)==128&&(dt=(31&N)<<6|63&et,127<dt&&(P=dt))):G===3?(et=s[A+1],K=s[A+2],(192&et)==128&&(192&K)==128&&(dt=(15&N)<<12|(63&et)<<6|63&K,2047<dt&&(55296>dt||57343<dt)&&(P=dt))):G===4&&(et=s[A+1],K=s[A+2],Q=s[A+3],(192&et)==128&&(192&K)==128&&(192&Q)==128&&(dt=(15&N)<<18|(63&et)<<12|(63&K)<<6|63&Q,65535<dt&&1114112>dt&&(P=dt)))}P===null?(P=65533,G=1):65535<P&&(P-=65536,k.push(55296|1023&P>>>10),P=56320|1023&P),k.push(P),A+=G}return pt(k)}function pt(s){var l=s.length;if(l<=4096)return c.apply(String,s);for(var d="",k=0;k<l;)d+=c.apply(String,s.slice(k,k+=4096));return d}function H(s,l,d){var k="";d=m(s.length,d);for(var A=l;A<d;++A)k+=c(127&s[A]);return k}function ye(s,l,d){var k="";d=m(s.length,d);for(var A=l;A<d;++A)k+=c(s[A]);return k}function _t(s,l,d){var k=s.length;(!l||0>l)&&(l=0),(!d||0>d||d>k)&&(d=k);for(var A="",N=l;N<d;++N)A+=re(s[N]);return A}function Qt(s,l,d){for(var k=s.slice(l,d),A="",N=0;N<k.length;N+=2)A+=c(k[N]+256*k[N+1]);return A}function rt(s,l,d){if(s%1!=0||0>s)throw new RangeError("offset is not uint");if(s+l>d)throw new RangeError("Trying to access beyond buffer length")}function Z(s,l,d,k,A,N){if(!h.isBuffer(s))throw new TypeError('"buffer" argument must be a Buffer instance');if(l>A||l<N)throw new RangeError('"value" argument is out of bounds');if(d+k>s.length)throw new RangeError("Index out of range")}function vt(s,l,d,k){if(d+k>s.length)throw new RangeError("Index out of range");if(0>d)throw new RangeError("Index out of range")}function Gt(s,l,d,k,A){return l=+l,d>>>=0,A||vt(s,l,d,4),q.write(s,l,d,k,23,4),d+4}function Kt(s,l,d,k,A){return l=+l,d>>>=0,A||vt(s,l,d,8),q.write(s,l,d,k,52,8),d+8}function Le(s){if(s=s.split("=")[0],s=s.trim().replace(b,""),2>s.length)return"";for(;s.length%4!=0;)s+="=";return s}function re(s){return 16>s?"0"+s.toString(16):s.toString(16)}function se(s,l){l=l||1/0;for(var d,k=s.length,A=null,N=[],P=0;P<k;++P){if(d=s.charCodeAt(P),55295<d&&57344>d){if(!A){if(56319<d){-1<(l-=3)&&N.push(239,191,189);continue}else if(P+1===k){-1<(l-=3)&&N.push(239,191,189);continue}A=d;continue}if(56320>d){-1<(l-=3)&&N.push(239,191,189),A=d;continue}d=(A-55296<<10|d-56320)+65536}else A&&-1<(l-=3)&&N.push(239,191,189);if(A=null,128>d){if(0>(l-=1))break;N.push(d)}else if(2048>d){if(0>(l-=2))break;N.push(192|d>>6,128|63&d)}else if(65536>d){if(0>(l-=3))break;N.push(224|d>>12,128|63&d>>6,128|63&d)}else if(1114112>d){if(0>(l-=4))break;N.push(240|d>>18,128|63&d>>12,128|63&d>>6,128|63&d)}else throw new Error("Invalid code point")}return N}function Oe(s){for(var l=[],d=0;d<s.length;++d)l.push(255&s.charCodeAt(d));return l}function Jt(s,l){for(var d,k,A,N=[],P=0;P<s.length&&!(0>(l-=2));++P)d=s.charCodeAt(P),k=d>>8,A=d%256,N.push(A),N.push(k);return N}function Ct(s){return B.toByteArray(Le(s))}function Et(s,l,d,k){for(var A=0;A<k&&!(A+d>=l.length||A>=s.length);++A)l[A+d]=s[A];return A}function I(s,l){return s instanceof l||s!=null&&s.constructor!=null&&s.constructor.name!=null&&s.constructor.name===l.name}function O(s){return s!==s}var B=o("base64-js"),q=o("ieee754");u.Buffer=h,u.SlowBuffer=function(s){return+s!=s&&(s=0),h.alloc(+s)},u.INSPECT_MAX_BYTES=50,u.kMaxLength=2147483647,h.TYPED_ARRAY_SUPPORT=function(){try{var s=new Uint8Array(1);return s.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},s.foo()===42}catch{return!1}}(),h.TYPED_ARRAY_SUPPORT||typeof console=="undefined"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(h.prototype,"parent",{enumerable:!0,get:function(){return h.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(h.prototype,"offset",{enumerable:!0,get:function(){return h.isBuffer(this)?this.byteOffset:void 0}}),typeof Symbol!="undefined"&&Symbol.species!=null&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),h.poolSize=8192,h.from=function(s,l,d){return p(s,l,d)},h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,h.alloc=function(s,l,d){return f(s,l,d)},h.allocUnsafe=function(s){return E(s)},h.allocUnsafeSlow=function(s){return E(s)},h.isBuffer=function(s){return s!=null&&s._isBuffer===!0&&s!==h.prototype},h.compare=function(s,l){if(I(s,Uint8Array)&&(s=h.from(s,s.offset,s.byteLength)),I(l,Uint8Array)&&(l=h.from(l,l.offset,l.byteLength)),!h.isBuffer(s)||!h.isBuffer(l))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(s===l)return 0;for(var d=s.length,k=l.length,A=0,N=m(d,k);A<N;++A)if(s[A]!==l[A]){d=s[A],k=l[A];break}return d<k?-1:k<d?1:0},h.isEncoding=function(s){switch((s+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(s,l){if(!Array.isArray(s))throw new TypeError('"list" argument must be an Array of Buffers');if(s.length===0)return h.alloc(0);var d;if(l===void 0)for(l=0,d=0;d<s.length;++d)l+=s[d].length;var k=h.allocUnsafe(l),A=0;for(d=0;d<s.length;++d){var N=s[d];if(I(N,Uint8Array)&&(N=h.from(N)),!h.isBuffer(N))throw new TypeError('"list" argument must be an Array of Buffers');N.copy(k,A),A+=N.length}return k},h.byteLength=v,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var s=this.length;if(s%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var l=0;l<s;l+=2)C(this,l,l+1);return this},h.prototype.swap32=function(){var s=this.length;if(s%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var l=0;l<s;l+=4)C(this,l,l+3),C(this,l+1,l+2);return this},h.prototype.swap64=function(){var s=this.length;if(s%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var l=0;l<s;l+=8)C(this,l,l+7),C(this,l+1,l+6),C(this,l+2,l+5),C(this,l+3,l+4);return this},h.prototype.toString=function(){var s=this.length;return s===0?"":arguments.length===0?it(this,0,s):S.apply(this,arguments)},h.prototype.toLocaleString=h.prototype.toString,h.prototype.equals=function(s){if(!h.isBuffer(s))throw new TypeError("Argument must be a Buffer");return this===s||h.compare(this,s)===0},h.prototype.inspect=function(){var s="",l=u.INSPECT_MAX_BYTES;return s=this.toString("hex",0,l).replace(/(.{2})/g,"$1 ").trim(),this.length>l&&(s+=" ... "),"<Buffer "+s+">"},h.prototype.compare=function(s,l,d,k,A){if(I(s,Uint8Array)&&(s=h.from(s,s.offset,s.byteLength)),!h.isBuffer(s))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof s);if(l===void 0&&(l=0),d===void 0&&(d=s?s.length:0),k===void 0&&(k=0),A===void 0&&(A=this.length),0>l||d>s.length||0>k||A>this.length)throw new RangeError("out of range index");if(k>=A&&l>=d)return 0;if(k>=A)return-1;if(l>=d)return 1;if(l>>>=0,d>>>=0,k>>>=0,A>>>=0,this===s)return 0;for(var N=A-k,P=d-l,G=m(N,P),et=this.slice(k,A),K=s.slice(l,d),Q=0;Q<G;++Q)if(et[Q]!==K[Q]){N=et[Q],P=K[Q];break}return N<P?-1:P<N?1:0},h.prototype.includes=function(s,l,d){return this.indexOf(s,l,d)!==-1},h.prototype.indexOf=function(s,l,d){return R(this,s,l,d,!0)},h.prototype.lastIndexOf=function(s,l,d){return R(this,s,l,d,!1)},h.prototype.write=function(s,l,d,k){if(l===void 0)k="utf8",d=this.length,l=0;else if(d===void 0&&typeof l=="string")k=l,d=this.length,l=0;else if(isFinite(l))l>>>=0,isFinite(d)?(d>>>=0,k===void 0&&(k="utf8")):(k=d,d=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var A=this.length-l;if((d===void 0||d>A)&&(d=A),0<s.length&&(0>d||0>l)||l>this.length)throw new RangeError("Attempt to write outside buffer bounds");k||(k="utf8");for(var N=!1;;)switch(k){case"hex":return T(this,s,l,d);case"utf8":case"utf-8":return D(this,s,l,d);case"ascii":return F(this,s,l,d);case"latin1":case"binary":return j(this,s,l,d);case"base64":return W(this,s,l,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y(this,s,l,d);default:if(N)throw new TypeError("Unknown encoding: "+k);k=(""+k).toLowerCase(),N=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},h.prototype.slice=function(s,l){var d=this.length;s=~~s,l=l===void 0?d:~~l,0>s?(s+=d,0>s&&(s=0)):s>d&&(s=d),0>l?(l+=d,0>l&&(l=0)):l>d&&(l=d),l<s&&(l=s);var k=this.subarray(s,l);return k.__proto__=h.prototype,k},h.prototype.readUIntLE=function(s,l,d){s>>>=0,l>>>=0,d||rt(s,l,this.length);for(var k=this[s],A=1,N=0;++N<l&&(A*=256);)k+=this[s+N]*A;return k},h.prototype.readUIntBE=function(s,l,d){s>>>=0,l>>>=0,d||rt(s,l,this.length);for(var k=this[s+--l],A=1;0<l&&(A*=256);)k+=this[s+--l]*A;return k},h.prototype.readUInt8=function(s,l){return s>>>=0,l||rt(s,1,this.length),this[s]},h.prototype.readUInt16LE=function(s,l){return s>>>=0,l||rt(s,2,this.length),this[s]|this[s+1]<<8},h.prototype.readUInt16BE=function(s,l){return s>>>=0,l||rt(s,2,this.length),this[s]<<8|this[s+1]},h.prototype.readUInt32LE=function(s,l){return s>>>=0,l||rt(s,4,this.length),(this[s]|this[s+1]<<8|this[s+2]<<16)+16777216*this[s+3]},h.prototype.readUInt32BE=function(s,l){return s>>>=0,l||rt(s,4,this.length),16777216*this[s]+(this[s+1]<<16|this[s+2]<<8|this[s+3])},h.prototype.readIntLE=function(s,l,d){s>>>=0,l>>>=0,d||rt(s,l,this.length);for(var k=this[s],A=1,N=0;++N<l&&(A*=256);)k+=this[s+N]*A;return A*=128,k>=A&&(k-=i(2,8*l)),k},h.prototype.readIntBE=function(s,l,d){s>>>=0,l>>>=0,d||rt(s,l,this.length);for(var k=l,A=1,N=this[s+--k];0<k&&(A*=256);)N+=this[s+--k]*A;return A*=128,N>=A&&(N-=i(2,8*l)),N},h.prototype.readInt8=function(s,l){return s>>>=0,l||rt(s,1,this.length),128&this[s]?-1*(255-this[s]+1):this[s]},h.prototype.readInt16LE=function(s,l){s>>>=0,l||rt(s,2,this.length);var d=this[s]|this[s+1]<<8;return 32768&d?4294901760|d:d},h.prototype.readInt16BE=function(s,l){s>>>=0,l||rt(s,2,this.length);var d=this[s+1]|this[s]<<8;return 32768&d?4294901760|d:d},h.prototype.readInt32LE=function(s,l){return s>>>=0,l||rt(s,4,this.length),this[s]|this[s+1]<<8|this[s+2]<<16|this[s+3]<<24},h.prototype.readInt32BE=function(s,l){return s>>>=0,l||rt(s,4,this.length),this[s]<<24|this[s+1]<<16|this[s+2]<<8|this[s+3]},h.prototype.readFloatLE=function(s,l){return s>>>=0,l||rt(s,4,this.length),q.read(this,s,!0,23,4)},h.prototype.readFloatBE=function(s,l){return s>>>=0,l||rt(s,4,this.length),q.read(this,s,!1,23,4)},h.prototype.readDoubleLE=function(s,l){return s>>>=0,l||rt(s,8,this.length),q.read(this,s,!0,52,8)},h.prototype.readDoubleBE=function(s,l){return s>>>=0,l||rt(s,8,this.length),q.read(this,s,!1,52,8)},h.prototype.writeUIntLE=function(s,l,d,k){if(s=+s,l>>>=0,d>>>=0,!k){var A=i(2,8*d)-1;Z(this,s,l,d,A,0)}var N=1,P=0;for(this[l]=255&s;++P<d&&(N*=256);)this[l+P]=255&s/N;return l+d},h.prototype.writeUIntBE=function(s,l,d,k){if(s=+s,l>>>=0,d>>>=0,!k){var A=i(2,8*d)-1;Z(this,s,l,d,A,0)}var N=d-1,P=1;for(this[l+N]=255&s;0<=--N&&(P*=256);)this[l+N]=255&s/P;return l+d},h.prototype.writeUInt8=function(s,l,d){return s=+s,l>>>=0,d||Z(this,s,l,1,255,0),this[l]=255&s,l+1},h.prototype.writeUInt16LE=function(s,l,d){return s=+s,l>>>=0,d||Z(this,s,l,2,65535,0),this[l]=255&s,this[l+1]=s>>>8,l+2},h.prototype.writeUInt16BE=function(s,l,d){return s=+s,l>>>=0,d||Z(this,s,l,2,65535,0),this[l]=s>>>8,this[l+1]=255&s,l+2},h.prototype.writeUInt32LE=function(s,l,d){return s=+s,l>>>=0,d||Z(this,s,l,4,4294967295,0),this[l+3]=s>>>24,this[l+2]=s>>>16,this[l+1]=s>>>8,this[l]=255&s,l+4},h.prototype.writeUInt32BE=function(s,l,d){return s=+s,l>>>=0,d||Z(this,s,l,4,4294967295,0),this[l]=s>>>24,this[l+1]=s>>>16,this[l+2]=s>>>8,this[l+3]=255&s,l+4},h.prototype.writeIntLE=function(s,l,d,k){if(s=+s,l>>>=0,!k){var A=i(2,8*d-1);Z(this,s,l,d,A-1,-A)}var N=0,P=1,G=0;for(this[l]=255&s;++N<d&&(P*=256);)0>s&&G===0&&this[l+N-1]!==0&&(G=1),this[l+N]=255&(s/P>>0)-G;return l+d},h.prototype.writeIntBE=function(s,l,d,k){if(s=+s,l>>>=0,!k){var A=i(2,8*d-1);Z(this,s,l,d,A-1,-A)}var N=d-1,P=1,G=0;for(this[l+N]=255&s;0<=--N&&(P*=256);)0>s&&G===0&&this[l+N+1]!==0&&(G=1),this[l+N]=255&(s/P>>0)-G;return l+d},h.prototype.writeInt8=function(s,l,d){return s=+s,l>>>=0,d||Z(this,s,l,1,127,-128),0>s&&(s=255+s+1),this[l]=255&s,l+1},h.prototype.writeInt16LE=function(s,l,d){return s=+s,l>>>=0,d||Z(this,s,l,2,32767,-32768),this[l]=255&s,this[l+1]=s>>>8,l+2},h.prototype.writeInt16BE=function(s,l,d){return s=+s,l>>>=0,d||Z(this,s,l,2,32767,-32768),this[l]=s>>>8,this[l+1]=255&s,l+2},h.prototype.writeInt32LE=function(s,l,d){return s=+s,l>>>=0,d||Z(this,s,l,4,2147483647,-2147483648),this[l]=255&s,this[l+1]=s>>>8,this[l+2]=s>>>16,this[l+3]=s>>>24,l+4},h.prototype.writeInt32BE=function(s,l,d){return s=+s,l>>>=0,d||Z(this,s,l,4,2147483647,-2147483648),0>s&&(s=4294967295+s+1),this[l]=s>>>24,this[l+1]=s>>>16,this[l+2]=s>>>8,this[l+3]=255&s,l+4},h.prototype.writeFloatLE=function(s,l,d){return Gt(this,s,l,!0,d)},h.prototype.writeFloatBE=function(s,l,d){return Gt(this,s,l,!1,d)},h.prototype.writeDoubleLE=function(s,l,d){return Kt(this,s,l,!0,d)},h.prototype.writeDoubleBE=function(s,l,d){return Kt(this,s,l,!1,d)},h.prototype.copy=function(s,l,d,k){if(!h.isBuffer(s))throw new TypeError("argument should be a Buffer");if(d||(d=0),k||k===0||(k=this.length),l>=s.length&&(l=s.length),l||(l=0),0<k&&k<d&&(k=d),k===d||s.length===0||this.length===0)return 0;if(0>l)throw new RangeError("targetStart out of bounds");if(0>d||d>=this.length)throw new RangeError("Index out of range");if(0>k)throw new RangeError("sourceEnd out of bounds");k>this.length&&(k=this.length),s.length-l<k-d&&(k=s.length-l+d);var A=k-d;if(this===s&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(l,d,k);else if(this===s&&d<l&&l<k)for(var N=A-1;0<=N;--N)s[N+l]=this[N+d];else Uint8Array.prototype.set.call(s,this.subarray(d,k),l);return A},h.prototype.fill=function(s,l,d,k){if(typeof s=="string"){if(typeof l=="string"?(k=l,l=0,d=this.length):typeof d=="string"&&(k=d,d=this.length),k!==void 0&&typeof k!="string")throw new TypeError("encoding must be a string");if(typeof k=="string"&&!h.isEncoding(k))throw new TypeError("Unknown encoding: "+k);if(s.length===1){var A=s.charCodeAt(0);(k==="utf8"&&128>A||k==="latin1")&&(s=A)}}else typeof s=="number"&&(s&=255);if(0>l||this.length<l||this.length<d)throw new RangeError("Out of range index");if(d<=l)return this;l>>>=0,d=d===void 0?this.length:d>>>0,s||(s=0);var N;if(typeof s=="number")for(N=l;N<d;++N)this[N]=s;else{var P=h.isBuffer(s)?s:h.from(s,k),G=P.length;if(G===0)throw new TypeError('The value "'+s+'" is invalid for argument "value"');for(N=0;N<d-l;++N)this[N+l]=P[N%G]}return this};var b=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,o("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:9}],4:[function(o,a,u){(function(c){(function(){function m(){let h;try{h=u.storage.getItem("debug")}catch{}return!h&&typeof c!="undefined"&&"env"in c&&(h=c.env.DEBUG),h}u.formatArgs=function(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+a.exports.humanize(this.diff),!this.useColors)return;const p="color: "+this.color;h.splice(1,0,p,"color: inherit");let g=0,f=0;h[0].replace(/%[a-zA-Z%]/g,E=>{E==="%%"||(g++,E==="%c"&&(f=g))}),h.splice(f,0,p)},u.save=function(h){try{h?u.storage.setItem("debug",h):u.storage.removeItem("debug")}catch{}},u.load=m,u.useColors=function(){return!!(typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))||!(typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},u.storage=function(){try{return localStorage}catch{}}(),u.destroy=(()=>{let h=!1;return()=>{h||(h=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),u.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],u.log=console.debug||console.log||(()=>{}),a.exports=o("./common")(u);const{formatters:w}=a.exports;w.j=function(h){try{return JSON.stringify(h)}catch(p){return"[UnexpectedJSONParseError]: "+p.message}}}).call(this)}).call(this,o("_process"))},{"./common":5,_process:12}],5:[function(o,a){a.exports=function(u){function c(h){function p(...E){if(!p.enabled)return;const L=p,x=+new Date,U=x-(g||x);L.diff=U,L.prev=g,L.curr=x,g=x,E[0]=c.coerce(E[0]),typeof E[0]!="string"&&E.unshift("%O");let y=0;E[0]=E[0].replace(/%([a-zA-Z%])/g,(v,S)=>{if(v==="%%")return"%";y++;const C=c.formatters[S];if(typeof C=="function"){const R=E[y];v=C.call(L,R),E.splice(y,1),y--}return v}),c.formatArgs.call(L,E),(L.log||c.log).apply(L,E)}let g,f=null;return p.namespace=h,p.useColors=c.useColors(),p.color=c.selectColor(h),p.extend=m,p.destroy=c.destroy,Object.defineProperty(p,"enabled",{enumerable:!0,configurable:!1,get:()=>f===null?c.enabled(h):f,set:E=>{f=E}}),typeof c.init=="function"&&c.init(p),p}function m(h,p){const g=c(this.namespace+(typeof p=="undefined"?":":p)+h);return g.log=this.log,g}function w(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}return c.debug=c,c.default=c,c.coerce=function(h){return h instanceof Error?h.stack||h.message:h},c.disable=function(){const h=[...c.names.map(w),...c.skips.map(w).map(p=>"-"+p)].join(",");return c.enable(""),h},c.enable=function(h){c.save(h),c.names=[],c.skips=[];let p;const g=(typeof h=="string"?h:"").split(/[\s,]+/),f=g.length;for(p=0;p<f;p++)g[p]&&(h=g[p].replace(/\*/g,".*?"),h[0]==="-"?c.skips.push(new RegExp("^"+h.substr(1)+"$")):c.names.push(new RegExp("^"+h+"$")))},c.enabled=function(h){if(h[h.length-1]==="*")return!0;let p,g;for(p=0,g=c.skips.length;p<g;p++)if(c.skips[p].test(h))return!1;for(p=0,g=c.names.length;p<g;p++)if(c.names[p].test(h))return!0;return!1},c.humanize=o("ms"),c.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(u).forEach(h=>{c[h]=u[h]}),c.names=[],c.skips=[],c.formatters={},c.selectColor=function(h){let p=0;for(let g=0;g<h.length;g++)p=(p<<5)-p+h.charCodeAt(g),p|=0;return c.colors[r(p)%c.colors.length]},c.enable(c.load()),c}},{ms:11}],6:[function(o,a){function u(c,m){for(const w in m)Object.defineProperty(c,w,{value:m[w],enumerable:!0,configurable:!0});return c}a.exports=function(c,m,w){if(!c||typeof c=="string")throw new TypeError("Please pass an Error to err-code");w||(w={}),typeof m=="object"&&(w=m,m=""),m&&(w.code=m);try{return u(c,w)}catch{w.message=c.message,w.stack=c.stack;const p=function(){};return p.prototype=Object.create(Object.getPrototypeOf(c)),u(new p,w)}}},{}],7:[function(o,a){function u(T){console&&console.warn&&console.warn(T)}function c(){c.init.call(this)}function m(T){if(typeof T!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof T)}function w(T){return T._maxListeners===void 0?c.defaultMaxListeners:T._maxListeners}function h(T,D,F,j){var W,Y,X;if(m(F),Y=T._events,Y===void 0?(Y=T._events=Object.create(null),T._eventsCount=0):(Y.newListener!==void 0&&(T.emit("newListener",D,F.listener?F.listener:F),Y=T._events),X=Y[D]),X===void 0)X=Y[D]=F,++T._eventsCount;else if(typeof X=="function"?X=Y[D]=j?[F,X]:[X,F]:j?X.unshift(F):X.push(F),W=w(T),0<W&&X.length>W&&!X.warned){X.warned=!0;var it=new Error("Possible EventEmitter memory leak detected. "+X.length+" "+(D+" listeners added. Use emitter.setMaxListeners() to increase limit"));it.name="MaxListenersExceededWarning",it.emitter=T,it.type=D,it.count=X.length,u(it)}return T}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function g(T,D,F){var j={fired:!1,wrapFn:void 0,target:T,type:D,listener:F},W=p.bind(j);return W.listener=F,j.wrapFn=W,W}function f(T,D,F){var j=T._events;if(j===void 0)return[];var W=j[D];return W===void 0?[]:typeof W=="function"?F?[W.listener||W]:[W]:F?U(W):L(W,W.length)}function E(T){var D=this._events;if(D!==void 0){var F=D[T];if(typeof F=="function")return 1;if(F!==void 0)return F.length}return 0}function L(T,D){for(var F=Array(D),j=0;j<D;++j)F[j]=T[j];return F}function x(T,D){for(;D+1<T.length;D++)T[D]=T[D+1];T.pop()}function U(T){for(var D=Array(T.length),F=0;F<D.length;++F)D[F]=T[F].listener||T[F];return D}function y(T,D,F){typeof T.on=="function"&&_(T,"error",D,F)}function _(T,D,F,j){if(typeof T.on=="function")j.once?T.once(D,F):T.on(D,F);else if(typeof T.addEventListener=="function")T.addEventListener(D,function W(Y){j.once&&T.removeEventListener(D,W),F(Y)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof T)}var v,S=typeof Reflect=="object"?Reflect:null,C=S&&typeof S.apply=="function"?S.apply:function(T,D,F){return Function.prototype.apply.call(T,D,F)};v=S&&typeof S.ownKeys=="function"?S.ownKeys:Object.getOwnPropertySymbols?function(T){return Object.getOwnPropertyNames(T).concat(Object.getOwnPropertySymbols(T))}:function(T){return Object.getOwnPropertyNames(T)};var R=Number.isNaN||function(T){return T!==T};a.exports=c,a.exports.once=function(T,D){return new Promise(function(F,j){function W(X){T.removeListener(D,Y),j(X)}function Y(){typeof T.removeListener=="function"&&T.removeListener("error",W),F([].slice.call(arguments))}_(T,D,Y,{once:!0}),D!=="error"&&y(T,W,{once:!0})})},c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var M=10;Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return M},set:function(T){if(typeof T!="number"||0>T||R(T))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+T+".");M=T}}),c.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(T){if(typeof T!="number"||0>T||R(T))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+T+".");return this._maxListeners=T,this},c.prototype.getMaxListeners=function(){return w(this)},c.prototype.emit=function(T){for(var D=[],F=1;F<arguments.length;F++)D.push(arguments[F]);var j=T==="error",W=this._events;if(W!==void 0)j=j&&W.error===void 0;else if(!j)return!1;if(j){var Y;if(0<D.length&&(Y=D[0]),Y instanceof Error)throw Y;var X=new Error("Unhandled error."+(Y?" ("+Y.message+")":""));throw X.context=Y,X}var it=W[T];if(it===void 0)return!1;if(typeof it=="function")C(it,this,D);else for(var pt=it.length,H=L(it,pt),F=0;F<pt;++F)C(H[F],this,D);return!0},c.prototype.addListener=function(T,D){return h(this,T,D,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(T,D){return h(this,T,D,!0)},c.prototype.once=function(T,D){return m(D),this.on(T,g(this,T,D)),this},c.prototype.prependOnceListener=function(T,D){return m(D),this.prependListener(T,g(this,T,D)),this},c.prototype.removeListener=function(T,D){var F,j,W,Y,X;if(m(D),j=this._events,j===void 0)return this;if(F=j[T],F===void 0)return this;if(F===D||F.listener===D)--this._eventsCount==0?this._events=Object.create(null):(delete j[T],j.removeListener&&this.emit("removeListener",T,F.listener||D));else if(typeof F!="function"){for(W=-1,Y=F.length-1;0<=Y;Y--)if(F[Y]===D||F[Y].listener===D){X=F[Y].listener,W=Y;break}if(0>W)return this;W===0?F.shift():x(F,W),F.length===1&&(j[T]=F[0]),j.removeListener!==void 0&&this.emit("removeListener",T,X||D)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(T){var D,F,j;if(F=this._events,F===void 0)return this;if(F.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):F[T]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete F[T]),this;if(arguments.length===0){var W,Y=Object.keys(F);for(j=0;j<Y.length;++j)W=Y[j],W!=="removeListener"&&this.removeAllListeners(W);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(D=F[T],typeof D=="function")this.removeListener(T,D);else if(D!==void 0)for(j=D.length-1;0<=j;j--)this.removeListener(T,D[j]);return this},c.prototype.listeners=function(T){return f(this,T,!0)},c.prototype.rawListeners=function(T){return f(this,T,!1)},c.listenerCount=function(T,D){return typeof T.listenerCount=="function"?T.listenerCount(D):E.call(T,D)},c.prototype.listenerCount=E,c.prototype.eventNames=function(){return 0<this._eventsCount?v(this._events):[]}},{}],8:[function(o,a){a.exports=function(){if(typeof globalThis=="undefined")return null;var u={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return u.RTCPeerConnection?u:null}},{}],9:[function(o,a,u){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */u.read=function(c,m,w,h,p){var g,f,E=8*p-h-1,L=(1<<E)-1,x=L>>1,U=-7,y=w?p-1:0,_=w?-1:1,v=c[m+y];for(y+=_,g=v&(1<<-U)-1,v>>=-U,U+=E;0<U;g=256*g+c[m+y],y+=_,U-=8);for(f=g&(1<<-U)-1,g>>=-U,U+=h;0<U;f=256*f+c[m+y],y+=_,U-=8);if(g===0)g=1-x;else{if(g===L)return f?NaN:(v?-1:1)*(1/0);f+=i(2,h),g-=x}return(v?-1:1)*f*i(2,g-h)},u.write=function(c,m,w,h,p,g){var f,E,L,x=Math.LN2,U=Math.log,y=8*g-p-1,_=(1<<y)-1,v=_>>1,S=p===23?i(2,-24)-i(2,-77):0,C=h?0:g-1,R=h?1:-1,M=0>m||m===0&&0>1/m?1:0;for(m=r(m),isNaN(m)||m===1/0?(E=isNaN(m)?1:0,f=_):(f=n(U(m)/x),1>m*(L=i(2,-f))&&(f--,L*=2),m+=1<=f+v?S/L:S*i(2,1-v),2<=m*L&&(f++,L/=2),f+v>=_?(E=0,f=_):1<=f+v?(E=(m*L-1)*i(2,p),f+=v):(E=m*i(2,v-1)*i(2,p),f=0));8<=p;c[w+C]=255&E,C+=R,E/=256,p-=8);for(f=f<<p|E,y+=p;0<y;c[w+C]=255&f,C+=R,f/=256,y-=8);c[w+C-R]|=128*M}},{}],10:[function(o,a){a.exports=typeof Object.create=="function"?function(u,c){c&&(u.super_=c,u.prototype=Object.create(c.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}))}:function(u,c){if(c){u.super_=c;var m=function(){};m.prototype=c.prototype,u.prototype=new m,u.prototype.constructor=u}}},{}],11:[function(o,a){var u=Math.round;function c(p){if(p+="",!(100<p.length)){var g=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(p);if(g){var f=parseFloat(g[1]),E=(g[2]||"ms").toLowerCase();return E==="years"||E==="year"||E==="yrs"||E==="yr"||E==="y"?315576e5*f:E==="weeks"||E==="week"||E==="w"?6048e5*f:E==="days"||E==="day"||E==="d"?864e5*f:E==="hours"||E==="hour"||E==="hrs"||E==="hr"||E==="h"?36e5*f:E==="minutes"||E==="minute"||E==="mins"||E==="min"||E==="m"?6e4*f:E==="seconds"||E==="second"||E==="secs"||E==="sec"||E==="s"?1e3*f:E==="milliseconds"||E==="millisecond"||E==="msecs"||E==="msec"||E==="ms"?f:void 0}}}function m(p){var g=r(p);return 864e5<=g?u(p/864e5)+"d":36e5<=g?u(p/36e5)+"h":6e4<=g?u(p/6e4)+"m":1e3<=g?u(p/1e3)+"s":p+"ms"}function w(p){var g=r(p);return 864e5<=g?h(p,g,864e5,"day"):36e5<=g?h(p,g,36e5,"hour"):6e4<=g?h(p,g,6e4,"minute"):1e3<=g?h(p,g,1e3,"second"):p+" ms"}function h(p,g,f,E){return u(p/f)+" "+E+(g>=1.5*f?"s":"")}a.exports=function(p,g){g=g||{};var f=typeof p;if(f=="string"&&0<p.length)return c(p);if(f==="number"&&isFinite(p))return g.long?w(p):m(p);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(p))}},{}],12:[function(o,a){function u(){throw new Error("setTimeout has not been defined")}function c(){throw new Error("clearTimeout has not been defined")}function m(S){if(E===setTimeout)return setTimeout(S,0);if((E===u||!E)&&setTimeout)return E=setTimeout,setTimeout(S,0);try{return E(S,0)}catch{try{return E.call(null,S,0)}catch{return E.call(this,S,0)}}}function w(S){if(L===clearTimeout)return clearTimeout(S);if((L===c||!L)&&clearTimeout)return L=clearTimeout,clearTimeout(S);try{return L(S)}catch{try{return L.call(null,S)}catch{return L.call(this,S)}}}function h(){_&&U&&(_=!1,U.length?y=U.concat(y):v=-1,y.length&&p())}function p(){if(!_){var S=m(h);_=!0;for(var C=y.length;C;){for(U=y,y=[];++v<C;)U&&U[v].run();v=-1,C=y.length}U=null,_=!1,w(S)}}function g(S,C){this.fun=S,this.array=C}function f(){}var E,L,x=a.exports={};(function(){try{E=typeof setTimeout=="function"?setTimeout:u}catch{E=u}try{L=typeof clearTimeout=="function"?clearTimeout:c}catch{L=c}})();var U,y=[],_=!1,v=-1;x.nextTick=function(S){var C=Array(arguments.length-1);if(1<arguments.length)for(var R=1;R<arguments.length;R++)C[R-1]=arguments[R];y.push(new g(S,C)),y.length!==1||_||m(p)},g.prototype.run=function(){this.fun.apply(null,this.array)},x.title="browser",x.browser=!0,x.env={},x.argv=[],x.version="",x.versions={},x.on=f,x.addListener=f,x.once=f,x.off=f,x.removeListener=f,x.removeAllListeners=f,x.emit=f,x.prependListener=f,x.prependOnceListener=f,x.listeners=function(){return[]},x.binding=function(){throw new Error("process.binding is not supported")},x.cwd=function(){return"/"},x.chdir=function(){throw new Error("process.chdir is not supported")},x.umask=function(){return 0}},{}],13:[function(o,a){(function(u){(function(){/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let c;a.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window=="undefined"?u:window):m=>(c||(c=Promise.resolve())).then(m).catch(w=>setTimeout(()=>{throw w},0))}).call(this)}).call(this,typeof Rt=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:Rt)},{}],14:[function(o,a){(function(u,c){(function(){var m=o("safe-buffer").Buffer,w=c.crypto||c.msCrypto;a.exports=w&&w.getRandomValues?function(h,p){if(h>4294967295)throw new RangeError("requested too many random bytes");var g=m.allocUnsafe(h);if(0<h)if(65536<h)for(var f=0;f<h;f+=65536)w.getRandomValues(g.slice(f,f+65536));else w.getRandomValues(g);return typeof p=="function"?u.nextTick(function(){p(null,g)}):g}:function(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}}).call(this)}).call(this,o("_process"),typeof Rt=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:Rt)},{_process:12,"safe-buffer":30}],15:[function(o,a){function u(f,E){f.prototype=Object.create(E.prototype),f.prototype.constructor=f,f.__proto__=E}function c(f,E,L){function x(y,_,v){return typeof E=="string"?E:E(y,_,v)}L||(L=Error);var U=function(y){function _(v,S,C){return y.call(this,x(v,S,C))||this}return u(_,y),_}(L);U.prototype.name=L.name,U.prototype.code=f,g[f]=U}function m(f,E){if(Array.isArray(f)){var L=f.length;return f=f.map(function(x){return x+""}),2<L?"one of ".concat(E," ").concat(f.slice(0,L-1).join(", "),", or ")+f[L-1]:L===2?"one of ".concat(E," ").concat(f[0]," or ").concat(f[1]):"of ".concat(E," ").concat(f[0])}return"of ".concat(E," ").concat(f+"")}function w(f,E,L){return f.substr(!L||0>L?0:+L,E.length)===E}function h(f,E,L){return(L===void 0||L>f.length)&&(L=f.length),f.substring(L-E.length,L)===E}function p(f,E,L){return typeof L!="number"&&(L=0),!(L+E.length>f.length)&&f.indexOf(E,L)!==-1}var g={};c("ERR_INVALID_OPT_VALUE",function(f,E){return'The value "'+E+'" is invalid for option "'+f+'"'},TypeError),c("ERR_INVALID_ARG_TYPE",function(f,E,L){var x;typeof E=="string"&&w(E,"not ")?(x="must not be",E=E.replace(/^not /,"")):x="must be";var U;if(h(f," argument"))U="The ".concat(f," ").concat(x," ").concat(m(E,"type"));else{var y=p(f,".")?"property":"argument";U='The "'.concat(f,'" ').concat(y," ").concat(x," ").concat(m(E,"type"))}return U+=". Received type ".concat(typeof L),U},TypeError),c("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),c("ERR_METHOD_NOT_IMPLEMENTED",function(f){return"The "+f+" method is not implemented"}),c("ERR_STREAM_PREMATURE_CLOSE","Premature close"),c("ERR_STREAM_DESTROYED",function(f){return"Cannot call "+f+" after a stream was destroyed"}),c("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),c("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),c("ERR_STREAM_WRITE_AFTER_END","write after end"),c("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),c("ERR_UNKNOWN_ENCODING",function(f){return"Unknown encoding: "+f},TypeError),c("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),a.exports.codes=g},{}],16:[function(o,a){(function(u){(function(){function c(x){return this instanceof c?(p.call(this,x),g.call(this,x),this.allowHalfOpen=!0,void(x&&(x.readable===!1&&(this.readable=!1),x.writable===!1&&(this.writable=!1),x.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",m))))):new c(x)}function m(){this._writableState.ended||u.nextTick(w,this)}function w(x){x.end()}var h=Object.keys||function(x){var U=[];for(var y in x)U.push(y);return U};a.exports=c;var p=o("./_stream_readable"),g=o("./_stream_writable");o("inherits")(c,p);for(var f,E=h(g.prototype),L=0;L<E.length;L++)f=E[L],c.prototype[f]||(c.prototype[f]=g.prototype[f]);Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(x){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=x,this._writableState.destroyed=x)}})}).call(this)}).call(this,o("_process"))},{"./_stream_readable":18,"./_stream_writable":20,_process:12,inherits:10}],17:[function(o,a){function u(m){return this instanceof u?void c.call(this,m):new u(m)}a.exports=u;var c=o("./_stream_transform");o("inherits")(u,c),u.prototype._transform=function(m,w,h){h(null,m)}},{"./_stream_transform":19,inherits:10}],18:[function(o,a){(function(u,c){(function(){function m(b){return Qt.from(b)}function w(b){return Qt.isBuffer(b)||b instanceof rt}function h(b,s,l){return typeof b.prependListener=="function"?b.prependListener(s,l):void(b._events&&b._events[s]?Array.isArray(b._events[s])?b._events[s].unshift(l):b._events[s]=[l,b._events[s]]:b.on(s,l))}function p(b,s,l){pt=pt||o("./_stream_duplex"),b=b||{},typeof l!="boolean"&&(l=s instanceof pt),this.objectMode=!!b.objectMode,l&&(this.objectMode=this.objectMode||!!b.readableObjectMode),this.highWaterMark=Oe(this,b,"readableHighWaterMark",l),this.buffer=new Le,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=b.emitClose!==!1,this.autoDestroy=!!b.autoDestroy,this.destroyed=!1,this.defaultEncoding=b.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,b.encoding&&(!vt&&(vt=o("string_decoder/").StringDecoder),this.decoder=new vt(b.encoding),this.encoding=b.encoding)}function g(b){if(pt=pt||o("./_stream_duplex"),!(this instanceof g))return new g(b);var s=this instanceof pt;this._readableState=new p(b,this,s),this.readable=!0,b&&(typeof b.read=="function"&&(this._read=b.read),typeof b.destroy=="function"&&(this._destroy=b.destroy)),_t.call(this)}function f(b,s,l,d,k){H("readableAddChunk",s);var A=b._readableState;if(s===null)A.reading=!1,y(b,A);else{var N;if(k||(N=L(A,s)),N)B(b,N);else if(!(A.objectMode||s&&0<s.length))d||(A.reading=!1,S(b,A));else if(typeof s=="string"||A.objectMode||Object.getPrototypeOf(s)===Qt.prototype||(s=m(s)),d)A.endEmitted?B(b,new O):E(b,A,s,!0);else if(A.ended)B(b,new Et);else{if(A.destroyed)return!1;A.reading=!1,A.decoder&&!l?(s=A.decoder.write(s),A.objectMode||s.length!==0?E(b,A,s,!1):S(b,A)):E(b,A,s,!1)}}return!A.ended&&(A.length<A.highWaterMark||A.length===0)}function E(b,s,l,d){s.flowing&&s.length===0&&!s.sync?(s.awaitDrain=0,b.emit("data",l)):(s.length+=s.objectMode?1:l.length,d?s.buffer.unshift(l):s.buffer.push(l),s.needReadable&&_(b)),S(b,s)}function L(b,s){var l;return w(s)||typeof s=="string"||s===void 0||b.objectMode||(l=new Ct("chunk",["string","Buffer","Uint8Array"],s)),l}function x(b){return 1073741824<=b?b=1073741824:(b--,b|=b>>>1,b|=b>>>2,b|=b>>>4,b|=b>>>8,b|=b>>>16,b++),b}function U(b,s){return 0>=b||s.length===0&&s.ended?0:s.objectMode?1:b===b?(b>s.highWaterMark&&(s.highWaterMark=x(b)),b<=s.length?b:s.ended?s.length:(s.needReadable=!0,0)):s.flowing&&s.length?s.buffer.head.data.length:s.length}function y(b,s){if(H("onEofChunk"),!s.ended){if(s.decoder){var l=s.decoder.end();l&&l.length&&(s.buffer.push(l),s.length+=s.objectMode?1:l.length)}s.ended=!0,s.sync?_(b):(s.needReadable=!1,!s.emittedReadable&&(s.emittedReadable=!0,v(b)))}}function _(b){var s=b._readableState;H("emitReadable",s.needReadable,s.emittedReadable),s.needReadable=!1,s.emittedReadable||(H("emitReadable",s.flowing),s.emittedReadable=!0,u.nextTick(v,b))}function v(b){var s=b._readableState;H("emitReadable_",s.destroyed,s.length,s.ended),!s.destroyed&&(s.length||s.ended)&&(b.emit("readable"),s.emittedReadable=!1),s.needReadable=!s.flowing&&!s.ended&&s.length<=s.highWaterMark,j(b)}function S(b,s){s.readingMore||(s.readingMore=!0,u.nextTick(C,b,s))}function C(b,s){for(;!s.reading&&!s.ended&&(s.length<s.highWaterMark||s.flowing&&s.length===0);){var l=s.length;if(H("maybeReadMore read 0"),b.read(0),l===s.length)break}s.readingMore=!1}function R(b){return function(){var s=b._readableState;H("pipeOnDrain",s.awaitDrain),s.awaitDrain&&s.awaitDrain--,s.awaitDrain===0&&ye(b,"data")&&(s.flowing=!0,j(b))}}function M(b){var s=b._readableState;s.readableListening=0<b.listenerCount("readable"),s.resumeScheduled&&!s.paused?s.flowing=!0:0<b.listenerCount("data")&&b.resume()}function T(b){H("readable nexttick read 0"),b.read(0)}function D(b,s){s.resumeScheduled||(s.resumeScheduled=!0,u.nextTick(F,b,s))}function F(b,s){H("resume",s.reading),s.reading||b.read(0),s.resumeScheduled=!1,b.emit("resume"),j(b),s.flowing&&!s.reading&&b.read(0)}function j(b){var s=b._readableState;for(H("flow",s.flowing);s.flowing&&b.read()!==null;);}function W(b,s){if(s.length===0)return null;var l;return s.objectMode?l=s.buffer.shift():!b||b>=s.length?(l=s.decoder?s.buffer.join(""):s.buffer.length===1?s.buffer.first():s.buffer.concat(s.length),s.buffer.clear()):l=s.buffer.consume(b,s.decoder),l}function Y(b){var s=b._readableState;H("endReadable",s.endEmitted),s.endEmitted||(s.ended=!0,u.nextTick(X,s,b))}function X(b,s){if(H("endReadableNT",b.endEmitted,b.length),!b.endEmitted&&b.length===0&&(b.endEmitted=!0,s.readable=!1,s.emit("end"),b.autoDestroy)){var l=s._writableState;(!l||l.autoDestroy&&l.finished)&&s.destroy()}}function it(b,s){for(var l=0,d=b.length;l<d;l++)if(b[l]===s)return l;return-1}a.exports=g;var pt;g.ReadableState=p;var H;o("events").EventEmitter;var ye=function(b,s){return b.listeners(s).length},_t=o("./internal/streams/stream"),Qt=o("buffer").Buffer,rt=c.Uint8Array||function(){},Z=o("util");H=Z&&Z.debuglog?Z.debuglog("stream"):function(){};var vt,Gt,Kt,Le=o("./internal/streams/buffer_list"),re=o("./internal/streams/destroy"),se=o("./internal/streams/state"),Oe=se.getHighWaterMark,Jt=o("../errors").codes,Ct=Jt.ERR_INVALID_ARG_TYPE,Et=Jt.ERR_STREAM_PUSH_AFTER_EOF,I=Jt.ERR_METHOD_NOT_IMPLEMENTED,O=Jt.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;o("inherits")(g,_t);var B=re.errorOrDestroy,q=["error","close","destroy","pause","resume"];Object.defineProperty(g.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(b){this._readableState&&(this._readableState.destroyed=b)}}),g.prototype.destroy=re.destroy,g.prototype._undestroy=re.undestroy,g.prototype._destroy=function(b,s){s(b)},g.prototype.push=function(b,s){var l,d=this._readableState;return d.objectMode?l=!0:typeof b=="string"&&(s=s||d.defaultEncoding,s!==d.encoding&&(b=Qt.from(b,s),s=""),l=!0),f(this,b,s,!1,l)},g.prototype.unshift=function(b){return f(this,b,null,!0,!1)},g.prototype.isPaused=function(){return this._readableState.flowing===!1},g.prototype.setEncoding=function(b){vt||(vt=o("string_decoder/").StringDecoder);var s=new vt(b);this._readableState.decoder=s,this._readableState.encoding=this._readableState.decoder.encoding;for(var l=this._readableState.buffer.head,d="";l!==null;)d+=s.write(l.data),l=l.next;return this._readableState.buffer.clear(),d!==""&&this._readableState.buffer.push(d),this._readableState.length=d.length,this},g.prototype.read=function(b){H("read",b),b=parseInt(b,10);var s=this._readableState,l=b;if(b!==0&&(s.emittedReadable=!1),b===0&&s.needReadable&&((s.highWaterMark===0?0<s.length:s.length>=s.highWaterMark)||s.ended))return H("read: emitReadable",s.length,s.ended),s.length===0&&s.ended?Y(this):_(this),null;if(b=U(b,s),b===0&&s.ended)return s.length===0&&Y(this),null;var d=s.needReadable;H("need readable",d),(s.length===0||s.length-b<s.highWaterMark)&&(d=!0,H("length less than watermark",d)),s.ended||s.reading?(d=!1,H("reading or ended",d)):d&&(H("do read"),s.reading=!0,s.sync=!0,s.length===0&&(s.needReadable=!0),this._read(s.highWaterMark),s.sync=!1,!s.reading&&(b=U(l,s)));var k;return k=0<b?W(b,s):null,k===null?(s.needReadable=s.length<=s.highWaterMark,b=0):(s.length-=b,s.awaitDrain=0),s.length===0&&(!s.ended&&(s.needReadable=!0),l!==b&&s.ended&&Y(this)),k!==null&&this.emit("data",k),k},g.prototype._read=function(){B(this,new I("_read()"))},g.prototype.pipe=function(b,s){function l(be,_e){H("onunpipe"),be===K&&_e&&_e.hasUnpiped===!1&&(_e.hasUnpiped=!0,k())}function d(){H("onend"),b.end()}function k(){H("cleanup"),b.removeListener("close",P),b.removeListener("finish",G),b.removeListener("drain",we),b.removeListener("error",N),b.removeListener("unpipe",l),K.removeListener("end",d),K.removeListener("end",et),K.removeListener("data",A),Ne=!0,Q.awaitDrain&&(!b._writableState||b._writableState.needDrain)&&we()}function A(be){H("ondata");var _e=b.write(be);H("dest.write",_e),_e===!1&&((Q.pipesCount===1&&Q.pipes===b||1<Q.pipesCount&&it(Q.pipes,b)!==-1)&&!Ne&&(H("false write response, pause",Q.awaitDrain),Q.awaitDrain++),K.pause())}function N(be){H("onerror",be),et(),b.removeListener("error",N),ye(b,"error")===0&&B(b,be)}function P(){b.removeListener("finish",G),et()}function G(){H("onfinish"),b.removeListener("close",P),et()}function et(){H("unpipe"),K.unpipe(b)}var K=this,Q=this._readableState;switch(Q.pipesCount){case 0:Q.pipes=b;break;case 1:Q.pipes=[Q.pipes,b];break;default:Q.pipes.push(b)}Q.pipesCount+=1,H("pipe count=%d opts=%j",Q.pipesCount,s);var dt=(!s||s.end!==!1)&&b!==u.stdout&&b!==u.stderr,ie=dt?d:et;Q.endEmitted?u.nextTick(ie):K.once("end",ie),b.on("unpipe",l);var we=R(K);b.on("drain",we);var Ne=!1;return K.on("data",A),h(b,"error",N),b.once("close",P),b.once("finish",G),b.emit("pipe",K),Q.flowing||(H("pipe resume"),K.resume()),b},g.prototype.unpipe=function(b){var s=this._readableState,l={hasUnpiped:!1};if(s.pipesCount===0)return this;if(s.pipesCount===1)return b&&b!==s.pipes?this:(b||(b=s.pipes),s.pipes=null,s.pipesCount=0,s.flowing=!1,b&&b.emit("unpipe",this,l),this);if(!b){var d=s.pipes,k=s.pipesCount;s.pipes=null,s.pipesCount=0,s.flowing=!1;for(var A=0;A<k;A++)d[A].emit("unpipe",this,{hasUnpiped:!1});return this}var N=it(s.pipes,b);return N===-1?this:(s.pipes.splice(N,1),s.pipesCount-=1,s.pipesCount===1&&(s.pipes=s.pipes[0]),b.emit("unpipe",this,l),this)},g.prototype.on=function(b,s){var l=_t.prototype.on.call(this,b,s),d=this._readableState;return b==="data"?(d.readableListening=0<this.listenerCount("readable"),d.flowing!==!1&&this.resume()):b=="readable"&&!d.endEmitted&&!d.readableListening&&(d.readableListening=d.needReadable=!0,d.flowing=!1,d.emittedReadable=!1,H("on readable",d.length,d.reading),d.length?_(this):!d.reading&&u.nextTick(T,this)),l},g.prototype.addListener=g.prototype.on,g.prototype.removeListener=function(b,s){var l=_t.prototype.removeListener.call(this,b,s);return b==="readable"&&u.nextTick(M,this),l},g.prototype.removeAllListeners=function(b){var s=_t.prototype.removeAllListeners.apply(this,arguments);return(b==="readable"||b===void 0)&&u.nextTick(M,this),s},g.prototype.resume=function(){var b=this._readableState;return b.flowing||(H("resume"),b.flowing=!b.readableListening,D(this,b)),b.paused=!1,this},g.prototype.pause=function(){return H("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(H("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},g.prototype.wrap=function(b){var s=this,l=this._readableState,d=!1;for(var k in b.on("end",function(){if(H("wrapped end"),l.decoder&&!l.ended){var N=l.decoder.end();N&&N.length&&s.push(N)}s.push(null)}),b.on("data",function(N){if(H("wrapped data"),l.decoder&&(N=l.decoder.write(N)),!(l.objectMode&&N==null)&&(l.objectMode||N&&N.length)){var P=s.push(N);P||(d=!0,b.pause())}}),b)this[k]===void 0&&typeof b[k]=="function"&&(this[k]=function(N){return function(){return b[N].apply(b,arguments)}}(k));for(var A=0;A<q.length;A++)b.on(q[A],this.emit.bind(this,q[A]));return this._read=function(N){H("wrapped _read",N),d&&(d=!1,b.resume())},this},typeof Symbol=="function"&&(g.prototype[Symbol.asyncIterator]=function(){return Gt===void 0&&(Gt=o("./internal/streams/async_iterator")),Gt(this)}),Object.defineProperty(g.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(g.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(g.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(b){this._readableState&&(this._readableState.flowing=b)}}),g._fromList=W,Object.defineProperty(g.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(g.from=function(b,s){return Kt===void 0&&(Kt=o("./internal/streams/from")),Kt(g,b,s)})}).call(this)}).call(this,o("_process"),typeof Rt=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:Rt)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/async_iterator":21,"./internal/streams/buffer_list":22,"./internal/streams/destroy":23,"./internal/streams/from":25,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,events:7,inherits:10,"string_decoder/":31,util:2}],19:[function(o,a){function u(x,U){var y=this._transformState;y.transforming=!1;var _=y.writecb;if(_===null)return this.emit("error",new g);y.writechunk=null,y.writecb=null,U!=null&&this.push(U),_(x);var v=this._readableState;v.reading=!1,(v.needReadable||v.length<v.highWaterMark)&&this._read(v.highWaterMark)}function c(x){return this instanceof c?(L.call(this,x),this._transformState={afterTransform:u.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,x&&(typeof x.transform=="function"&&(this._transform=x.transform),typeof x.flush=="function"&&(this._flush=x.flush)),void this.on("prefinish",m)):new c(x)}function m(){var x=this;typeof this._flush!="function"||this._readableState.destroyed?w(this,null,null):this._flush(function(U,y){w(x,U,y)})}function w(x,U,y){if(U)return x.emit("error",U);if(y!=null&&x.push(y),x._writableState.length)throw new E;if(x._transformState.transforming)throw new f;return x.push(null)}a.exports=c;var h=o("../errors").codes,p=h.ERR_METHOD_NOT_IMPLEMENTED,g=h.ERR_MULTIPLE_CALLBACK,f=h.ERR_TRANSFORM_ALREADY_TRANSFORMING,E=h.ERR_TRANSFORM_WITH_LENGTH_0,L=o("./_stream_duplex");o("inherits")(c,L),c.prototype.push=function(x,U){return this._transformState.needTransform=!1,L.prototype.push.call(this,x,U)},c.prototype._transform=function(x,U,y){y(new p("_transform()"))},c.prototype._write=function(x,U,y){var _=this._transformState;if(_.writecb=y,_.writechunk=x,_.writeencoding=U,!_.transforming){var v=this._readableState;(_.needTransform||v.needReadable||v.length<v.highWaterMark)&&this._read(v.highWaterMark)}},c.prototype._read=function(){var x=this._transformState;x.writechunk===null||x.transforming?x.needTransform=!0:(x.transforming=!0,this._transform(x.writechunk,x.writeencoding,x.afterTransform))},c.prototype._destroy=function(x,U){L.prototype._destroy.call(this,x,function(y){U(y)})}},{"../errors":15,"./_stream_duplex":16,inherits:10}],20:[function(o,a){(function(u,c){(function(){function m(I){var O=this;this.next=null,this.entry=null,this.finish=function(){Y(O,I)}}function w(I){return H.from(I)}function h(I){return H.isBuffer(I)||I instanceof ye}function p(){}function g(I,O,B){X=X||o("./_stream_duplex"),I=I||{},typeof B!="boolean"&&(B=O instanceof X),this.objectMode=!!I.objectMode,B&&(this.objectMode=this.objectMode||!!I.writableObjectMode),this.highWaterMark=rt(this,I,"writableHighWaterMark",B),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var q=I.decodeStrings===!1;this.decodeStrings=!q,this.defaultEncoding=I.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(b){S(O,b)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=I.emitClose!==!1,this.autoDestroy=!!I.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new m(this)}function f(I){X=X||o("./_stream_duplex");var O=this instanceof X;return O||Et.call(f,this)?(this._writableState=new g(I,this,O),this.writable=!0,I&&(typeof I.write=="function"&&(this._write=I.write),typeof I.writev=="function"&&(this._writev=I.writev),typeof I.destroy=="function"&&(this._destroy=I.destroy),typeof I.final=="function"&&(this._final=I.final)),void pt.call(this)):new f(I)}function E(I,O){var B=new Oe;Ct(I,B),u.nextTick(O,B)}function L(I,O,B,q){var b;return B===null?b=new se:typeof B!="string"&&!O.objectMode&&(b=new vt("chunk",["string","Buffer"],B)),!b||(Ct(I,b),u.nextTick(q,b),!1)}function x(I,O,B){return I.objectMode||I.decodeStrings===!1||typeof O!="string"||(O=H.from(O,B)),O}function U(I,O,B,q,b,s){if(!B){var l=x(O,q,b);q!==l&&(B=!0,b="buffer",q=l)}var d=O.objectMode?1:q.length;O.length+=d;var k=O.length<O.highWaterMark;if(k||(O.needDrain=!0),O.writing||O.corked){var A=O.lastBufferedRequest;O.lastBufferedRequest={chunk:q,encoding:b,isBuf:B,callback:s,next:null},A?A.next=O.lastBufferedRequest:O.bufferedRequest=O.lastBufferedRequest,O.bufferedRequestCount+=1}else y(I,O,!1,d,q,b,s);return k}function y(I,O,B,q,b,s,l){O.writelen=q,O.writecb=l,O.writing=!0,O.sync=!0,O.destroyed?O.onwrite(new re("write")):B?I._writev(b,O.onwrite):I._write(b,s,O.onwrite),O.sync=!1}function _(I,O,B,q,b){--O.pendingcb,B?(u.nextTick(b,q),u.nextTick(j,I,O),I._writableState.errorEmitted=!0,Ct(I,q)):(b(q),I._writableState.errorEmitted=!0,Ct(I,q),j(I,O))}function v(I){I.writing=!1,I.writecb=null,I.length-=I.writelen,I.writelen=0}function S(I,O){var B=I._writableState,q=B.sync,b=B.writecb;if(typeof b!="function")throw new Kt;if(v(B),O)_(I,B,q,O,b);else{var s=T(B)||I.destroyed;s||B.corked||B.bufferProcessing||!B.bufferedRequest||M(I,B),q?u.nextTick(C,I,B,s,b):C(I,B,s,b)}}function C(I,O,B,q){B||R(I,O),O.pendingcb--,q(),j(I,O)}function R(I,O){O.length===0&&O.needDrain&&(O.needDrain=!1,I.emit("drain"))}function M(I,O){O.bufferProcessing=!0;var B=O.bufferedRequest;if(I._writev&&B&&B.next){var q=O.bufferedRequestCount,b=Array(q),s=O.corkedRequestsFree;s.entry=B;for(var l=0,d=!0;B;)b[l]=B,B.isBuf||(d=!1),B=B.next,l+=1;b.allBuffers=d,y(I,O,!0,O.length,b,"",s.finish),O.pendingcb++,O.lastBufferedRequest=null,s.next?(O.corkedRequestsFree=s.next,s.next=null):O.corkedRequestsFree=new m(O),O.bufferedRequestCount=0}else{for(;B;){var k=B.chunk,A=B.encoding,N=B.callback,P=O.objectMode?1:k.length;if(y(I,O,!1,P,k,A,N),B=B.next,O.bufferedRequestCount--,O.writing)break}B===null&&(O.lastBufferedRequest=null)}O.bufferedRequest=B,O.bufferProcessing=!1}function T(I){return I.ending&&I.length===0&&I.bufferedRequest===null&&!I.finished&&!I.writing}function D(I,O){I._final(function(B){O.pendingcb--,B&&Ct(I,B),O.prefinished=!0,I.emit("prefinish"),j(I,O)})}function F(I,O){O.prefinished||O.finalCalled||(typeof I._final!="function"||O.destroyed?(O.prefinished=!0,I.emit("prefinish")):(O.pendingcb++,O.finalCalled=!0,u.nextTick(D,I,O)))}function j(I,O){var B=T(O);if(B&&(F(I,O),O.pendingcb===0&&(O.finished=!0,I.emit("finish"),O.autoDestroy))){var q=I._readableState;(!q||q.autoDestroy&&q.endEmitted)&&I.destroy()}return B}function W(I,O,B){O.ending=!0,j(I,O),B&&(O.finished?u.nextTick(B):I.once("finish",B)),O.ended=!0,I.writable=!1}function Y(I,O,B){var q=I.entry;for(I.entry=null;q;){var b=q.callback;O.pendingcb--,b(B),q=q.next}O.corkedRequestsFree.next=I}a.exports=f;var X;f.WritableState=g;var it={deprecate:o("util-deprecate")},pt=o("./internal/streams/stream"),H=o("buffer").Buffer,ye=c.Uint8Array||function(){},_t=o("./internal/streams/destroy"),Qt=o("./internal/streams/state"),rt=Qt.getHighWaterMark,Z=o("../errors").codes,vt=Z.ERR_INVALID_ARG_TYPE,Gt=Z.ERR_METHOD_NOT_IMPLEMENTED,Kt=Z.ERR_MULTIPLE_CALLBACK,Le=Z.ERR_STREAM_CANNOT_PIPE,re=Z.ERR_STREAM_DESTROYED,se=Z.ERR_STREAM_NULL_VALUES,Oe=Z.ERR_STREAM_WRITE_AFTER_END,Jt=Z.ERR_UNKNOWN_ENCODING,Ct=_t.errorOrDestroy;o("inherits")(f,pt),g.prototype.getBuffer=function(){for(var I=this.bufferedRequest,O=[];I;)O.push(I),I=I.next;return O},function(){try{Object.defineProperty(g.prototype,"buffer",{get:it.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var Et;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(Et=Function.prototype[Symbol.hasInstance],Object.defineProperty(f,Symbol.hasInstance,{value:function(I){return!!Et.call(this,I)||this===f&&I&&I._writableState instanceof g}})):Et=function(I){return I instanceof this},f.prototype.pipe=function(){Ct(this,new Le)},f.prototype.write=function(I,O,B){var q=this._writableState,b=!1,s=!q.objectMode&&h(I);return s&&!H.isBuffer(I)&&(I=w(I)),typeof O=="function"&&(B=O,O=null),s?O="buffer":!O&&(O=q.defaultEncoding),typeof B!="function"&&(B=p),q.ending?E(this,B):(s||L(this,q,I,B))&&(q.pendingcb++,b=U(this,q,s,I,O,B)),b},f.prototype.cork=function(){this._writableState.corked++},f.prototype.uncork=function(){var I=this._writableState;I.corked&&(I.corked--,!I.writing&&!I.corked&&!I.bufferProcessing&&I.bufferedRequest&&M(this,I))},f.prototype.setDefaultEncoding=function(I){if(typeof I=="string"&&(I=I.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((I+"").toLowerCase())))throw new Jt(I);return this._writableState.defaultEncoding=I,this},Object.defineProperty(f.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(f.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),f.prototype._write=function(I,O,B){B(new Gt("_write()"))},f.prototype._writev=null,f.prototype.end=function(I,O,B){var q=this._writableState;return typeof I=="function"?(B=I,I=null,O=null):typeof O=="function"&&(B=O,O=null),I!=null&&this.write(I,O),q.corked&&(q.corked=1,this.uncork()),q.ending||W(this,q,B),this},Object.defineProperty(f.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(f.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(I){this._writableState&&(this._writableState.destroyed=I)}}),f.prototype.destroy=_t.destroy,f.prototype._undestroy=_t.undestroy,f.prototype._destroy=function(I,O){O(I)}}).call(this)}).call(this,o("_process"),typeof Rt=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:Rt)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/destroy":23,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,inherits:10,"util-deprecate":32}],21:[function(o,a){(function(u){(function(){function c(R,M,T){return M in R?Object.defineProperty(R,M,{value:T,enumerable:!0,configurable:!0,writable:!0}):R[M]=T,R}function m(R,M){return{value:R,done:M}}function w(R){var M=R[E];if(M!==null){var T=R[v].read();T!==null&&(R[y]=null,R[E]=null,R[L]=null,M(m(T,!1)))}}function h(R){u.nextTick(w,R)}function p(R,M){return function(T,D){R.then(function(){return M[U]?void T(m(void 0,!0)):void M[_](T,D)},D)}}var g,f=o("./end-of-stream"),E=Symbol("lastResolve"),L=Symbol("lastReject"),x=Symbol("error"),U=Symbol("ended"),y=Symbol("lastPromise"),_=Symbol("handlePromise"),v=Symbol("stream"),S=Object.getPrototypeOf(function(){}),C=Object.setPrototypeOf((g={get stream(){return this[v]},next:function(){var R=this,M=this[x];if(M!==null)return Promise.reject(M);if(this[U])return Promise.resolve(m(void 0,!0));if(this[v].destroyed)return new Promise(function(j,W){u.nextTick(function(){R[x]?W(R[x]):j(m(void 0,!0))})});var T,D=this[y];if(D)T=new Promise(p(D,this));else{var F=this[v].read();if(F!==null)return Promise.resolve(m(F,!1));T=new Promise(this[_])}return this[y]=T,T}},c(g,Symbol.asyncIterator,function(){return this}),c(g,"return",function(){var R=this;return new Promise(function(M,T){R[v].destroy(null,function(D){return D?void T(D):void M(m(void 0,!0))})})}),g),S);a.exports=function(R){var M,T=Object.create(C,(M={},c(M,v,{value:R,writable:!0}),c(M,E,{value:null,writable:!0}),c(M,L,{value:null,writable:!0}),c(M,x,{value:null,writable:!0}),c(M,U,{value:R._readableState.endEmitted,writable:!0}),c(M,_,{value:function(D,F){var j=T[v].read();j?(T[y]=null,T[E]=null,T[L]=null,D(m(j,!1))):(T[E]=D,T[L]=F)},writable:!0}),M));return T[y]=null,f(R,function(D){if(D&&D.code!=="ERR_STREAM_PREMATURE_CLOSE"){var F=T[L];return F!==null&&(T[y]=null,T[E]=null,T[L]=null,F(D)),void(T[x]=D)}var j=T[E];j!==null&&(T[y]=null,T[E]=null,T[L]=null,j(m(void 0,!0))),T[U]=!0}),R.on("readable",h.bind(null,T)),T}}).call(this)}).call(this,o("_process"))},{"./end-of-stream":24,_process:12}],22:[function(o,a){function u(y,_){var v=Object.keys(y);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(y);_&&(S=S.filter(function(C){return Object.getOwnPropertyDescriptor(y,C).enumerable})),v.push.apply(v,S)}return v}function c(y){for(var _,v=1;v<arguments.length;v++)_=arguments[v]==null?{}:arguments[v],v%2?u(Object(_),!0).forEach(function(S){m(y,S,_[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(_)):u(Object(_)).forEach(function(S){Object.defineProperty(y,S,Object.getOwnPropertyDescriptor(_,S))});return y}function m(y,_,v){return _ in y?Object.defineProperty(y,_,{value:v,enumerable:!0,configurable:!0,writable:!0}):y[_]=v,y}function w(y,_){if(!(y instanceof _))throw new TypeError("Cannot call a class as a function")}function h(y,_){for(var v,S=0;S<_.length;S++)v=_[S],v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(y,v.key,v)}function p(y,_,v){return _&&h(y.prototype,_),v&&h(y,v),y}function g(y,_,v){E.prototype.copy.call(y,_,v)}var f=o("buffer"),E=f.Buffer,L=o("util"),x=L.inspect,U=x&&x.custom||"inspect";a.exports=function(){function y(){w(this,y),this.head=null,this.tail=null,this.length=0}return p(y,[{key:"push",value:function(_){var v={data:_,next:null};0<this.length?this.tail.next=v:this.head=v,this.tail=v,++this.length}},{key:"unshift",value:function(_){var v={data:_,next:this.head};this.length===0&&(this.tail=v),this.head=v,++this.length}},{key:"shift",value:function(){if(this.length!==0){var _=this.head.data;return this.head=this.length===1?this.tail=null:this.head.next,--this.length,_}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(_){if(this.length===0)return"";for(var v=this.head,S=""+v.data;v=v.next;)S+=_+v.data;return S}},{key:"concat",value:function(_){if(this.length===0)return E.alloc(0);for(var v=E.allocUnsafe(_>>>0),S=this.head,C=0;S;)g(S.data,v,C),C+=S.data.length,S=S.next;return v}},{key:"consume",value:function(_,v){var S;return _<this.head.data.length?(S=this.head.data.slice(0,_),this.head.data=this.head.data.slice(_)):_===this.head.data.length?S=this.shift():S=v?this._getString(_):this._getBuffer(_),S}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(_){var v=this.head,S=1,C=v.data;for(_-=C.length;v=v.next;){var R=v.data,M=_>R.length?R.length:_;if(C+=M===R.length?R:R.slice(0,_),_-=M,_===0){M===R.length?(++S,this.head=v.next?v.next:this.tail=null):(this.head=v,v.data=R.slice(M));break}++S}return this.length-=S,C}},{key:"_getBuffer",value:function(_){var v=E.allocUnsafe(_),S=this.head,C=1;for(S.data.copy(v),_-=S.data.length;S=S.next;){var R=S.data,M=_>R.length?R.length:_;if(R.copy(v,v.length-_,0,M),_-=M,_===0){M===R.length?(++C,this.head=S.next?S.next:this.tail=null):(this.head=S,S.data=R.slice(M));break}++C}return this.length-=C,v}},{key:U,value:function(_,v){return x(this,c({},v,{depth:0,customInspect:!1}))}}]),y}()},{buffer:3,util:2}],23:[function(o,a){(function(u){(function(){function c(h,p){w(h,p),m(h)}function m(h){h._writableState&&!h._writableState.emitClose||h._readableState&&!h._readableState.emitClose||h.emit("close")}function w(h,p){h.emit("error",p)}a.exports={destroy:function(h,p){var g=this,f=this._readableState&&this._readableState.destroyed,E=this._writableState&&this._writableState.destroyed;return f||E?(p?p(h):h&&(this._writableState?!this._writableState.errorEmitted&&(this._writableState.errorEmitted=!0,u.nextTick(w,this,h)):u.nextTick(w,this,h)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(h||null,function(L){!p&&L?g._writableState?g._writableState.errorEmitted?u.nextTick(m,g):(g._writableState.errorEmitted=!0,u.nextTick(c,g,L)):u.nextTick(c,g,L):p?(u.nextTick(m,g),p(L)):u.nextTick(m,g)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(h,p){var g=h._readableState,f=h._writableState;g&&g.autoDestroy||f&&f.autoDestroy?h.destroy(p):h.emit("error",p)}}}).call(this)}).call(this,o("_process"))},{_process:12}],24:[function(o,a){function u(p){var g=!1;return function(){if(!g){g=!0;for(var f=arguments.length,E=Array(f),L=0;L<f;L++)E[L]=arguments[L];p.apply(this,E)}}}function c(){}function m(p){return p.setHeader&&typeof p.abort=="function"}function w(p,g,f){if(typeof g=="function")return w(p,null,g);g||(g={}),f=u(f||c);var E=g.readable||g.readable!==!1&&p.readable,L=g.writable||g.writable!==!1&&p.writable,x=function(){p.writable||y()},U=p._writableState&&p._writableState.finished,y=function(){L=!1,U=!0,E||f.call(p)},_=p._readableState&&p._readableState.endEmitted,v=function(){E=!1,_=!0,L||f.call(p)},S=function(M){f.call(p,M)},C=function(){var M;return E&&!_?(p._readableState&&p._readableState.ended||(M=new h),f.call(p,M)):L&&!U?(p._writableState&&p._writableState.ended||(M=new h),f.call(p,M)):void 0},R=function(){p.req.on("finish",y)};return m(p)?(p.on("complete",y),p.on("abort",C),p.req?R():p.on("request",R)):L&&!p._writableState&&(p.on("end",x),p.on("close",x)),p.on("end",v),p.on("finish",y),g.error!==!1&&p.on("error",S),p.on("close",C),function(){p.removeListener("complete",y),p.removeListener("abort",C),p.removeListener("request",R),p.req&&p.req.removeListener("finish",y),p.removeListener("end",x),p.removeListener("close",x),p.removeListener("finish",y),p.removeListener("end",v),p.removeListener("error",S),p.removeListener("close",C)}}var h=o("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;a.exports=w},{"../../../errors":15}],25:[function(o,a){a.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],26:[function(o,a){function u(U){var y=!1;return function(){y||(y=!0,U.apply(void 0,arguments))}}function c(U){if(U)throw U}function m(U){return U.setHeader&&typeof U.abort=="function"}function w(U,y,_,v){v=u(v);var S=!1;U.on("close",function(){S=!0}),f===void 0&&(f=o("./end-of-stream")),f(U,{readable:y,writable:_},function(R){return R?v(R):(S=!0,void v())});var C=!1;return function(R){if(!S)return C?void 0:(C=!0,m(U)?U.abort():typeof U.destroy=="function"?U.destroy():void v(R||new x("pipe")))}}function h(U){U()}function p(U,y){return U.pipe(y)}function g(U){return U.length&&typeof U[U.length-1]=="function"?U.pop():c}var f,E=o("../../../errors").codes,L=E.ERR_MISSING_ARGS,x=E.ERR_STREAM_DESTROYED;a.exports=function(){for(var U=arguments.length,y=Array(U),_=0;_<U;_++)y[_]=arguments[_];var v=g(y);if(Array.isArray(y[0])&&(y=y[0]),2>y.length)throw new L("streams");var S,C=y.map(function(R,M){var T=M<y.length-1;return w(R,T,0<M,function(D){S||(S=D),D&&C.forEach(h),T||(C.forEach(h),v(S))})});return y.reduce(p)}},{"../../../errors":15,"./end-of-stream":24}],27:[function(o,a){function u(m,w,h){return m.highWaterMark==null?w?m[h]:null:m.highWaterMark}var c=o("../../../errors").codes.ERR_INVALID_OPT_VALUE;a.exports={getHighWaterMark:function(m,w,h,p){var g=u(w,p,h);if(g!=null){if(!(isFinite(g)&&n(g)===g)||0>g){var f=p?h:"highWaterMark";throw new c(f,g)}return n(g)}return m.objectMode?16:16384}}},{"../../../errors":15}],28:[function(o,a){a.exports=o("events").EventEmitter},{events:7}],29:[function(o,a,u){u=a.exports=o("./lib/_stream_readable.js"),u.Stream=u,u.Readable=u,u.Writable=o("./lib/_stream_writable.js"),u.Duplex=o("./lib/_stream_duplex.js"),u.Transform=o("./lib/_stream_transform.js"),u.PassThrough=o("./lib/_stream_passthrough.js"),u.finished=o("./lib/internal/streams/end-of-stream.js"),u.pipeline=o("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,"./lib/_stream_writable.js":20,"./lib/internal/streams/end-of-stream.js":24,"./lib/internal/streams/pipeline.js":26}],30:[function(o,a,u){function c(p,g){for(var f in p)g[f]=p[f]}function m(p,g,f){return h(p,g,f)}/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var w=o("buffer"),h=w.Buffer;h.from&&h.alloc&&h.allocUnsafe&&h.allocUnsafeSlow?a.exports=w:(c(w,u),u.Buffer=m),m.prototype=Object.create(h.prototype),c(h,m),m.from=function(p,g,f){if(typeof p=="number")throw new TypeError("Argument must not be a number");return h(p,g,f)},m.alloc=function(p,g,f){if(typeof p!="number")throw new TypeError("Argument must be a number");var E=h(p);return g===void 0?E.fill(0):typeof f=="string"?E.fill(g,f):E.fill(g),E},m.allocUnsafe=function(p){if(typeof p!="number")throw new TypeError("Argument must be a number");return h(p)},m.allocUnsafeSlow=function(p){if(typeof p!="number")throw new TypeError("Argument must be a number");return w.SlowBuffer(p)}},{buffer:3}],31:[function(o,a,u){function c(C){if(!C)return"utf8";for(var R;;)switch(C){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return C;default:if(R)return;C=(""+C).toLowerCase(),R=!0}}function m(C){var R=c(C);if(typeof R!="string"&&(v.isEncoding===S||!S(C)))throw new Error("Unknown encoding: "+C);return R||C}function w(C){this.encoding=m(C);var R;switch(this.encoding){case"utf16le":this.text=E,this.end=L,R=4;break;case"utf8":this.fillLast=f,R=4;break;case"base64":this.text=x,this.end=U,R=3;break;default:return this.write=y,void(this.end=_)}this.lastNeed=0,this.lastTotal=0,this.lastChar=v.allocUnsafe(R)}function h(C){return 127>=C?0:C>>5==6?2:C>>4==14?3:C>>3==30?4:C>>6==2?-1:-2}function p(C,R,M){var T=R.length-1;if(T<M)return 0;var D=h(R[T]);return 0<=D?(0<D&&(C.lastNeed=D-1),D):--T<M||D===-2?0:(D=h(R[T]),0<=D?(0<D&&(C.lastNeed=D-2),D):--T<M||D===-2?0:(D=h(R[T]),0<=D?(0<D&&(D===2?D=0:C.lastNeed=D-3),D):0))}function g(C,R){if((192&R[0])!=128)return C.lastNeed=0,"\uFFFD";if(1<C.lastNeed&&1<R.length){if((192&R[1])!=128)return C.lastNeed=1,"\uFFFD";if(2<C.lastNeed&&2<R.length&&(192&R[2])!=128)return C.lastNeed=2,"\uFFFD"}}function f(C){var R=this.lastTotal-this.lastNeed,M=g(this,C);return M===void 0?this.lastNeed<=C.length?(C.copy(this.lastChar,R,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(C.copy(this.lastChar,R,0,C.length),void(this.lastNeed-=C.length)):M}function E(C,R){if((C.length-R)%2==0){var M=C.toString("utf16le",R);if(M){var T=M.charCodeAt(M.length-1);if(55296<=T&&56319>=T)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=C[C.length-2],this.lastChar[1]=C[C.length-1],M.slice(0,-1)}return M}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=C[C.length-1],C.toString("utf16le",R,C.length-1)}function L(C){var R=C&&C.length?this.write(C):"";if(this.lastNeed){var M=this.lastTotal-this.lastNeed;return R+this.lastChar.toString("utf16le",0,M)}return R}function x(C,R){var M=(C.length-R)%3;return M==0?C.toString("base64",R):(this.lastNeed=3-M,this.lastTotal=3,M==1?this.lastChar[0]=C[C.length-1]:(this.lastChar[0]=C[C.length-2],this.lastChar[1]=C[C.length-1]),C.toString("base64",R,C.length-M))}function U(C){var R=C&&C.length?this.write(C):"";return this.lastNeed?R+this.lastChar.toString("base64",0,3-this.lastNeed):R}function y(C){return C.toString(this.encoding)}function _(C){return C&&C.length?this.write(C):""}var v=o("safe-buffer").Buffer,S=v.isEncoding||function(C){switch(C=""+C,C&&C.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};u.StringDecoder=w,w.prototype.write=function(C){if(C.length===0)return"";var R,M;if(this.lastNeed){if(R=this.fillLast(C),R===void 0)return"";M=this.lastNeed,this.lastNeed=0}else M=0;return M<C.length?R?R+this.text(C,M):this.text(C,M):R||""},w.prototype.end=function(C){var R=C&&C.length?this.write(C):"";return this.lastNeed?R+"\uFFFD":R},w.prototype.text=function(C,R){var M=p(this,C,R);if(!this.lastNeed)return C.toString("utf8",R);this.lastTotal=M;var T=C.length-(M-this.lastNeed);return C.copy(this.lastChar,0,T),C.toString("utf8",R,T)},w.prototype.fillLast=function(C){return this.lastNeed<=C.length?(C.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(C.copy(this.lastChar,this.lastTotal-this.lastNeed,0,C.length),void(this.lastNeed-=C.length))}},{"safe-buffer":30}],32:[function(o,a){(function(u){(function(){function c(m){try{if(!u.localStorage)return!1}catch{return!1}var w=u.localStorage[m];return w!=null&&(w+"").toLowerCase()==="true"}a.exports=function(m,w){function h(){if(!p){if(c("throwDeprecation"))throw new Error(w);c("traceDeprecation")?console.trace(w):console.warn(w),p=!0}return m.apply(this,arguments)}if(c("noDeprecation"))return m;var p=!1;return h}}).call(this)}).call(this,typeof Rt=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:Rt)},{}],"/":[function(o,a){function u(U){return U.replace(/a=ice-options:trickle\s\n/g,"")}function c(U){console.warn(U)}/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const m=o("debug")("simple-peer"),w=o("get-browser-rtc"),h=o("randombytes"),p=o("readable-stream"),g=o("queue-microtask"),f=o("err-code"),{Buffer:E}=o("buffer"),L=65536;class x extends p.Duplex{constructor(y){if(y=Object.assign({allowHalfOpen:!1},y),super(y),this._id=h(4).toString("hex").slice(0,7),this._debug("new peer %o",y),this.channelName=y.initiator?y.channelName||h(20).toString("hex"):null,this.initiator=y.initiator||!1,this.channelConfig=y.channelConfig||x.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},x.config,y.config),this.offerOptions=y.offerOptions||{},this.answerOptions=y.answerOptions||{},this.sdpTransform=y.sdpTransform||(_=>_),this.streams=y.streams||(y.stream?[y.stream]:[]),this.trickle=y.trickle===void 0||y.trickle,this.allowHalfTrickle=y.allowHalfTrickle!==void 0&&y.allowHalfTrickle,this.iceCompleteTimeout=y.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=y.wrtc&&typeof y.wrtc=="object"?y.wrtc:w(),!this._wrtc)throw f(typeof window=="undefined"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(_){return void this.destroy(f(_,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=_=>{this._onIceCandidate(_)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(_=>{this.destroy(f(_,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=_=>{this._setupData(_)},this.streams&&this.streams.forEach(_=>{this.addStream(_)}),this._pc.ontrack=_=>{this._onTrack(_)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(y){if(!this.destroying){if(this.destroyed)throw f(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof y=="string")try{y=JSON.parse(y)}catch{y={}}this._debug("signal()"),y.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),y.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(y.transceiverRequest.kind,y.transceiverRequest.init)),y.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(y.candidate):this._pendingCandidates.push(y.candidate)),y.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(y)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(_=>{this._addIceCandidate(_)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(_=>{this.destroy(f(_,"ERR_SET_REMOTE_DESCRIPTION"))}),y.sdp||y.candidate||y.renegotiate||y.transceiverRequest||this.destroy(f(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(y){const _=new this._wrtc.RTCIceCandidate(y);this._pc.addIceCandidate(_).catch(v=>{!_.address||_.address.endsWith(".local")?c("Ignoring unsupported ICE candidate."):this.destroy(f(v,"ERR_ADD_ICE_CANDIDATE"))})}send(y){if(!this.destroying){if(this.destroyed)throw f(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(y)}}addTransceiver(y,_){if(!this.destroying){if(this.destroyed)throw f(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(y,_),this._needsNegotiation()}catch(v){this.destroy(f(v,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:y,init:_}})}}addStream(y){if(!this.destroying){if(this.destroyed)throw f(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),y.getTracks().forEach(_=>{this.addTrack(_,y)})}}addTrack(y,_){if(this.destroying)return;if(this.destroyed)throw f(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const v=this._senderMap.get(y)||new Map;let S=v.get(_);if(!S)S=this._pc.addTrack(y,_),v.set(_,S),this._senderMap.set(y,v),this._needsNegotiation();else throw S.removed?f(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):f(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(y,_,v){if(this.destroying)return;if(this.destroyed)throw f(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const S=this._senderMap.get(y),C=S?S.get(v):null;if(!C)throw f(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");_&&this._senderMap.set(_,S),C.replaceTrack==null?this.destroy(f(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK")):C.replaceTrack(_)}removeTrack(y,_){if(this.destroying)return;if(this.destroyed)throw f(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const v=this._senderMap.get(y),S=v?v.get(_):null;if(!S)throw f(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{S.removed=!0,this._pc.removeTrack(S)}catch(C){C.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(S):this.destroy(f(C,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(y){if(!this.destroying){if(this.destroyed)throw f(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),y.getTracks().forEach(_=>{this.removeTrack(_,y)})}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,g(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw f(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(y){this._destroy(y,()=>{})}_destroy(y,_){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",y&&(y.message||y)),g(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",y&&(y.message||y)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,y&&this.emit("error",y),this.emit("close"),_()}))}_setupData(y){if(!y.channel)return this.destroy(f(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=y.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=L),this.channelName=this._channel.label,this._channel.onmessage=v=>{this._onChannelMessage(v)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=v=>{const S=v.error instanceof Error?v.error:new Error(`Datachannel error: ${v.message} ${v.filename}:${v.lineno}:${v.colno}`);this.destroy(f(S,"ERR_DATA_CHANNEL"))};let _=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(_&&this._onChannelClose(),_=!0):_=!1},5e3)}_read(){}_write(y,_,v){if(this.destroyed)return v(f(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(y)}catch(S){return this.destroy(f(S,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>L?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=v):v(null)}else this._debug("write before connect"),this._chunk=y,this._cb=v}_onFinish(){if(!this.destroyed){const y=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?y():this.once("connect",y)}}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(y=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(y.sdp=u(y.sdp)),y.sdp=this.sdpTransform(y.sdp);const _=()=>{if(!this.destroyed){const v=this._pc.localDescription||y;this._debug("signal"),this.emit("signal",{type:v.type,sdp:v.sdp})}};this._pc.setLocalDescription(y).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?_():this.once("_iceComplete",_))}).catch(v=>{this.destroy(f(v,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(y=>{this.destroy(f(y,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(y=>{y.mid||!y.sender.track||y.requested||(y.requested=!0,this.addTransceiver(y.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(y=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(y.sdp=u(y.sdp)),y.sdp=this.sdpTransform(y.sdp);const _=()=>{if(!this.destroyed){const v=this._pc.localDescription||y;this._debug("signal"),this.emit("signal",{type:v.type,sdp:v.sdp}),this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(y).then(()=>{this.destroyed||(this.trickle||this._iceComplete?_():this.once("_iceComplete",_))}).catch(v=>{this.destroy(f(v,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(y=>{this.destroy(f(y,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(f(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const y=this._pc.iceConnectionState,_=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",y,_),this.emit("iceStateChange",y,_),(y==="connected"||y==="completed")&&(this._pcReady=!0,this._maybeReady()),y==="failed"&&this.destroy(f(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),y==="closed"&&this.destroy(f(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(y){const _=v=>(Object.prototype.toString.call(v.values)==="[object Array]"&&v.values.forEach(S=>{Object.assign(v,S)}),v);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(v=>{const S=[];v.forEach(C=>{S.push(_(C))}),y(null,S)},v=>y(v)):0<this._pc.getStats.length?this._pc.getStats(v=>{if(this.destroyed)return;const S=[];v.result().forEach(C=>{const R={};C.names().forEach(M=>{R[M]=C.stat(M)}),R.id=C.id,R.type=C.type,R.timestamp=C.timestamp,S.push(_(R))}),y(null,S)},v=>y(v)):y(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const y=()=>{this.destroyed||this.getStats((_,v)=>{if(this.destroyed)return;_&&(v=[]);const S={},C={},R={};let M=!1;v.forEach(D=>{(D.type==="remotecandidate"||D.type==="remote-candidate")&&(S[D.id]=D),(D.type==="localcandidate"||D.type==="local-candidate")&&(C[D.id]=D),(D.type==="candidatepair"||D.type==="candidate-pair")&&(R[D.id]=D)});const T=D=>{M=!0;let F=C[D.localCandidateId];F&&(F.ip||F.address)?(this.localAddress=F.ip||F.address,this.localPort=+F.port):F&&F.ipAddress?(this.localAddress=F.ipAddress,this.localPort=+F.portNumber):typeof D.googLocalAddress=="string"&&(F=D.googLocalAddress.split(":"),this.localAddress=F[0],this.localPort=+F[1]),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let j=S[D.remoteCandidateId];j&&(j.ip||j.address)?(this.remoteAddress=j.ip||j.address,this.remotePort=+j.port):j&&j.ipAddress?(this.remoteAddress=j.ipAddress,this.remotePort=+j.portNumber):typeof D.googRemoteAddress=="string"&&(j=D.googRemoteAddress.split(":"),this.remoteAddress=j[0],this.remotePort=+j[1]),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(v.forEach(D=>{D.type==="transport"&&D.selectedCandidatePairId&&T(R[D.selectedCandidatePairId]),(D.type==="googCandidatePair"&&D.googActiveConnection==="true"||(D.type==="candidatepair"||D.type==="candidate-pair")&&D.selected)&&T(D)}),!M&&(!Object.keys(R).length||Object.keys(C).length))return void setTimeout(y,100);if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(F){return this.destroy(f(F,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const D=this._cb;this._cb=null,D(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};y()}_onInterval(){this._cb&&this._channel&&!(this._channel.bufferedAmount>L)&&this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(y=>{this._pc.removeTrack(y),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(y){this.destroyed||(y.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:y.candidate.candidate,sdpMLineIndex:y.candidate.sdpMLineIndex,sdpMid:y.candidate.sdpMid}}):!y.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),y.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(y){if(this.destroyed)return;let _=y.data;_ instanceof ArrayBuffer&&(_=E.from(_)),this.push(_)}_onChannelBufferedAmountLow(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const y=this._cb;this._cb=null,y(null)}}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(y){this.destroyed||y.streams.forEach(_=>{this._debug("on track"),this.emit("track",y.track,_),this._remoteTracks.push({track:y.track,stream:_}),this._remoteStreams.some(v=>v.id===_.id)||(this._remoteStreams.push(_),g(()=>{this._debug("on stream"),this.emit("stream",_)}))})}_debug(){const y=[].slice.call(arguments);y[0]="["+this._id+"] "+y[0],m.apply(null,y)}}x.WEBRTC_SUPPORT=!!w(),x.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},x.channelConfig={},a.exports=x},{buffer:3,debug:4,"err-code":6,"get-browser-rtc":8,"queue-microtask":13,randombytes:14,"readable-stream":29}]},{},[])("/")})})(Ai);var mc=Ai.exports;const jr=0,Pr=1,Di=2,Ii=(e,t)=>{V(e,jr);const n=Dl(t);st(e,n)},xi=(e,t,n)=>{V(e,Pr),st(e,kl(t,n))},yc=(e,t,n)=>xi(t,n,ct(e)),Li=(e,t,n)=>{try{Cl(t,ct(e),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},wc=(e,t)=>{V(e,Di),st(e,t)},bc=Li,_c=(e,t,n,r)=>{const i=$(e);switch(i){case jr:yc(e,t,n);break;case Pr:Li(e,n,r);break;case Di:bc(e,n,r);break;default:throw new Error("Unknown message type")}return i},Kn=3e4;class vc extends Rn{constructor(t){super(),this.doc=t,this.clientID=t.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const n=Ht();this.getLocalState()!==null&&Kn/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const r=[];this.meta.forEach((i,o)=>{o!==this.clientID&&Kn<=n-i.lastUpdated&&this.states.has(o)&&r.push(o)}),r.length>0&&or(this,r,"timeout")},Ot(Kn/10)),t.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){const n=this.clientID,r=this.meta.get(n),i=r===void 0?0:r.clock+1,o=this.states.get(n);t===null?this.states.delete(n):this.states.set(n,t),this.meta.set(n,{clock:i,lastUpdated:Ht()});const a=[],u=[],c=[],m=[];t===null?m.push(n):o==null?t!=null&&a.push(n):(u.push(n),Fe(o,t)||c.push(n)),(a.length>0||c.length>0||m.length>0)&&this.emit("change",[{added:a,updated:c,removed:m},"local"]),this.emit("update",[{added:a,updated:u,removed:m},"local"])}setLocalStateField(t,n){const r=this.getLocalState();r!==null&&this.setLocalState({...r,[t]:n})}getStates(){return this.states}}const or=(e,t,n)=>{const r=[];for(let i=0;i<t.length;i++){const o=t[i];if(e.states.has(o)){if(e.states.delete(o),o===e.clientID){const a=e.meta.get(o);e.meta.set(o,{clock:a.clock+1,lastUpdated:Ht()})}r.push(o)}}r.length>0&&(e.emit("change",[{added:[],updated:[],removed:r},n]),e.emit("update",[{added:[],updated:[],removed:r},n]))},kn=(e,t,n=e.states)=>{const r=t.length,i=ut();V(i,r);for(let o=0;o<r;o++){const a=t[o],u=n.get(a)||null,c=e.meta.get(a).clock;V(i,a),V(i,c),xt(i,JSON.stringify(u))}return nt(i)},Cc=(e,t,n)=>{const r=Ft(t),i=Ht(),o=[],a=[],u=[],c=[],m=$(r);for(let w=0;w<m;w++){const h=$(r);let p=$(r);const g=JSON.parse(qt(r)),f=e.meta.get(h),E=e.states.get(h),L=f===void 0?0:f.clock;(L<p||L===p&&g===null&&e.states.has(h))&&(g===null?h===e.clientID&&e.getLocalState()!=null?p++:e.states.delete(h):e.states.set(h,g),e.meta.set(h,{clock:p,lastUpdated:i}),f===void 0&&g!==null?o.push(h):f!==void 0&&g===null?c.push(h):g!==null&&(Fe(g,E)||u.push(h),a.push(h)))}(o.length>0||u.length>0||c.length>0)&&e.emit("change",[{added:o,updated:u,removed:c},n]),(o.length>0||a.length>0||c.length>0)&&e.emit("update",[{added:o,updated:a,removed:c},n])},Ec=(e,t)=>{const n=Xn(e).buffer,r=Xn(t).buffer;return crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveKey"]).then(i=>crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},i,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]))},Oi=(e,t)=>{if(!t)return gr(e);const n=crypto.getRandomValues(new Uint8Array(12));return crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,e).then(r=>{const i=ut();return xt(i,"AES-GCM"),st(i,n),st(i,new Uint8Array(r)),nt(i)})},Sc=(e,t)=>{const n=ut();return Se(n,e),Oi(nt(n),t)},Ni=(e,t)=>{if(!t)return gr(e);const n=Ft(e);qt(n)!=="AES-GCM"&&nl(ne("Unknown encryption algorithm"));const i=ct(n),o=ct(n);return crypto.subtle.decrypt({name:"AES-GCM",iv:i},t,o).then(a=>new Uint8Array(a))},kc=(e,t)=>Ni(e,t).then(n=>Ee(Ft(new Uint8Array(n)))),St=hl("y-webrtc"),Ce=0,Mi=3,Qe=1,qr=4,Tn=new Map,ae=new Map,Ui=e=>{let t=!0;e.webrtcConns.forEach(n=>{n.synced||(t=!1)}),(!t&&e.synced||t&&!e.synced)&&(e.synced=t,e.provider.emit("synced",[{synced:t}]),St("synced ",gt,e.name,te," with all peers"))},Fi=(e,t,n)=>{const r=Ft(t),i=ut(),o=$(r);if(e===void 0)return null;const a=e.awareness,u=e.doc;let c=!1;switch(o){case Ce:{V(i,Ce);const m=_c(r,i,u,e);m===Pr&&!e.synced&&n(),m===jr&&(c=!0);break}case Mi:V(i,Qe),st(i,kn(a,Array.from(a.getStates().keys()))),c=!0;break;case Qe:Cc(a,ct(r),e);break;case qr:{const m=ue(r)===1,w=qt(r);if(w!==e.peerId&&(e.bcConns.has(w)&&!m||!e.bcConns.has(w)&&m)){const h=[],p=[];m?(e.bcConns.add(w),p.push(w)):(e.bcConns.delete(w),h.push(w)),e.provider.emit("peers",[{added:p,removed:h,webrtcPeers:Array.from(e.webrtcConns.keys()),bcPeers:Array.from(e.bcConns)}]),Bi(e)}break}default:return console.error("Unable to compute message"),i}return c?i:null},Tc=(e,t)=>{const n=e.room;return St("received message from ",gt,e.remotePeerId,xn," (",n.name,")",te,Ke),Fi(n,t,()=>{e.synced=!0,St("synced ",gt,n.name,te," with ",gt,e.remotePeerId),Ui(n)})},Jn=(e,t)=>{St("send message to ",gt,e.remotePeerId,te,xn," (",e.room.name,")",Ke);try{e.peer.send(nt(t))}catch{}},Rc=(e,t)=>{St("broadcast message in ",gt,e.name,te),e.webrtcConns.forEach(n=>{try{n.peer.send(t)}catch{}})};class gs{constructor(t,n,r,i){St("establishing connection to ",gt,r),this.room=i,this.remotePeerId=r,this.closed=!1,this.connected=!1,this.synced=!1,this.peer=new mc({initiator:n,...i.provider.peerOpts}),this.peer.on("signal",o=>{Vr(t,i,{to:r,from:i.peerId,type:"signal",signal:o})}),this.peer.on("connect",()=>{St("connected to ",gt,r),this.connected=!0;const a=i.provider.doc,u=i.awareness,c=ut();V(c,Ce),Ii(c,a),Jn(this,c);const m=u.getStates();if(m.size>0){const w=ut();V(w,Qe),st(w,kn(u,Array.from(m.keys()))),Jn(this,w)}}),this.peer.on("close",()=>{this.connected=!1,this.closed=!0,i.webrtcConns.has(this.remotePeerId)&&(i.webrtcConns.delete(this.remotePeerId),i.provider.emit("peers",[{removed:[this.remotePeerId],added:[],webrtcPeers:Array.from(i.webrtcConns.keys()),bcPeers:Array.from(i.bcConns)}])),Ui(i),this.peer.destroy(),St("closed connection to ",gt,r),lr(i)}),this.peer.on("error",o=>{St("Error in connection to ",gt,r,": ",o),lr(i)}),this.peer.on("data",o=>{const a=Tc(this,o);a!==null&&Jn(this,a)})}destroy(){this.peer.destroy()}}const zt=(e,t)=>Oi(t,e.key).then(n=>e.mux(()=>pc(e.name,n))),ms=(e,t)=>{e.bcconnected&&zt(e,t),Rc(e,t)},lr=e=>{Tn.forEach(t=>{t.connected&&(t.send({type:"subscribe",topics:[e.name]}),e.webrtcConns.size<e.provider.maxConns&&Vr(t,e,{type:"announce",from:e.peerId}))})},Bi=e=>{if(e.provider.filterBcConns){const t=ut();V(t,qr),Ve(t,1),xt(t,e.peerId),zt(e,nt(t))}};class Ac{constructor(t,n,r,i){this.peerId=Bs(),this.doc=t,this.awareness=n.awareness,this.provider=n,this.synced=!1,this.name=r,this.key=i,this.webrtcConns=new Map,this.bcConns=new Set,this.mux=gc(),this.bcconnected=!1,this._bcSubscriber=o=>Ni(new Uint8Array(o),i).then(a=>this.mux(()=>{const u=Fi(this,a,()=>{});u&&zt(this,nt(u))})),this._docUpdateHandler=(o,a)=>{const u=ut();V(u,Ce),wc(u,o),ms(this,nt(u))},this._awarenessUpdateHandler=({added:o,updated:a,removed:u},c)=>{const m=o.concat(a).concat(u),w=ut();V(w,Qe),st(w,kn(this.awareness,m)),ms(this,nt(w))},this._beforeUnloadHandler=()=>{or(this.awareness,[t.clientID],"window unload"),ae.forEach(o=>{o.disconnect()})},typeof window!="undefined"?window.addEventListener("beforeunload",this._beforeUnloadHandler):typeof process!="undefined"&&process.on("exit",this._beforeUnloadHandler)}connect(){this.doc.on("update",this._docUpdateHandler),this.awareness.on("update",this._awarenessUpdateHandler),lr(this);const t=this.name;dc(t,this._bcSubscriber),this.bcconnected=!0,Bi(this);const n=ut();V(n,Ce),Ii(n,this.doc),zt(this,nt(n));const r=ut();V(r,Ce),xi(r,this.doc),zt(this,nt(r));const i=ut();V(i,Mi),zt(this,nt(i));const o=ut();V(o,Qe),st(o,kn(this.awareness,[this.doc.clientID])),zt(this,nt(o))}disconnect(){Tn.forEach(n=>{n.connected&&n.send({type:"unsubscribe",topics:[this.name]})}),or(this.awareness,[this.doc.clientID],"disconnect");const t=ut();V(t,qr),Ve(t,0),xt(t,this.peerId),zt(this,nt(t)),fc(this.name,this._bcSubscriber),this.bcconnected=!1,this.doc.off("update",this._docUpdateHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.webrtcConns.forEach(n=>n.destroy())}destroy(){this.disconnect(),typeof window!="undefined"?window.removeEventListener("beforeunload",this._beforeUnloadHandler):typeof process!="undefined"&&process.off("exit",this._beforeUnloadHandler)}}const Dc=(e,t,n,r)=>{if(ae.has(n))throw ne(`A Yjs Doc connected to room "${n}" already exists!`);const i=new Ac(e,t,n,r);return ae.set(n,i),i},Vr=(e,t,n)=>{t.key?Sc(n,t.key).then(r=>{e.send({type:"publish",topic:t.name,data:Ms(r)})}):e.send({type:"publish",topic:t.name,data:n})};class Ic extends ac{constructor(t){super(t),this.providers=new Set,this.on("connect",()=>{St(`connected (${t})`);const n=Array.from(ae.keys());this.send({type:"subscribe",topics:n}),ae.forEach(r=>Vr(this,r,{type:"announce",from:r.peerId}))}),this.on("message",n=>{switch(n.type){case"publish":{const r=n.topic,i=ae.get(r);if(i==null||typeof r!="string")return;const o=a=>{const u=i.webrtcConns,c=i.peerId;if(a==null||a.from===c||a.to!==void 0&&a.to!==c||i.bcConns.has(a.from))return;const m=u.has(a.from)?()=>{}:()=>i.provider.emit("peers",[{removed:[],added:[a.from],webrtcPeers:Array.from(i.webrtcConns.keys()),bcPeers:Array.from(i.bcConns)}]);switch(a.type){case"announce":u.size<i.provider.maxConns&&(bt(u,a.from,()=>new gs(this,!0,a.from,i)),m());break;case"signal":a.to===c&&(bt(u,a.from,()=>new gs(this,!1,a.from,i)).peer.signal(a.signal),m());break}};i.key?typeof n.data=="string"&&kc(Us(n.data),i.key).then(o):o(n.data)}}}),this.on("disconnect",()=>St(`disconnect (${t})`))}}class xc extends Rn{constructor(t,n,{signaling:r=["wss://signaling.yjs.dev","wss://y-webrtc-signaling-eu.herokuapp.com","wss://y-webrtc-signaling-us.herokuapp.com"],password:i=null,awareness:o=new vc(n),maxConns:a=20+Ot(Zo()*15),filterBcConns:u=!0,peerOpts:c={}}={}){super(),this.roomName=t,this.doc=n,this.filterBcConns=u,this.awareness=o,this.shouldConnect=!1,this.signalingUrls=r,this.signalingConns=[],this.maxConns=a,this.peerOpts=c,this.key=i?Ec(i,t):gr(null),this.room=null,this.key.then(m=>{this.room=Dc(n,this,t,m),this.shouldConnect?this.room.connect():this.room.disconnect()}),this.connect(),this.destroy=this.destroy.bind(this),n.on("destroy",this.destroy)}get connected(){return this.room!==null&&this.shouldConnect}connect(){this.shouldConnect=!0,this.signalingUrls.forEach(t=>{const n=bt(Tn,t,()=>new Ic(t));this.signalingConns.push(n),n.providers.add(this)}),this.room&&this.room.connect()}disconnect(){this.shouldConnect=!1,this.signalingConns.forEach(t=>{t.providers.delete(this),t.providers.size===0&&(t.destroy(),Tn.delete(t.url))}),this.room&&this.room.disconnect()}destroy(){this.doc.off("destroy",this.destroy),this.key.then(()=>{this.room.destroy(),ae.delete(this.roomName)}),super.destroy()}}const ji=new De;new xc("remesh-todo-app",ji);const ys=document.getElementById("root");if(ys){const e=Pi(ys),t=Tt.store({externs:[eo,ki.impl({doc:ji})],inspectors:[]});e.render(J(oe.exports.StrictMode,{children:J(Qi,{store:t,children:J(Hi,{basename:"/",children:kt(Wi,{children:[J(Hr,{path:"/",element:J(ps,{})}),J(Hr,{path:"/:filter",element:J(ps,{})})]})})})})),window.root=e}
//# sourceMappingURL=index.0acf976f.js.map
