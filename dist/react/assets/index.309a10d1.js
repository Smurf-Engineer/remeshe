var z=Object.defineProperty,J=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var K=(e,t,o)=>t in e?z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,S=(e,t)=>{for(var o in t||(t={}))Z.call(t,o)&&K(e,o,t[o]);if(b)for(var o of b(t))ee.call(t,o)&&K(e,o,t[o]);return e},A=(e,t)=>J(e,X(t));import{j as p,a as l,r as h,F as te,c as oe}from"./jsx-runtime.a8396eb8.js";import{l as q,t as ne,u as re,N as F,H as se,R as ae,a as Q}from"./localforage.9da87b6f.js";import{R as x,u as y,b as g,t as le,c as de,d as ce,e as me}from"./remesh-logger.7deef13f.js";import{f as ie,m as N}from"./map.8bf9640d.js";import{f as O}from"./filter.6e56622c.js";import{L as ue}from"./list.ccef92b0.js";const M=x.extern({name:"Storage",default:{get:()=>{throw new Error("Not implemented")},set:()=>{throw new Error("Not implemented")},clear:()=>{throw new Error("Not implemented")}}}),pe=M({get:e=>q.getItem(e),set:async(e,t)=>{await q.setItem(e,t)},clear:e=>q.removeItem(e)}),Te=(e,t)=>{var d;const o=e.state({name:`${t.name}.TextState`,default:(d=t.default)!=null?d:""}),n=e.query({name:`${t.name}.TextQuery`,impl:({get:i})=>i(o())}),a=e.command({name:`${t.name}.setText`,impl:({},i)=>o().new(i)}),r=e.command({name:`${t.name}.clearText`,impl:()=>a("")}),s=e.command({name:`${t.name}.reset`,impl:({})=>{var i;return o().new((i=t.default)!=null?i:"")}});return{query:{text:n},command:{setText:a,clearText:r,reset:s}}},he=(e,t)=>({listenTo:o=>({saveData:n=>({readData:a=>t({storageKey:e,TriggerEvent:o,saveData:n,readData:a})}),readData:n=>t({storageKey:e,TriggerEvent:o,saveData:a=>a,readData:n})})}),ge=(e,t)=>{const o=e.getExtern(M),n=e.command$({name:"readStorage",impl:()=>ie(o.get(t.storageKey)).pipe(O(r=>!!r),N(r=>t.readData(r)))}),a=e.command$({name:"writeStorage",impl:({fromEvent:r})=>r(t.TriggerEvent).pipe(ne(s=>o.set(t.storageKey,t.saveData(s))),N(()=>null))});e.ignite(()=>n()),e.ignite(()=>a())},R=(e,t)=>he(t,o=>ge(e,o)),ye="remesh-example/todo-input",P=x.domain({name:"TodoInput",impl:e=>{const t=Te(e,{name:"TodoInput"}),o=e.event({name:"TodoInputChangedEvent"}),n=t.query.text,a=e.command({name:"setTodoInput",impl:({},s)=>[t.command.setText(s),o(s)]}),r=t.command.clearText;return R(e,ye).listenTo(o).readData(s=>a(s)),{query:{todoInput:n},command:{setTodoInput:a,clearTodoInput:r},event:{TodoInputChangedEvent:o}}}}),fe=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,o=e=="x"?t:t&3|8;return o.toString(16)}),xe="remesh-example/todo-list",D=e=>e.id,I=x.domain({name:"TodoList",impl:e=>{const t=ue(e,{name:"TodoList",key:D}),o=t.query.itemList,n=t.query.item,a=t.query.keyList,r=e.event({name:"TodoListChangedEvent"}),s=e.command({name:"setTodoList",impl:(m,c)=>[t.command.setList(c),r(c)]}),d=e.event({name:"FailedToAddTodoEvent"}),i=e.event({name:"TodoItemAddedEvent"}),T=e.command({name:"TodoList.addTodo",impl:(m,c)=>{if(c==="")return d({reason:"Title cannot be empty"});const u={id:fe(),title:c,completed:!1};return[t.command.addItem(u),i(u)]}}),f=e.command({name:"TodoList.updateTodo",impl:(m,c)=>c.title===""?E(c.id):t.command.updateItem(c)}),E=t.command.deleteItem,w=e.query({name:"ActiveTodoListQuery",impl:({get:m})=>m(o()).filter(u=>!u.completed)}),v=e.query({name:"CompletedTodoListQuery",impl:({get:m})=>m(o()).filter(u=>u.completed)}),C=e.query({name:"ActiveTodoCountQuery",impl:({get:m})=>m(w()).length}),$=e.query({name:"CompletedTodoCountQuery",impl:({get:m})=>m(v()).length}),B=e.query({name:"IsAllCompletedQuery",impl:({get:m})=>{const c=m(o());return c.length===0?!1:m($())===c.length}}),G=e.command({name:"toggleTodo",impl:({get:m},c)=>{const u=m(n(c)),L=A(S({},u),{completed:!u.completed});return t.command.updateItem(L)}}),W=e.command({name:"toggleAllTodos",impl:({get:m})=>{const c=m(o());if(c.length===0)return null;const L=m(C())>0,U=c.map(V=>A(S({},V),{completed:L}));return s(U)}}),Y=e.command({name:"clearAllCompletedTodos",impl:({get:m})=>{const c=m(o());if(c.length===0)return null;const u=c.filter(L=>!L.completed);return s(u)}});return R(e,xe).listenTo(r).readData(m=>s(m)),{query:{todoState:n,todoKeyList:a,todoList:o,activeTodoList:w,completedTodoList:v,activeTodoCount:C,completedTodoCount:$,isAllCompleted:B},command:{setTodoList:s,addTodo:T,updateTodo:f,deleteTodo:E,toggleTodo:G,toggleAllTodos:W,clearAllCompletedTodos:Y},event:{FailedToAddTodoEvent:d,TodoListChangedEvent:r,TodoItemAddedEvent:i}}}});function H(e,t){return n=>{const a=Array.isArray(e)?e:[e];for(const r of a)n.key.toLowerCase()===r.toLowerCase()&&(n.preventDefault(),t(n,r))}}const ve=()=>{const e=y(P()),t=y(I()),o=g(e.query.todoInput()),n=r=>{e.command.setTodoInput(r.target.value)},a=H("Enter",()=>{t.command.addTodo(o)});return le(t.event.FailedToAddTodoEvent,r=>{alert(r.reason)}),p("header",{className:"header",children:[l("h1",{children:"todos"}),l("input",{className:"new-todo",placeholder:"What needs to be done?",value:o,onChange:n,onKeyDown:a})]})},Ce=(e,t)=>{const o=e.state({name:`${t.name}.SwitchState`,default:t.default}),n=e.query({name:`${t.name}.SwitchStateQuery`,impl:({get:s})=>s(o())}),a=e.command({name:`${t.name}.switchTo`,impl:({get:s},d)=>o().new(d)}),r=e.command({name:`${t.name}.reset`,impl:({},s)=>o().new(s)});return{query:{switchState:n},command:{switchTo:a,reset:r}}},Le="remesh-example/todo-filter",Ie=e=>{if(e===void 0)return"all";switch(e){case"all":case"active":case"completed":return e;default:return"all"}},j=x.domain({name:"TodoFilter",impl:e=>{const t=Ce(e,{name:"TodoFilter",default:"all"}),o=e.event({name:"TodoFilterChangedEvent"}),n=t.query.switchState,a=e.command({name:"TodoFilter.setFilter",impl:(r,s)=>{const d=Ie(s);return[t.command.switchTo(d),o(d)]}});return R(e,Le).listenTo(o).readData(r=>a(r)),{query:{todoFilter:n},command:{setFilter:a},event:{TodoFilterChangedEvent:o}}}}),Ee=x.domain({name:"TodoApp",impl:e=>{const t=e.getDomain(P()),o=e.getDomain(I()),n=e.getDomain(j()),a=e.query({name:"FilteredTodoList",impl:({get:s})=>{const d=s(n.query.todoFilter());if(d==="all")return s(o.query.todoList()).map(D);if(d==="active")return s(o.query.activeTodoList()).map(D);if(d==="completed")return s(o.query.completedTodoList()).map(D);throw new Error(`Unknown filter: ${d}`)}}),r=e.command$({name:"clearTodoInputWhenSubmit",impl:({fromEvent:s,get:d})=>s(o.event.TodoItemAddedEvent).pipe(O(i=>d(t.query.todoInput())===i.title),N(()=>t.command.clearTodoInput()))});return e.ignite(()=>r()),{query:{FilteredTodoKeyListQuery:a},command:{},event:{}}}});function we(e){const[t,o]=h.exports.useState(e),n=h.exports.useCallback(a=>{o(a.target.value)},[]);return[t,n,o]}function Se(e){const t=y(I()),o=g(t.query.todoState(e.id)),[n,a]=h.exports.useState(!1),[r,s]=we(o.title),d=()=>{t.command.updateTodo(A(S({},o),{title:r})),a(!1)},i=H(["Enter","Escape"],()=>{d()}),T=()=>{a(!0)},f=()=>{t.command.toggleTodo(o.id)},E=()=>{t.command.deleteTodo(o.id)},w=()=>{d()},v=h.exports.useRef(null);return h.exports.useEffect(()=>{var C;n&&((C=v.current)==null||C.focus())},[n]),p("li",{className:`${n&&"editing"} ${o.completed&&"completed"}`,children:[p("div",{className:"view",children:[l("input",{type:"checkbox",className:"toggle",checked:o.completed,onChange:f}),l("label",{onDoubleClick:T,children:o.title}),l("button",{className:"destroy",onClick:E})]}),n&&l("input",{ref:v,className:"edit",value:r,onChange:s,onKeyDown:i,onBlur:w})]})}const Ae=()=>{const e=y(Ee()),t=g(e.query.FilteredTodoKeyListQuery());return console.log("render list"),p("section",{className:"main",children:[l(De,{}),l("ul",{className:"todo-list",children:t.map(o=>l(Se,{id:o},o))})]})},De=()=>{const e=y(I()),t=g(e.query.isAllCompleted());return p(te,{children:[l("input",{id:"toggle-all",type:"checkbox",className:"toggle-all",checked:t,onChange:()=>{e.command.toggleAllTodos()}}),l("label",{htmlFor:"toggle-all"})]})},qe=()=>{const e=y(I()),t=y(j()),o=g(t.query.todoFilter()),n=g(e.query.activeTodoCount()),r=g(e.query.completedTodoCount())>0,s=()=>{e.command.clearAllCompletedTodos()},d=T=>T.isActive?"selected":"",i=re();return h.exports.useEffect(()=>{var f;const T=(f=i.filter)!=null?f:"all";T!==o&&t.command.setFilter(T)},[i,o]),p("footer",{className:"footer",children:[p("span",{className:"todo-count",children:[l("strong",{children:n})," item",n!==1&&"s"," left"]}),p("ul",{className:"filters",children:[l("li",{children:l(F,{to:"/",className:d,children:"All"})}),l("li",{children:l(F,{to:"/active",className:d,children:"Active"})}),l("li",{children:l(F,{to:"/completed",className:d,children:"Completed"})})]}),r&&l("button",{className:"clear-completed",onClick:s,children:"Clear completed"})]})},_=()=>p("div",{className:"todoapp",children:[l(ve,{}),l(Ae,{}),l(qe,{})]}),k=document.getElementById("root");if(k){const e=oe(k),t=x.store({externs:[pe],inspectors:[de(),ce()]});e.render(l(h.exports.StrictMode,{children:l(me,{store:t,children:l(se,{basename:"/",children:p(ae,{children:[l(Q,{path:"/",element:l(_,{})}),l(Q,{path:"/:filter",element:l(_,{})})]})})})}))}
//# sourceMappingURL=index.309a10d1.js.map
