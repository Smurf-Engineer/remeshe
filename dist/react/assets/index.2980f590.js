var X=Object.defineProperty,Y=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var $=(e,o,t)=>o in e?X(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,u=(e,o)=>{for(var t in o||(o={}))ee.call(o,t)&&$(e,t,o[t]);if(D)for(var t of D(o))oe.call(o,t)&&$(e,t,o[t]);return e},w=(e,o)=>Y(e,Z(o));import{r as h,j as T,a as s,c as te}from"./jsx-runtime.a8396eb8.js";import{t as I,u as ne,N as S,l as N,H as de,R as se,a as B}from"./localforage.042ccd1b.js";import{R as k,u as K,b,t as ae,c as me,d as le,e as re}from"./remesh-logger.82eef2ea.js";import{f as ce,m as F}from"./map.4b85a765.js";import{m as ie}from"./merge.2c1510c0.js";import"./mergeAll.4b1c5b5d.js";const pe=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var o=Math.random()*16|0,t=e=="x"?o:o&3|8;return t.toString(16)}),U=k.extern({name:"TodoRepoExtern",default:{async getTodoList(){throw new Error("Not implemented")},async addTodo(){throw new Error("Not implemented")},async removeTodoByIds(){throw new Error("Not implemented")},async updateTodo(){throw new Error("Not implemented")},async toggleCompletedByIds(){throw new Error("Not implemented")}}}),j=k.domain({name:"TodoDomain",impl:e=>{const o=e.getExtern(U),t=e.state({name:"TodoListState",default:[]}),l=e.query({name:"TodoListQuery",impl({get:d},n){const c=d(t());return n==="active"?c.filter(a=>!a.completed):n==="completed"?c.filter(a=>a.completed):c}}),p=e.query({name:"HasCompletedQuery",impl({get:d}){return d(l("completed")).length>0}}),C=e.query({name:"ActiveTodoCountQuery",impl({get:d}){return d(l("active")).length}}),x=e.query({name:"AllCompletedQuery",impl({get:d}){return d(C())===0&&d(l()).length>0}}),f=e.event({name:"TodoAddedEvent"}),L=e.command({name:"SetTodoListCommand",impl(d,n){return t().new(n)}}),v=e.event({name:"AddTodoFailedEvent"}),R=e.command({name:"AddTodoCommand",impl({get:d},n){if(n.trim()==="")return[v("Cannot be empty, please enter the TODO name")];const c=d(t()),a={id:pe(),name:n,completed:!1};return[t().new([a,...c]),f(a)]}}),g=e.event({name:"RemoveTodoEvent"}),i=e.command({name:"RemoveTodoCommand",impl({get:d},n){const a=d(t()).filter(m=>m.id!==n);return[t().new(a),g([n])]}}),q=e.event({name:"TodoUpdatedEvent"}),V=e.command({name:"UpdateTodoCommand",impl({get:d},n){const c=d(t());if(n.name&&n.name.trim()==="")return i(n.id);const a=c.map(r=>r.id===n.id?w(u(u({},r),n),{id:r.id}):r),m=a.find(r=>r.id===n.id);return m?[t().new(a),q(m)]:null}}),Q=e.event({name:"TodoCompletedChangedEvent"}),W=e.command({name:"ToggleTodoCompletedCommand",impl({get:d},n){const a=d(t()).map(y=>y.id===n?w(u({},y),{completed:!y.completed}):y),m=a.find(y=>y.id===n);if(!m)return null;const r={ids:[n],completed:m==null?void 0:m.completed};return[t().new(a),Q(r)]}}),_=e.command({name:"ToggleAllTodoCompletedCommand",impl({get:d},n){const c=d(t());if(c.length===0)return null;const a=c.map(m=>w(u({},m),{completed:n}));return[t().new(a),Q({ids:a.map(m=>m.id),completed:n})]}}),z=e.command({name:"ClearCompletedCommand",impl({get:d}){const n=d(t()),c=n.filter(m=>!m.completed),a=n.filter(m=>m.completed).map(m=>m.id);return[t().new(c),g(a)]}}),G=e.command$({name:"FromRepoToStateCommand",impl(){return ce(o.getTodoList()).pipe(F(d=>L(d)))}}),J=e.command$({name:"FromStateToRepoCommand",impl:({fromEvent:d})=>{const n=d(f).pipe(I(r=>o.addTodo(r))),c=d(g).pipe(I(r=>o.removeTodoByIds(r))),a=d(q).pipe(I(r=>o.updateTodo(r))),m=d(Q).pipe(I(r=>o.toggleCompletedByIds(r.ids,r.completed)));return ie(n,c,a,m).pipe(F(()=>null))}});return e.ignite(()=>G()),e.ignite(()=>J()),{query:{TodoListQuery:l,ActiveTodoCountQuery:C,HasCompletedQuery:p,AllCompletedQuery:x},command:{AddTodoCommand:R,RemoveTodoCommand:i,ToggleTodoCompletedCommand:W,ToggleAllTodoCompletedCommand:_,UpdateTodoCommand:V,ClearCompletedCommand:z},event:{AddTodoFailedEvent:v}}}});function M(e){const[o,t]=h.exports.useState(e),l=h.exports.useCallback(p=>{t(p.target.value)},[]);return[o,l,t]}function O(e,o){const t=h.exports.useRef(o),l=h.exports.useCallback(p=>{p.key.toLocaleLowerCase()===e.toLocaleLowerCase()&&(p.preventDefault(),t.current(p))},[e]);return h.exports.useEffect(()=>{t.current=o}),l}function ue({todo:e}){const o=K(j()),[t,l]=h.exports.useState(!1),p=h.exports.useRef(null),[C,x]=M(e.name),f=O("Enter",()=>{o.command.UpdateTodoCommand(w(u({},e),{name:C})),l(!1)}),L=()=>{l(!0)},v=()=>{o.command.ToggleTodoCompletedCommand(e.id)},R=()=>{o.command.RemoveTodoCommand(e.id)};return h.exports.useEffect(()=>{var g;t&&((g=p.current)==null||g.focus())},[t]),T("li",{onDoubleClick:L,className:`${t?"editing":""} ${e.completed?"completed":""}`,children:[T("div",{className:"view",children:[s("input",{type:"checkbox",className:"toggle",checked:e.completed,onChange:v}),s("label",{children:e.name}),s("button",{className:"destroy",onClick:R})]}),t&&s("input",{ref:p,className:"edit",value:C,onChange:x,onKeyPress:f,onBlur:()=>{l(!1)}})]})}const H=()=>{const{filter:e}=ne(),o=K(j()),t=b(o.query.TodoListQuery(e)),l=b(o.query.ActiveTodoCountQuery()),p=b(o.query.HasCompletedQuery()),C=b(o.query.AllCompletedQuery()),[x,f,L]=M(""),v=O("Enter",()=>{o.command.AddTodoCommand(x),L("")}),R=()=>{o.command.ToggleAllTodoCompletedCommand(!C)},g=()=>{o.command.ClearCompletedCommand()};return ae(o.event.AddTodoFailedEvent,i=>{alert(i)}),console.log("render list"),T("div",{className:"todoapp",children:[T("header",{className:"header",children:[s("h1",{children:"todos"}),s("input",{className:"new-todo",placeholder:"What needs to be done?",value:x,onChange:f,onKeyDown:v})]}),T("section",{className:"main",children:[s("input",{id:"toggle-all",type:"checkbox",className:"toggle-all",checked:C,onChange:R}),s("label",{htmlFor:"toggle-all"}),s("ul",{className:"todo-list",children:t.map(i=>s(ue,{todo:i},i.id))})]}),T("footer",{className:"footer",children:[T("span",{className:"todo-count",children:[s("strong",{children:l})," items left"]}),T("ul",{className:"filters",children:[s("li",{children:s(S,{to:"/",className:i=>i.isActive?"selected":"",children:"All"})}),s("li",{children:s(S,{to:"/active",className:i=>i.isActive?"selected":"",children:"Active"})}),s("li",{children:s(S,{to:"/completed",className:i=>i.isActive?"selected":"",children:"Completed"})})]}),p&&s("button",{className:"clear-completed",onClick:g,children:"Clear completed"})]})]})},A="todo-mvc-data",E=()=>N.getItem(A).then(e=>e!=null?e:[]),Te=U.impl({async getTodoList(){return E()},async addTodo(e){let o=await E();await N.setItem(A,o.concat(e))},async removeTodoByIds(e){let o=await E();await N.setItem(A,o.filter(t=>!e.includes(t.id)))},async updateTodo(e){let o=await E();await N.setItem(A,o.map(t=>t.id===e.id?u(u({},t),e):t))},async toggleCompletedByIds(e,o){let t=await E();await N.setItem(A,t.map(l=>e.includes(l.id)?w(u({},l),{completed:o}):l))}}),P=document.getElementById("root");if(P){const e=te(P),o=k.store({externs:[Te],inspectors:[me(),le({include:["command","query","event","domain","command$","state"]})]});e.render(s(h.exports.StrictMode,{children:s(re,{store:o,children:s(de,{basename:"/",children:T(se,{children:[s(B,{path:"/",element:s(H,{})}),s(B,{path:"/:filter",element:s(H,{})})]})})})}))}
//# sourceMappingURL=index.2980f590.js.map
