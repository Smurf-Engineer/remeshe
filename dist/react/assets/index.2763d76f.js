var J=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var B=(e,t,o)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,v=(e,t)=>{for(var o in t||(t={}))Z.call(t,o)&&B(e,o,t[o]);if(D)for(var o of D(t))ee.call(t,o)&&B(e,o,t[o]);return e},E=(e,t)=>X(e,Y(t));import{r as x,j as g,a,c as oe}from"./jsx-runtime.a8396eb8.js";import{u as te,N as k,l as A,H as ne,R as de,a as F}from"./localforage.bf54c3f4.js";import{o as se,c as ae,i as le,k as re,R as q,j as ce,m as H,u as U,b as $,d as I,r as me,e as ie,f as ue,g as pe}from"./remesh-logger.3c4497cd.js";import{m as Te}from"./merge.52b1bff1.js";import"./mergeAll.c6f90998.js";import"./mergeMap.e508a938.js";function Q(e,t,o){var n=re(e)||t||o?{next:e,error:t,complete:o}:e;return n?se(function(p,h){var C;(C=n.subscribe)===null||C===void 0||C.call(n);var f=!0;p.subscribe(ae(h,function(c){var m;(m=n.next)===null||m===void 0||m.call(n,c),h.next(c)},function(){var c;f=!1,(c=n.complete)===null||c===void 0||c.call(n),h.complete()},function(c){var m;f=!1,(m=n.error)===null||m===void 0||m.call(n,c),h.error(c)},function(){var c,m;f&&((c=n.unsubscribe)===null||c===void 0||c.call(n)),(m=n.finalize)===null||m===void 0||m.call(n)}))}):le}const he=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,o=e=="x"?t:t&3|8;return o.toString(16)}),K=q.extern({name:"TodoRepoExtern",default:{async getTodoList(){throw new Error("Not implemented")},async addTodo(){throw new Error("Not implemented")},async removeTodoByIds(){throw new Error("Not implemented")},async updateTodo(){throw new Error("Not implemented")},async toggleCompletedByIds(){throw new Error("Not implemented")}}}),j=q.domain({name:"TodoDomain",impl:e=>{const t=e.getExtern(K),o=e.state({name:"TodoListState",default:[]}),n=e.query({name:"TodoListQuery",impl({get:s},d){const u=s(o());return d==="active"?u.filter(l=>!l.completed):d==="completed"?u.filter(l=>l.completed):u}}),p=e.query({name:"HasCompletedQuery",impl({get:s}){return s(n("completed")).length>0}}),h=e.query({name:"ActiveTodoCountQuery",impl({get:s}){return s(n("active")).length}}),C=e.query({name:"AllCompletedQuery",impl({get:s}){return s(h())===0&&s(n()).length>0}}),f=e.event({name:"TodoAddedEvent"}),c=e.command({name:"SetTodoListCommand",impl(s,d){return o().new(d)}}),m=e.event({name:"AddTodoFailedEvent"}),R=e.command({name:"AddTodoCommand",impl({get:s},d){if(d.trim()==="")return[m("Cannot be empty, please enter the TODO name")];const u=s(o()),l={id:he(),name:d,completed:!1};return[o().new([...u,l]),f(l)]}}),y=e.event({name:"RemoveTodoEvent"}),w=e.command({name:"RemoveTodoCommand",impl({get:s},d){const l=s(o()).filter(r=>r.id!==d);return[o().new(l),y([d])]}}),T=e.event({name:"TodoUpdatedEvent"}),z=e.command({name:"UpdateTodoCommand",impl({get:s},d){const u=s(o());if(d.name&&d.name.trim()==="")return w(d.id);const l=u.map(i=>i.id===d.id?E(v(v({},i),d),{id:i.id}):i),r=l.find(i=>i.id===d.id);return r?[o().new(l),T(r)]:null}}),S=e.event({name:"TodoCompletedChangedEvent"}),V=e.command({name:"ToggleTodoCompletedCommand",impl({get:s},d){const l=s(o()).map(L=>L.id===d?E(v({},L),{completed:!L.completed}):L),r=l.find(L=>L.id===d);if(!r)return null;const i={ids:[d],completed:r==null?void 0:r.completed};return[o().new(l),S(i)]}}),W=e.command({name:"ToggleAllTodoCompletedCommand",impl({get:s},d){const u=s(o());if(u.length===0)return null;const l=u.map(r=>E(v({},r),{completed:d}));return[o().new(l),S({ids:l.map(r=>r.id),completed:d})]}}),G=e.command({name:"ClearCompletedCommand",impl({get:s}){const d=s(o()),u=d.filter(r=>!r.completed),l=d.filter(r=>r.completed).map(r=>r.id);return[o().new(u),y(l)]}});return e.effect({name:"FromRepoToStateEffect",impl(){return ce(t.getTodoList()).pipe(H(s=>c(s)))}}),e.effect({name:"FromStateToRepoEffect",impl:({fromEvent:s})=>{const d=s(f).pipe(Q(i=>t.addTodo(i))),u=s(y).pipe(Q(i=>t.removeTodoByIds(i))),l=s(T).pipe(Q(i=>t.updateTodo(i))),r=s(S).pipe(Q(i=>t.toggleCompletedByIds(i.ids,i.completed)));return Te(d,u,l,r).pipe(H(()=>null))}}),{query:{TodoListQuery:n,ActiveTodoCountQuery:h,HasCompletedQuery:p,AllCompletedQuery:C},command:{AddTodoCommand:R,RemoveTodoCommand:w,ToggleTodoCompletedCommand:V,ToggleAllTodoCompletedCommand:W,UpdateTodoCommand:z,ClearCompletedCommand:G},event:{AddTodoFailedEvent:m}}}});function M(e){const[t,o]=x.exports.useState(e),n=x.exports.useCallback(p=>{o(p.target.value)},[]);return[t,n,o]}function O(e,t){const o=x.exports.useRef(t),n=x.exports.useCallback(p=>{p.key.toLocaleLowerCase()===e.toLocaleLowerCase()&&(p.preventDefault(),o.current(p))},[e]);return x.exports.useEffect(()=>{o.current=t}),n}function Ce({todo:e}){const t=U(),o=$(j()),[n,p]=x.exports.useState(!1),h=x.exports.useRef(null),[C,f]=M(e.name),c=O("Enter",()=>{t(o.command.UpdateTodoCommand(E(v({},e),{name:C}))),p(!1)}),m=()=>{p(!0)},R=()=>{t(o.command.ToggleTodoCompletedCommand(e.id))},y=()=>{t(o.command.RemoveTodoCommand(e.id))};return x.exports.useEffect(()=>{var w;n&&((w=h.current)==null||w.focus())},[n]),g("li",{onDoubleClick:m,className:`${n?"editing":""} ${e.completed?"completed":""}`,children:[g("div",{className:"view",children:[a("input",{type:"checkbox",className:"toggle",checked:e.completed,onChange:R}),a("label",{children:e.name}),a("button",{className:"destroy",onClick:y})]}),n&&a("input",{ref:h,className:"edit",value:C,onChange:f,onKeyPress:c,onBlur:()=>{p(!1)}})]})}const _=()=>{const e=U(),{filter:t}=te(),o=$(j()),n=I(o.query.TodoListQuery(t)),p=I(o.query.ActiveTodoCountQuery()),h=I(o.query.HasCompletedQuery()),C=I(o.query.AllCompletedQuery()),[f,c,m]=M(""),R=O("Enter",()=>{e(o.command.AddTodoCommand(f)),m("")}),y=()=>{e(o.command.ToggleAllTodoCompletedCommand(!C))},w=()=>{e(o.command.ClearCompletedCommand())};return me(o.event.AddTodoFailedEvent,T=>{alert(T)}),console.log("render list"),g("div",{className:"todoapp",children:[g("header",{className:"header",children:[a("h1",{children:"todos"}),a("input",{className:"new-todo",placeholder:"What needs to be done?",value:f,onChange:c,onKeyDown:R})]}),g("section",{className:"main",children:[a("input",{id:"toggle-all",type:"checkbox",className:"toggle-all",checked:C,onChange:y}),a("label",{htmlFor:"toggle-all"}),a("ul",{className:"todo-list",children:n.map(T=>a(Ce,{todo:T},T.id))})]}),g("footer",{className:"footer",children:[g("span",{className:"todo-count",children:[a("strong",{children:p})," items left"]}),g("ul",{className:"filters",children:[a("li",{children:a(k,{to:"/",className:T=>T.isActive?"selected":"",children:"All"})}),a("li",{children:a(k,{to:"/active",className:T=>T.isActive?"selected":"",children:"Active"})}),a("li",{children:a(k,{to:"/completed",className:T=>T.isActive?"selected":"",children:"Completed"})})]}),h&&a("button",{className:"clear-completed",onClick:w,children:"Clear completed"})]})]})},b="todo-mvc-data",N=()=>A.getItem(b).then(e=>e!=null?e:[]),fe=K.impl({async getTodoList(){return N()},async addTodo(e){let t=await N();await A.setItem(b,t.concat(e))},async removeTodoByIds(e){let t=await N();await A.setItem(b,t.filter(o=>!e.includes(o.id)))},async updateTodo(e){let t=await N();await A.setItem(b,t.map(o=>o.id===e.id?v(v({},o),e):o))},async toggleCompletedByIds(e,t){let o=await N();await A.setItem(b,o.map(n=>e.includes(n.id)?E(v({},n),{completed:t}):n))}}),P=document.getElementById("root");if(P){const e=oe(P),t=q.store({externs:[fe],inspectors:[ie(),ue()]});e.render(a(x.exports.StrictMode,{children:a(pe,{store:t,children:a(ne,{basename:"/",children:g(de,{children:[a(F,{path:"/",element:a(_,{})}),a(F,{path:"/:filter",element:a(_,{})})]})})})}))}
//# sourceMappingURL=index.2763d76f.js.map
