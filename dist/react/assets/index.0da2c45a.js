var J=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var D=(e,t,o)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,u=(e,t)=>{for(var o in t||(t={}))Z.call(t,o)&&D(e,o,t[o]);if(q)for(var o of q(t))ee.call(t,o)&&D(e,o,t[o]);return e},L=(e,t)=>X(e,Y(t));import{r as C,j as T,a as s,c as te}from"./jsx-runtime.a8396eb8.js";import{l as A,t as b,u as oe,N as I,H as ne,R as de,a as F}from"./localforage.d6d60220.js";import{R as S,u as K,b as Q,t as se,c as ae,d as le,e as me}from"./remesh-logger.ff43b83d.js";import{f as re,m as H}from"./map.53d3c8f5.js";import{m as ce}from"./merge.d3c5cec3.js";import"./mergeAll.cb073436.js";const ie=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,o=e=="x"?t:t&3|8;return o.toString(16)}),E="todo-mvc-data",N=()=>A.getItem(E).then(e=>e!=null?e:[]),pe=S.extern({name:"TodoRepoExtern",default:{async getTodoList(){return N()},async addTodo(e){let t=await N();await A.setItem(E,t.concat(e))},async removeTodoByIds(e){let t=await N();await A.setItem(E,t.filter(o=>!e.includes(o.id)))},async updateTodo(e){let t=await N();await A.setItem(E,t.map(o=>o.id===e.id?u(u({},o),e):o))},async toggleCompletedByIds(e,t){let o=await N();await A.setItem(E,o.map(m=>e.includes(m.id)?L(u({},m),{completed:t}):m))}}}),U=S.domain({name:"TodoDomain",impl:e=>{const t=e.getExtern(pe),o=e.state({name:"TodoList",default:[]}),m=e.query({name:"TodoListQuery",impl({get:d},n){const c=d(o());return n==="active"?c.filter(a=>!a.completed):n==="completed"?c.filter(a=>a.completed):c}}),p=e.query({name:"HasCompletedQuery",impl({get:d}){return d(m("completed")).length>0}}),h=e.query({name:"ActiveTodoCountQuery",impl({get:d}){return d(m("active")).length}}),f=e.query({name:"AllCompletedQuery",impl({get:d}){return d(h())===0&&d(m()).length>0}}),x=e.event({name:"addTodoEvent"}),R=e.command({name:"SetTodoListCommand",impl(d,n){return o().new(n)}}),v=e.event({name:"AddTodoFailedEvent"}),w=e.command({name:"AddTodoCommand",impl({get:d},n){if(n.trim()==="")return[v("Cannot be empty, please enter the TODO name")];const c=d(o()),a={id:ie(),name:n,completed:!1};return[o().new([a,...c]),x(a)]}}),g=e.event({name:"RemoveTodoEvent"}),i=e.command({name:"RemoveTodoCommand",impl({get:d},n){const a=d(o()).filter(l=>l.id!==n);return[o().new(a),g([n])]}}),k=e.event({name:"TodoUpdatedEvent"}),O=e.command({name:"UpdateTodoCommand",impl({get:d},n){const c=d(o());if(n.name&&n.name.trim()==="")return i(n.id);const a=c.map(r=>r.id===n.id?L(u(u({},r),n),{id:r.id}):r),l=a.find(r=>r.id===n.id);return l?[o().new(a),k(l)]:null}}),$=e.event({name:"TodoCompletedChangedEvent"}),V=e.command({name:"ToggleTodoCompletedCommand",impl({get:d},n){const a=d(o()).map(y=>y.id===n?L(u({},y),{completed:!y.completed}):y),l=a.find(y=>y.id===n);if(!l)return null;const r={ids:[n],completed:l==null?void 0:l.completed};return[o().new(a),$(r)]}}),W=e.command({name:"ToggleAllTodoCompletedCommand",impl({get:d},n){const c=d(o());if(c.length===0)return null;const a=c.map(l=>L(u({},l),{completed:n}));return[o().new(a),$({ids:a.map(l=>l.id),completed:n})]}}),_=e.command({name:"ClearCompletedCommand",impl({get:d}){const n=d(o()),c=n.filter(l=>!l.completed),a=n.filter(l=>l.completed).map(l=>l.id);return[o().new(c),g(a)]}}),z=e.command$({name:"FromRepoToStateCommand$",impl(){return re(t.getTodoList()).pipe(H(d=>R(d)))}}),G=e.command$({name:"FromStateToRepoCommand$",impl:({fromEvent:d})=>{const n=d(x).pipe(b(r=>t.addTodo(r))),c=d(g).pipe(b(r=>t.removeTodoByIds(r))),a=d(k).pipe(b(r=>t.updateTodo(r))),l=d($).pipe(b(r=>t.toggleCompletedByIds(r.ids,r.completed)));return ce(n,c,a,l).pipe(H(()=>null))}});return e.ignite(()=>z()),e.ignite(()=>G()),{query:{TodoListQuery:m,ActiveTodoCountQuery:h,HasCompletedQuery:p,AllCompletedQuery:f},command:{AddTodoCommand:w,RemoveTodoCommand:i,ToggleTodoCompletedCommand:V,ToggleAllTodoCompletedCommand:W,UpdateTodoCommand:O,ClearCompletedCommand:_},event:{AddTodoFailedEvent:v}}}});function j(e){const[t,o]=C.exports.useState(e),m=C.exports.useCallback(p=>{o(p.target.value)},[]);return[t,m,o]}function M(e,t){const o=C.exports.useRef(t),m=C.exports.useCallback(p=>{p.key.toLocaleLowerCase()===e.toLocaleLowerCase()&&(p.preventDefault(),o.current(p))},[e]);return C.exports.useEffect(()=>{o.current=t}),m}function ue({todo:e}){const t=K(U()),[o,m]=C.exports.useState(!1),p=C.exports.useRef(null),[h,f]=j(e.name),x=M("Enter",()=>{t.command.UpdateTodoCommand(L(u({},e),{name:h})),m(!1)}),R=()=>{m(!0)},v=()=>{t.command.ToggleTodoCompletedCommand(e.id)},w=()=>{t.command.RemoveTodoCommand(e.id)};return C.exports.useEffect(()=>{var g;o&&((g=p.current)==null||g.focus())},[o]),T("li",{onDoubleClick:R,className:`${o?"editing":""} ${e.completed?"completed":""}`,children:[T("div",{className:"view",children:[s("input",{type:"checkbox",className:"toggle",checked:e.completed,onChange:v}),s("label",{children:e.name}),s("button",{className:"destroy",onClick:w})]}),o&&s("input",{ref:p,className:"edit",value:h,onChange:f,onKeyPress:x,onBlur:()=>{m(!1)}})]})}const B=()=>{const{filter:e}=oe(),t=K(U()),o=Q(t.query.TodoListQuery(e)),m=Q(t.query.ActiveTodoCountQuery()),p=Q(t.query.HasCompletedQuery()),h=Q(t.query.AllCompletedQuery()),[f,x,R]=j(""),v=M("Enter",()=>{t.command.AddTodoCommand(f),R("")}),w=()=>{t.command.ToggleAllTodoCompletedCommand(!h)},g=()=>{t.command.ClearCompletedCommand()};return se(t.event.AddTodoFailedEvent,i=>{alert(i)}),console.log("render list"),T("div",{className:"todoapp",children:[T("header",{className:"header",children:[s("h1",{children:"todos"}),s("input",{className:"new-todo",placeholder:"What needs to be done?",value:f,onChange:x,onKeyDown:v})]}),T("section",{className:"main",children:[s("input",{id:"toggle-all",type:"checkbox",className:"toggle-all",checked:h,onChange:w}),s("label",{htmlFor:"toggle-all"}),s("ul",{className:"todo-list",children:o.map(i=>s(ue,{todo:i},i.id))})]}),T("footer",{className:"footer",children:[T("span",{className:"todo-count",children:[s("strong",{children:m})," items left"]}),T("ul",{className:"filters",children:[s("li",{children:s(I,{to:"/",className:i=>i.isActive?"selected":"",children:"All"})}),s("li",{children:s(I,{to:"/active",className:i=>i.isActive?"selected":"",children:"Active"})}),s("li",{children:s(I,{to:"/completed",className:i=>i.isActive?"selected":"",children:"Completed"})})]}),p&&s("button",{className:"clear-completed",onClick:g,children:"Clear completed"})]})]})},P=document.getElementById("root");if(P){const e=te(P),t=S.store({inspectors:[ae(),le({include:["command","query","event","domain","command$","state"]})]});e.render(s(C.exports.StrictMode,{children:s(me,{store:t,children:s(ne,{basename:"/",children:T(de,{children:[s(F,{path:"/",element:s(B,{})}),s(F,{path:"/:filter",element:s(B,{})})]})})})}))}
//# sourceMappingURL=index.0da2c45a.js.map
