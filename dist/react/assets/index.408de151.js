var z=Object.defineProperty,J=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var _=(e,t,o)=>t in e?z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,D=(e,t)=>{for(var o in t||(t={}))Z.call(t,o)&&_(e,o,t[o]);if($)for(var o of $(t))ee.call(t,o)&&_(e,o,t[o]);return e},Q=(e,t)=>J(e,X(t));import{j as T,a as d,r as C,F as te,c as oe}from"./jsx-runtime.a8396eb8.js";import{l as w,t as ne,u as re,N as q,H as ae,R as me,a as K}from"./localforage.437d46f7.js";import{R as f,u as h,b as y,t as de,c as le,d as se,e as ce}from"./remesh-logger.45390822.js";import{f as ue,m as F}from"./map.596f380b.js";import{f as O}from"./filter.526c2a27.js";import{L as ie}from"./list.9747f933.js";const M=f.extern({name:"Storage",default:{get:()=>{throw new Error("Not implemented")},set:()=>{throw new Error("Not implemented")},clear:()=>{throw new Error("Not implemented")}}}),pe=M.impl({get:e=>w.getItem(e),set:async(e,t)=>{await w.setItem(e,t)},clear:e=>w.removeItem(e)}),Te=(e,t)=>{var l;const o=e.state({name:`${t.name}.TextState`,default:(l=t.default)!=null?l:""}),n=e.query({name:`${t.name}.TextQuery`,impl:({get:u})=>u(o())}),m=e.command({name:`${t.name}.SetTextCommand`,impl:(u,p)=>o().new(p)}),r=e.command({name:`${t.name}.ClearTextCommand`,impl:()=>o().new("")}),a=e.command({name:`${t.name}.ResetCommand`,impl:()=>{var u;return o().new((u=t.default)!=null?u:"")}});return{query:{TextQuery:n},command:{SetTextCommand:m,ClearTextCommand:r,ResetCommand:a}}},Ce=(e,t)=>({listenTo:o=>({saveData:n=>({readData:m=>t({storageKey:e,TriggerEvent:o,saveData:n,readData:m})}),readData:n=>t({storageKey:e,TriggerEvent:o,saveData:m=>m,readData:n})})}),ye=(e,t)=>{const o=e.getExtern(M),n=e.command$({name:"ReadStorageCommand$",impl:()=>ue(o.get(t.storageKey)).pipe(O(r=>!!r),F(r=>t.readData(r)))}),m=e.command$({name:"WriteStorageCommand$",impl:({fromEvent:r})=>r(t.TriggerEvent).pipe(ne(a=>o.set(t.storageKey,t.saveData(a))),F(()=>null))});e.ignite(()=>n()),e.ignite(()=>m())},R=(e,t)=>Ce(t,o=>ye(e,o)),he="remesh-example/todo-input",P=f.domain({name:"TodoInputDomain",impl:e=>{const t=Te(e,{name:"TodoInput"}),o=e.event({name:"TodoInputChangedEvent"}),n=t.query.TextQuery,m=e.command({name:"setTodoInput",impl:({},a)=>[t.command.SetTextCommand(a),o(a)]}),r=t.command.ClearTextCommand;return R(e,he).listenTo(o).readData(a=>m(a)),{query:{TodoInputQuery:n},command:{SetTodoInputCommand:m,ClearTodoInputCommand:r},event:{TodoInputChangedEvent:o}}}}),ge=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,o=e=="x"?t:t&3|8;return o.toString(16)}),fe="remesh-example/todo-list",E=e=>e.id,L=f.domain({name:"TodoListDomain",impl:e=>{const t=ie(e,{name:"TodoList",key:E}),o=t.query.ItemListQuery,n=t.query.ItemQuery,m=t.query.KeyListQuery,r=e.event({name:"TodoListChangedEvent"}),a=e.command({name:"SetTodoListCommand",impl:(c,s)=>[t.command.SetListCommand(s),r(s)]}),l=e.event({name:"FailedToAddTodoEvent"}),u=e.event({name:"TodoItemAddedEvent"}),p=e.command({name:"AddTodoCommand",impl:(c,s)=>{if(s==="")return l({reason:"Title cannot be empty"});const i={id:ge(),title:s,completed:!1};return[t.command.AddItemCommand(i),u(i)]}}),g=e.command({name:"UpdateTodoCommand",impl:(c,s)=>s.title===""?S(s.id):t.command.UpdateItemCommand(s)}),S=t.command.DeleteItemCommand,A=e.query({name:"ActiveTodoListQuery",impl:({get:c})=>c(o()).filter(i=>!i.completed)}),x=e.query({name:"CompletedTodoListQuery",impl:({get:c})=>c(o()).filter(i=>i.completed)}),v=e.query({name:"ActiveTodoCountQuery",impl:({get:c})=>c(A()).length}),N=e.query({name:"CompletedTodoCountQuery",impl:({get:c})=>c(x()).length}),j=e.query({name:"IsAllCompletedQuery",impl:({get:c})=>{const s=c(o());return s.length===0?!1:c(N())===s.length}}),B=e.command({name:"ToggleTodoCommand",impl:({get:c},s)=>{const i=c(n(s)),I=Q(D({},i),{completed:!i.completed});return t.command.UpdateItemCommand(I)}}),G=e.command({name:"ToggleAllCommand",impl:({get:c})=>{const s=c(o());if(s.length===0)return null;const I=c(v())>0,Y=s.map(V=>Q(D({},V),{completed:I}));return a(Y)}}),W=e.command({name:"ClearAllCompletedCommand",impl:({get:c})=>{const s=c(o());if(s.length===0)return null;const i=s.filter(I=>!I.completed);return a(i)}});return R(e,fe).listenTo(r).readData(c=>a(c)),{query:{TodoQuery:n,TodoKeyListQuery:m,TodoListQuery:o,ActiveTodoListQuery:A,CompletedTodoListQuery:x,ActiveTodoCountQuery:v,CompletedTodoCountQuery:N,IsAllCompletedQuery:j},command:{SetTodoListCommand:a,AddTodoCommand:p,UpdateTodoCommand:g,DeleteTodoCommand:S,ToggleTodoCommand:B,ToggleAllCommand:G,ClearAllCompletedCommand:W},event:{FailedToAddTodoEvent:l,TodoListChangedEvent:r,TodoItemAddedEvent:u}}}});function U(e,t){return n=>{const m=Array.isArray(e)?e:[e];for(const r of m)n.key.toLowerCase()===r.toLowerCase()&&(n.preventDefault(),t(n,r))}}const xe=()=>{const e=h(P()),t=h(L()),o=y(e.query.TodoInputQuery()),n=r=>{e.command.SetTodoInputCommand(r.target.value)},m=U("Enter",()=>{t.command.AddTodoCommand(o)});return de(t.event.FailedToAddTodoEvent,r=>{alert(r.reason)}),T("header",{className:"header",children:[d("h1",{children:"todos"}),d("input",{className:"new-todo",placeholder:"What needs to be done?",value:o,onChange:n,onKeyDown:m})]})},ve=(e,t)=>{const o=e.state({name:`${t.name}.SwitchState`,default:t.default}),n=e.query({name:`${t.name}.SwitchQuery`,impl:({get:a})=>a(o())}),m=e.command({name:`${t.name}.SwitchCommand`,impl:(a,l)=>o().new(l)}),r=e.command({name:`${t.name}.ResetCommand`,impl:(a,l)=>o().new(l)});return{query:{SwitchQuery:n},command:{SwitchCommand:m,ResetCommand:r}}},Ie="remesh-example/todo-filter",Le=e=>{if(e===void 0)return"all";switch(e){case"all":case"active":case"completed":return e;default:return"all"}},H=f.domain({name:"TodoFilterDomain",impl:e=>{const t=ve(e,{name:"TodoFilter",default:"all"}),o=e.event({name:"TodoFilterChangedEvent"}),n=t.query.SwitchQuery,m=e.command({name:"SetFilterCommand",impl:(r,a)=>{const l=Le(a);return[t.command.SwitchCommand(l),o(l)]}});return R(e,Ie).listenTo(o).readData(r=>m(r)),{query:{TodoFilterQuery:n},command:{SetFilterCommand:m},event:{TodoFilterChangedEvent:o}}}}),Se=f.domain({name:"TodoAppDomain",impl:e=>{const t=e.getDomain(P()),o=e.getDomain(L()),n=e.getDomain(H()),m=e.query({name:"FilteredTodoKeyListQuery",impl:({get:a})=>{const l=a(n.query.TodoFilterQuery());if(l==="all")return a(o.query.TodoListQuery()).map(E);if(l==="active")return a(o.query.ActiveTodoListQuery()).map(E);if(l==="completed")return a(o.query.CompletedTodoListQuery()).map(E);throw new Error(`Unknown filter: ${l}`)}}),r=e.command$({name:"ClearTodoInputCommand$",impl:({fromEvent:a,get:l})=>a(o.event.TodoItemAddedEvent).pipe(O(u=>l(t.query.TodoInputQuery())===u.title),F(()=>t.command.ClearTodoInputCommand()))});return e.ignite(()=>r()),{query:{FilteredTodoKeyListQuery:m}}}});function Ae(e){const[t,o]=C.exports.useState(e),n=C.exports.useCallback(m=>{o(m.target.value)},[]);return[t,n,o]}function De(e){const t=h(L()),o=y(t.query.TodoQuery(e.id)),[n,m]=C.exports.useState(!1),[r,a]=Ae(o.title),l=()=>{t.command.UpdateTodoCommand(Q(D({},o),{title:r})),m(!1)},u=U(["Enter","Escape"],()=>{l()}),p=()=>{m(!0)},g=()=>{t.command.ToggleTodoCommand(o.id)},S=()=>{t.command.DeleteTodoCommand(o.id)},A=()=>{l()},x=C.exports.useRef(null);return C.exports.useEffect(()=>{var v;n&&((v=x.current)==null||v.focus())},[n]),T("li",{className:`${n&&"editing"} ${o.completed&&"completed"}`,children:[T("div",{className:"view",children:[d("input",{type:"checkbox",className:"toggle",checked:o.completed,onChange:g}),d("label",{onDoubleClick:p,children:o.title}),d("button",{className:"destroy",onClick:S})]}),n&&d("input",{ref:x,className:"edit",value:r,onChange:a,onKeyDown:u,onBlur:A})]})}const Qe=()=>{const e=h(Se()),t=y(e.query.FilteredTodoKeyListQuery());return console.log("render list"),T("section",{className:"main",children:[d(Ee,{}),d("ul",{className:"todo-list",children:t.map(o=>d(De,{id:o},o))})]})},Ee=()=>{const e=h(L()),t=y(e.query.IsAllCompletedQuery());return T(te,{children:[d("input",{id:"toggle-all",type:"checkbox",className:"toggle-all",checked:t,onChange:()=>{e.command.ToggleAllCommand()}}),d("label",{htmlFor:"toggle-all"})]})},we=()=>{const e=h(L()),t=h(H()),o=y(t.query.TodoFilterQuery()),n=y(e.query.ActiveTodoCountQuery()),r=y(e.query.CompletedTodoCountQuery())>0,a=()=>{e.command.ClearAllCompletedCommand()},l=p=>p.isActive?"selected":"",u=re();return C.exports.useEffect(()=>{var g;const p=(g=u.filter)!=null?g:"all";p!==o&&t.command.SetFilterCommand(p)},[u,o]),T("footer",{className:"footer",children:[T("span",{className:"todo-count",children:[d("strong",{children:n})," item",n!==1&&"s"," left"]}),T("ul",{className:"filters",children:[d("li",{children:d(q,{to:"/",className:l,children:"All"})}),d("li",{children:d(q,{to:"/active",className:l,children:"Active"})}),d("li",{children:d(q,{to:"/completed",className:l,children:"Completed"})})]}),r&&d("button",{className:"clear-completed",onClick:a,children:"Clear completed"})]})},b=()=>T("div",{className:"todoapp",children:[d(xe,{}),d(Qe,{}),d(we,{})]}),k=document.getElementById("root");if(k){const e=oe(k),t=f.store({externs:[pe],inspectors:[le(),se()]});e.render(d(C.exports.StrictMode,{children:d(ce,{store:t,children:d(ae,{basename:"/",children:T(me,{children:[d(K,{path:"/",element:d(b,{})}),d(K,{path:"/:filter",element:d(b,{})})]})})})}))}
//# sourceMappingURL=index.408de151.js.map
