var z=Object.defineProperty,J=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var b=(e,t,o)=>t in e?z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,Q=(e,t)=>{for(var o in t||(t={}))Z.call(t,o)&&b(e,o,t[o]);if(K)for(var o of K(t))ee.call(t,o)&&b(e,o,t[o]);return e},w=(e,t)=>J(e,X(t));import{j as p,a as l,r as y,F as te,c as oe}from"./jsx-runtime.a8396eb8.js";import{l as F,u as ne,N as R,H as re,R as de,a as $}from"./localforage.bf54c3f4.js";import{R as C,m as _,u as q,b as f,d as g,r as me,e as ae,f as le,g as se}from"./remesh-logger.3c4497cd.js";import{L as ce}from"./list.1de299b3.js";import{f as ue}from"./filter.6b722d08.js";const M=C.extern({name:"StorageExtern",default:{get:()=>{throw new Error("Not implemented")},set:()=>{throw new Error("Not implemented")},clear:()=>{throw new Error("Not implemented")}}}),ie=M.impl({get:e=>F.getItem(e),set:async(e,t)=>{await F.setItem(e,t)},clear:e=>F.removeItem(e)}),pe=(e,t)=>{var u;const o=e.state({name:`${t.name}.TextState`,default:(u=t.default)!=null?u:""}),n=e.query({name:`${t.name}.TextQuery`,impl:({get:s})=>s(o())}),r=e.command({name:`${t.name}.SetTextCommand`,impl:({},s)=>o().new(s)}),m=e.command({name:`${t.name}.ClearTextCommand`,impl:({})=>o().new("")}),d=e.command({name:`${t.name}.ResetCommand`,impl:({})=>{var s;return o().new((s=t.default)!=null?s:"")}});return C.module({query:{TextQuery:n},command:{SetTextCommand:r,ClearTextCommand:m,ResetCommand:d}})},Te=(e,t)=>({listenTo:o=>({get:n=>({set:r=>t({storageKey:e,TriggerEvent:o,get:n,set:r})}),set:n=>t({storageKey:e,TriggerEvent:o,get:r=>r,set:n})})}),Ce=(e,t)=>{const o=e.getExtern(M);e.effect({name:"ReadStorageEffect",impl:async n=>{const r=await o.get(t.storageKey);return r?t.set(n,r):null}}),e.effect({name:"WriteStorageEffect",impl:({fromEvent:n})=>n(t.TriggerEvent).pipe(_(r=>(o.set(t.storageKey,t.get(r)),null)))})},N=(e,t)=>Te(t,o=>Ce(e,o)),he="remesh-example/todo-input",P=C.domain({name:"TodoInputDomain",impl:e=>{const t=pe(e,{name:"TodoInput"}),o=e.event({name:"TodoInputChangedEvent"}),n=t.query.TextQuery,r=e.command({name:"SetTodoInputCommand",impl:({},d)=>[t.command.SetTextCommand(d),o(d)]}),m=e.command({name:"ClearTodoInputCommand",impl:({get:d})=>[t.command.ClearTextCommand(),o("")]});return N(e,he).listenTo(o).set(({},d)=>r(d)),{query:{TodoInputQuery:n},command:{SetTodoInputCommand:r,ClearTodoInputCommand:m},event:{TodoInputChangedEvent:o}}}}),ye=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,o=e=="x"?t:t&3|8;return o.toString(16)}),ge="remesh-example/todo-list",D=e=>e.id,A=C.domain({name:"TodoListDomain",impl:e=>{const t=ce(e,{name:"TodoList",key:D}),o=t.query.ItemListQuery,n=t.query.ItemQuery,r=t.query.KeyListQuery,m=e.event({name:"TodoListChangedEvent",impl:({get:a})=>a(o())}),d=e.command({name:"SetTodoListCommand",impl:({},a)=>[t.command.SetListCommand(a),m()]}),u=e.event({name:"FailedToAddTodoEvent"}),s=e.event({name:"TodoItemAddedEvent"}),x=e.command({name:"AddTodoCommand",impl:({},a)=>{if(a==="")return u({reason:"Title cannot be empty"});const c={id:ye(),title:a,completed:!1};return[t.command.AddItemCommand(c),s(c),m()]}}),T=e.command({name:"UpdateTodoCommand",impl:({},a)=>a.title===""?h(a.id):[t.command.UpdateItemCommand(a),m()]}),h=e.command({name:"DeleteTodoCommand",impl:({},a)=>[t.command.DeleteItemCommand(a),m()]}),I=e.query({name:"ActiveTodoListQuery",impl:({get:a})=>a(o()).filter(i=>!i.completed)}),E=e.query({name:"CompletedTodoListQuery",impl:({get:a})=>a(o()).filter(i=>i.completed)}),v=e.query({name:"ActiveTodoCountQuery",impl:({get:a})=>a(I()).length}),L=e.query({name:"CompletedTodoCountQuery",impl:({get:a})=>a(E()).length}),j=e.query({name:"IsAllCompletedQuery",impl:({get:a})=>{const c=a(o());return c.length===0?!1:a(L())===c.length}}),B=e.command({name:"ToggleTodoCommand",impl:({get:a},c)=>{const i=a(n(c)),S=w(Q({},i),{completed:!i.completed});return T(S)}}),G=e.command({name:"ToggleAllCommand",impl:({get:a})=>{const c=a(o());if(c.length===0)return null;const S=a(v())>0,Y=c.map(V=>w(Q({},V),{completed:S}));return d(Y)}}),W=e.command({name:"ClearAllCompletedCommand",impl:({get:a})=>{const c=a(o());if(c.length===0)return null;const i=c.filter(S=>!S.completed);return d(i)}});return N(e,ge).listenTo(m).set(({},a)=>d(a)),{query:{TodoQuery:n,TodoKeyListQuery:r,TodoListQuery:o,ActiveTodoListQuery:I,CompletedTodoListQuery:E,ActiveTodoCountQuery:v,CompletedTodoCountQuery:L,IsAllCompletedQuery:j},command:{SetTodoListCommand:d,AddTodoCommand:x,UpdateTodoCommand:T,DeleteTodoCommand:h,ToggleTodoCommand:B,ToggleAllCommand:G,ClearAllCompletedCommand:W},event:{FailedToAddTodoEvent:u,TodoListChangedEvent:m,TodoItemAddedEvent:s}}}});function H(e,t){return n=>{const r=Array.isArray(e)?e:[e];for(const m of r)n.key.toLowerCase()===m.toLowerCase()&&(n.preventDefault(),t(n,m))}}const fe=()=>{const e=q(),t=f(P()),o=f(A()),n=g(t.query.TodoInputQuery()),r=d=>{e(t.command.SetTodoInputCommand(d.target.value))},m=H("Enter",()=>{e(o.command.AddTodoCommand(n))});return me(o.event.FailedToAddTodoEvent,d=>{alert(d.reason)}),p("header",{className:"header",children:[l("h1",{children:"todos"}),l("input",{className:"new-todo",placeholder:"What needs to be done?",value:n,onChange:r,onKeyDown:m})]})},xe=(e,t)=>{const o=e.state({name:`${t.name}.SwitchState`,default:t.default}),n=e.query({name:`${t.name}.SwitchQuery`,impl:({get:d})=>d(o())}),r=e.command({name:`${t.name}.SwitchCommand`,impl:({},d)=>o().new(d)}),m=e.command({name:`${t.name}.ResetCommand`,impl:({})=>o().new(t.default)});return C.module({query:{SwitchQuery:n},command:{SwitchCommand:r,ResetCommand:m}})},ve="remesh-example/todo-filter",Le=e=>{if(e===void 0)return"all";switch(e){case"all":case"active":case"completed":return e;default:return"all"}},U=C.domain({name:"TodoFilterDomain",impl:e=>{const t=xe(e,{name:"TodoFilter",default:"all"}),o=e.event({name:"TodoFilterChangedEvent"}),n=t.query.SwitchQuery,r=e.command({name:"SetFilterCommand",impl:({},m)=>{const d=Le(m);return[t.command.SwitchCommand(d),o(d)]}});return N(e,ve).listenTo(o).set(({},m)=>r(m)),{query:{TodoFilterQuery:n},command:{SetFilterCommand:r},event:{TodoFilterChangedEvent:o}}}}),Se=C.domain({name:"TodoAppDomain",impl:e=>{const t=e.getDomain(P()),o=e.getDomain(A()),n=e.getDomain(U()),r=e.query({name:"FilteredTodoKeyListQuery",impl:({get:m})=>{const d=m(n.query.TodoFilterQuery());if(d==="all")return m(o.query.TodoListQuery()).map(D);if(d==="active")return m(o.query.ActiveTodoListQuery()).map(D);if(d==="completed")return m(o.query.CompletedTodoListQuery()).map(D);throw new Error(`Unknown filter: ${d}`)}});return e.effect({name:"ClearTodoInputWhenTodoAddedEffect",impl:({fromEvent:m,get:d})=>m(o.event.TodoItemAddedEvent).pipe(ue(u=>d(t.query.TodoInputQuery())===u.title),_(()=>t.command.ClearTodoInputCommand()))}),{query:{FilteredTodoKeyListQuery:r}}}});function Ae(e){const[t,o]=y.exports.useState(e),n=y.exports.useCallback(r=>{o(r.target.value)},[]);return[t,n,o]}function Ie(e){const t=q(),o=f(A()),n=g(o.query.TodoQuery(e.id)),[r,m]=y.exports.useState(!1),[d,u]=Ae(n.title),s=()=>{t(o.command.UpdateTodoCommand(w(Q({},n),{title:d}))),m(!1)},x=H(["Enter","Escape"],()=>{s()}),T=()=>{m(!0)},h=()=>{t(o.command.ToggleTodoCommand(n.id))},I=()=>{t(o.command.DeleteTodoCommand(n.id))},E=()=>{s()},v=y.exports.useRef(null);return y.exports.useEffect(()=>{var L;r&&((L=v.current)==null||L.focus())},[r]),p("li",{className:`${r&&"editing"} ${n.completed&&"completed"}`,children:[p("div",{className:"view",children:[l("input",{type:"checkbox",className:"toggle",checked:n.completed,onChange:h}),l("label",{onDoubleClick:T,children:n.title}),l("button",{className:"destroy",onClick:I})]}),r&&l("input",{ref:v,className:"edit",value:d,onChange:u,onKeyDown:x,onBlur:E})]})}const Ee=()=>{const e=f(Se()),t=g(e.query.FilteredTodoKeyListQuery());return console.log("render list"),p("section",{className:"main",children:[l(Qe,{}),l("ul",{className:"todo-list",children:t.map(o=>l(Ie,{id:o},o))})]})},Qe=()=>{const e=q(),t=f(A()),o=g(t.query.IsAllCompletedQuery());return p(te,{children:[l("input",{id:"toggle-all",type:"checkbox",className:"toggle-all",checked:o,onChange:()=>{e(t.command.ToggleAllCommand())}}),l("label",{htmlFor:"toggle-all"})]})},we=()=>{const e=q(),t=f(A()),o=f(U()),n=g(o.query.TodoFilterQuery()),r=g(t.query.ActiveTodoCountQuery()),d=g(t.query.CompletedTodoCountQuery())>0,u=()=>{e(t.command.ClearAllCompletedCommand())},s=T=>T.isActive?"selected":"",x=ne();return y.exports.useEffect(()=>{var h;const T=(h=x.filter)!=null?h:"all";T!==n&&e(o.command.SetFilterCommand(T))},[x,n]),p("footer",{className:"footer",children:[p("span",{className:"todo-count",children:[l("strong",{children:r})," item",r!==1&&"s"," left"]}),p("ul",{className:"filters",children:[l("li",{children:l(R,{to:"/",className:s,children:"All"})}),l("li",{children:l(R,{to:"/active",className:s,children:"Active"})}),l("li",{children:l(R,{to:"/completed",className:s,children:"Completed"})})]}),d&&l("button",{className:"clear-completed",onClick:u,children:"Clear completed"})]})},k=()=>p("div",{className:"todoapp",children:[l(fe,{}),l(Ee,{}),l(we,{})]}),O=document.getElementById("root");if(O){const e=oe(O),t=C.store({externs:[ie],inspectors:[ae(),le()]});e.render(l(y.exports.StrictMode,{children:l(se,{store:t,children:l(re,{basename:"/",children:p(de,{children:[l($,{path:"/",element:l(k,{})}),l($,{path:"/:filter",element:l(k,{})})]})})})})),window.root=e}
//# sourceMappingURL=index.0dd78478.js.map
