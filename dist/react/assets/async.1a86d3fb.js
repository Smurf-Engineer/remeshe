import{j as q,o as Q,c as F,g as o,m as k,R as P,O as V}from"./remesh-react.691c86dd.js";import{s as z,t as B}from"./takeUntil.5d5ca843.js";import{m as p}from"./mergeMap.2dc77344.js";function G(e,n){return q(n)?p(e,n,1):p(e,1)}function b(e,n){return n?function(h){return h.pipe(b(function(d,s){return o(e(d,s)).pipe(k(function(m,f){return n(d,m,s,f)}))}))}:Q(function(h,d){var s=0,m=null,f=!1;h.subscribe(F(d,function(C){m||(m=F(d,void 0,function(){m=null,f&&d.complete()}),o(e(C,s++)).subscribe(m))},function(){f=!0,!m&&d.complete()}))})}const i={default:()=>({type:"default"}),loading:()=>({type:"loading"}),success:e=>({type:"success",value:e}),failed:e=>({type:"failed",error:e}),canceled:()=>({type:"canceled"}),isDefault:e=>e.type==="default",isLoading:e=>e.type==="loading",isSuccess:e=>e.type==="success",isFailed:e=>e.type==="failed",isCanceled:e=>e.type==="canceled",assertDefault:e=>{if(e.type!=="default")throw new Error(`Expected async data in default phase, but got '${e.type}'`)},assertLoading:e=>{if(e.type!=="loading")throw new Error(`Expected async data in loading phase, but got '${e.type}'`)},assertSuccess:e=>{if(e.type!=="success")throw new Error(`Expected async data in success phase, but got '${e.type}'`)},assertFailed:e=>{if(e.type!=="failed")throw new Error(`Expected async data in failed phase, but got '${e.type}'`)},assertCanceled:e=>{if(e.type!=="canceled")throw new Error(`Expected async data in canceled phase, but got '${e.type}'`)}},K=(e,n)=>{const h="default"in n&&n.default?n.default:i.default(),d=e.state({name:`${n.name}.AsyncDataState`,default:h}),s=e.command({name:`${n.name}.UpdateAsyncDataCommand`,impl:({get:c},[a,r])=>{var l,t;return[d().new(a),S(a),(t=(l=n.onChanged)==null?void 0:l.call(n,{get:c},a,r))!=null?t:null]}}),m=e.query({name:`${n.name}.AsyncDataQuery`,impl:({get:c})=>c(d())}),f=Symbol("arg"),C=e.state({name:`${n.name}.ArgState`,inspectable:!1,default:f}),v=e.event({name:`${n.name}.LoadingEvent`}),w=e.event({name:`${n.name}.SuccessEvent`}),A=e.event({name:`${n.name}.FailedEvent`}),E=e.event({name:`${n.name}.CanceledEvent`}),S=e.event({name:`${n.name}.ChangedEvent`}),$=e.event({name:`${n.name}.LoadEvent`}),x=e.command({name:`${n.name}.LoadCommand`,impl:({get:c},a)=>{var r,l;return[C().new(a),s([i.loading(),a]),$(a),v(a),(l=(r=n.onLoading)==null?void 0:r.call(n,{get:c},a))!=null?l:null]}}),M=e.command({name:`${n.name}.SuccessCommand`,impl:({get:c},[a,r])=>{var t,u;const l=i.success(a);return[s([l,r]),w(a),(u=(t=n.onSuccess)==null?void 0:t.call(n,{get:c},a,r))!=null?u:null]}}),R=e.command({name:`${n.name}.FailedCommand`,impl:({get:c},[a,r])=>{var t,u;const l=i.failed(a);return[s([l,r]),A(a),(u=(t=n.onFailed)==null?void 0:t.call(n,{get:c},a,r))!=null?u:null]}}),L=e.command({name:`${n.name}.CancelCommand`,impl:({get:c})=>{var t,u;const a=c(m());if(!i.isLoading(a))return null;const r=c(C());if(r===f)return null;const l=i.canceled();return[s([l,r]),E(),(u=(t=n.onCanceled)==null?void 0:t.call(n,{get:c},r))!=null?u:null]}}),U=e.command({name:`${n.name}.ReloadCommand`,impl:({get:c})=>{const a=c(C());return a===f?null:[L(),x(a)]}});return e.effect({name:`${n.name}.LoadEffect`,impl:({get:c,fromEvent:a})=>{const r={get:c},l=t=>new V(u=>{let g=!1;const O=y=>{g||(u.next(M([y,t])),u.complete())},D=y=>{g||(u.next(R([y instanceof Error?y:new Error(`${y}`),t])),u.complete())};try{n.load(r,t).then(O,D)}catch(y){D(y)}return()=>{g=!0}}).pipe(B(a(E)));if(!n.mode||n.mode==="switch")return a($).pipe(z(t=>l(t)));if(n.mode==="concat")return a($).pipe(G(t=>l(t)));if(n.mode==="merge")return a($).pipe(p(t=>l(t)));if(n.mode==="exhaust")return a($).pipe(b(t=>l(t)));throw new Error(`RemeshAsyncModule: invalid mode: ${n.mode}`)}}),P.module({query:{AsyncDataQuery:m},command:{LoadCommand:x,CancelCommand:L,ReloadCommand:U},event:{CanceledEvent:E,LoadingEvent:v,SuccessEvent:w,FailedEvent:A,ChangedEvent:S}})};export{K as A,i as a};
//# sourceMappingURL=async.1a86d3fb.js.map
