var J=Object.defineProperty,K=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var z=(t,e,n)=>e in t?J(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,S=(t,e)=>{for(var n in e||(e={}))Z.call(e,n)&&z(t,n,e[n]);if(I)for(var n of I(e))V.call(e,n)&&z(t,n,e[n]);return t},w=(t,e)=>K(t,U(e));import{R as tt,r as C,a as h,j as $,c as et}from"./jsx-runtime.cbb87597.js";import{r as E,S as nt,_ as P,a as F,t as ot,j as rt,p as it,O as st,v as at,o as H,c as j,n as ct,q as ut,R as L,m as lt,u as dt,d as ft,w as D,f as pt,g as vt,h as ht}from"./remesh-logger.3b445c02.js";import{f as mt}from"./filter.b510e523.js";import{m as yt,E as xt}from"./mergeAll.77155404.js";import{m as gt}from"./mapTo.5ab1c99f.js";var O={now:function(){return(O.delegate||Date).now()},delegate:void 0},St=function(t){E(e,t);function e(n,o){return t.call(this)||this}return e.prototype.schedule=function(n,o){return this},e}(nt),A={setInterval:function(t,e){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];var r=A.delegate;return r!=null&&r.setInterval?r.setInterval.apply(r,P([t,e],F(n))):setInterval.apply(void 0,P([t,e],F(n)))},clearInterval:function(t){var e=A.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},wt=function(t){E(e,t);function e(n,o){var r=t.call(this,n,o)||this;return r.scheduler=n,r.work=o,r.pending=!1,r}return e.prototype.schedule=function(n,o){if(o===void 0&&(o=0),this.closed)return this;this.state=n;var r=this.id,c=this.scheduler;return r!=null&&(this.id=this.recycleAsyncId(c,r,o)),this.pending=!0,this.delay=o,this.id=this.id||this.requestAsyncId(c,this.id,o),this},e.prototype.requestAsyncId=function(n,o,r){return r===void 0&&(r=0),A.setInterval(n.flush.bind(n,this),r)},e.prototype.recycleAsyncId=function(n,o,r){if(r===void 0&&(r=0),r!=null&&this.delay===r&&this.pending===!1)return o;A.clearInterval(o)},e.prototype.execute=function(n,o){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(n,o);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,o){var r=!1,c;try{this.work(n)}catch(s){r=!0,c=s||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),c},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,o=n.id,r=n.scheduler,c=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ot(c,this),o!=null&&(this.id=this.recycleAsyncId(r,o,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(St),_=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,o){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(o,n)},t.now=O.now,t}(),kt=function(t){E(e,t);function e(n,o){o===void 0&&(o=_.now);var r=t.call(this,n,o)||this;return r.actions=[],r._active=!1,r._scheduled=void 0,r}return e.prototype.flush=function(n){var o=this.actions;if(this._active){o.push(n);return}var r;this._active=!0;do if(r=n.execute(n.state,n.delay))break;while(n=o.shift());if(this._active=!1,r){for(;n=o.shift();)n.unsubscribe();throw r}},e}(_),N=new kt(wt),Ct=N;function bt(t){return t instanceof Date&&!isNaN(t)}function At(){return yt(1)}function Et(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return At()(rt(t,it(t)))}function Gt(t,e,n){t===void 0&&(t=0),n===void 0&&(n=Ct);var o=-1;return e!=null&&(at(e)?n=e:o=e),new st(function(r){var c=bt(t)?+t-n.now():t;c<0&&(c=0);var s=0;return n.schedule(function(){r.closed||(r.next(s++),0<=o?this.schedule(void 0,o):r.complete())},c)})}function q(t){return t<=0?function(){return xt}:H(function(e,n){var o=0;e.subscribe(j(n,function(r){++o<=t&&(n.next(r),t<=o&&n.complete())}))})}function Mt(){return H(function(t,e){t.subscribe(j(e,ct))})}function Q(t,e){return e?function(n){return Et(e.pipe(q(1),Mt()),n.pipe(Q(t)))}:ut(function(n,o){return t(n,o).pipe(q(1),gt(n))})}function Rt(t,e){e===void 0&&(e=N);var n=Gt(t,e);return Q(function(){return n})}const b=tt.createContext({left:0,top:0,gridSize:60,chessSize:40}),It=t=>{const{left:e,top:n,gridSize:o}=t,r=e+o/2,c=n+o/2,s=(i,a,u,m)=>`M${r+i*o},${c+a*o} L${r+u*o},${c+m*o}`,d=(i,a)=>{const u=[];let f,y,g,p;return i!=0&&(f=i-.1,y=a-.1-.25,g=i-.1-.25,p=a-.1,u.push(s(f,y,f,p)),u.push(s(f,p,g,p)),y=a+.1+.25,p=a+.1,u.push(s(f,y,f,p)),u.push(s(f,p,g,p))),i!=8&&(f=i+.1,y=a-.1-.25,g=i+.1+.25,p=a-.1,u.push(s(f,y,f,p)),u.push(s(f,p,g,p)),y=a+.1+.25,p=a+.1,u.push(s(f,y,f,p)),u.push(s(f,p,g,p))),u};return[[1,2],[7,2],[1,7],[7,7],[0,3],[2,3],[4,3],[6,3],[8,3],[0,6],[2,6],[4,6],[6,6],[8,6]].map(([i,a])=>d(i,a)).reduce((i,a)=>i.concat(a),[]).concat(new Array(8).fill(0).map((i,a)=>s(0,a+1,8,a+1))).concat(new Array(7).fill(0).map((i,a)=>s(a+1,0,a+1,4))).concat(new Array(7).fill(0).map((i,a)=>s(a+1,5,a+1,9))).concat([s(3,0,5,2),s(5,0,3,2),s(3,7,5,9),s(3,9,5,7)])},zt=()=>{const t=C.exports.useContext(b),{left:e,top:n,gridSize:o,chessSize:r}=t,c=e+o/2,s=n+o/2,d=o*8,l=o*9,i=It(t),a={position:"absolute",left:0,top:0,width:d+r,height:l+r};return h("svg",{xmlns:"http://www.w3.org/2000/svg",style:a,children:$("g",{children:[h("rect",{x:c,y:s,width:d,height:l,fill:"none",stroke:"#000000",strokeWidth:"3"}),i.map((u,m)=>h("path",{fill:"none",stroke:"#000000",d:u},m))]})})};var v=(t=>(t[t.General=100]="General",t[t.Chariot=50]="Chariot",t[t.Cannon=30]="Cannon",t[t.Horse=29]="Horse",t[t.Elephant=16]="Elephant",t[t.Guard=10]="Guard",t[t.Soldier=1]="Soldier",t))(v||{}),k=(t=>(t[t.Red=1]="Red",t[t.Black=-1]="Black",t))(k||{});const Pt=(t,e)=>t.x===e.x&&t.y===e.y,Ft=(t,{x:e,y:n})=>{switch(t){case-1:return!(e<3||e>5||n>2&&n<7);case 1:return!(e<3||e>5||n>2&&n<7)}},Dt=(t,{x:e,y:n})=>{switch(t){case-1:return[[3,0],[3,2],[5,0],[5,2],[4,1]].find(([o,r])=>o===e&&r===n);case 1:return[[3,7],[3,9],[5,7],[5,9],[4,8]].find(([o,r])=>o===e&&r===n)}},_t=(t,{x:e,y:n})=>{switch(t){case-1:return[[0,2],[2,0],[2,4],[4,2],[6,0],[6,4],[8,2]].find(([o,r])=>o===e&&r===n);case 1:return[[0,7],[2,5],[2,9],[4,7],[6,5],[6,9],[8,7]].find(([o,r])=>o===e&&r===n)}},qt=(t,{x:e,y:n})=>{switch(t){case-1:return!(n<3||n<5&&e%2===1);case 1:return!(n>6||n>4&&e%2===1)}},Bt=t=>({position:e},{x:n,y:o})=>{if(e.x!==n&&e.y!==o)return!1;if(t.situation.find(r=>r.position.x===n&&r.position.y===o)){if(e.y===o)return t.situation.filter(r=>r.position.y===o&&(r.position.x-n)*(r.position.x-e.x)<0).length===1;if(e.x===n)return t.situation.filter(r=>r.position.x===n&&(r.position.y-o)*(r.position.y-e.y)<0).length===1}return!1},Wt=()=>({position:t},{x:e,y:n})=>Math.abs(t.y-n)+Math.abs(t.x-e)===1,Yt=()=>({position:t},{x:e,y:n})=>{const o=r=>r*r;return o(t.x-e)+o(t.y-n)===2},$t=t=>({position:e},{x:n,y:o})=>Math.abs(e.x-n)!==2||Math.abs(e.y-o)!==2?!1:!t.situation.find(r=>r.position.x===(e.x+n)/2&&r.position.y===(e.y+o)/2),Ht=t=>({position:e},{x:n,y:o})=>{const r=e.x-n,c=e.y-o;return r*r+c*c===5&&!t.situation.find(s=>s.position.x===Math.round((2*e.x+n)/3)&&s.position.y===Math.round((2*e.y+o)/3))},B=t=>({position:e},{x:n,y:o})=>e.x!==n&&e.y!==o?!1:e.y===o?!t.situation.find(r=>r.position.y===o&&(r.position.x-n)*(r.position.x-e.x)<0):e.x===n?!t.situation.find(r=>r.position.x===n&&(r.position.y-o)*(r.position.y-e.y)<0):!1,jt=()=>({position:t,color:e},{x:n,y:o})=>{switch(e){case-1:return o>=t.y&&Math.abs(n-t.x)+Math.abs(o-t.y)===1;case 1:return o<=t.y&&Math.abs(n-t.x)+Math.abs(o-t.y)===1}},G=t=>(e,n)=>{const{color:o,value:r}=e;switch(r){case 100:return Ft(o,n)&&Wt()(e,n);case 10:return Dt(o,n)&&Yt()(e,n);case 16:return _t(o,n)&&$t(t)(e,n);case 29:return Ht(t)(e,n);case 50:return B(t)(e,n);case 30:return B(t)(e,n);case 1:return qt(o,n)&&jt()(e,n)}},X=t=>(e,n)=>e.color===n.color?!1:e.value===30?Bt(t)(e,n.position):t.situation.find(o=>Pt(o.position,n.position))&&G(t)(e,n.position),Lt=t=>w(S({},t),{selected:!0}),M=t=>w(S({},t),{selected:!1}),Ot=t=>w(S({},t),{marked:!0}),R=t=>w(S({},t),{marked:!1}),T=t=>e=>w(S({},e),{position:t}),Nt=t=>e=>{const{currentPlayer:n,situation:o}=e,{x:r,y:c}=t;let s;const d=o.map(i=>R(M(i))).map(i=>i.position.x===r&&i.position.y===c?(s=Lt(i),s):i).map(i=>X(e)(s,i)?Ot(i):i),l=new Array(90).fill(null).map((i,a)=>{const u=a%9,m=(a-u)/9;return{x:u,y:m}}).filter(i=>G(e)(s,i));return{currentPlayer:n,selectedChess:s,situation:d,markers:l}},Qt=t=>e=>{const{currentPlayer:n,situation:o,selectedChess:r}=e;if(r&&G(e)(r,t)){const{x:c,y:s}=r.position,d=o.map(l=>l.position.x===c&&l.position.y===s?T(t)(l):l).map(l=>R(M(l)));return{currentPlayer:-n,selectedChess:void 0,situation:d,markers:[]}}return e},Xt=t=>e=>{const{currentPlayer:n,situation:o,selectedChess:r}=e,c=o.find(s=>s.position.x===t.x&&s.position.y===t.y);if(r&&c&&X(e)(r,c)){const{x:s,y:d}=r.position,l=o.map(i=>i.position.x===s&&i.position.y===d?T(t)(i):i.position.x===t.x&&i.position.y===t.y?null:i).filter(i=>!!i).map(i=>R(M(i)));return{currentPlayer:-n,selectedChess:void 0,situation:l,markers:[]}}return e},Tt=t=>t.some(o=>o.color===1&&o.value===100)?t.some(o=>o.color===-1&&o.value===100)?"playing":"red-win":"black-win",Jt=[{color:-1,value:50,position:{x:0,y:0}},{color:-1,value:29,position:{x:1,y:0}},{color:-1,value:16,position:{x:2,y:0}},{color:-1,value:10,position:{x:3,y:0}},{color:-1,value:100,position:{x:4,y:0}},{color:-1,value:10,position:{x:5,y:0}},{color:-1,value:16,position:{x:6,y:0}},{color:-1,value:29,position:{x:7,y:0}},{color:-1,value:50,position:{x:8,y:0}},{color:-1,value:30,position:{x:1,y:2}},{color:-1,value:30,position:{x:7,y:2}},{color:-1,value:1,position:{x:0,y:3}},{color:-1,value:1,position:{x:2,y:3}},{color:-1,value:1,position:{x:4,y:3}},{color:-1,value:1,position:{x:6,y:3}},{color:-1,value:1,position:{x:8,y:3}},{color:1,value:1,position:{x:0,y:6}},{color:1,value:1,position:{x:2,y:6}},{color:1,value:1,position:{x:4,y:6}},{color:1,value:1,position:{x:6,y:6}},{color:1,value:1,position:{x:8,y:6}},{color:1,value:30,position:{x:1,y:7}},{color:1,value:30,position:{x:7,y:7}},{color:1,value:50,position:{x:0,y:9}},{color:1,value:29,position:{x:1,y:9}},{color:1,value:16,position:{x:2,y:9}},{color:1,value:10,position:{x:3,y:9}},{color:1,value:100,position:{x:4,y:9}},{color:1,value:10,position:{x:5,y:9}},{color:1,value:16,position:{x:6,y:9}},{color:1,value:29,position:{x:7,y:9}},{color:1,value:50,position:{x:8,y:9}}],Kt=L.domain({name:"GameDomain",impl:t=>{const e={currentPlayer:1,selectedChess:void 0,situation:Jt,markers:[]},n=t.state({name:"Game",default:e}),o=n.query,r=t.query({name:"gameStatus",impl:({get:a})=>{const{situation:u}=a(o());return Tt(u)}}),c=t.event({name:"gameOverEvent"}),s=t.event({name:"notYourMoveEvent"}),d=t.command({name:"resetGameState",impl:()=>n().new(e)}),l=t.command({name:"selectChess",impl({get:a},u){if(a(r())!=="playing")return c();const x=a(n()),{currentPlayer:f,selectedChess:y}=x;return u.color===f?[n().new(Nt(u.position)(x))]:y?[n().new(Xt(u.position)(x))]:[s()]}}),i=t.command({name:"moveChess",impl({get:a},u){if(a(r())!=="playing")return c();const x=a(n()),{selectedChess:f}=x;return f?[n().new(Qt(u)(x))]:[s()]}});return t.command$({name:"checkGameStatus",impl:({fromQuery:a})=>a(r()).pipe(mt(u=>u!=="playing"),Rt(100),lt(()=>c()))}),{query:{gameState:o,gameStatus:r},command:{selectChess:l,moveChess:i,resetGameState:d},event:{notYourMoveEvent:s,gameOverEvent:c}}}}),W=t=>({[k.Red]:"red",[k.Black]:"black"})[t],Ut=(t,e)=>({[k.Red]:{[v.General]:"\u5E05",[v.Guard]:"\u4ED5",[v.Elephant]:"\u76F8",[v.Horse]:"\u99AC",[v.Chariot]:"\u8ECA",[v.Cannon]:"\u70AE",[v.Soldier]:"\u5175"},[k.Black]:{[v.General]:"\u5C06",[v.Guard]:"\u58EB",[v.Elephant]:"\u8C61",[v.Horse]:"\u9A6C",[v.Chariot]:"\u8F66",[v.Cannon]:"\u7832",[v.Soldier]:"\u5352"}})[t][e],Zt=t=>{const{chess:e,onClick:n}=t,{color:o,value:r,position:{x:c,y:s},selected:d,marked:l}=e,{chessSize:i,gridSize:a,left:u,top:m}=C.exports.useContext(b),x={position:"absolute",zIndex:10,backgroundColor:"white",fontSize:26,textAlign:"center",borderWidth:2,width:i,height:i,left:u+c*a+(a-i)/2-2,top:m+s*a+(a-i)/2-2,borderStyle:d?"dashed":"solid",borderColor:l?"aqua":W(o),borderRadius:i/2+1,color:W(o)};return h("div",{onClick:()=>n(e),style:x,children:Ut(o,r)})},Vt=t=>{const{marker:e,onClick:n}=t,{x:o,y:r}=e,{chessSize:c,gridSize:s,left:d,top:l}=C.exports.useContext(b),i={position:"absolute",borderWidth:2,borderStyle:"dashed",borderColor:"green",backgroundColor:"white",width:c/2,height:c/2,left:d+o*s+c/4+(s-c)/2-2,top:l+r*s+c/4+(s-c)/2-2};return h("div",{onClick:()=>n(e),style:i})},te=()=>{const{left:t,top:e,gridSize:n}=C.exports.useContext(b),o=dt(Kt()),r=ft(o.query.gameState());D(o.event.notYourMoveEvent,()=>{alert("\u4E0D\u8BE5\u4F60\u8D70")}),D(o.event.gameOverEvent,()=>{window.confirm("\u6E38\u620F\u7ED3\u675F\uFF0C\u662F\u5426\u91CD\u65B0\u5F00\u59CB\uFF1F")&&o.command.resetGameState()});const c={width:t+9*n,height:e+10*n},{situation:s,markers:d}=r;return $("div",{style:c,children:[h(zt,{}),s.map((l,i)=>h(Zt,{chess:l,onClick:()=>o.command.selectChess(l)},i)),d.map((l,i)=>h(Vt,{marker:l,onClick:()=>o.command.moveChess(l)},i))]})},Y=document.getElementById("root");if(Y){const t=et(Y),e=L.store({inspectors:[pt(),vt({include:["command","query","event","domain","command$","state"]})]});t.render(h(C.exports.StrictMode,{children:h(ht,{store:e,children:h(b.Provider,{value:{left:0,top:0,gridSize:60,chessSize:40},children:h(te,{})})})}))}
//# sourceMappingURL=index.5f3832ca.js.map
