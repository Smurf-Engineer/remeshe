import{r as R,a as K,j as tr,F as ge}from"./jsx-runtime.bdd3bf05.js";var Ne=function(r,t,o,s){var a=o?o.call(s,r,t):void 0;if(a!==void 0)return!!a;if(r===t)return!0;if(typeof r!="object"||!r||typeof t!="object"||!t)return!1;var c=Object.keys(r),l=Object.keys(t);if(c.length!==l.length)return!1;for(var m=Object.prototype.hasOwnProperty.bind(t),d=0;d<c.length;d++){var h=c[d];if(!m(h))return!1;var y=r[h],v=t[h];if(a=o?o.call(s,y,v,h):void 0,a===!1||a===void 0&&y!==v)return!1}return!0};/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function ze(e){return Object.prototype.toString.call(e)==="[object Object]"}function Ke(e){var r,t;return ze(e)===!1?!1:(r=e.constructor,r===void 0?!0:(t=r.prototype,!(ze(t)===!1||t.hasOwnProperty("isPrototypeOf")===!1)))}let rr=0;function Be(e){var o;const r=rr++,t=s=>({type:"RemeshEventAction",arg:s,Event:t});return t.type="RemeshEvent",t.eventId=r,t.eventName=e.name,t.owner=ne(),t.inspectable="inspectable"in e&&(o=e.inspectable)!=null?o:!0,t.toSubscribeOnlyEvent=()=>qe(t),"impl"in e&&(t.impl=e.impl),t}const Ye=new WeakMap,Ae=new WeakMap,qe=e=>{const r=Ye.get(e);if(r)return r;const t={type:"RemeshSubscribeOnlyEvent",eventId:e.eventId,eventName:e.eventName};return Ye.set(e,t),Ae.set(t,e),t},He=e=>{const r=Ae.get(e);if(r)return r;throw new Error(`SubscribeOnlyEvent ${e.eventName} does not have an associated Event`)},he=Symbol("DefaultStateValue");let nr=0;const et=(e,r)=>Ke(e)&&Ke(r)||Array.isArray(e)&&Array.isArray(r)?Ne(e,r):e===r,tt=e=>{var s,a;const r=nr++;let t=null;const o=()=>{if(t)return t;const c={type:"RemeshStateItem",State:o,new:l=>({type:"RemeshStateItemUpdatePayload",value:l,stateItem:c})};return t=c,c};return o.type="RemeshState",o.stateId=r,o.stateName=e.name,"default"in e?o.default=e.default:e.defer&&(o.default=he),o.compare=(s=e.compare)!=null?s:et,o.owner=ne(),o.inspectable=(a=e.inspectable)!=null?a:!0,o};let or=0;const rt=e=>{var s,a;const r=or++;let t=null;const o=c=>{if(c===void 0&&t)return t;const l={type:"RemeshQueryAction",Query:o,arg:c};return c===void 0&&(t=l),l};return o.type="RemeshQuery",o.queryId=r,o.queryName=e.name,o.impl=e.impl,o.compare=(s=e.compare)!=null?s:et,o.owner=ne(),o.inspectable=(a=e.inspectable)!=null?a:!0,o.onError=e.onError,o.changed=c=>{if(M.changed.has(o))return M.changed.get(o).add(c);const l=new Set;return M.changed.set(o,l),l.add(c),l},o};let sr=0;const M={before:new WeakMap,after:new WeakMap,changed:new WeakMap},le=(e,r)=>M[r].get(e),nt=e=>{var o;const r=sr++,t=s=>({type:"RemeshCommandAction",arg:s,Command:t});return t.type="RemeshCommand",t.commandId=r,t.commandName=e.name,t.impl=e.impl,t.owner=ne(),t.inspectable=(o=e.inspectable)!=null?o:!0,t.before=s=>{if(M.before.has(t))return M.before.get(t).add(s);const a=new Set;return M.before.set(t,a),a.add(s),a},t.after=s=>{if(M.after.has(t))return M.after.get(t).add(s);const a=new Set;return M.after.set(t,a),a.add(s),a},t};let ar=0;const ir=e=>{const r={type:"RemeshExtern",externId:ar++,default:e.default,impl:t=>({type:"RemeshExternImpl",Extern:r,value:t})};return r},ot=e=>{const r={};if(e.event){const t={};for(const o in e.event){const s=e.event[o];s.type==="RemeshSubscribeOnlyEvent"?t[o]=s:t[o]=qe(s)}r.event=t}return e.query&&(r.query=e.query),e.command&&(r.command=e.command),r},cr=e=>ot(e);let ur=0;const we=e=>{var o;let r=null;const t=s=>{if(s===void 0&&r)return r;const a={type:"RemeshDomainAction",Domain:t,arg:s};return s===void 0&&(r=a),a};return t.type="RemeshDomain",t.domainId=ur++,t.domainName=e.name,t.impl=e.impl,t.inspectable=(o=e.inspectable)!=null?o:!0,t},ne=we({name:"DefaultDomain",impl:()=>({})});var ye=function(e,r){return ye=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(t[s]=o[s])},ye(e,r)};function Y(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");ye(e,r);function t(){this.constructor=e}e.prototype=r===null?Object.create(r):(t.prototype=r.prototype,new t)}function fr(e,r,t,o){function s(a){return a instanceof t?a:new t(function(c){c(a)})}return new(t||(t=Promise))(function(a,c){function l(h){try{d(o.next(h))}catch(y){c(y)}}function m(h){try{d(o.throw(h))}catch(y){c(y)}}function d(h){h.done?a(h.value):s(h.value).then(l,m)}d((o=o.apply(e,r||[])).next())})}function st(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},o,s,a,c;return c={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function l(d){return function(h){return m([d,h])}}function m(d){if(o)throw new TypeError("Generator is already executing.");for(;c&&(c=0,d[0]&&(t=0)),t;)try{if(o=1,s&&(a=d[0]&2?s.return:d[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,d[1])).done)return a;switch(s=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,s=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){t.label=d[1];break}if(d[0]===6&&t.label<a[1]){t.label=a[1],a=d;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(d);break}a[2]&&t.ops.pop(),t.trys.pop();continue}d=r.call(e,t)}catch(h){d=[6,h],s=0}finally{o=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function V(e){var r=typeof Symbol=="function"&&Symbol.iterator,t=r&&e[r],o=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function te(e,r){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var o=t.call(e),s,a=[],c;try{for(;(r===void 0||r-- >0)&&!(s=o.next()).done;)a.push(s.value)}catch(l){c={error:l}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(c)throw c.error}}return a}function re(e,r,t){if(t||arguments.length===2)for(var o=0,s=r.length,a;o<s;o++)(a||!(o in r))&&(a||(a=Array.prototype.slice.call(r,0,o)),a[o]=r[o]);return e.concat(a||Array.prototype.slice.call(r))}function j(e){return this instanceof j?(this.v=e,this):new j(e)}function lr(e,r,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=t.apply(e,r||[]),s,a=[];return s={},c("next"),c("throw"),c("return"),s[Symbol.asyncIterator]=function(){return this},s;function c(v){o[v]&&(s[v]=function(C){return new Promise(function(U,D){a.push([v,C,U,D])>1||l(v,C)})})}function l(v,C){try{m(o[v](C))}catch(U){y(a[0][3],U)}}function m(v){v.value instanceof j?Promise.resolve(v.value.v).then(d,h):y(a[0][2],v)}function d(v){l("next",v)}function h(v){l("throw",v)}function y(v,C){v(C),a.shift(),a.length&&l(a[0][0],a[0][1])}}function dr(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e[Symbol.asyncIterator],t;return r?r.call(e):(e=typeof V=="function"?V(e):e[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(a){t[a]=e[a]&&function(c){return new Promise(function(l,m){c=e[a](c),s(l,m,c.done,c.value)})}}function s(a,c,l,m){Promise.resolve(m).then(function(d){a({value:d,done:l})},c)}}function x(e){return typeof e=="function"}function at(e){var r=function(o){Error.call(o),o.stack=new Error().stack},t=e(r);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var de=at(function(e){return function(t){e(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(o,s){return s+1+") "+o.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function ve(e,r){if(e){var t=e.indexOf(r);0<=t&&e.splice(t,1)}}var H=function(){function e(r){this.initialTeardown=r,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var r,t,o,s,a;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var l=V(c),m=l.next();!m.done;m=l.next()){var d=m.value;d.remove(this)}}catch(D){r={error:D}}finally{try{m&&!m.done&&(t=l.return)&&t.call(l)}finally{if(r)throw r.error}}else c.remove(this);var h=this.initialTeardown;if(x(h))try{h()}catch(D){a=D instanceof de?D.errors:[D]}var y=this._finalizers;if(y){this._finalizers=null;try{for(var v=V(y),C=v.next();!C.done;C=v.next()){var U=C.value;try{Ge(U)}catch(D){a=a!=null?a:[],D instanceof de?a=re(re([],te(a)),te(D.errors)):a.push(D)}}}catch(D){o={error:D}}finally{try{C&&!C.done&&(s=v.return)&&s.call(v)}finally{if(o)throw o.error}}}if(a)throw new de(a)}},e.prototype.add=function(r){var t;if(r&&r!==this)if(this.closed)Ge(r);else{if(r instanceof e){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(r)}},e.prototype._hasParent=function(r){var t=this._parentage;return t===r||Array.isArray(t)&&t.includes(r)},e.prototype._addParent=function(r){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(r),t):t?[t,r]:r},e.prototype._removeParent=function(r){var t=this._parentage;t===r?this._parentage=null:Array.isArray(t)&&ve(t,r)},e.prototype.remove=function(r){var t=this._finalizers;t&&ve(t,r),r instanceof e&&r._removeParent(this)},e.EMPTY=function(){var r=new e;return r.closed=!0,r}(),e}(),it=H.EMPTY;function ct(e){return e instanceof H||e&&"closed"in e&&x(e.remove)&&x(e.add)&&x(e.unsubscribe)}function Ge(e){x(e)?e():e.unsubscribe()}var oe={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Se={setTimeout:function(e,r){for(var t=[],o=2;o<arguments.length;o++)t[o-2]=arguments[o];var s=Se.delegate;return s!=null&&s.setTimeout?s.setTimeout.apply(s,re([e,r],te(t))):setTimeout.apply(void 0,re([e,r],te(t)))},clearTimeout:function(e){var r=Se.delegate;return((r==null?void 0:r.clearTimeout)||clearTimeout)(e)},delegate:void 0};function ut(e){Se.setTimeout(function(){var r=oe.onUnhandledError;if(r)r(e);else throw e})}function Je(){}var B=null;function q(e){if(oe.useDeprecatedSynchronousErrorHandling){var r=!B;if(r&&(B={errorThrown:!1,error:null}),e(),r){var t=B,o=t.errorThrown,s=t.error;if(B=null,o)throw s}}else e()}var Ee=function(e){Y(r,e);function r(t){var o=e.call(this)||this;return o.isStopped=!1,t?(o.destination=t,ct(t)&&t.add(o)):o.destination=yr,o}return r.create=function(t,o,s){return new be(t,o,s)},r.prototype.next=function(t){this.isStopped||this._next(t)},r.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},r.prototype._next=function(t){this.destination.next(t)},r.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},r.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},r}(H),mr=Function.prototype.bind;function me(e,r){return mr.call(e,r)}var pr=function(){function e(r){this.partialObserver=r}return e.prototype.next=function(r){var t=this.partialObserver;if(t.next)try{t.next(r)}catch(o){A(o)}},e.prototype.error=function(r){var t=this.partialObserver;if(t.error)try{t.error(r)}catch(o){A(o)}else A(r)},e.prototype.complete=function(){var r=this.partialObserver;if(r.complete)try{r.complete()}catch(t){A(t)}},e}(),be=function(e){Y(r,e);function r(t,o,s){var a=e.call(this)||this,c;if(x(t)||!t)c={next:t!=null?t:void 0,error:o!=null?o:void 0,complete:s!=null?s:void 0};else{var l;a&&oe.useDeprecatedNextContext?(l=Object.create(t),l.unsubscribe=function(){return a.unsubscribe()},c={next:t.next&&me(t.next,l),error:t.error&&me(t.error,l),complete:t.complete&&me(t.complete,l)}):c=t}return a.destination=new pr(c),a}return r}(Ee);function A(e){ut(e)}function hr(e){throw e}var yr={closed:!0,next:Je,error:hr,complete:Je},Re=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function vr(e){return e}function Sr(e){return e.length===0?vr:e.length===1?e[0]:function(t){return e.reduce(function(o,s){return s(o)},t)}}var I=function(){function e(r){r&&(this._subscribe=r)}return e.prototype.lift=function(r){var t=new e;return t.source=this,t.operator=r,t},e.prototype.subscribe=function(r,t,o){var s=this,a=gr(r)?r:new be(r,t,o);return q(function(){var c=s,l=c.operator,m=c.source;a.add(l?l.call(a,m):m?s._subscribe(a):s._trySubscribe(a))}),a},e.prototype._trySubscribe=function(r){try{return this._subscribe(r)}catch(t){r.error(t)}},e.prototype.forEach=function(r,t){var o=this;return t=Xe(t),new t(function(s,a){var c=new be({next:function(l){try{r(l)}catch(m){a(m),c.unsubscribe()}},error:a,complete:s});o.subscribe(c)})},e.prototype._subscribe=function(r){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(r)},e.prototype[Re]=function(){return this},e.prototype.pipe=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return Sr(r)(this)},e.prototype.toPromise=function(r){var t=this;return r=Xe(r),new r(function(o,s){var a;t.subscribe(function(c){return a=c},function(c){return s(c)},function(){return o(a)})})},e.create=function(r){return new e(r)},e}();function Xe(e){var r;return(r=e!=null?e:oe.Promise)!==null&&r!==void 0?r:Promise}function br(e){return e&&x(e.next)&&x(e.error)&&x(e.complete)}function gr(e){return e&&e instanceof Ee||br(e)&&ct(e)}function wr(e){return x(e==null?void 0:e.lift)}function xe(e){return function(r){if(wr(r))return r.lift(function(t){try{return e(t,this)}catch(o){this.error(o)}});throw new TypeError("Unable to lift unknown Observable type")}}function ft(e,r,t,o,s){return new Er(e,r,t,o,s)}var Er=function(e){Y(r,e);function r(t,o,s,a,c,l){var m=e.call(this,t)||this;return m.onFinalize=c,m.shouldUnsubscribe=l,m._next=o?function(d){try{o(d)}catch(h){t.error(h)}}:e.prototype._next,m._error=a?function(d){try{a(d)}catch(h){t.error(h)}finally{this.unsubscribe()}}:e.prototype._error,m._complete=s?function(){try{s()}catch(d){t.error(d)}finally{this.unsubscribe()}}:e.prototype._complete,m}return r.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var o=this.closed;e.prototype.unsubscribe.call(this),!o&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},r}(Ee),Rr=at(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),ee=function(e){Y(r,e);function r(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return r.prototype.lift=function(t){var o=new Ze(this,this);return o.operator=t,o},r.prototype._throwIfClosed=function(){if(this.closed)throw new Rr},r.prototype.next=function(t){var o=this;q(function(){var s,a;if(o._throwIfClosed(),!o.isStopped){o.currentObservers||(o.currentObservers=Array.from(o.observers));try{for(var c=V(o.currentObservers),l=c.next();!l.done;l=c.next()){var m=l.value;m.next(t)}}catch(d){s={error:d}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(s)throw s.error}}}})},r.prototype.error=function(t){var o=this;q(function(){if(o._throwIfClosed(),!o.isStopped){o.hasError=o.isStopped=!0,o.thrownError=t;for(var s=o.observers;s.length;)s.shift().error(t)}})},r.prototype.complete=function(){var t=this;q(function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var o=t.observers;o.length;)o.shift().complete()}})},r.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(r.prototype,"observed",{get:function(){var t;return((t=this.observers)===null||t===void 0?void 0:t.length)>0},enumerable:!1,configurable:!0}),r.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},r.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},r.prototype._innerSubscribe=function(t){var o=this,s=this,a=s.hasError,c=s.isStopped,l=s.observers;return a||c?it:(this.currentObservers=null,l.push(t),new H(function(){o.currentObservers=null,ve(l,t)}))},r.prototype._checkFinalizedStatuses=function(t){var o=this,s=o.hasError,a=o.thrownError,c=o.isStopped;s?t.error(a):c&&t.complete()},r.prototype.asObservable=function(){var t=new I;return t.source=this,t},r.create=function(t,o){return new Ze(t,o)},r}(I),Ze=function(e){Y(r,e);function r(t,o){var s=e.call(this)||this;return s.destination=t,s.source=o,s}return r.prototype.next=function(t){var o,s;(s=(o=this.destination)===null||o===void 0?void 0:o.next)===null||s===void 0||s.call(o,t)},r.prototype.error=function(t){var o,s;(s=(o=this.destination)===null||o===void 0?void 0:o.error)===null||s===void 0||s.call(o,t)},r.prototype.complete=function(){var t,o;(o=(t=this.destination)===null||t===void 0?void 0:t.complete)===null||o===void 0||o.call(t)},r.prototype._subscribe=function(t){var o,s;return(s=(o=this.source)===null||o===void 0?void 0:o.subscribe(t))!==null&&s!==void 0?s:it},r}(ee),lt=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function dt(e){return x(e==null?void 0:e.then)}function mt(e){return x(e[Re])}function pt(e){return Symbol.asyncIterator&&x(e==null?void 0:e[Symbol.asyncIterator])}function ht(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function xr(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var yt=xr();function vt(e){return x(e==null?void 0:e[yt])}function St(e){return lr(this,arguments,function(){var t,o,s,a;return st(this,function(c){switch(c.label){case 0:t=e.getReader(),c.label=1;case 1:c.trys.push([1,,9,10]),c.label=2;case 2:return[4,j(t.read())];case 3:return o=c.sent(),s=o.value,a=o.done,a?[4,j(void 0)]:[3,5];case 4:return[2,c.sent()];case 5:return[4,j(s)];case 6:return[4,c.sent()];case 7:return c.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function bt(e){return x(e==null?void 0:e.getReader)}function Ce(e){if(e instanceof I)return e;if(e!=null){if(mt(e))return Cr(e);if(lt(e))return Dr(e);if(dt(e))return Or(e);if(pt(e))return gt(e);if(vt(e))return kr(e);if(bt(e))return Ir(e)}throw ht(e)}function Cr(e){return new I(function(r){var t=e[Re]();if(x(t.subscribe))return t.subscribe(r);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Dr(e){return new I(function(r){for(var t=0;t<e.length&&!r.closed;t++)r.next(e[t]);r.complete()})}function Or(e){return new I(function(r){e.then(function(t){r.closed||(r.next(t),r.complete())},function(t){return r.error(t)}).then(null,ut)})}function kr(e){return new I(function(r){var t,o;try{for(var s=V(e),a=s.next();!a.done;a=s.next()){var c=a.value;if(r.next(c),r.closed)return}}catch(l){t={error:l}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(t)throw t.error}}r.complete()})}function gt(e){return new I(function(r){Qr(e,r).catch(function(t){return r.error(t)})})}function Ir(e){return gt(St(e))}function Qr(e,r){var t,o,s,a;return fr(this,void 0,void 0,function(){var c,l;return st(this,function(m){switch(m.label){case 0:m.trys.push([0,5,6,11]),t=dr(e),m.label=1;case 1:return[4,t.next()];case 2:if(o=m.sent(),!!o.done)return[3,4];if(c=o.value,r.next(c),r.closed)return[2];m.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return l=m.sent(),s={error:l},[3,11];case 6:return m.trys.push([6,,9,10]),o&&!o.done&&(a=t.return)?[4,a.call(t)]:[3,8];case 7:m.sent(),m.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return r.complete(),[2]}})})}function T(e,r,t,o,s){o===void 0&&(o=0),s===void 0&&(s=!1);var a=r.schedule(function(){t(),s?e.add(this.schedule(null,o)):this.unsubscribe()},o);if(e.add(a),!s)return a}function wt(e,r){return r===void 0&&(r=0),xe(function(t,o){t.subscribe(ft(o,function(s){return T(o,e,function(){return o.next(s)},r)},function(){return T(o,e,function(){return o.complete()},r)},function(s){return T(o,e,function(){return o.error(s)},r)}))})}function Et(e,r){return r===void 0&&(r=0),xe(function(t,o){o.add(e.schedule(function(){return t.subscribe(o)},r))})}function Mr(e,r){return Ce(e).pipe(Et(r),wt(r))}function Pr(e,r){return Ce(e).pipe(Et(r),wt(r))}function _r(e,r){return new I(function(t){var o=0;return r.schedule(function(){o===e.length?t.complete():(t.next(e[o++]),t.closed||this.schedule())})})}function Ur(e,r){return new I(function(t){var o;return T(t,r,function(){o=e[yt](),T(t,r,function(){var s,a,c;try{s=o.next(),a=s.value,c=s.done}catch(l){t.error(l);return}c?t.complete():t.next(a)},0,!0)}),function(){return x(o==null?void 0:o.return)&&o.return()}})}function Rt(e,r){if(!e)throw new Error("Iterable cannot be null");return new I(function(t){T(t,r,function(){var o=e[Symbol.asyncIterator]();T(t,r,function(){o.next().then(function(s){s.done?t.complete():t.next(s.value)})},0,!0)})})}function Tr(e,r){return Rt(St(e),r)}function jr(e,r){if(e!=null){if(mt(e))return Mr(e,r);if(lt(e))return _r(e,r);if(dt(e))return Pr(e,r);if(pt(e))return Rt(e,r);if(vt(e))return Ur(e,r);if(bt(e))return Tr(e,r)}throw ht(e)}function Vr(e,r){return r?jr(e,r):Ce(e)}function Lr(e,r){return xe(function(t,o){var s=0;t.subscribe(ft(o,function(a){o.next(e.call(r,a,s++))}))})}const k={DomainCreated:"Domain::Created",DomainDiscarded:"Domain::Discarded",DomainReused:"Domain::Reused",StateCreated:"State::Created",StateUpdated:"State::Updated",StateDiscarded:"State::Discarded",StateReused:"State::Reused",QueryCreated:"Query::Created",QueryUpdated:"Query::Updated",QueryDiscarded:"Query::Discarded",QueryReused:"Query::Reused",EventEmitted:"Event::Emitted",CommandReceived:"Command::Received"},F=we({name:"RemeshInspectorDomain",impl:e=>{const r=e.event({name:"RemeshDomainStorageEvent"}),t=e.command({name:"RemeshDomainStorageCommand",impl:({},y)=>r(y)}),o=e.event({name:"RemeshStateStorageEvent"}),s=e.command({name:"RemeshStateStorageCommand",impl:({},y)=>o(y)}),a=e.event({name:"RemeshQueryStorageEvent"}),c=e.command({name:"RemeshQueryStorageCommand",impl:({},y)=>a(y)}),l=e.event({name:"RemeshEventEmittedEvent"}),m=e.command({name:"RemeshEventEmittedCommand",impl:({},y)=>l(y)}),d=e.event({name:"RemeshCommandReceivedEvent"}),h=e.command({name:"RemeshCommandReceivedCommand",impl:({},y)=>d(y)});return{command:{RemeshDomainStorageCommand:t,RemeshStateStorageCommand:s,RemeshQueryStorageCommand:c,RemeshEventEmittedCommand:m,RemeshCommandReceivedCommand:h},event:{RemeshDomainStorageEvent:r,RemeshStateStorageEvent:o,RemeshQueryStorageEvent:a,RemeshEventEmittedEvent:l,RemeshCommandReceivedEvent:d}}}}),N=e=>e.owner?e.owner.Domain.inspectable&&e.inspectable:e.inspectable,Wr=e=>{var r;return((r=e.inspectors)!=null?r:[]).filter(t=>!!t).map(t=>{const{inspectors:o,...s}=e;return t(s)})},$r=e=>{let r=null;const t=()=>(r||(r=Wr(e)),r);return{destroyInspectors:()=>{if(r){for(const d of r)d.discard();r=null}},inspectDomainStorage:(d,h)=>{if(N(h.Domain))for(const y of t()){const v=y.getDomain(F());y.send(v.command.RemeshDomainStorageCommand({type:d,storage:h}))}},inspectStateStorage:(d,h)=>{if(N(h.State))for(const y of t()){const v=y.getDomain(F());y.send(v.command.RemeshStateStorageCommand({type:d,storage:h}))}},inspectQueryStorage:(d,h)=>{if(N(h.Query))for(const y of t()){const v=y.getDomain(F());y.send(v.command.RemeshQueryStorageCommand({type:d,storage:h}))}},inspectEventEmitted:(d,h)=>{if(N(h.Event))for(const y of t()){const v=y.getDomain(F());y.send(v.command.RemeshEventEmittedCommand({type:d,action:h}))}},inspectCommandReceived:(d,h)=>{if(N(h.Command))for(const y of t()){const v=y.getDomain(F());y.send(v.command.RemeshCommandReceivedCommand({type:d,action:h}))}}}};let z=0;const xt=e=>{const r={...e},t=$r(r),o=new Set,s=new Set,a=new Set,c=new Map,l=new WeakMap,m=n=>{var i;for(const u of(i=r.externs)!=null?i:[])if(u.Extern===n)return u.value;return n.default},d=n=>{const i=l.get(n);if(i)return i;const u=m(n),f={id:z++,type:"RemeshExternStorage",Extern:n,currentValue:u};return l.set(n,f),f},h=n=>d(n).currentValue,y=new WeakMap,v=n=>{var b;const i=y.get(n);if(i)return i;const u=n.Query.queryName,f=(b=JSON.stringify(n.arg))!=null?b:"",p=`Query/${n.Query.queryId}/${u}:${f}`;return y.set(n,p),p},C=n=>{var b;const i=y.get(n);if(i)return i;const u=n.Domain.domainName,f=(b=JSON.stringify(n.arg))!=null?b:"",p=`Domain/${n.Domain.domainId}/${u}:${f}`;return y.set(n,p),p},U=n=>n.type==="RemeshQueryAction"?v(n):C(n),D=new WeakMap,De=n=>typeof n.default=="function"?n.default():n.default,kt=n=>{const i=E(n.State.owner),u=De(n.State),f={id:z++,type:"RemeshStateStorage",State:n.State,stateItem:n,currentState:u,downstreamSet:new Set};return i.stateMap.set(n,f),D.set(n,f),t.inspectStateStorage(k.StateCreated,f),f},Oe=n=>{const i=E(n.State.owner);i.stateMap.has(n.stateItem)||(n.currentState=De(n.State),i.stateMap.set(n.stateItem,n),t.inspectStateStorage(k.StateReused,n))},G=n=>{const u=E(n.State.owner).stateMap.get(n);if(u)return u;const f=D.get(n);return f?(Oe(f),f):kt(n)},ke=new WeakMap,It=n=>{const i=E(n.owner),u={get:O.get},f=new ee,p=f.pipe(Lr(g=>n.impl?n.impl(u,g):g)),b=ke.get(n),S=Object.assign(b!=null?b:{},{id:z++,type:"RemeshEventStorage",Event:n,subject:f,observable:p,refCount:0});return i.eventMap.set(n,S),ke.set(n,S),S},J=n=>{var f;return(f=E(n.owner).eventMap.get(n))!=null?f:It(n)},Ie=new WeakMap,Qt=n=>{const i=E(n.Query.owner),u=v(n),f=new ee,p=f.asObservable(),b=new Set,S={id:z++,type:"RemeshQueryStorage",Query:n.Query,arg:n.arg,key:u,upstreamSet:b,downstreamSet:new Set,subject:f,observable:p,refCount:0,status:"default",wipUpstreamSet:new Set},{Query:g}=n,w={get:_=>{if(S.upstreamSet!==b)return O.get(_);if(_.type==="RemeshStateItem"){const $=G(_);return S.upstreamSet.add($),$.downstreamSet.add(S),O.get(_)}if(_.type==="RemeshQueryAction"){const $=W(_);return S.upstreamSet.add($),$.downstreamSet.add(S),O.get(_)}return O.get(_)}},Q=g.impl(w,n.arg);return S.currentValue=Q,i.queryMap.set(u,S),Ie.set(n,S),t.inspectQueryStorage(k.QueryCreated,S),S},Qe=n=>{const i=E(n.Query.owner);if(i.queryMap.has(n.key))return;const u=new ee,f=u.asObservable();n.status="default",n.subject=u,n.observable=f,i.queryMap.set(n.key,n);for(const p of n.upstreamSet)if(p.downstreamSet.add(n),p.type==="RemeshQueryStorage")Qe(p);else if(p.type==="RemeshStateStorage")Oe(p);else throw new Error(`Unknown upstream: ${p}`);Ue(n),t.inspectQueryStorage(k.QueryReused,n)},W=n=>{const i=E(n.Query.owner),u=v(n),f=i.queryMap.get(u);if(f)return f;const p=Ie.get(n);return p?(Qe(p),p):Qt(n)},ae=new WeakMap,Mt=n=>{const i=C(n),u=new Set,f={state:S=>{const g=tt(S);return g.owner=n,g},query:S=>{const g=rt(S);return g.owner=n,g},event:S=>{const g=Be(S);return g.owner=n,g},command:S=>{const g=nt(S);return g.owner=n,g},effect:S=>{p.ignited||p.effectList.push(S)},preload:S=>{p.ignited||p.preloadOptionsList.push(S)},getDomain:S=>{const g=E(S);return u.add(g),g.downstreamSet.add(p),p.ignited&&fe(S),g.domain},getExtern:S=>h(S)},p={id:z++,type:"RemeshDomainStorage",Domain:n.Domain,get domain(){return b},arg:n.arg,domainContext:f,domainAction:n,key:i,upstreamSet:u,downstreamSet:new Set,effectList:[],stateMap:new Map,entityMap:new Map,queryMap:new Map,eventMap:new Map,effectMap:new Map,commandMap:new Map,preloadOptionsList:[],preloadedState:{},refCount:0,ignited:!1,hasBeenPreloaded:!1,isDiscarding:!1},b=ot(n.Domain.impl(f,n.arg));return c.set(i,p),ae.set(n,p),t.inspectDomainStorage(k.DomainCreated,p),Pt(p),p},Pt=n=>{if(!(e!=null&&e.preloadedState))return;const i={get:O.get};for(const u of n.preloadOptionsList)if(Object.prototype.hasOwnProperty.call(e.preloadedState,u.key)){const f=e.preloadedState[u.key];P(u.command(i,f))}},E=n=>{const i=C(n),u=c.get(i);if(u)return ae.set(n,u),u;const f=ae.get(n);if(f){f.ignited=!1,f.isDiscarding=!1,c.set(f.key,f);for(const p of f.upstreamSet)p.downstreamSet.add(f);return t.inspectDomainStorage(k.DomainReused,f),f}return Mt(n)},Me=n=>{const i=E(n.Query.owner);if(!!i.queryMap.has(n.key)){i.queryMap.delete(n.key),n.subject.complete(),t.inspectQueryStorage(k.QueryDiscarded,n);for(const u of n.upstreamSet)!u.downstreamSet.has(n)||(u.downstreamSet.delete(n),u.type==="RemeshQueryStorage"&&ie(u));X(i)}},_t=n=>!(n.refCount>0||n.downstreamSet.size!==0),ie=n=>{_t(n)&&Me(n)},Ut=n=>{const i=E(n.State.owner);!i.stateMap.has(n.stateItem)||(i.stateMap.delete(n.stateItem),n.downstreamSet.clear(),t.inspectStateStorage(k.StateDiscarded,n))},Pe=n=>{const i=E(n.Event.owner);n.subject.complete(),i.eventMap.delete(n.Event),X(i)},Tt=n=>!(n.refCount>0),jt=n=>{Tt(n)&&Pe(n)},ce=n=>{if(!n.isDiscarding){n.isDiscarding=!0,n.ignited=!1;for(const i of n.effectMap.values())i.unsubscribe();for(const i of n.eventMap.values())Pe(i);for(const i of n.queryMap.values())Me(i);for(const i of n.stateMap.values())Ut(i);n.downstreamSet.clear(),n.stateMap.clear(),n.queryMap.clear(),n.eventMap.clear(),n.effectMap.clear(),c.delete(n.key),t.inspectDomainStorage(k.DomainDiscarded,n);for(const i of n.upstreamSet)!i.downstreamSet.has(n)||(i.downstreamSet.delete(n),X(i))}},Vt=n=>{if(n.refCount>0||n.isDiscarding||n.downstreamSet.size!==0)return!1;for(const i of n.queryMap.values())if(i.refCount>0)return!1;for(const i of n.eventMap.values())if(i.refCount>0)return!1;return!0},X=n=>{Vt(n)&&ce(n)},Lt=n=>{const i=G(n);if(i.currentState===he)throw new Error(`Unexpected reading domain.state before initializing: ${i.State.stateName}`);return i.currentState},_e=n=>{const i=W(n);return ue(i),i.currentValue},O={get:n=>{if(n.type==="RemeshStateItem")return Lt(n);if(n.type==="RemeshQueryAction")return _e(n);throw new Error(`Unexpected input in ctx.get(..): ${n}`)},fromEvent:n=>{if(n.type==="RemeshEvent")return J(n).observable;if(n.type==="RemeshSubscribeOnlyEvent"){const i=He(n);return J(i).observable}throw new Error(`Unexpected input in fromEvent(..): ${n}`)},fromQuery:n=>W(n).observable},ue=n=>{if(n.status!=="wip")return;if(n.wipUpstreamSet.size!==0){let u=!1;for(const f of n.wipUpstreamSet)if(f.type==="RemeshStateStorage")u=!0;else if(f.type==="RemeshQueryStorage")f.status==="wip"&&ue(f),f.status==="updated"&&(u=!0);else throw new Error(`Unexpected upstream: ${f}`);if(n.wipUpstreamSet.clear(),!u){n.status="default";return}}Ue(n)?n.status="updated":n.status="default"},Ue=n=>{const{Query:i}=n;for(const w of n.upstreamSet)!w.downstreamSet.has(n)||(w.downstreamSet.delete(n),w.downstreamSet.size===0&&w.type!=="RemeshStateStorage"&&a.add(w));const u=new Set;n.upstreamSet=u;const f={get:w=>{if(n.upstreamSet!==u)return O.get(w);if(w.type==="RemeshStateItem"){const Q=G(w);return n.upstreamSet.add(Q),Q.downstreamSet.add(n),O.get(w)}if(w.type==="RemeshQueryAction"){const Q=W(w);return n.upstreamSet.add(Q),Q.downstreamSet.add(n),O.get(w)}return O.get(w)}};let p;const b=n.currentValue;if(!i.onError)p=i.impl(f,n.arg);else try{p=i.impl(f,n.arg)}catch(w){const Q=w instanceof Error?w:new Error(`${w}`);p=i.onError(Q,b)}if(i.compare(b,p))return!1;n.currentValue=p,o.add(n),t.inspectQueryStorage(k.QueryUpdated,n);const g=le(i,"changed");if(g){const w={current:p,previous:b};for(const Q of g)P(Q(Z,w))}return!0},Te=()=>{if(a.size===0)return;const n=[...a];a.clear();for(const i of n)ie(i);Te()},je=()=>{if(o.size===0)return;const n=[...o];o.clear();for(const i of n)o.has(i)||(i.type==="RemeshQueryStorage"?i.subject.next(i.currentValue):i.type==="RemeshEventAction"&&$t(i));je()},Ve=n=>{if(n.status="wip",n.downstreamSet.size>0)for(const i of n.downstreamSet)i.wipUpstreamSet.has(n)||(i.wipUpstreamSet.add(n),Ve(i));else s.add(n)},Le=()=>{if(s.size===0)return;const n=[...s];s.clear();for(const i of n)ue(i);Le()},We=()=>{Le(),Te(),je()},Wt=(n,i)=>{const u=G(n);if(!(u.currentState!==he&&n.State.compare(u.currentState,i))){u.currentState=i,t.inspectStateStorage(k.StateUpdated,u);for(const f of u.downstreamSet)f.wipUpstreamSet.add(u),Ve(f)}},$t=n=>{const{Event:i,arg:u}=n,f=J(i);t.inspectEventEmitted(k.EventEmitted,n),f.subject.next(u)},Z={get:O.get},Ft=n=>{t.inspectCommandReceived(k.CommandReceived,n);const{Command:i,arg:u}=n,f=i.impl,p=le(i,"before");if(p)for(const S of p)P(S(Z,u));P(f(Z,u));const b=le(i,"after");if(b)for(const S of b)P(S(Z,u))},P=n=>{if(!!n)if(Array.isArray(n))for(const i of n)P(i);else n.type==="RemeshCommandAction"?Ft(n):n.type==="RemeshStateItemUpdatePayload"?Wt(n.stateItem,n.value):n.type==="RemeshEventAction"&&o.add(n)},Nt=n=>{const i=E(n),u=new H(()=>{i.refCount-=1,i.refCount===0&&X(i)});return i.refCount+=1,u},zt=(n,i)=>{const u=W(n),f=new I(p=>{const b=u.subject.subscribe(p);return u.refCount+=1,()=>{u.refCount-=1,b.unsubscribe(),u.refCount===0&&ie(u)}});return f.subscribe(i)},$e=(n,i)=>{if(n.type==="RemeshEvent"){const u=J(n);return new I(b=>{const S=u.observable.subscribe(b);return u.refCount+=1,()=>{u.refCount-=1,S.unsubscribe(),u.refCount===0&&jt(u)}}).subscribe(i)}else if(n.type==="RemeshSubscribeOnlyEvent"){const u=He(n);return $e(u,i)}throw new Error(`Unknown event type of ${n}`)},Kt=n=>E(n).domain,Yt={get:O.get,fromEvent:O.fromEvent,fromQuery:O.fromQuery},Ht=n=>{P(n),We()},fe=n=>{const i=E(n);if(!i.ignited){i.ignited=!0;for(const u of i.upstreamSet)fe(u.domainAction);for(const u of i.effectList){const f=u.impl(Yt);if(f===null)continue;const p=Vr(f).subscribe(Ht);i.effectMap.set(u,p)}}},Gt=n=>{const i=E(n);ce(i)},Jt=()=>{t.destroyInspectors();for(const n of c.values())ce(n);c.clear(),o.clear()},Fe=n=>{const i=E(n);if(i.ignited)throw new Error(`Domain ${n.Domain.domainName} was ignited before preloading`);if(i.preloadedPromise)return i.preloadedPromise;const u=Bt(n);return i.preloadedPromise=u,u},Xt={get:O.get},Zt={get:O.get},Bt=async n=>{const i=E(n);i.hasBeenPreloaded||(i.hasBeenPreloaded=!0,await Promise.all(Array.from(i.upstreamSet).map(u=>Fe(u.domainAction))),await Promise.all(i.preloadOptionsList.map(async u=>{const f=await u.query(Zt);if(Object.prototype.hasOwnProperty.call(i.preloadedState,u.key))throw new Error(`Duplicate key ${u.key}`);i.preloadedState[u.key]=f;const p=u.command(Xt,f);P(p)})))},At=()=>{const n={};for(const i of c.values())Object.assign(n,i.preloadedState);return n},qt=n=>E(n).preloadedState,er=n=>{P(n),We()};return{name:r.name,getDomain:Kt,igniteDomain:fe,discardDomain:Gt,query:_e,send:er,discard:Jt,preload:Fe,getPreloadedState:At,getDomainPreloadedState:qt,subscribeDomain:Nt,subscribeQuery:zt,subscribeEvent:$e,getKey:U}},tn={domain:we,extern:ir,store:xt,state:tt,query:rt,command:nt,event:Be,module:cr};var Ct={exports:{}},Dt={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var L=R.exports;function Fr(e,r){return e===r&&(e!==0||1/e===1/r)||e!==e&&r!==r}var Nr=typeof Object.is=="function"?Object.is:Fr,zr=L.useState,Kr=L.useEffect,Yr=L.useLayoutEffect,Hr=L.useDebugValue;function Gr(e,r){var t=r(),o=zr({inst:{value:t,getSnapshot:r}}),s=o[0].inst,a=o[1];return Yr(function(){s.value=t,s.getSnapshot=r,pe(s)&&a({inst:s})},[e,t,r]),Kr(function(){return pe(s)&&a({inst:s}),e(function(){pe(s)&&a({inst:s})})},[e]),Hr(t),t}function pe(e){var r=e.getSnapshot;e=e.value;try{var t=r();return!Nr(e,t)}catch{return!0}}function Jr(e,r){return r()}var Xr=typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"?Jr:Gr;Dt.useSyncExternalStore=L.useSyncExternalStore!==void 0?L.useSyncExternalStore:Xr;Ct.exports=Dt;const Ot=R.exports.createContext(null),Zr=()=>{const e=R.exports.useContext(Ot);if(e===null)throw new Error("You may forget to add <RemeshRoot />");return e},se=()=>Zr().remeshStore,rn=e=>{const r=R.exports.useRef(e.store);r.current||(r.current=xt("options"in e?e.options:{}));const t=r.current,o=R.exports.useMemo(()=>({remeshStore:t}),[t]);return K(Ot.Provider,{value:o,children:e.children})},nn=function(e){const r=se(),t=R.exports.useRef(null),o=R.exports.useCallback(m=>(t.current=m,()=>{t.current=null}),[]),s=R.exports.useCallback(()=>r.query(e),[r,e]),a=Ct.exports.useSyncExternalStore(o,s,s),c=R.exports.useRef(null),l=r.getKey(e);return R.exports.useEffect(()=>()=>{var m;(m=c.current)==null||m.unsubscribe(),c.current=null},[r,l]),R.exports.useEffect(()=>{c.current===null&&(c.current=r.subscribeQuery(e,()=>{var m;(m=t.current)==null||m.call(t)}))},[r,e]),a},on=function(e,r){const t=se(),o=R.exports.useRef(r);R.exports.useEffect(()=>{o.current=r}),R.exports.useEffect(()=>{const s=t.subscribeEvent(e,a=>{o.current(a)});return()=>{s.unsubscribe()}},[e,t])},sn=function(){return se().send},Br=function(e){const r=se(),t=r.getDomain(e);R.exports.useEffect(()=>{r.igniteDomain(e)},[r,e]);const o=r.getKey(e),s=R.exports.useRef(null);return R.exports.useEffect(()=>()=>{var a;(a=s.current)==null||a.unsubscribe(),s.current=null},[r,o]),R.exports.useEffect(()=>{s.current===null&&(s.current=r.subscribeDomain(e))},[r,e]),t},Ar=e=>(Br(e.domain),K(ge,{})),qr=e=>K(ge,{children:e.domains.map((r,t)=>K(Ar,{domain:r},t))}),an=e=>tr(ge,{children:[K(qr,{domains:e.domains}),e.children]});export{I as O,tn as R,H as S,re as _,te as a,Br as b,ft as c,nn as d,rn as e,F as f,Ce as g,Vr as h,vr as i,x as j,T as k,on as l,Lr as m,Je as n,xe as o,Y as p,ve as q,we as r,an as s,sn as u};
//# sourceMappingURL=remesh-react.691c86dd.js.map
