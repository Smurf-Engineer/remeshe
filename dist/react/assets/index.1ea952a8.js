import{j as Rt,a as X,r as se,F as Ri,c as Ai}from"./jsx-runtime.5f4d5f7e.js";import{l as Un,u as Di,N as Fn,b as Ii,c as kt,d as Je,H as Li,R as xi,a as jr}from"./localforage.13a304dd.js";import{R as Lt,m as cn,O as Oi,u as En,b as Xt,d as ie,q as ds,e as Ni}from"./remesh-react.2e60fbbd.js";import{m as Mi}from"./merge.e3bdf018.js";import{L as Ui}from"./list.eb60b134.js";import{f as Fi}from"./filter.fc0c7b02.js";import"./mergeAll.f2c6f2dd.js";import"./mergeMap.fb99bae7.js";const fs=Lt.extern({name:"StorageExtern",default:null}),ji=fs.impl({get:e=>Un.getItem(e),set:async(e,t)=>{await Un.setItem(e,t)},clear:e=>Un.removeItem(e)}),At=()=>new Map,an=e=>{const t=At();return e.forEach((n,s)=>{t.set(s,n)}),t},bt=(e,t,n)=>{let s=e.get(t);return s===void 0&&e.set(t,s=n()),s},Bi=(e,t)=>{const n=[];for(const[s,i]of e)n.push(t(i,s));return n},Pi=(e,t)=>{for(const[n,s]of e)if(t(s,n))return!0;return!1},Ue=()=>new Set,jn=e=>e[e.length-1],qi=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},ps=Array.from,ya=Array.isArray;class Sn{constructor(){this._observers=At()}on(t,n){bt(this._observers,t,Ue).add(n)}once(t,n){const s=(...i)=>{this.off(t,s),n(...i)};this.on(t,s)}off(t,n){const s=this._observers.get(t);s!==void 0&&(s.delete(n),s.size===0&&this._observers.delete(t))}emit(t,n){return ps((this._observers.get(t)||At()).values()).forEach(s=>s(...n))}destroy(){this._observers=At()}}const xt=Math.floor,en=Math.abs,Vi=Math.log10,ir=(e,t)=>e<t?e:t,de=(e,t)=>e>t?e:t,gs=e=>e!==0?e<0:1/e<0,Wi=String.fromCharCode,Hi=e=>e.toLowerCase(),$i=/^\s*/g,Yi=e=>e.replace($i,""),Ki=/([A-Z])/g,Br=(e,t)=>Yi(e.replace(Ki,n=>`${t}${Hi(n)}`)),Qi=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,s=new Uint8Array(n);for(let i=0;i<n;i++)s[i]=t.codePointAt(i);return s},kn=typeof TextEncoder!="undefined"?new TextEncoder:null,Gi=e=>kn.encode(e),zn=kn?Gi:Qi;let Ne=typeof TextDecoder=="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Ne&&Ne.decode(new Uint8Array).length===1&&(Ne=null);const Pr=e=>e===void 0?null:e;class zi{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let ms=new zi,ys=!0;try{typeof localStorage!="undefined"&&(ms=localStorage,ys=!1)}catch{}const ws=ms,Ji=e=>ys||addEventListener("storage",e),Tn=typeof process!="undefined"&&process.release&&/node|io\.js/.test(process.release.name),bs=typeof window!="undefined"&&!Tn;typeof navigator!="undefined"&&/Mac/.test(navigator.platform);let Tt;const Xi=()=>{if(Tt===void 0)if(Tn){Tt=At();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const s=e[n];s[0]==="-"?(t!==null&&Tt.set(t,""),t=s):t!==null&&(Tt.set(t,s),t=null)}t!==null&&Tt.set(t,"")}else typeof location=="object"?(Tt=At(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");Tt.set(`--${Br(t,"-")}`,n),Tt.set(`-${Br(t,"-")}`,n)}})):Tt=At();return Tt},Zi=e=>Xi().has(e),_s=e=>Pr(Tn?process.env[e.toUpperCase()]:ws.getItem(e)),to=e=>Zi("--"+e)||_s(e)!==null;to("production");const qr=1,Vr=2,Bn=4,Pn=8,Fe=32,jt=64,mt=128,Rn=31,Jn=63,oe=127,eo=2147483647,vs=Number.MAX_SAFE_INTEGER,no=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&xt(e)===e);class An{constructor(t){this.arr=t,this.pos=0}}const Ut=e=>new An(e),ro=e=>e.pos!==e.arr.length,so=(e,t)=>{const n=cr(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},at=e=>so(e,$(e)),ce=e=>e.arr[e.pos++],$=e=>{let t=0,n=1;for(;;){const s=e.arr[e.pos++];if(t=t+(s&oe)*n,n*=128,s<mt)return t;if(t>vs)throw new Error("Integer out of range!")}},or=e=>{let t=e.arr[e.pos++],n=t&Jn,s=64;const i=(t&jt)>0?-1:1;if((t&mt)===0)return i*n;for(;;){if(t=e.arr[e.pos++],n=n+(t&oe)*s,s*=128,t<mt)return i*n;if(n>vs)throw new Error("Integer out of range!")}},io=e=>{let t=$(e);if(t===0)return"";{let n=String.fromCodePoint(ce(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(ce(e));else for(;t>0;){const s=t<1e4?t:1e4,i=e.arr.subarray(e.pos,e.pos+s);e.pos+=s,n+=String.fromCodePoint.apply(null,i),t-=s}return decodeURIComponent(escape(n))}},oo=e=>Ne.decode(at(e)),Bt=Ne?oo:io,lr=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},lo=e=>lr(e,4).getFloat32(0,!1),co=e=>lr(e,8).getFloat64(0,!1),ao=e=>lr(e,8).getBigInt64(0,!1),ho=[e=>{},e=>null,or,lo,co,ao,e=>!1,e=>!0,Bt,e=>{const t=$(e),n={};for(let s=0;s<t;s++){const i=Bt(e);n[i]=ve(e)}return n},e=>{const t=$(e),n=[];for(let s=0;s<t;s++)n.push(ve(e));return n},at],ve=e=>ho[127-ce(e)](e);class Wr extends An{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),ro(this)?this.count=$(this)+1:this.count=-1),this.count--,this.s}}class nn extends An{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=or(this);const t=gs(this.s);this.count=1,t&&(this.s=-this.s,this.count=$(this)+2)}return this.count--,this.s}}class qn extends An{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=or(this),n=t&1;this.diff=xt(t/2),this.count=1,n&&(this.count=$(this)+2)}return this.s+=this.diff,this.count--,this.s}}class uo{constructor(t){this.decoder=new nn(t),this.str=Bt(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const Cs=e=>new Uint8Array(e),cr=(e,t,n)=>new Uint8Array(e,t,n),fo=e=>new Uint8Array(e),po=e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=Wi(e[n]);return btoa(t)},go=e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),mo=e=>{const t=atob(e),n=Cs(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return n},yo=e=>{const t=Buffer.from(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)},Es=bs?po:go,Ss=bs?mo:yo,wo=e=>{const t=Cs(e.byteLength);return t.set(e),t};class He{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const ht=()=>new He,bo=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},nt=e=>{const t=new Uint8Array(bo(e));let n=0;for(let s=0;s<e.bufs.length;s++){const i=e.bufs[s];t.set(i,n),n+=i.length}return t.set(cr(e.cbuf.buffer,0,e.cpos),n),t},_o=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(cr(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(de(n,t)*2),e.cpos=0)},ct=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},je=ct,V=(e,t)=>{for(;t>oe;)ct(e,mt|oe&t),t=xt(t/128);ct(e,oe&t)},ar=(e,t)=>{const n=gs(t);for(n&&(t=-t),ct(e,(t>Jn?mt:0)|(n?jt:0)|Jn&t),t=xt(t/64);t>0;)ct(e,(t>oe?mt:0)|oe&t),t=xt(t/128)},Xn=new Uint8Array(3e4),vo=Xn.length/3,Co=(e,t)=>{if(t.length<vo){const n=kn.encodeInto(t,Xn).written||0;V(e,n);for(let s=0;s<n;s++)ct(e,Xn[s])}else st(e,zn(t))},Eo=(e,t)=>{const n=unescape(encodeURIComponent(t)),s=n.length;V(e,s);for(let i=0;i<s;i++)ct(e,n.codePointAt(i))},Dt=kn?Co:Eo,Dn=(e,t)=>{const n=e.cbuf.length,s=e.cpos,i=ir(n-s,t.length),o=t.length-i;e.cbuf.set(t.subarray(0,i),s),e.cpos+=i,o>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(de(n*2,o)),e.cbuf.set(t.subarray(i)),e.cpos=o)},st=(e,t)=>{V(e,t.byteLength),Dn(e,t)},hr=(e,t)=>{_o(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},So=(e,t)=>hr(e,4).setFloat32(0,t,!1),ko=(e,t)=>hr(e,8).setFloat64(0,t,!1),To=(e,t)=>hr(e,8).setBigInt64(0,t,!1),Hr=new DataView(new ArrayBuffer(4)),Ro=e=>(Hr.setFloat32(0,e),Hr.getFloat32(0)===e),Ce=(e,t)=>{switch(typeof t){case"string":ct(e,119),Dt(e,t);break;case"number":no(t)&&en(t)<=eo?(ct(e,125),ar(e,t)):Ro(t)?(ct(e,124),So(e,t)):(ct(e,123),ko(e,t));break;case"bigint":ct(e,122),To(e,t);break;case"object":if(t===null)ct(e,126);else if(t instanceof Array){ct(e,117),V(e,t.length);for(let n=0;n<t.length;n++)Ce(e,t[n])}else if(t instanceof Uint8Array)ct(e,116),st(e,t);else{ct(e,118);const n=Object.keys(t);V(e,n.length);for(let s=0;s<n.length;s++){const i=n[s];Dt(e,i),Ce(e,t[i])}}break;case"boolean":ct(e,t?120:121);break;default:ct(e,127)}};class $r extends He{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&V(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const Yr=e=>{e.count>0&&(ar(e.encoder,e.count===1?e.s:-e.s),e.count>1&&V(e.encoder,e.count-2))};class rn{constructor(){this.encoder=new He,this.s=0,this.count=0}write(t){this.s===t?this.count++:(Yr(this),this.count=1,this.s=t)}toUint8Array(){return Yr(this),nt(this.encoder)}}const Kr=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);ar(e.encoder,t),e.count>1&&V(e.encoder,e.count-2)}};class Vn{constructor(){this.encoder=new He,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(Kr(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return Kr(this),nt(this.encoder)}}class Ao{constructor(){this.sarr=[],this.s="",this.lensE=new rn}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new He;return this.sarr.push(this.s),this.s="",Dt(t,this.sarr.join("")),Dn(t,this.lensE.toUint8Array()),nt(t)}}const Qr=typeof crypto=="undefined"?null:crypto,Do=Qr!==null?e=>{const t=new ArrayBuffer(e),n=new Uint8Array(t);return Qr.getRandomValues(n),t}:e=>{const t=new ArrayBuffer(e),n=new Uint8Array(t);for(let s=0;s<e;s++)n[s]=Math.ceil(Math.random()*4294967295>>>0);return t},Io=Math.random,ks=()=>new Uint32Array(Do(4))[0],Lo=[1e7]+-1e3+-4e3+-8e3+-1e11,Ts=()=>Lo.replace(/[018]/g,e=>(e^ks()&15>>e/4).toString(16)),qt=Date.now,xo=e=>new Promise(e),Oo=e=>Promise.reject(e),ur=e=>Promise.resolve(e),ke=e=>new Error(e),It=()=>{throw ke("Method unimplemented")},Ot=()=>{throw ke("Unexpected case")},No=Object.keys,hn=e=>No(e).length,Mo=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},Rs=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Uo=(e,t)=>e===t||hn(e)===hn(t)&&Mo(e,(n,s)=>(n!==void 0||Rs(t,s))&&t[s]===n),dr=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&dr(e,t,n+1)}},Fo=()=>{},jo=(e,t)=>e===t,Me=(e,t)=>{if(e==null||t==null)return jo(e,t);if(e.constructor!==t.constructor)return!1;if(e===t)return!0;switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:{if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break}case Set:{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;break}case Map:{if(e.size!==t.size)return!1;for(const n of e.keys())if(!t.has(n)||!Me(e.get(n),t.get(n)))return!1;break}case Object:if(hn(e)!==hn(t))return!1;for(const n in e)if(!Rs(e,n)||!Me(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Me(e[n],t[n]))return!1;break;default:return!1}return!0},Wt=Symbol;class Bo{constructor(t,n){this.left=t,this.right=n}}const Ft=(e,t)=>new Bo(e,t),fe=typeof document!="undefined"?document:{};typeof DOMParser!="undefined"&&new DOMParser;const Po=e=>Bi(e,(t,n)=>`${n}:${t};`).join("");fe.ELEMENT_NODE;fe.TEXT_NODE;fe.CDATA_SECTION_NODE;fe.COMMENT_NODE;fe.DOCUMENT_NODE;fe.DOCUMENT_TYPE_NODE;fe.DOCUMENT_FRAGMENT_NODE;const gt=Wt(),Zt=Wt(),fr=Wt(),In=Wt(),pr=Wt(),gr=Wt(),mr=Wt(),Ln=Wt(),$e=Wt(),qo={[gt]:Ft("font-weight","bold"),[Zt]:Ft("font-weight","normal"),[fr]:Ft("color","blue"),[pr]:Ft("color","green"),[In]:Ft("color","grey"),[gr]:Ft("color","red"),[mr]:Ft("color","purple"),[Ln]:Ft("color","orange"),[$e]:Ft("color","black")},Vo={[gt]:"\x1B[1m",[Zt]:"\x1B[2m",[fr]:"\x1B[34m",[pr]:"\x1B[32m",[In]:"\x1B[37m",[gr]:"\x1B[31m",[mr]:"\x1B[35m",[Ln]:"\x1B[38;5;208m",[$e]:"\x1B[0m"},Wo=e=>{const t=[],n=[],s=At();let i=[],o=0;for(;o<e.length;o++){const c=e[o],a=qo[c];if(a!==void 0)s.set(a.left,a.right);else if(c.constructor===String||c.constructor===Number){const h=Po(s);o>0||h.length>0?(t.push("%c"+c),n.push(h)):t.push(c)}else break}for(o>0&&(i=n,i.unshift(t.join("")));o<e.length;o++){const c=e[o];c instanceof Symbol||i.push(c)}return i},Ho=e=>{const t=[],n=[];let s=0;for(;s<e.length;s++){const i=e[s],o=Vo[i];if(o!==void 0)t.push(o);else if(i.constructor===String||i.constructor===Number)t.push(i);else break}for(s>0&&(t.push("\x1B[0m"),n.push(t.join("")));s<e.length;s++){const i=e[s];i instanceof Symbol||n.push(i)}return n},$o=Tn?Ho:Wo,As=(...e)=>{console.log(...$o(e)),Yo.forEach(t=>t.print(e))},Yo=new Set,Gr=[pr,mr,Ln,fr];let Wn=0,zr=qt();const Ko=e=>{const t=Gr[Wn],n=_s("log"),s=n!==null&&(n==="*"||n==="true"||new RegExp(n,"gi").test(e));return Wn=(Wn+1)%Gr.length,e+=": ",s?(...i)=>{const o=qt(),c=o-zr;zr=o,As(t,e,$e,...i.map(a=>typeof a=="string"||typeof a=="symbol"?a:JSON.stringify(a)),t," +"+c+"ms")}:Fo},Ds=e=>({[Symbol.iterator](){return this},next:e}),Qo=(e,t)=>Ds(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),Hn=(e,t)=>Ds(()=>{const{done:n,value:s}=e.next();return{done:n,value:n?void 0:t(s)}});class yr{constructor(t,n){this.clock=t,this.len=n}}class Ye{constructor(){this.clients=new Map}}const Zn=(e,t,n)=>t.clients.forEach((s,i)=>{const o=e.doc.store.clients.get(i);for(let c=0;c<s.length;c++){const a=s[c];Ws(e,o,a.clock,a.len,n)}}),Go=(e,t)=>{let n=0,s=e.length-1;for(;n<=s;){const i=xt((n+s)/2),o=e[i],c=o.clock;if(c<=t){if(t<c+o.len)return i;n=i+1}else s=i-1}return null},Is=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&Go(n,t.clock)!==null},wr=e=>{e.clients.forEach(t=>{t.sort((i,o)=>i.clock-o.clock);let n,s;for(n=1,s=1;n<t.length;n++){const i=t[s-1],o=t[n];i.clock+i.len>=o.clock?i.len=de(i.len,o.clock+o.len-i.clock):(s<n&&(t[s]=o),s++)}t.length=s})},zo=e=>{const t=new Ye;for(let n=0;n<e.length;n++)e[n].clients.forEach((s,i)=>{if(!t.clients.has(i)){const o=s.slice();for(let c=n+1;c<e.length;c++)qi(o,e[c].clients.get(i)||[]);t.clients.set(i,o)}});return wr(t),t},un=(e,t,n,s)=>{bt(e.clients,t,()=>[]).push(new yr(n,s))},Ls=()=>new Ye,Jo=e=>{const t=Ls();return e.clients.forEach((n,s)=>{const i=[];for(let o=0;o<n.length;o++){const c=n[o];if(c.deleted){const a=c.id.clock;let h=c.length;if(o+1<n.length)for(let y=n[o+1];o+1<n.length&&y.deleted;y=n[++o+1])h+=y.length;i.push(new yr(a,h))}}i.length>0&&t.clients.set(s,i)}),t},Te=(e,t)=>{V(e.restEncoder,t.clients.size),t.clients.forEach((n,s)=>{e.resetDsCurVal(),V(e.restEncoder,s);const i=n.length;V(e.restEncoder,i);for(let o=0;o<i;o++){const c=n[o];e.writeDsClock(c.clock),e.writeDsLen(c.len)}})},br=e=>{const t=new Ye,n=$(e.restDecoder);for(let s=0;s<n;s++){e.resetDsCurVal();const i=$(e.restDecoder),o=$(e.restDecoder);if(o>0){const c=bt(t.clients,i,()=>[]);for(let a=0;a<o;a++)c.push(new yr(e.readDsClock(),e.readDsLen()))}}return t},Jr=(e,t,n)=>{const s=new Ye,i=$(e.restDecoder);for(let o=0;o<i;o++){e.resetDsCurVal();const c=$(e.restDecoder),a=$(e.restDecoder),h=n.clients.get(c)||[],y=ut(n,c);for(let b=0;b<a;b++){const u=e.readDsClock(),f=u+e.readDsLen();if(u<y){y<f&&un(s,c,y,f-y);let g=Nt(h,u),p=h[g];for(!p.deleted&&p.id.clock<u&&(h.splice(g+1,0,wn(t,p,u-p.id.clock)),g++);g<h.length&&(p=h[g++],p.id.clock<f);)p.deleted||(f<p.id.clock+p.length&&h.splice(g,0,wn(t,p,f-p.id.clock)),p.delete(t))}else un(s,c,u,f-u)}}if(s.clients.size>0){const o=new ae;return V(o.restEncoder,0),Te(o,s),o.toUint8Array()}return null},xs=ks;class Re extends Sn{constructor({guid:t=Ts(),collectionid:n=null,gc:s=!0,gcFilter:i=()=>!0,meta:o=null,autoLoad:c=!1,shouldLoad:a=!0}={}){super(),this.gc=s,this.gcFilter=i,this.clientID=xs(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new qs,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=c,this.meta=o,this.isLoaded=!1,this.whenLoaded=xo(h=>{this.on("load",()=>{this.isLoaded=!0,h(this)})})}load(){const t=this._item;t!==null&&!this.shouldLoad&&tt(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Array.from(this.subdocs).map(t=>t.guid))}transact(t,n=null){tt(this,t,n)}get(t,n=ft){const s=bt(this.share,t,()=>{const o=new n;return o._integrate(this,null),o}),i=s.constructor;if(n!==ft&&i!==n)if(i===ft){const o=new n;o._map=s._map,s._map.forEach(c=>{for(;c!==null;c=c.left)c.parent=o}),o._start=s._start;for(let c=o._start;c!==null;c=c.right)c.parent=o;return o._length=s._length,this.share.set(t,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return s}getArray(t=""){return this.get(t,Pt)}getText(t=""){return this.get(t,Se)}getMap(t=""){return this.get(t,Vt)}getXmlFragment(t=""){return this.get(t,he)}toJSON(){const t={};return this.share.forEach((n,s)=>{t[s]=n.toJSON()}),t}destroy(){ps(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Re({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,tt(t.parent.doc,s=>{const i=n.doc;t.deleted||s.subdocsAdded.add(i),s.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(t,n){super.on(t,n)}off(t,n){super.off(t,n)}}class Os{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return $(this.restDecoder)}readDsLen(){return $(this.restDecoder)}}class Ns extends Os{readLeftID(){return z($(this.restDecoder),$(this.restDecoder))}readRightID(){return z($(this.restDecoder),$(this.restDecoder))}readClient(){return $(this.restDecoder)}readInfo(){return ce(this.restDecoder)}readString(){return Bt(this.restDecoder)}readParentInfo(){return $(this.restDecoder)===1}readTypeRef(){return $(this.restDecoder)}readLen(){return $(this.restDecoder)}readAny(){return ve(this.restDecoder)}readBuf(){return wo(at(this.restDecoder))}readJSON(){return JSON.parse(Bt(this.restDecoder))}readKey(){return Bt(this.restDecoder)}}class Xo{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=$(this.restDecoder),this.dsCurrVal}readDsLen(){const t=$(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Ee extends Xo{constructor(t){super(t),this.keys=[],$(t),this.keyClockDecoder=new qn(at(t)),this.clientDecoder=new nn(at(t)),this.leftClockDecoder=new qn(at(t)),this.rightClockDecoder=new qn(at(t)),this.infoDecoder=new Wr(at(t),ce),this.stringDecoder=new uo(at(t)),this.parentInfoDecoder=new Wr(at(t),ce),this.typeRefDecoder=new nn(at(t)),this.lenDecoder=new nn(at(t))}readLeftID(){return new be(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new be(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return ve(this.restDecoder)}readBuf(){return at(this.restDecoder)}readJSON(){return ve(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class Ms{constructor(){this.restEncoder=ht()}toUint8Array(){return nt(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){V(this.restEncoder,t)}writeDsLen(t){V(this.restEncoder,t)}}class Ke extends Ms{writeLeftID(t){V(this.restEncoder,t.client),V(this.restEncoder,t.clock)}writeRightID(t){V(this.restEncoder,t.client),V(this.restEncoder,t.clock)}writeClient(t){V(this.restEncoder,t)}writeInfo(t){je(this.restEncoder,t)}writeString(t){Dt(this.restEncoder,t)}writeParentInfo(t){V(this.restEncoder,t?1:0)}writeTypeRef(t){V(this.restEncoder,t)}writeLen(t){V(this.restEncoder,t)}writeAny(t){Ce(this.restEncoder,t)}writeBuf(t){st(this.restEncoder,t)}writeJSON(t){Dt(this.restEncoder,JSON.stringify(t))}writeKey(t){Dt(this.restEncoder,t)}}class Us{constructor(){this.restEncoder=ht(),this.dsCurrVal=0}toUint8Array(){return nt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,V(this.restEncoder,n)}writeDsLen(t){t===0&&Ot(),V(this.restEncoder,t-1),this.dsCurrVal+=t}}class ae extends Us{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Vn,this.clientEncoder=new rn,this.leftClockEncoder=new Vn,this.rightClockEncoder=new Vn,this.infoEncoder=new $r(je),this.stringEncoder=new Ao,this.parentInfoEncoder=new $r(je),this.typeRefEncoder=new rn,this.lenEncoder=new rn}toUint8Array(){const t=ht();return V(t,0),st(t,this.keyClockEncoder.toUint8Array()),st(t,this.clientEncoder.toUint8Array()),st(t,this.leftClockEncoder.toUint8Array()),st(t,this.rightClockEncoder.toUint8Array()),st(t,nt(this.infoEncoder)),st(t,this.stringEncoder.toUint8Array()),st(t,nt(this.parentInfoEncoder)),st(t,this.typeRefEncoder.toUint8Array()),st(t,this.lenEncoder.toUint8Array()),Dn(t,nt(this.restEncoder)),nt(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){Ce(this.restEncoder,t)}writeBuf(t){st(this.restEncoder,t)}writeJSON(t){Ce(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const Zo=(e,t,n,s)=>{s=de(s,t[0].id.clock);const i=Nt(t,s);V(e.restEncoder,t.length-i),e.writeClient(n),V(e.restEncoder,s);const o=t[i];o.write(e,s-o.id.clock);for(let c=i+1;c<t.length;c++)t[c].write(e,0)},_r=(e,t,n)=>{const s=new Map;n.forEach((i,o)=>{ut(t,o)>i&&s.set(o,i)}),xn(t).forEach((i,o)=>{n.has(o)||s.set(o,0)}),V(e.restEncoder,s.size),Array.from(s.entries()).sort((i,o)=>o[0]-i[0]).forEach(([i,o])=>{Zo(e,t.clients.get(i),i,o)})},tl=(e,t)=>{const n=At(),s=$(e.restDecoder);for(let i=0;i<s;i++){const o=$(e.restDecoder),c=new Array(o),a=e.readClient();let h=$(e.restDecoder);n.set(a,{i:0,refs:c});for(let y=0;y<o;y++){const b=e.readInfo();switch(Rn&b){case 0:{const u=e.readLen();c[y]=new yt(z(a,h),u),h+=u;break}case 10:{const u=$(e.restDecoder);c[y]=new wt(z(a,h),u),h+=u;break}default:{const u=(b&(jt|mt))===0,f=new ot(z(a,h),null,(b&mt)===mt?e.readLeftID():null,null,(b&jt)===jt?e.readRightID():null,u?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,u&&(b&Fe)===Fe?e.readString():null,ci(e,b));c[y]=f,h+=f.length}}}}return n},el=(e,t,n)=>{const s=[];let i=Array.from(n.keys()).sort((g,p)=>g-p);if(i.length===0)return null;const o=()=>{if(i.length===0)return null;let g=n.get(i[i.length-1]);for(;g.refs.length===g.i;)if(i.pop(),i.length>0)g=n.get(i[i.length-1]);else return null;return g};let c=o();if(c===null&&s.length===0)return null;const a=new qs,h=new Map,y=(g,p)=>{const C=h.get(g);(C==null||C>p)&&h.set(g,p)};let b=c.refs[c.i++];const u=new Map,f=()=>{for(const g of s){const p=g.id.client,C=n.get(p);C?(C.i--,a.clients.set(p,C.refs.slice(C.i)),n.delete(p),C.i=0,C.refs=[]):a.clients.set(p,[g]),i=i.filter(x=>x!==p)}s.length=0};for(;;){if(b.constructor!==wt){const p=bt(u,b.id.client,()=>ut(t,b.id.client))-b.id.clock;if(p<0)s.push(b),y(b.id.client,b.id.clock-1),f();else{const C=b.getMissing(e,t);if(C!==null){s.push(b);const x=n.get(C)||{refs:[],i:0};if(x.refs.length===x.i)y(C,ut(t,C)),f();else{b=x.refs[x.i++];continue}}else(p===0||p<b.length)&&(b.integrate(e,p),u.set(b.id.client,b.id.clock+b.length))}}if(s.length>0)b=s.pop();else if(c!==null&&c.i<c.refs.length)b=c.refs[c.i++];else{if(c=o(),c===null)break;b=c.refs[c.i++]}}if(a.clients.size>0){const g=new ae;return _r(g,a,new Map),V(g.restEncoder,0),{missing:h,update:g.toUint8Array()}}return null},nl=(e,t)=>_r(e,t.doc.store,t.beforeState),rl=(e,t,n,s=new Ee(e))=>tt(t,i=>{i.local=!1;let o=!1;const c=i.doc,a=c.store,h=tl(s,c),y=el(i,a,h),b=a.pendingStructs;if(b){for(const[f,g]of b.missing)if(g<ut(a,f)){o=!0;break}if(y){for(const[f,g]of y.missing){const p=b.missing.get(f);(p==null||p>g)&&b.missing.set(f,g)}b.update=dn([b.update,y.update])}}else a.pendingStructs=y;const u=Jr(s,i,a);if(a.pendingDs){const f=new Ee(Ut(a.pendingDs));$(f.restDecoder);const g=Jr(f,i,a);u&&g?a.pendingDs=dn([u,g]):a.pendingDs=u||g}else a.pendingDs=u;if(o){const f=a.pendingStructs.update;a.pendingStructs=null,Fs(i.doc,f)}},n,!1),Fs=(e,t,n,s=Ee)=>{const i=Ut(t);rl(i,e,n,new s(i))},sl=(e,t,n)=>Fs(e,t,n,Ns),il=(e,t,n=new Map)=>{_r(e,t.store,n),Te(e,Jo(t.store))},ol=(e,t=new Uint8Array([0]),n=new ae)=>{const s=js(t);il(n,e,s);const i=[n.toUint8Array()];if(e.store.pendingDs&&i.push(e.store.pendingDs),e.store.pendingStructs&&i.push(Sl(e.store.pendingStructs.update,t)),i.length>1){if(n.constructor===Ke)return Cl(i.map((o,c)=>c===0?o:Tl(o)));if(n.constructor===ae)return dn(i)}return i[0]},ll=(e,t)=>ol(e,t,new Ke),cl=e=>{const t=new Map,n=$(e.restDecoder);for(let s=0;s<n;s++){const i=$(e.restDecoder),o=$(e.restDecoder);t.set(i,o)}return t},js=e=>cl(new Os(Ut(e))),Bs=(e,t)=>(V(e.restEncoder,t.size),Array.from(t.entries()).sort((n,s)=>s[0]-n[0]).forEach(([n,s])=>{V(e.restEncoder,n),V(e.restEncoder,s)}),e),al=(e,t)=>Bs(e,xn(t.store)),hl=(e,t=new Us)=>(e instanceof Map?Bs(t,e):al(t,e),t.toUint8Array()),ul=e=>hl(e,new Ms);class dl{constructor(){this.l=[]}}const Xr=()=>new dl,Zr=(e,t)=>e.l.push(t),ts=(e,t)=>{const n=e.l,s=n.length;e.l=n.filter(i=>t!==i),s===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Ps=(e,t,n)=>dr(e.l,[t,n]);class be{constructor(t,n){this.client=t,this.clock=n}}const Xe=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,z=(e,t)=>new be(e,t),fl=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw Ot()};class pl{constructor(t,n){this.ds=t,this.sv=n}}const gl=(e,t)=>new pl(e,t);gl(Ls(),new Map);const Oe=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!Is(t.ds,e.id),sn=(e,t)=>{const n=bt(e.meta,sn,Ue),s=e.doc.store;n.has(t)||(t.sv.forEach((i,o)=>{i<ut(s,o)&&te(e,z(o,i))}),Zn(e,t.ds,i=>{}),n.add(t))};class qs{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const xn=e=>{const t=new Map;return e.clients.forEach((n,s)=>{const i=n[n.length-1];t.set(s,i.id.clock+i.length)}),t},ut=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const s=n[n.length-1];return s.id.clock+s.length},Vs=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const s=n[n.length-1];if(s.id.clock+s.length!==t.id.clock)throw Ot()}n.push(t)},Nt=(e,t)=>{let n=0,s=e.length-1,i=e[s],o=i.id.clock;if(o===t)return s;let c=xt(t/(o+i.length-1)*s);for(;n<=s;){if(i=e[c],o=i.id.clock,o<=t){if(t<o+i.length)return c;n=c+1}else s=c-1;c=xt((n+s)/2)}throw Ot()},ml=(e,t)=>{const n=e.clients.get(t.client);return n[Nt(n,t.clock)]},$n=ml,tr=(e,t,n)=>{const s=Nt(t,n),i=t[s];return i.id.clock<n&&i instanceof ot?(t.splice(s+1,0,wn(e,i,n-i.id.clock)),s+1):s},te=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[tr(e,n,t.clock)]},es=(e,t,n)=>{const s=t.clients.get(n.client),i=Nt(s,n.clock),o=s[i];return n.clock!==o.id.clock+o.length-1&&o.constructor!==yt&&s.splice(i+1,0,wn(e,o,n.clock-o.id.clock+1)),o},yl=(e,t,n)=>{const s=e.clients.get(t.id.client);s[Nt(s,t.id.clock)]=n},Ws=(e,t,n,s,i)=>{if(s===0)return;const o=n+s;let c=tr(e,t,n),a;do a=t[c++],o<a.id.clock+a.length&&tr(e,t,o),i(a);while(c<t.length&&t[c].id.clock<o)};class wl{constructor(t,n,s){this.doc=t,this.deleteSet=new Ye,this.beforeState=xn(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=s,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set}}const ns=(e,t)=>t.deleteSet.clients.size===0&&!Pi(t.afterState,(n,s)=>t.beforeState.get(s)!==n)?!1:(wr(t.deleteSet),nl(e,t),Te(e,t.deleteSet),!0),rs=(e,t,n)=>{const s=t._item;(s===null||s.id.clock<(e.beforeState.get(s.id.client)||0)&&!s.deleted)&&bt(e.changed,t,Ue).add(n)},on=(e,t)=>{const n=e[t-1],s=e[t];n.deleted===s.deleted&&n.constructor===s.constructor&&n.mergeWith(s)&&(e.splice(t,1),s instanceof ot&&s.parentSub!==null&&s.parent._map.get(s.parentSub)===s&&s.parent._map.set(s.parentSub,n))},bl=(e,t,n)=>{for(const[s,i]of e.clients.entries()){const o=t.clients.get(s);for(let c=i.length-1;c>=0;c--){const a=i[c],h=a.clock+a.len;for(let y=Nt(o,a.clock),b=o[y];y<o.length&&b.id.clock<h;b=o[++y]){const u=o[y];if(a.clock+a.len<=u.id.clock)break;u instanceof ot&&u.deleted&&!u.keep&&n(u)&&u.gc(t,!1)}}}},_l=(e,t)=>{e.clients.forEach((n,s)=>{const i=t.clients.get(s);for(let o=n.length-1;o>=0;o--){const c=n[o],a=ir(i.length-1,1+Nt(i,c.clock+c.len-1));for(let h=a,y=i[h];h>0&&y.id.clock>=c.clock;y=i[--h])on(i,h)}})},Hs=(e,t)=>{if(t<e.length){const n=e[t],s=n.doc,i=s.store,o=n.deleteSet,c=n._mergeStructs;try{wr(o),n.afterState=xn(n.doc.store),s._transaction=null,s.emit("beforeObserverCalls",[n,s]);const a=[];n.changed.forEach((h,y)=>a.push(()=>{(y._item===null||!y._item.deleted)&&y._callObserver(n,h)})),a.push(()=>{n.changedParentTypes.forEach((h,y)=>a.push(()=>{(y._item===null||!y._item.deleted)&&(h=h.filter(b=>b.target._item===null||!b.target._item.deleted),h.forEach(b=>{b.currentTarget=y}),h.sort((b,u)=>b.path.length-u.path.length),Ps(y._dEH,h,n))})),a.push(()=>s.emit("afterTransaction",[n,s]))}),dr(a,[])}finally{s.gc&&bl(o,i,s.gcFilter),_l(o,i),n.afterState.forEach((b,u)=>{const f=n.beforeState.get(u)||0;if(f!==b){const g=i.clients.get(u),p=de(Nt(g,f),1);for(let C=g.length-1;C>=p;C--)on(g,C)}});for(let b=0;b<c.length;b++){const{client:u,clock:f}=c[b].id,g=i.clients.get(u),p=Nt(g,f);p+1<g.length&&on(g,p+1),p>0&&on(g,p)}if(!n.local&&n.afterState.get(s.clientID)!==n.beforeState.get(s.clientID)&&(As(Ln,gt,"[yjs] ",Zt,gr,"Changed the client-id because another client seems to be using it."),s.clientID=xs()),s.emit("afterTransactionCleanup",[n,s]),s._observers.has("update")){const b=new Ke;ns(b,n)&&s.emit("update",[b.toUint8Array(),n.origin,s,n])}if(s._observers.has("updateV2")){const b=new ae;ns(b,n)&&s.emit("updateV2",[b.toUint8Array(),n.origin,s,n])}const{subdocsAdded:a,subdocsLoaded:h,subdocsRemoved:y}=n;(a.size>0||y.size>0||h.size>0)&&(a.forEach(b=>{b.clientID=s.clientID,b.collectionid==null&&(b.collectionid=s.collectionid),s.subdocs.add(b)}),y.forEach(b=>s.subdocs.delete(b)),s.emit("subdocs",[{loaded:h,added:a,removed:y},s,n]),y.forEach(b=>b.destroy())),e.length<=t+1?(s._transactionCleanups=[],s.emit("afterAllTransactions",[s,e])):Hs(e,t+1)}}},tt=(e,t,n=null,s=!0)=>{const i=e._transactionCleanups;let o=!1;e._transaction===null&&(o=!0,e._transaction=new wl(e,n,s),i.push(e._transaction),i.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{t(e._transaction)}finally{o&&i[0]===e._transaction&&Hs(i,0)}};function*vl(e){const t=$(e.restDecoder);for(let n=0;n<t;n++){const s=$(e.restDecoder),i=e.readClient();let o=$(e.restDecoder);for(let c=0;c<s;c++){const a=e.readInfo();if(a===10){const h=$(e.restDecoder);yield new wt(z(i,o),h),o+=h}else if((Rn&a)!==0){const h=(a&(jt|mt))===0,y=new ot(z(i,o),null,(a&mt)===mt?e.readLeftID():null,null,(a&jt)===jt?e.readRightID():null,h?e.readParentInfo()?e.readString():e.readLeftID():null,h&&(a&Fe)===Fe?e.readString():null,ci(e,a));yield y,o+=y.length}else{const h=e.readLen();yield new yt(z(i,o),h),o+=h}}}}class vr{constructor(t,n){this.gen=vl(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===wt);return this.curr}}class Cr{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const Cl=e=>dn(e,Ns,Ke),El=(e,t)=>{if(e.constructor===yt){const{client:n,clock:s}=e.id;return new yt(z(n,s+t),e.length-t)}else if(e.constructor===wt){const{client:n,clock:s}=e.id;return new wt(z(n,s+t),e.length-t)}else{const n=e,{client:s,clock:i}=n.id;return new ot(z(s,i+t),null,z(s,i+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},dn=(e,t=Ee,n=ae)=>{if(e.length===1)return e[0];const s=e.map(b=>new t(Ut(b)));let i=s.map(b=>new vr(b,!0)),o=null;const c=new n,a=new Cr(c);for(;i=i.filter(f=>f.curr!==null),i.sort((f,g)=>{if(f.curr.id.client===g.curr.id.client){const p=f.curr.id.clock-g.curr.id.clock;return p===0?f.curr.constructor===g.curr.constructor?0:f.curr.constructor===wt?1:-1:p}else return g.curr.id.client-f.curr.id.client}),i.length!==0;){const b=i[0],u=b.curr.id.client;if(o!==null){let f=b.curr,g=!1;for(;f!==null&&f.id.clock+f.length<=o.struct.id.clock+o.struct.length&&f.id.client>=o.struct.id.client;)f=b.next(),g=!0;if(f===null||f.id.client!==u||g&&f.id.clock>o.struct.id.clock+o.struct.length)continue;if(u!==o.struct.id.client)zt(a,o.struct,o.offset),o={struct:f,offset:0},b.next();else if(o.struct.id.clock+o.struct.length<f.id.clock)if(o.struct.constructor===wt)o.struct.length=f.id.clock+f.length-o.struct.id.clock;else{zt(a,o.struct,o.offset);const p=f.id.clock-o.struct.id.clock-o.struct.length;o={struct:new wt(z(u,o.struct.id.clock+o.struct.length),p),offset:0}}else{const p=o.struct.id.clock+o.struct.length-f.id.clock;p>0&&(o.struct.constructor===wt?o.struct.length-=p:f=El(f,p)),o.struct.mergeWith(f)||(zt(a,o.struct,o.offset),o={struct:f,offset:0},b.next())}}else o={struct:b.curr,offset:0},b.next();for(let f=b.curr;f!==null&&f.id.client===u&&f.id.clock===o.struct.id.clock+o.struct.length&&f.constructor!==wt;f=b.next())zt(a,o.struct,o.offset),o={struct:f,offset:0}}o!==null&&(zt(a,o.struct,o.offset),o=null),Er(a);const h=s.map(b=>br(b)),y=zo(h);return Te(c,y),c.toUint8Array()},Sl=(e,t,n=Ee,s=ae)=>{const i=js(t),o=new s,c=new Cr(o),a=new n(Ut(e)),h=new vr(a,!1);for(;h.curr;){const b=h.curr,u=b.id.client,f=i.get(u)||0;if(h.curr.constructor===wt){h.next();continue}if(b.id.clock+b.length>f)for(zt(c,b,de(f-b.id.clock,0)),h.next();h.curr&&h.curr.id.client===u;)zt(c,h.curr,0),h.next();else for(;h.curr&&h.curr.id.client===u&&h.curr.id.clock+h.curr.length<=f;)h.next()}Er(c);const y=br(a);return Te(o,y),o.toUint8Array()},$s=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:nt(e.encoder.restEncoder)}),e.encoder.restEncoder=ht(),e.written=0)},zt=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&$s(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),V(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Er=e=>{$s(e);const t=e.encoder.restEncoder;V(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const s=e.clientStructs[n];V(t,s.written),Dn(t,s.restEncoder)}},kl=(e,t,n)=>{const s=new t(Ut(e)),i=new vr(s,!1),o=new n,c=new Cr(o);for(let h=i.curr;h!==null;h=i.next())zt(c,h,0);Er(c);const a=br(s);return Te(o,a),o.toUint8Array()},Tl=e=>kl(e,Ee,Ke);class On{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null}get path(){return Rl(this.currentTarget,this.target)}deletes(t){return Is(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(i=>{if(i!==null){const o=n._map.get(i);let c,a;if(this.adds(o)){let h=o.left;for(;h!==null&&this.adds(h);)h=h.left;if(this.deletes(o))if(h!==null&&this.deletes(h))c="delete",a=jn(h.content.getContent());else return;else h!==null&&this.deletes(h)?(c="update",a=jn(h.content.getContent())):(c="add",a=void 0)}else if(this.deletes(o))c="delete",a=jn(o.content.getContent());else return;t.set(i,{action:c,oldValue:a})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){const n=this.target,s=Ue(),i=Ue(),o=[];if(t={added:s,deleted:i,delta:o,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const h=()=>{a&&o.push(a)};for(let y=n._start;y!==null;y=y.right)y.deleted?this.deletes(y)&&!this.adds(y)&&((a===null||a.delete===void 0)&&(h(),a={delete:0}),a.delete+=y.length,i.add(y)):this.adds(y)?((a===null||a.insert===void 0)&&(h(),a={insert:[]}),a.insert=a.insert.concat(y.content.getContent()),s.add(y)):((a===null||a.retain===void 0)&&(h(),a={retain:0}),a.retain+=y.length);a!==null&&a.retain===void 0&&h()}this._changes=t}return t}}const Rl=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let s=0,i=t._item.parent._start;for(;i!==t._item&&i!==null;)i.deleted||s++,i=i.right;n.unshift(s)}t=t._item.parent}return n},Ys=80;let Sr=0;class Al{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=Sr++}}const Dl=e=>{e.timestamp=Sr++},Ks=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Sr++},Il=(e,t,n)=>{if(e.length>=Ys){const s=e.reduce((i,o)=>i.timestamp<o.timestamp?i:o);return Ks(s,t,n),s}else{const s=new Al(t,n);return e.push(s),s}},Nn=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((o,c)=>en(t-o.index)<en(t-c.index)?o:c);let s=e._start,i=0;for(n!==null&&(s=n.p,i=n.index,Dl(n));s.right!==null&&i<t;){if(!s.deleted&&s.countable){if(t<i+s.length)break;i+=s.length}s=s.right}for(;s.left!==null&&i>t;)s=s.left,!s.deleted&&s.countable&&(i-=s.length);for(;s.left!==null&&s.left.id.client===s.id.client&&s.left.id.clock+s.left.length===s.id.clock;)s=s.left,!s.deleted&&s.countable&&(i-=s.length);return n!==null&&en(n.index-i)<s.parent.length/Ys?(Ks(n,s,i),n):Il(e._searchMarker,s,i)},Be=(e,t,n)=>{for(let s=e.length-1;s>=0;s--){const i=e[s];if(n>0){let o=i.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(i.index-=o.length);if(o===null||o.marker===!0){e.splice(s,1);continue}i.p=o,o.marker=!0}(t<i.index||n>0&&t===i.index)&&(i.index=de(t,i.index+n))}},Mn=(e,t,n)=>{const s=e,i=t.changedParentTypes;for(;bt(i,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;Ps(s._eH,n,t)};class ft{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Xr(),this._dEH=Xr(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw It()}clone(){throw It()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Zr(this._eH,t)}observeDeep(t){Zr(this._dEH,t)}unobserve(t){ts(this._eH,t)}unobserveDeep(t){ts(this._dEH,t)}toJSON(){}}const Qs=(e,t,n)=>{t<0&&(t=e._length+t),n<0&&(n=e._length+n);let s=n-t;const i=[];let o=e._start;for(;o!==null&&s>0;){if(o.countable&&!o.deleted){const c=o.content.getContent();if(c.length<=t)t-=c.length;else{for(let a=t;a<c.length&&s>0;a++)i.push(c[a]),s--;t=0}}o=o.right}return i},Gs=e=>{const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const s=n.content.getContent();for(let i=0;i<s.length;i++)t.push(s[i])}n=n.right}return t},Pe=(e,t)=>{let n=0,s=e._start;for(;s!==null;){if(s.countable&&!s.deleted){const i=s.content.getContent();for(let o=0;o<i.length;o++)t(i[o],n++,e)}s=s.right}},zs=(e,t)=>{const n=[];return Pe(e,(s,i)=>{n.push(t(s,i,e))}),n},Ll=e=>{let t=e._start,n=null,s=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),s=0,t=t.right}const i=n[s++];return n.length<=s&&(n=null),{done:!1,value:i}}}},Js=(e,t)=>{const n=Nn(e,t);let s=e._start;for(n!==null&&(s=n.p,t-=n.index);s!==null;s=s.right)if(!s.deleted&&s.countable){if(t<s.length)return s.content.getContent()[t];t-=s.length}},fn=(e,t,n,s)=>{let i=n;const o=e.doc,c=o.clientID,a=o.store,h=n===null?t._start:n.right;let y=[];const b=()=>{y.length>0&&(i=new ot(z(c,ut(a,c)),i,i&&i.lastId,h,h&&h.id,t,null,new ue(y)),i.integrate(e,0),y=[])};s.forEach(u=>{if(u===null)y.push(u);else switch(u.constructor){case Number:case Object:case Boolean:case Array:case String:y.push(u);break;default:switch(b(),u.constructor){case Uint8Array:case ArrayBuffer:i=new ot(z(c,ut(a,c)),i,i&&i.lastId,h,h&&h.id,t,null,new Qe(new Uint8Array(u))),i.integrate(e,0);break;case Re:i=new ot(z(c,ut(a,c)),i,i&&i.lastId,h,h&&h.id,t,null,new Ge(u)),i.integrate(e,0);break;default:if(u instanceof ft)i=new ot(z(c,ut(a,c)),i,i&&i.lastId,h,h&&h.id,t,null,new Ht(u)),i.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),b()},Xs=ke("Length exceeded!"),Zs=(e,t,n,s)=>{if(n>t._length)throw Xs;if(n===0)return t._searchMarker&&Be(t._searchMarker,n,s.length),fn(e,t,null,s);const i=n,o=Nn(t,n);let c=t._start;for(o!==null&&(c=o.p,n-=o.index,n===0&&(c=c.prev,n+=c&&c.countable&&!c.deleted?c.length:0));c!==null;c=c.right)if(!c.deleted&&c.countable){if(n<=c.length){n<c.length&&te(e,z(c.id.client,c.id.clock+n));break}n-=c.length}return t._searchMarker&&Be(t._searchMarker,i,s.length),fn(e,t,c,s)},xl=(e,t,n)=>{let i=(t._searchMarker||[]).reduce((o,c)=>c.index>o.index?c:o,{index:0,p:t._start}).p;if(i)for(;i.right;)i=i.right;return fn(e,t,i,n)},ti=(e,t,n,s)=>{if(s===0)return;const i=n,o=s,c=Nn(t,n);let a=t._start;for(c!==null&&(a=c.p,n-=c.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&te(e,z(a.id.client,a.id.clock+n)),n-=a.length);for(;s>0&&a!==null;)a.deleted||(s<a.length&&te(e,z(a.id.client,a.id.clock+s)),a.delete(e),s-=a.length),a=a.right;if(s>0)throw Xs;t._searchMarker&&Be(t._searchMarker,i,-o+s)},pn=(e,t,n)=>{const s=t._map.get(n);s!==void 0&&s.delete(e)},kr=(e,t,n,s)=>{const i=t._map.get(n)||null,o=e.doc,c=o.clientID;let a;if(s==null)a=new ue([s]);else switch(s.constructor){case Number:case Object:case Boolean:case Array:case String:a=new ue([s]);break;case Uint8Array:a=new Qe(s);break;case Re:a=new Ge(s);break;default:if(s instanceof ft)a=new Ht(s);else throw new Error("Unexpected content type")}new ot(z(c,ut(o.store,c)),i,i&&i.lastId,null,null,t,n,a).integrate(e,0)},Tr=(e,t)=>{const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},ei=e=>{const t={};return e._map.forEach((n,s)=>{n.deleted||(t[s]=n.content.getContent()[n.length-1])}),t},ni=(e,t)=>{const n=e._map.get(t);return n!==void 0&&!n.deleted},Ze=e=>Qo(e.entries(),t=>!t[1].deleted);class Ol extends On{constructor(t,n){super(t,n),this._transaction=n}}class Pt extends ft{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new Pt;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Pt}clone(){const t=new Pt;return t.insert(0,this.toArray().map(n=>n instanceof ft?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(t,n){super._callObserver(t,n),Mn(this,t,new Ol(this,t))}insert(t,n){this.doc!==null?tt(this.doc,s=>{Zs(s,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?tt(this.doc,n=>{xl(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?tt(this.doc,s=>{ti(s,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Js(this,t)}toArray(){return Gs(this)}slice(t=0,n=this.length){return Qs(this,t,n)}toJSON(){return this.map(t=>t instanceof ft?t.toJSON():t)}map(t){return zs(this,t)}forEach(t){Pe(this,t)}[Symbol.iterator](){return Ll(this)}_write(t){t.writeTypeRef(nc)}}const Nl=e=>new Pt;class Ml extends On{constructor(t,n,s){super(t,n),this.keysChanged=s}}class Vt extends ft{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((s,i)=>{this.set(i,s)}),this._prelimContent=null}_copy(){return new Vt}clone(){const t=new Vt;return this.forEach((n,s)=>{t.set(s,n instanceof ft?n.clone():n)}),t}_callObserver(t,n){Mn(this,t,new Ml(this,t,n))}toJSON(){const t={};return this._map.forEach((n,s)=>{if(!n.deleted){const i=n.content.getContent()[n.length-1];t[s]=i instanceof ft?i.toJSON():i}}),t}get size(){return[...Ze(this._map)].length}keys(){return Hn(Ze(this._map),t=>t[0])}values(){return Hn(Ze(this._map),t=>t[1].content.getContent()[t[1].length-1])}entries(){return Hn(Ze(this._map),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){const n={};return this._map.forEach((s,i)=>{s.deleted||t(s.content.getContent()[s.length-1],i,this)}),n}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?tt(this.doc,n=>{pn(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?tt(this.doc,s=>{kr(s,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return Tr(this,t)}has(t){return ni(this,t)}clear(){this.doc!==null?tt(this.doc,t=>{this.forEach(function(n,s,i){pn(t,i,s)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(rc)}}const Ul=e=>new Vt,Jt=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&Uo(e,t);class er{constructor(t,n,s,i){this.left=t,this.right=n,this.index=s,this.currentAttributes=i}forward(){switch(this.right===null&&Ot(),this.right.content.constructor){case lt:this.right.deleted||Ae(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const ss=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case lt:t.right.deleted||Ae(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&te(e,z(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},tn=(e,t,n)=>{const s=new Map,i=Nn(t,n);if(i){const o=new er(i.p.left,i.p,i.index,s);return ss(e,o,n-i.index)}else{const o=new er(null,t._start,0,s);return ss(e,o,n)}},ri=(e,t,n,s)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===lt&&Jt(s.get(n.right.content.key),n.right.content.value));)n.right.deleted||s.delete(n.right.content.key),n.forward();const i=e.doc,o=i.clientID;s.forEach((c,a)=>{const h=n.left,y=n.right,b=new ot(z(o,ut(i.store,o)),h,h&&h.lastId,y,y&&y.id,t,null,new lt(a,c));b.integrate(e,0),n.right=b,n.forward()})},Ae=(e,t)=>{const{key:n,value:s}=t;s===null?e.delete(n):e.set(n,s)},si=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===lt&&Jt(t[e.right.content.key]||null,e.right.content.value)))break;e.forward()}},ii=(e,t,n,s)=>{const i=e.doc,o=i.clientID,c=new Map;for(const a in s){const h=s[a],y=n.currentAttributes.get(a)||null;if(!Jt(y,h)){c.set(a,y);const{left:b,right:u}=n;n.right=new ot(z(o,ut(i.store,o)),b,b&&b.lastId,u,u&&u.id,t,null,new lt(a,h)),n.right.integrate(e,0),n.forward()}}return c},Yn=(e,t,n,s,i)=>{n.currentAttributes.forEach((f,g)=>{i[g]===void 0&&(i[g]=null)});const o=e.doc,c=o.clientID;si(n,i);const a=ii(e,t,n,i),h=s.constructor===String?new Mt(s):s instanceof ft?new Ht(s):new pe(s);let{left:y,right:b,index:u}=n;t._searchMarker&&Be(t._searchMarker,n.index,h.getLength()),b=new ot(z(c,ut(o.store,c)),y,y&&y.lastId,b,b&&b.id,t,null,h),b.integrate(e,0),n.right=b,n.index=u,n.forward(),ri(e,t,n,a)},is=(e,t,n,s,i)=>{const o=e.doc,c=o.clientID;si(n,i);const a=ii(e,t,n,i);t:for(;n.right!==null&&(s>0||a.size>0&&(n.right.deleted||n.right.content.constructor===lt));){if(!n.right.deleted)switch(n.right.content.constructor){case lt:{const{key:h,value:y}=n.right.content,b=i[h];if(b!==void 0){if(Jt(b,y))a.delete(h);else{if(s===0)break t;a.set(h,y)}n.right.delete(e)}else n.currentAttributes.set(h,y);break}default:s<n.right.length&&te(e,z(n.right.id.client,n.right.id.clock+s)),s-=n.right.length;break}n.forward()}if(s>0){let h="";for(;s>0;s--)h+=`
`;n.right=new ot(z(c,ut(o.store,c)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Mt(h)),n.right.integrate(e,0),n.forward()}ri(e,t,n,a)},oi=(e,t,n,s,i)=>{let o=n;const c=an(i);for(;o&&(!o.countable||o.deleted);)!o.deleted&&o.content.constructor===lt&&Ae(c,o.content),o=o.right;let a=0,h=!1;for(;t!==o;){if(n===t&&(h=!0),!t.deleted){const y=t.content;switch(y.constructor){case lt:{const{key:b,value:u}=y;((c.get(b)||null)!==u||(s.get(b)||null)===u)&&(t.delete(e),a++,!h&&(i.get(b)||null)===u&&(s.get(b)||null)!==u&&i.delete(b));break}}}t=t.right}return a},Fl=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===lt){const s=t.content.key;n.has(s)?t.delete(e):n.add(s)}t=t.left}},jl=e=>{let t=0;return tt(e.doc,n=>{let s=e._start,i=e._start,o=At();const c=an(o);for(;i;){if(i.deleted===!1)switch(i.content.constructor){case lt:Ae(c,i.content);break;default:t+=oi(n,s,i,o,c),o=an(c),s=i;break}i=i.right}}),t},os=(e,t,n)=>{const s=n,i=an(t.currentAttributes),o=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Ht:case pe:case Mt:n<t.right.length&&te(e,z(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}o&&oi(e,o,t.right,i,t.currentAttributes);const c=(t.left||t.right).parent;return c._searchMarker&&Be(c._searchMarker,t.index,-s+n),t};class Bl extends On{constructor(t,n,s){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,s.forEach(i=>{i===null?this.childListChanged=!0:this.keysChanged.add(i)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];tt(t,s=>{const i=new Map,o=new Map;let c=this.target._start,a=null;const h={};let y="",b=0,u=0;const f=()=>{if(a!==null){let g;switch(a){case"delete":g={delete:u},u=0;break;case"insert":g={insert:y},i.size>0&&(g.attributes={},i.forEach((p,C)=>{p!==null&&(g.attributes[C]=p)})),y="";break;case"retain":if(g={retain:b},Object.keys(h).length>0){g.attributes={};for(const p in h)g.attributes[p]=h[p]}b=0;break}n.push(g),a=null}};for(;c!==null;){switch(c.content.constructor){case Ht:case pe:this.adds(c)?this.deletes(c)||(f(),a="insert",y=c.content.getContent()[0],f()):this.deletes(c)?(a!=="delete"&&(f(),a="delete"),u+=1):c.deleted||(a!=="retain"&&(f(),a="retain"),b+=1);break;case Mt:this.adds(c)?this.deletes(c)||(a!=="insert"&&(f(),a="insert"),y+=c.content.str):this.deletes(c)?(a!=="delete"&&(f(),a="delete"),u+=c.length):c.deleted||(a!=="retain"&&(f(),a="retain"),b+=c.length);break;case lt:{const{key:g,value:p}=c.content;if(this.adds(c)){if(!this.deletes(c)){const C=i.get(g)||null;Jt(C,p)?p!==null&&c.delete(s):(a==="retain"&&f(),Jt(p,o.get(g)||null)?delete h[g]:h[g]=p)}}else if(this.deletes(c)){o.set(g,p);const C=i.get(g)||null;Jt(C,p)||(a==="retain"&&f(),h[g]=C)}else if(!c.deleted){o.set(g,p);const C=h[g];C!==void 0&&(Jt(C,p)?C!==null&&c.delete(s):(a==="retain"&&f(),p===null?delete h[g]:h[g]=p))}c.deleted||(a==="insert"&&f(),Ae(i,c.content));break}}c=c.right}for(f();n.length>0;){const g=n[n.length-1];if(g.retain!==void 0&&g.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class Se extends ft{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[]}get length(){return this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(s=>s())}catch(s){console.error(s)}this._pending=null}_copy(){return new Se}clone(){const t=new Se;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const s=new Bl(this,t,n),i=t.doc;if(Mn(this,t,s),!t.local){let o=!1;for(const[c,a]of t.afterState.entries()){const h=t.beforeState.get(c)||0;if(a!==h&&(Ws(t,i.store.clients.get(c),h,a,y=>{!y.deleted&&y.content.constructor===lt&&(o=!0)}),o))break}o||Zn(t,t.deleteSet,c=>{c instanceof yt||o||c.parent===this&&c.content.constructor===lt&&(o=!0)}),tt(i,c=>{o?jl(this):Zn(c,c.deleteSet,a=>{a instanceof yt||a.parent===this&&Fl(c,a)})})}}toString(){let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Mt&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?tt(this.doc,s=>{const i=new er(null,this._start,0,new Map);for(let o=0;o<t.length;o++){const c=t[o];if(c.insert!==void 0){const a=!n&&typeof c.insert=="string"&&o===t.length-1&&i.right===null&&c.insert.slice(-1)===`
`?c.insert.slice(0,-1):c.insert;(typeof a!="string"||a.length>0)&&Yn(s,this,i,a,c.attributes||{})}else c.retain!==void 0?is(s,this,i,c.retain,c.attributes||{}):c.delete!==void 0&&os(s,i,c.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,s){const i=[],o=new Map,c=this.doc;let a="",h=this._start;function y(){if(a.length>0){const b={};let u=!1;o.forEach((g,p)=>{u=!0,b[p]=g});const f={insert:a};u&&(f.attributes=b),i.push(f),a=""}}return tt(c,b=>{for(t&&sn(b,t),n&&sn(b,n);h!==null;){if(Oe(h,t)||n!==void 0&&Oe(h,n))switch(h.content.constructor){case Mt:{const u=o.get("ychange");t!==void 0&&!Oe(h,t)?(u===void 0||u.user!==h.id.client||u.state!=="removed")&&(y(),o.set("ychange",s?s("removed",h.id):{type:"removed"})):n!==void 0&&!Oe(h,n)?(u===void 0||u.user!==h.id.client||u.state!=="added")&&(y(),o.set("ychange",s?s("added",h.id):{type:"added"})):u!==void 0&&(y(),o.delete("ychange")),a+=h.content.str;break}case Ht:case pe:{y();const u={insert:h.content.getContent()[0]};if(o.size>0){const f={};u.attributes=f,o.forEach((g,p)=>{f[p]=g})}i.push(u);break}case lt:Oe(h,t)&&(y(),Ae(o,h.content));break}h=h.right}y()},sn),i}insert(t,n,s){if(n.length<=0)return;const i=this.doc;i!==null?tt(i,o=>{const c=tn(o,this,t);s||(s={},c.currentAttributes.forEach((a,h)=>{s[h]=a})),Yn(o,this,c,n,s)}):this._pending.push(()=>this.insert(t,n,s))}insertEmbed(t,n,s={}){const i=this.doc;i!==null?tt(i,o=>{const c=tn(o,this,t);Yn(o,this,c,n,s)}):this._pending.push(()=>this.insertEmbed(t,n,s))}delete(t,n){if(n===0)return;const s=this.doc;s!==null?tt(s,i=>{os(i,tn(i,this,t),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,s){if(n===0)return;const i=this.doc;i!==null?tt(i,o=>{const c=tn(o,this,t);c.right!==null&&is(o,this,c,n,s)}):this._pending.push(()=>this.format(t,n,s))}removeAttribute(t){this.doc!==null?tt(this.doc,n=>{pn(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?tt(this.doc,s=>{kr(s,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return Tr(this,t)}getAttributes(t){return ei(this)}_write(t){t.writeTypeRef(sc)}}const Pl=e=>new Se;class Kn{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===qe||n.constructor===he)&&n._start!==null)t=n._start;else for(;t!==null;)if(t.right!==null){t=t.right;break}else t.parent===this._root?t=null:t=t.parent._item;while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class he extends ft{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new he}clone(){const t=new he;return t.insert(0,this.toArray().map(n=>n instanceof ft?n.clone():n)),t}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Kn(this,t)}querySelector(t){t=t.toUpperCase();const s=new Kn(this,i=>i.nodeName&&i.nodeName.toUpperCase()===t).next();return s.done?null:s.value}querySelectorAll(t){return t=t.toUpperCase(),Array.from(new Kn(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){Mn(this,t,new Wl(this,n,t))}toString(){return zs(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},s){const i=t.createDocumentFragment();return s!==void 0&&s._createAssociation(i,this),Pe(this,o=>{i.insertBefore(o.toDOM(t,n,s),null)}),i}insert(t,n){this.doc!==null?tt(this.doc,s=>{Zs(s,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)tt(this.doc,s=>{const i=t&&t instanceof ft?t._item:t;fn(s,this,i,n)});else{const s=this._prelimContent,i=t===null?0:s.findIndex(o=>o===t)+1;if(i===0&&t!==null)throw ke("Reference item not found");s.splice(i,0,...n)}}delete(t,n=1){this.doc!==null?tt(this.doc,s=>{ti(s,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Gs(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Js(this,t)}slice(t=0,n=this.length){return Qs(this,t,n)}forEach(t){Pe(this,t)}_write(t){t.writeTypeRef(oc)}}const ql=e=>new he;class qe extends he{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((s,i)=>{this.setAttribute(i,s)}),this._prelimAttrs=null}_copy(){return new qe(this.nodeName)}clone(){const t=new qe(this.nodeName),n=this.getAttributes();for(const s in n)t.setAttribute(s,n[s]);return t.insert(0,this.toArray().map(s=>s instanceof ft?s.clone():s)),t}toString(){const t=this.getAttributes(),n=[],s=[];for(const a in t)s.push(a);s.sort();const i=s.length;for(let a=0;a<i;a++){const h=s[a];n.push(h+'="'+t[h]+'"')}const o=this.nodeName.toLocaleLowerCase(),c=n.length>0?" "+n.join(" "):"";return`<${o}${c}>${super.toString()}</${o}>`}removeAttribute(t){this.doc!==null?tt(this.doc,n=>{pn(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?tt(this.doc,s=>{kr(s,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return Tr(this,t)}hasAttribute(t){return ni(this,t)}getAttributes(t){return ei(this)}toDOM(t=document,n={},s){const i=t.createElement(this.nodeName),o=this.getAttributes();for(const c in o)i.setAttribute(c,o[c]);return Pe(this,c=>{i.appendChild(c.toDOM(t,n,s))}),s!==void 0&&s._createAssociation(i,this),i}_write(t){t.writeTypeRef(ic),t.writeKey(this.nodeName)}}const Vl=e=>new qe(e.readKey());class Wl extends On{constructor(t,n,s){super(t,s),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(i=>{i===null?this.childListChanged=!0:this.attributesChanged.add(i)})}}class gn extends Vt{constructor(t){super(),this.hookName=t}_copy(){return new gn(this.hookName)}clone(){const t=new gn(this.hookName);return this.forEach((n,s)=>{t.set(s,n)}),t}toDOM(t=document,n={},s){const i=n[this.hookName];let o;return i!==void 0?o=i.createDom(this):o=document.createElement(this.hookName),o.setAttribute("data-yjs-hook",this.hookName),s!==void 0&&s._createAssociation(o,this),o}_write(t){t.writeTypeRef(lc),t.writeKey(this.hookName)}}const Hl=e=>new gn(e.readKey());class mn extends Se{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new mn}clone(){const t=new mn;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,s){const i=t.createTextNode(this.toString());return s!==void 0&&s._createAssociation(i,this),i}toString(){return this.toDelta().map(t=>{const n=[];for(const i in t.attributes){const o=[];for(const c in t.attributes[i])o.push({key:c,value:t.attributes[i][c]});o.sort((c,a)=>c.key<a.key?-1:1),n.push({nodeName:i,attrs:o})}n.sort((i,o)=>i.nodeName<o.nodeName?-1:1);let s="";for(let i=0;i<n.length;i++){const o=n[i];s+=`<${o.nodeName}`;for(let c=0;c<o.attrs.length;c++){const a=o.attrs[c];s+=` ${a.key}="${a.value}"`}s+=">"}s+=t.insert;for(let i=n.length-1;i>=0;i--)s+=`</${n[i].nodeName}>`;return s}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(cc)}}const $l=e=>new mn;class Rr{constructor(t,n){this.id=t,this.length=n}get deleted(){throw It()}mergeWith(t){return!1}write(t,n,s){throw It()}integrate(t,n){throw It()}}const Yl=0;class yt extends Rr{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),Vs(t.doc.store,this)}write(t,n){t.writeInfo(Yl),t.writeLen(this.length-n)}getMissing(t,n){return null}}class Qe{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new Qe(this.content)}splice(t){throw It()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const Kl=e=>new Qe(e.readBuf());class Ve{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Ve(this.len)}splice(t){const n=new Ve(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){un(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const Ql=e=>new Ve(e.readLen()),li=(e,t)=>new Re({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Ge{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Ge(li(this.doc.guid,this.opts))}splice(t){throw It()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const Gl=e=>new Ge(li(e.readString(),e.readAny()));class pe{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new pe(this.embed)}splice(t){throw It()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const zl=e=>new pe(e.readJSON());class lt{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new lt(this.key,this.value)}splice(t){throw It()}mergeWith(t){return!1}integrate(t,n){n.parent._searchMarker=null}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const Jl=e=>new lt(e.readKey(),e.readJSON());class yn{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new yn(this.arr)}splice(t){const n=new yn(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const s=this.arr.length;t.writeLen(s-n);for(let i=n;i<s;i++){const o=this.arr[i];t.writeString(o===void 0?"undefined":JSON.stringify(o))}}getRef(){return 2}}const Xl=e=>{const t=e.readLen(),n=[];for(let s=0;s<t;s++){const i=e.readString();i==="undefined"?n.push(void 0):n.push(JSON.parse(i))}return new yn(n)};class ue{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ue(this.arr)}splice(t){const n=new ue(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const s=this.arr.length;t.writeLen(s-n);for(let i=n;i<s;i++){const o=this.arr[i];t.writeAny(o)}}getRef(){return 8}}const Zl=e=>{const t=e.readLen(),n=[];for(let s=0;s<t;s++)n.push(e.readAny());return new ue(n)};class Mt{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Mt(this.str)}splice(t){const n=new Mt(this.str.slice(t));this.str=this.str.slice(0,t);const s=this.str.charCodeAt(t-1);return s>=55296&&s<=56319&&(this.str=this.str.slice(0,t-1)+"\uFFFD",n.str="\uFFFD"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const tc=e=>new Mt(e.readString()),ec=[Nl,Ul,Pl,Vl,ql,Hl,$l],nc=0,rc=1,sc=2,ic=3,oc=4,lc=5,cc=6;class Ht{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Ht(this.type._copy())}splice(t){throw It()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(s=>{s.deleted?t._mergeStructs.push(s):s.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(s=>{for(;s!==null;)s.gc(t,!0),s=s.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const ac=e=>new Ht(ec[e.readTypeRef()](e));const wn=(e,t,n)=>{const{client:s,clock:i}=t.id,o=new ot(z(s,i+n),t,z(s,i+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&o.markDeleted(),t.keep&&(o.keep=!0),t.redone!==null&&(o.redone=z(t.redone.client,t.redone.clock+n)),t.right=o,o.right!==null&&(o.right.left=o),e._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),t.length=n,o};class ot extends Rr{constructor(t,n,s,i,o,c,a,h){super(t,h.getLength()),this.origin=s,this.left=n,this.right=i,this.rightOrigin=o,this.parent=c,this.parentSub=a,this.redone=null,this.content=h,this.info=this.content.isCountable()?Vr:0}set marker(t){(this.info&Pn)>0!==t&&(this.info^=Pn)}get marker(){return(this.info&Pn)>0}get keep(){return(this.info&qr)>0}set keep(t){this.keep!==t&&(this.info^=qr)}get countable(){return(this.info&Vr)>0}get deleted(){return(this.info&Bn)>0}set deleted(t){this.deleted!==t&&(this.info^=Bn)}markDeleted(){this.info|=Bn}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=ut(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=ut(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===be&&this.id.client!==this.parent.client&&this.parent.clock>=ut(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=es(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=te(t,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===yt||this.right&&this.right.constructor===yt)&&(this.parent=null),!this.parent)this.left&&this.left.constructor===ot&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===ot&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===be){const s=$n(n,this.parent);s.constructor===yt?this.parent=null:this.parent=s.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=es(t,t.doc.store,z(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let s=this.left,i;if(s!==null)i=s.right;else if(this.parentSub!==null)for(i=this.parent._map.get(this.parentSub)||null;i!==null&&i.left!==null;)i=i.left;else i=this.parent._start;const o=new Set,c=new Set;for(;i!==null&&i!==this.right;){if(c.add(i),o.add(i),Xe(this.origin,i.origin)){if(i.id.client<this.id.client)s=i,o.clear();else if(Xe(this.rightOrigin,i.rightOrigin))break}else if(i.origin!==null&&c.has($n(t.doc.store,i.origin)))o.has($n(t.doc.store,i.origin))||(s=i,o.clear());else break;i=i.right}this.left=s}if(this.left!==null){const s=this.left.right;this.right=s,this.left.right=this}else{let s;if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start,this.parent._start=this;this.right=s}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Vs(t.doc.store,this),this.content.integrate(t,this),rs(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new yt(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:z(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Xe(t.origin,this.lastId)&&this.right===t&&Xe(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(s=>{s.p===t&&(s.p=this,!this.deleted&&this.countable&&(s.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),un(t.deleteSet,this.id.client,this.id.clock,this.length),rs(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw Ot();this.content.gc(t),n?yl(t,this,new yt(this.id,this.length)):this.content=new Ve(this.length)}write(t,n){const s=n>0?z(this.id.client,this.id.clock+n-1):this.origin,i=this.rightOrigin,o=this.parentSub,c=this.content.getRef()&Rn|(s===null?0:mt)|(i===null?0:jt)|(o===null?0:Fe);if(t.writeInfo(c),s!==null&&t.writeLeftID(s),i!==null&&t.writeRightID(i),s===null&&i===null){const a=this.parent;if(a._item!==void 0){const h=a._item;if(h===null){const y=fl(a);t.writeParentInfo(!0),t.writeString(y)}else t.writeParentInfo(!1),t.writeLeftID(h.id)}else a.constructor===String?(t.writeParentInfo(!0),t.writeString(a)):a.constructor===be?(t.writeParentInfo(!1),t.writeLeftID(a)):Ot();o!==null&&t.writeString(o)}this.content.write(t,n)}}const ci=(e,t)=>hc[t&Rn](e),hc=[()=>{Ot()},Ql,Xl,Kl,tc,zl,Jl,ac,Zl,Gl,()=>{Ot()}],uc=10;class wt extends Rr{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){Ot()}write(t,n){t.writeInfo(uc),V(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const ai=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:{},hi="__ $YJS$ __";ai[hi]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");ai[hi]=!0;const ui="from-remesh-yjs",dc=e=>new Oi(t=>{const n=(o,c)=>{if(c.origin!==ui){const a=e.toJSON();t.next(a)}},s=()=>{e.observeDeep(n)},i=()=>{e.unobserveDeep(n)};return s(),()=>{i()}}),di=Lt.extern({default:null}),fc=(e,t)=>{const n=e.getExtern(di);if(n===null)return null;function s(y){if(!(Array.isArray(y)&&t.dataType==="array")&&!(y!==null&&typeof y=="object"&&t.dataType==="object"))throw new Error(`Expected value to be of type ${t.dataType}, got ${y}`)}const i=y=>y.get(t.key,t.dataType==="object"?Vt:Pt),o=Lt.event({name:"ReceivedEvent"}),c=Lt.event({name:"SendEvent"}),a=e.query({name:"DataForSyncQuery",impl:t.onSend}),h=e.command({name:"SyncDataCommand",impl:(y,b)=>[t.onReceive(y,b),o(b)]});e.effect({name:"YjsEffect",impl:({get:y,fromQuery:b})=>{const{doc:u}=n,f=i(u),g=b(a()).pipe(cn(C=>{s(C);const x=f.toJSON(),L=bn(x,C);return L===null?null:(tt(u,()=>{Dr(f,L)},ui),c(C))})),p=dc(f).pipe(cn(C=>{s(C);const x=y(a());if(x===null)return h(C);const L=bn(x,C);if(L===null)return null;const M=Ar(x,L);return h(M)}));return Mi(g,p)}})},fi=e=>!!e&&(e.type==="object"||e.type==="array"||e.type==="changed"),ls=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),pc=(e,t,n)=>{const s=[],i=[],o=[];for(const[c,a]of Object.entries(t))if(!ls(e,c))s.push({type:"added",key:c,value:a});else if(e[c]!==a){const h=bn(e[c],a,c);fi(h)&&o.push(h)}for(const c of Object.keys(e))ls(t,c)||i.push({type:"deleted",key:c});return s.length===0&&i.length===0&&o.length===0?null:{type:"object",key:n,addedResults:s,deletedResults:i,updatedResults:o}},gc=(e,t,n)=>{const s=[],i=[],o=[];for(let c=0;c<t.length;c++)if(c>=e.length)s.push({type:"added",key:c,value:t[c]});else if(e[c]!==t[c]){const a=bn(e[c],t[c],c);fi(a)&&o.push(a)}for(let c=t.length;c<e.length;c++)i.push({type:"deleted",key:c});return s.length===0&&i.length===0&&o.length===0?null:{type:"array",key:n,addedResults:s,deletedResults:i,updatedResults:o}},bn=(e,t,n)=>e===t?null:e===null||t===null?{type:"changed",key:n,value:t}:Array.isArray(e)&&Array.isArray(t)?gc(e,t,n):typeof e=="object"&&typeof t=="object"?pc(e,t,n):{type:"changed",key:n,value:t},mc=(e,t)=>{const n={...e};for(const s of t.addedResults){if(typeof s.key!="string")throw new Error(`Expected key to be a string, got ${s.key}`);n[s.key]=s.value}for(const s of t.updatedResults){if(typeof s.key!="string")throw new Error(`Expected key to be a string, got ${s.key}`);n[s.key]=Ar(n[s.key],s)}for(const s of t.deletedResults){if(typeof s.key!="string")throw new Error(`Expected key to be a string, got ${s.key}`);delete n[s.key]}return n},yc=(e,t)=>{const n=[...e];for(const s of t.updatedResults){if(typeof s.key!="number")throw new Error(`Expected key to be a number, got ${s.key}`);n[s.key]=Ar(n[s.key],s)}for(let s=t.deletedResults.length-1;s>=0;s--){const i=t.deletedResults[s];if(typeof i.key!="number")throw new Error(`Expected key to be a number, got ${i.key}`);n.splice(i.key,1)}if(t.addedResults.length>0){const s=t.addedResults.map(i=>i.value);n.push(...s)}return n},Ar=(e,t)=>{if(t===null)return e;if(t.type==="object")return mc(e,t);if(t.type==="array")return yc(e,t);if(t.type==="changed")return t.value;throw new Error(`Unknown diff result: ${t}`)},wc=(e,t)=>{const n=t!=null?t:new Pt;for(const s of e)n.push([ze(s)]);return n},bc=(e,t)=>{const n=t!=null?t:new Vt;for(const[s,i]of Object.entries(e))n.set(s,ze(i));return n},ze=e=>{if(Array.isArray(e))return wc(e);if(typeof e=="object"&&e!==null)return bc(e);if(e===void 0)return null;if(typeof e=="string"||typeof e=="number"||typeof e=="boolean")return e;throw new Error(`Cannot convert ${e} to Yjs type`)},_c=(e,t)=>{for(const n of t.updatedResults){if(typeof n.key!="number")throw new Error(`Expected key to be a number, got ${n.key}`);const s=e.get(n.key),i=Dr(s,n);i!==s&&(e.delete(n.key,1),e.insert(n.key,[i]))}for(let n=t.deletedResults.length-1;n>=0;n--){const s=t.deletedResults[n];if(typeof s.key!="number")throw new Error(`Expected key to be a number, got ${s.key}`);e.delete(s.key,1)}if(t.addedResults.length>0){const n=t.addedResults.map(s=>ze(s.value));e.push(n)}},vc=(e,t)=>{for(const n of t.addedResults){if(typeof n.key!="string")throw new Error(`Expected key to be a string, got ${n.key}`);e.set(n.key,ze(n.value))}for(const n of t.updatedResults){if(typeof n.key!="string")throw new Error(`Expected key to be a string, got ${n.key}`);const s=e.get(n.key),i=Dr(s,n);i!==s&&e.set(n.key,i)}for(const n of t.deletedResults){if(typeof n.key!="string")throw new Error(`Expected key to be a string, got ${n.key}`);e.delete(n.key)}},Dr=(e,t)=>{if(t===null)return e;if(t.type==="object"){if(e instanceof Vt)return vc(e,t),e;throw new Error(`Expected value to be a Y.Map, got ${e}`)}if(t.type==="array"){if(e instanceof Pt)return _c(e,t),e;throw new Error(`Expected value to be a Y.Array, got ${e}`)}if(t.type==="changed")return ze(t.value);throw new Error(`Unknown diff result: ${t}`)},Cc=(e,t)=>({listenTo:n=>({get:s=>({set:i=>t({storageKey:e,TriggerEvent:n,get:s,set:i})}),set:s=>t({storageKey:e,TriggerEvent:n,get:i=>i,set:s})})}),Ec=(e,t)=>{const n=e.getExtern(fs);!n||(e.effect({name:"ReadStorageEffect",impl:async s=>{const i=await n.get(t.storageKey);return i?t.set(s,i):null}}),e.effect({name:"WriteStorageEffect",impl:({fromEvent:s})=>s(t.TriggerEvent).pipe(cn(i=>(n.set(t.storageKey,t.get(i)),null)))}))},Ir=(e,t)=>Cc(t,n=>Ec(e,n)),Sc="remesh-example/todo-input",Lr=Lt.domain({name:"TodoInputDomain",impl:e=>{const t=e.state({name:"TodoTextState",default:""}),n=e.query({name:"TodoTextQuery",impl:({get:c})=>c(t())}),s=e.event({name:"TodoInputChangedEvent"}),i=e.command({name:"SetTodoInputCommand",impl:({},c)=>[t().new(c),s(c)]}),o=e.command({name:"ClearTodoInputCommand",impl:({get:c})=>[t().new(""),s("")]});return Ir(e,Sc).listenTo(s).set(({},c)=>i(c)),{query:{TodoInputQuery:n},command:{SetTodoInputCommand:i,ClearTodoInputCommand:o},event:{TodoInputChangedEvent:s}}}}),kc=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)}),Tc="remesh-example/todo-list",ln=e=>e.id,De=Lt.domain({name:"TodoListDomain",impl:e=>{const t=Ui(e,{name:"TodoListModule",key:ln}),n=t.query.ItemListQuery,s=t.query.ItemQuery,i=t.query.KeyListQuery,o=e.event({name:"TodoListChangedEvent",impl:({get:_})=>_(n())}),c=e.command({name:"SetTodoListCommand",impl:({},_)=>[t.command.SetListCommand(_),o()]}),a=e.event({name:"FailedToAddTodoEvent"}),h=e.event({name:"TodoItemAddedEvent"}),y=e.command({name:"AddTodoCommand",impl:({},_)=>{if(_==="")return a({reason:"Title cannot be empty"});const v={id:kc(),title:_,completed:!1};return[t.command.AddItemCommand(v),h(v),o()]}}),b=e.command({name:"UpdateTodoCommand",impl:({},_)=>_.title===""?u(_.id):[t.command.UpdateItemCommand(_),o()]}),u=e.command({name:"DeleteTodoCommand",impl:({},_)=>[t.command.DeleteItemCommand(_),o()]}),f=e.query({name:"ActiveTodoListQuery",impl:({get:_})=>_(n()).filter(T=>!T.completed)}),g=e.query({name:"CompletedTodoListQuery",impl:({get:_})=>_(n()).filter(T=>T.completed)}),p=e.query({name:"ActiveTodoCountQuery",impl:({get:_})=>_(f()).length}),C=e.query({name:"CompletedTodoCountQuery",impl:({get:_})=>_(g()).length}),x=e.query({name:"IsAllCompletedQuery",impl:({get:_})=>{const v=_(n());return v.length===0?!1:_(C())===v.length}}),L=e.command({name:"ToggleTodoCommand",impl:({get:_},v)=>{const T=_(s(v)),E={...T,completed:!T.completed};return b(E)}}),M=e.command({name:"ToggleAllCommand",impl:({get:_})=>{const v=_(n());if(v.length===0)return null;const E=_(p())>0,I=v.map(U=>({...U,completed:E}));return c(I)}}),m=e.command({name:"ClearAllCompletedCommand",impl:({get:_})=>{const v=_(n());if(v.length===0)return null;const T=v.filter(E=>!E.completed);return c(T)}});return Ir(e,Tc).listenTo(o).set(({},_)=>c(_)),{query:{TodoQuery:s,TodoKeyListQuery:i,TodoListQuery:n,ActiveTodoListQuery:f,CompletedTodoListQuery:g,ActiveTodoCountQuery:p,CompletedTodoCountQuery:C,IsAllCompletedQuery:x},command:{SetTodoListCommand:c,AddTodoCommand:y,UpdateTodoCommand:b,DeleteTodoCommand:u,ToggleTodoCommand:L,ToggleAllCommand:M,ClearAllCompletedCommand:m},event:{FailedToAddTodoEvent:a,TodoListChangedEvent:o,TodoItemAddedEvent:h}}}});function pi(e,t){return s=>{const i=Array.isArray(e)?e:[e];for(const o of i)s.key.toLowerCase()===o.toLowerCase()&&(s.preventDefault(),t(s,o))}}const Rc=()=>{const e=En(),t=Xt(Lr()),n=Xt(De()),s=ie(t.query.TodoInputQuery()),i=c=>{e(t.command.SetTodoInputCommand(c.target.value))},o=pi("Enter",()=>{e(n.command.AddTodoCommand(s))});return ds(n.event.FailedToAddTodoEvent,c=>{alert(c.reason)}),Rt("header",{className:"header",children:[X("h1",{children:"todos"}),X("input",{className:"new-todo",placeholder:"What needs to be done?",value:s,onChange:i,onKeyDown:o})]})},Ac="remesh-example/todo-filter",Dc=e=>{if(e===void 0)return"all";switch(e){case"all":case"active":case"completed":return e;default:return"all"}},xr=Lt.domain({name:"TodoFilterDomain",impl:e=>{const t=e.state({name:"TodoFilterState",default:"all"}),n=e.query({name:"TodoFilterQuery",impl:({get:o})=>o(t())}),s=e.event({name:"TodoFilterChangedEvent"}),i=e.command({name:"SetFilterCommand",impl:({},o)=>{const c=Dc(o);return[t().new(c),s(c)]}});return Ir(e,Ac).listenTo(s).set(({},o)=>i(o)),{query:{TodoFilterQuery:n},command:{SetFilterCommand:i},event:{TodoFilterChangedEvent:s}}}}),Ic=Lt.domain({name:"TodoAppDomain",impl:e=>{const t=e.getDomain(Lr()),n=e.getDomain(De()),s=e.getDomain(xr()),i=e.query({name:"FilteredTodoKeyListQuery",impl:({get:o})=>{const c=o(s.query.TodoFilterQuery());if(c==="all")return o(n.query.TodoListQuery()).map(ln);if(c==="active")return o(n.query.ActiveTodoListQuery()).map(ln);if(c==="completed")return o(n.query.CompletedTodoListQuery()).map(ln);throw new Error(`Unknown filter: ${c}`)}});return e.effect({name:"ClearTodoInputWhenTodoAddedEffect",impl:({fromEvent:o,get:c})=>o(n.event.TodoItemAddedEvent).pipe(Fi(a=>c(t.query.TodoInputQuery())===a.title),cn(()=>t.command.ClearTodoInputCommand()))}),{query:{FilteredTodoKeyListQuery:i}}}});function Lc(e){const[t,n]=se.exports.useState(e),s=se.exports.useCallback(i=>{n(i.target.value)},[]);return[t,s,n]}function xc(e){const t=En(),n=Xt(De()),s=ie(n.query.TodoQuery(e.id)),[i,o]=se.exports.useState(!1),[c,a]=Lc(s.title),h=()=>{t(n.command.UpdateTodoCommand({...s,title:c})),o(!1)},y=pi(["Enter","Escape"],()=>{h()}),b=()=>{o(!0)},u=()=>{t(n.command.ToggleTodoCommand(s.id))},f=()=>{t(n.command.DeleteTodoCommand(s.id))},g=()=>{h()},p=se.exports.useRef(null);return se.exports.useEffect(()=>{var C;i&&((C=p.current)==null||C.focus())},[i]),Rt("li",{className:`${i&&"editing"} ${s.completed&&"completed"}`,children:[Rt("div",{className:"view",children:[X("input",{type:"checkbox",className:"toggle",checked:s.completed,onChange:u}),X("label",{onDoubleClick:b,children:s.title}),X("button",{className:"destroy",onClick:f})]}),i&&X("input",{ref:p,className:"edit",value:c,onChange:a,onKeyDown:y,onBlur:g})]})}const Oc=()=>{const e=Xt(Ic()),t=ie(e.query.FilteredTodoKeyListQuery());return console.log("render list"),Rt("section",{className:"main",children:[X(Nc,{}),X("ul",{className:"todo-list",children:t.map(n=>X(xc,{id:n},n))})]})},Nc=()=>{const e=En(),t=Xt(De()),n=ie(t.query.IsAllCompletedQuery());return Rt(Ri,{children:[X("input",{id:"toggle-all",type:"checkbox",className:"toggle-all",checked:n,onChange:()=>{e(t.command.ToggleAllCommand())}}),X("label",{htmlFor:"toggle-all"})]})},Mc=()=>{const e=En(),t=Xt(De()),n=Xt(xr()),s=ie(n.query.TodoFilterQuery()),i=ie(t.query.ActiveTodoCountQuery()),c=ie(t.query.CompletedTodoCountQuery())>0,a=()=>{e(t.command.ClearAllCompletedCommand())},h=b=>b.isActive?"selected":"",y=Di();return se.exports.useEffect(()=>{var u;const b=(u=y.filter)!=null?u:"all";b!==s&&e(n.command.SetFilterCommand(b))},[y,s]),Rt("footer",{className:"footer",children:[Rt("span",{className:"todo-count",children:[X("strong",{children:i})," item",i!==1&&"s"," left"]}),Rt("ul",{className:"filters",children:[X("li",{children:X(Fn,{to:"/",className:h,children:"All"})}),X("li",{children:X(Fn,{to:"/active",className:h,children:"Active"})}),X("li",{children:X(Fn,{to:"/completed",className:h,children:"Completed"})})]}),c&&X("button",{className:"clear-completed",onClick:a,children:"Clear completed"})]})},Uc=Lt.domain({name:"TodoAppDomain",impl:e=>{const t=e.getDomain(De()),n=e.getDomain(xr()),s=e.getDomain(Lr()),i=e.event({name:"TodoFilterSyncEvent"});return fc(e,{key:"todo-app",dataType:"object",onSend:({get:o})=>{const c=o(t.query.TodoListQuery()),a=o(n.query.TodoFilterQuery()),h=o(s.query.TodoInputQuery());return{todos:c,filter:a,input:h}},onReceive:({get:o},c)=>{const a=o(n.query.TodoFilterQuery());return[t.command.SetTodoListCommand(c.todos),a!==c.filter?i(c.filter):null,s.command.SetTodoInputCommand(c.input)]}}),{event:{TodoFilterSyncEvent:i}}}}),cs=()=>{const e=Xt(Uc()),t=Ii();return ds(e.event.TodoFilterSyncEvent,n=>{t(`/${n}`)}),Rt("div",{className:"todoapp",children:[X(Rc,{}),X(Oc,{}),X(Mc,{})]})},Fc=1200,jc=2500,_n=3e4,nr=e=>{if(e.shouldConnect&&e.ws===null){const t=new WebSocket(e.url),n=e.binaryType;let s=null;n&&(t.binaryType=n),e.ws=t,e.connecting=!0,e.connected=!1,t.onmessage=c=>{e.lastMessageReceived=qt();const a=c.data,h=typeof a=="string"?JSON.parse(a):a;h&&h.type==="pong"&&(clearTimeout(s),s=setTimeout(o,_n/2)),e.emit("message",[h,e])};const i=c=>{e.ws!==null&&(e.ws=null,e.connecting=!1,e.connected?(e.connected=!1,e.emit("disconnect",[{type:"disconnect",error:c},e])):e.unsuccessfulReconnects++,setTimeout(nr,ir(Vi(e.unsuccessfulReconnects+1)*Fc,jc),e)),clearTimeout(s)},o=()=>{e.ws===t&&e.send({type:"ping"})};t.onclose=()=>i(null),t.onerror=c=>i(c),t.onopen=()=>{e.lastMessageReceived=qt(),e.connecting=!1,e.connected=!0,e.unsuccessfulReconnects=0,e.emit("connect",[{type:"connect"},e]),s=setTimeout(o,_n/2)}}};class Bc extends Sn{constructor(t,{binaryType:n}={}){super(),this.url=t,this.ws=null,this.binaryType=n||null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval(()=>{this.connected&&_n<qt()-this.lastMessageReceived&&this.ws.close()},_n/2),nr(this)}send(t){this.ws&&this.ws.send(JSON.stringify(t))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.connected&&this.ws===null&&nr(this)}}const Pc=new Map;class qc{constructor(t){this.room=t,this.onmessage=null,Ji(n=>n.key===t&&this.onmessage!==null&&this.onmessage({data:Ss(n.newValue||"")}))}postMessage(t){ws.setItem(this.room,Es(fo(t)))}}const Vc=typeof BroadcastChannel=="undefined"?qc:BroadcastChannel,Or=e=>bt(Pc,e,()=>{const t=new Set,n=new Vc(e);return n.onmessage=s=>t.forEach(i=>i(s.data,"broadcastchannel")),{bc:n,subs:t}}),Wc=(e,t)=>Or(e).subs.add(t),Hc=(e,t)=>Or(e).subs.delete(t),$c=(e,t,n=null)=>{const s=Or(e);s.bc.postMessage(t),s.subs.forEach(i=>i(t,n))},Yc=()=>{let e=!0;return(t,n)=>{if(e){e=!1;try{t()}finally{e=!0}}else n!==void 0&&n()}};var gi={exports:{}};(function(e,t){(function(n){e.exports=n()})(function(){var n=Math.floor,s=Math.abs,i=Math.pow;return function(){function o(c,a,h){function y(f,g){if(!a[f]){if(!c[f]){var p=typeof Je=="function"&&Je;if(!g&&p)return p(f,!0);if(b)return b(f,!0);var C=new Error("Cannot find module '"+f+"'");throw C.code="MODULE_NOT_FOUND",C}var x=a[f]={exports:{}};c[f][0].call(x.exports,function(L){var M=c[f][1][L];return y(M||L)},x,x.exports,o,c,a,h)}return a[f].exports}for(var b=typeof Je=="function"&&Je,u=0;u<h.length;u++)y(h[u]);return y}return o}()({1:[function(o,c,a){function h(_){var v=_.length;if(0<v%4)throw new Error("Invalid string. Length must be a multiple of 4");var T=_.indexOf("=");T===-1&&(T=v);var E=T===v?0:4-T%4;return[T,E]}function y(_,v,T){return 3*(v+T)/4-T}function b(_){var v,T,E=h(_),I=E[0],U=E[1],k=new x(y(_,I,U)),A=0,F=0<U?I-4:I;for(T=0;T<F;T+=4)v=C[_.charCodeAt(T)]<<18|C[_.charCodeAt(T+1)]<<12|C[_.charCodeAt(T+2)]<<6|C[_.charCodeAt(T+3)],k[A++]=255&v>>16,k[A++]=255&v>>8,k[A++]=255&v;return U===2&&(v=C[_.charCodeAt(T)]<<2|C[_.charCodeAt(T+1)]>>4,k[A++]=255&v),U===1&&(v=C[_.charCodeAt(T)]<<10|C[_.charCodeAt(T+1)]<<4|C[_.charCodeAt(T+2)]>>2,k[A++]=255&v>>8,k[A++]=255&v),k}function u(_){return p[63&_>>18]+p[63&_>>12]+p[63&_>>6]+p[63&_]}function f(_,v,T){for(var E,I=[],U=v;U<T;U+=3)E=(16711680&_[U]<<16)+(65280&_[U+1]<<8)+(255&_[U+2]),I.push(u(E));return I.join("")}function g(_){for(var v,T=_.length,E=T%3,I=[],U=16383,k=0,A=T-E;k<A;k+=U)I.push(f(_,k,k+U>A?A:k+U));return E===1?(v=_[T-1],I.push(p[v>>2]+p[63&v<<4]+"==")):E===2&&(v=(_[T-2]<<8)+_[T-1],I.push(p[v>>10]+p[63&v>>4]+p[63&v<<2]+"=")),I.join("")}a.byteLength=function(_){var v=h(_),T=v[0],E=v[1];return 3*(T+E)/4-E},a.toByteArray=b,a.fromByteArray=g;for(var p=[],C=[],x=typeof Uint8Array=="undefined"?Array:Uint8Array,L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",M=0,m=L.length;M<m;++M)p[M]=L[M],C[L.charCodeAt(M)]=M;C[45]=62,C[95]=63},{}],2:[function(){},{}],3:[function(o,c,a){(function(){(function(){var h=String.fromCharCode,y=Math.min;function b(r){if(2147483647<r)throw new RangeError('The value "'+r+'" is invalid for option "size"');var l=new Uint8Array(r);return l.__proto__=u.prototype,l}function u(r,l,d){if(typeof r=="number"){if(typeof l=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return C(r)}return f(r,l,d)}function f(r,l,d){if(typeof r=="string")return x(r,l);if(ArrayBuffer.isView(r))return L(r);if(r==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(D(r,ArrayBuffer)||r&&D(r.buffer,ArrayBuffer))return M(r,l,d);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var S=r.valueOf&&r.valueOf();if(S!=null&&S!==r)return u.from(S,l,d);var R=m(r);if(R)return R;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return u.from(r[Symbol.toPrimitive]("string"),l,d);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}function g(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(0>r)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function p(r,l,d){return g(r),0>=r||l===void 0?b(r):typeof d=="string"?b(r).fill(l,d):b(r).fill(l)}function C(r){return g(r),b(0>r?0:0|_(r))}function x(r,l){if((typeof l!="string"||l==="")&&(l="utf8"),!u.isEncoding(l))throw new TypeError("Unknown encoding: "+l);var d=0|v(r,l),S=b(d),R=S.write(r,l);return R!==d&&(S=S.slice(0,R)),S}function L(r){for(var l=0>r.length?0:0|_(r.length),d=b(l),S=0;S<l;S+=1)d[S]=255&r[S];return d}function M(r,l,d){if(0>l||r.byteLength<l)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<l+(d||0))throw new RangeError('"length" is outside of buffer bounds');var S;return S=l===void 0&&d===void 0?new Uint8Array(r):d===void 0?new Uint8Array(r,l):new Uint8Array(r,l,d),S.__proto__=u.prototype,S}function m(r){if(u.isBuffer(r)){var l=0|_(r.length),d=b(l);return d.length===0||r.copy(d,0,0,l),d}return r.length===void 0?r.type==="Buffer"&&Array.isArray(r.data)?L(r.data):void 0:typeof r.length!="number"||O(r.length)?b(0):L(r)}function _(r){if(r>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647 .toString(16)+" bytes");return 0|r}function v(r,l){if(u.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||D(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);var d=r.length,S=2<arguments.length&&arguments[2]===!0;if(!S&&d===0)return 0;for(var R=!1;;)switch(l){case"ascii":case"latin1":case"binary":return d;case"utf8":case"utf-8":return ne(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*d;case"hex":return d>>>1;case"base64":return Ct(r).length;default:if(R)return S?-1:ne(r).length;l=(""+l).toLowerCase(),R=!0}}function T(r,l,d){var S=!1;if((l===void 0||0>l)&&(l=0),l>this.length||((d===void 0||d>this.length)&&(d=this.length),0>=d)||(d>>>=0,l>>>=0,d<=l))return"";for(r||(r="utf8");;)switch(r){case"hex":return _t(this,l,d);case"utf8":case"utf-8":return it(this,l,d);case"ascii":return W(this,l,d);case"latin1":case"binary":return ge(this,l,d);case"base64":return J(this,l,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $t(this,l,d);default:if(S)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),S=!0}}function E(r,l,d){var S=r[l];r[l]=r[d],r[d]=S}function I(r,l,d,S,R){if(r.length===0)return-1;if(typeof d=="string"?(S=d,d=0):2147483647<d?d=2147483647:-2147483648>d&&(d=-2147483648),d=+d,O(d)&&(d=R?0:r.length-1),0>d&&(d=r.length+d),d>=r.length){if(R)return-1;d=r.length-1}else if(0>d)if(R)d=0;else return-1;if(typeof l=="string"&&(l=u.from(l,S)),u.isBuffer(l))return l.length===0?-1:U(r,l,d,S,R);if(typeof l=="number")return l&=255,typeof Uint8Array.prototype.indexOf=="function"?R?Uint8Array.prototype.indexOf.call(r,l,d):Uint8Array.prototype.lastIndexOf.call(r,l,d):U(r,[l],d,S,R);throw new TypeError("val must be string, number or Buffer")}function U(r,l,d,S,R){function N(me,xe){return P===1?me[xe]:me.readUInt16BE(xe*P)}var P=1,Q=r.length,et=l.length;if(S!==void 0&&(S=(S+"").toLowerCase(),S==="ucs2"||S==="ucs-2"||S==="utf16le"||S==="utf-16le")){if(2>r.length||2>l.length)return-1;P=2,Q/=2,et/=2,d/=2}var G;if(R){var K=-1;for(G=d;G<Q;G++)if(N(r,G)!==N(l,K===-1?0:G-K))K!==-1&&(G-=G-K),K=-1;else if(K===-1&&(K=G),G-K+1===et)return K*P}else for(d+et>Q&&(d=Q-et),G=d;0<=G;G--){for(var dt=!0,re=0;re<et;re++)if(N(r,G+re)!==N(l,re)){dt=!1;break}if(dt)return G}return-1}function k(r,l,d,S){d=+d||0;var R=r.length-d;S?(S=+S,S>R&&(S=R)):S=R;var N=l.length;S>N/2&&(S=N/2);for(var P,Q=0;Q<S;++Q){if(P=parseInt(l.substr(2*Q,2),16),O(P))return Q;r[d+Q]=P}return Q}function A(r,l,d,S){return Et(ne(l,r.length-d),r,d,S)}function F(r,l,d,S){return Et(Le(l),r,d,S)}function B(r,l,d,S){return F(r,l,d,S)}function H(r,l,d,S){return Et(Ct(l),r,d,S)}function Y(r,l,d,S){return Et(Qt(l,r.length-d),r,d,S)}function J(r,l,d){return l===0&&d===r.length?j.fromByteArray(r):j.fromByteArray(r.slice(l,d))}function it(r,l,d){d=y(r.length,d);for(var S=[],R=l;R<d;){var N=r[R],P=null,Q=239<N?4:223<N?3:191<N?2:1;if(R+Q<=d){var et,G,K,dt;Q===1?128>N&&(P=N):Q===2?(et=r[R+1],(192&et)==128&&(dt=(31&N)<<6|63&et,127<dt&&(P=dt))):Q===3?(et=r[R+1],G=r[R+2],(192&et)==128&&(192&G)==128&&(dt=(15&N)<<12|(63&et)<<6|63&G,2047<dt&&(55296>dt||57343<dt)&&(P=dt))):Q===4&&(et=r[R+1],G=r[R+2],K=r[R+3],(192&et)==128&&(192&G)==128&&(192&K)==128&&(dt=(15&N)<<18|(63&et)<<12|(63&G)<<6|63&K,65535<dt&&1114112>dt&&(P=dt)))}P===null?(P=65533,Q=1):65535<P&&(P-=65536,S.push(55296|1023&P>>>10),P=56320|1023&P),S.push(P),R+=Q}return pt(S)}function pt(r){var l=r.length;if(l<=4096)return h.apply(String,r);for(var d="",S=0;S<l;)d+=h.apply(String,r.slice(S,S+=4096));return d}function W(r,l,d){var S="";d=y(r.length,d);for(var R=l;R<d;++R)S+=h(127&r[R]);return S}function ge(r,l,d){var S="";d=y(r.length,d);for(var R=l;R<d;++R)S+=h(r[R]);return S}function _t(r,l,d){var S=r.length;(!l||0>l)&&(l=0),(!d||0>d||d>S)&&(d=S);for(var R="",N=l;N<d;++N)R+=ee(r[N]);return R}function $t(r,l,d){for(var S=r.slice(l,d),R="",N=0;N<S.length;N+=2)R+=h(S[N]+256*S[N+1]);return R}function rt(r,l,d){if(r%1!=0||0>r)throw new RangeError("offset is not uint");if(r+l>d)throw new RangeError("Trying to access beyond buffer length")}function Z(r,l,d,S,R,N){if(!u.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(l>R||l<N)throw new RangeError('"value" argument is out of bounds');if(d+S>r.length)throw new RangeError("Index out of range")}function vt(r,l,d,S){if(d+S>r.length)throw new RangeError("Index out of range");if(0>d)throw new RangeError("Index out of range")}function Yt(r,l,d,S,R){return l=+l,d>>>=0,R||vt(r,l,d,4),q.write(r,l,d,S,23,4),d+4}function Kt(r,l,d,S,R){return l=+l,d>>>=0,R||vt(r,l,d,8),q.write(r,l,d,S,52,8),d+8}function Ie(r){if(r=r.split("=")[0],r=r.trim().replace(w,""),2>r.length)return"";for(;r.length%4!=0;)r+="=";return r}function ee(r){return 16>r?"0"+r.toString(16):r.toString(16)}function ne(r,l){l=l||1/0;for(var d,S=r.length,R=null,N=[],P=0;P<S;++P){if(d=r.charCodeAt(P),55295<d&&57344>d){if(!R){if(56319<d){-1<(l-=3)&&N.push(239,191,189);continue}else if(P+1===S){-1<(l-=3)&&N.push(239,191,189);continue}R=d;continue}if(56320>d){-1<(l-=3)&&N.push(239,191,189),R=d;continue}d=(R-55296<<10|d-56320)+65536}else R&&-1<(l-=3)&&N.push(239,191,189);if(R=null,128>d){if(0>(l-=1))break;N.push(d)}else if(2048>d){if(0>(l-=2))break;N.push(192|d>>6,128|63&d)}else if(65536>d){if(0>(l-=3))break;N.push(224|d>>12,128|63&d>>6,128|63&d)}else if(1114112>d){if(0>(l-=4))break;N.push(240|d>>18,128|63&d>>12,128|63&d>>6,128|63&d)}else throw new Error("Invalid code point")}return N}function Le(r){for(var l=[],d=0;d<r.length;++d)l.push(255&r.charCodeAt(d));return l}function Qt(r,l){for(var d,S,R,N=[],P=0;P<r.length&&!(0>(l-=2));++P)d=r.charCodeAt(P),S=d>>8,R=d%256,N.push(R),N.push(S);return N}function Ct(r){return j.toByteArray(Ie(r))}function Et(r,l,d,S){for(var R=0;R<S&&!(R+d>=l.length||R>=r.length);++R)l[R+d]=r[R];return R}function D(r,l){return r instanceof l||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===l.name}function O(r){return r!==r}var j=o("base64-js"),q=o("ieee754");a.Buffer=u,a.SlowBuffer=function(r){return+r!=r&&(r=0),u.alloc(+r)},a.INSPECT_MAX_BYTES=50,a.kMaxLength=2147483647,u.TYPED_ARRAY_SUPPORT=function(){try{var r=new Uint8Array(1);return r.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},r.foo()===42}catch{return!1}}(),u.TYPED_ARRAY_SUPPORT||typeof console=="undefined"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){return u.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){return u.isBuffer(this)?this.byteOffset:void 0}}),typeof Symbol!="undefined"&&Symbol.species!=null&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),u.poolSize=8192,u.from=function(r,l,d){return f(r,l,d)},u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,u.alloc=function(r,l,d){return p(r,l,d)},u.allocUnsafe=function(r){return C(r)},u.allocUnsafeSlow=function(r){return C(r)},u.isBuffer=function(r){return r!=null&&r._isBuffer===!0&&r!==u.prototype},u.compare=function(r,l){if(D(r,Uint8Array)&&(r=u.from(r,r.offset,r.byteLength)),D(l,Uint8Array)&&(l=u.from(l,l.offset,l.byteLength)),!u.isBuffer(r)||!u.isBuffer(l))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(r===l)return 0;for(var d=r.length,S=l.length,R=0,N=y(d,S);R<N;++R)if(r[R]!==l[R]){d=r[R],S=l[R];break}return d<S?-1:S<d?1:0},u.isEncoding=function(r){switch((r+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(r,l){if(!Array.isArray(r))throw new TypeError('"list" argument must be an Array of Buffers');if(r.length===0)return u.alloc(0);var d;if(l===void 0)for(l=0,d=0;d<r.length;++d)l+=r[d].length;var S=u.allocUnsafe(l),R=0;for(d=0;d<r.length;++d){var N=r[d];if(D(N,Uint8Array)&&(N=u.from(N)),!u.isBuffer(N))throw new TypeError('"list" argument must be an Array of Buffers');N.copy(S,R),R+=N.length}return S},u.byteLength=v,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var r=this.length;if(r%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var l=0;l<r;l+=2)E(this,l,l+1);return this},u.prototype.swap32=function(){var r=this.length;if(r%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var l=0;l<r;l+=4)E(this,l,l+3),E(this,l+1,l+2);return this},u.prototype.swap64=function(){var r=this.length;if(r%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var l=0;l<r;l+=8)E(this,l,l+7),E(this,l+1,l+6),E(this,l+2,l+5),E(this,l+3,l+4);return this},u.prototype.toString=function(){var r=this.length;return r===0?"":arguments.length===0?it(this,0,r):T.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(r){if(!u.isBuffer(r))throw new TypeError("Argument must be a Buffer");return this===r||u.compare(this,r)===0},u.prototype.inspect=function(){var r="",l=a.INSPECT_MAX_BYTES;return r=this.toString("hex",0,l).replace(/(.{2})/g,"$1 ").trim(),this.length>l&&(r+=" ... "),"<Buffer "+r+">"},u.prototype.compare=function(r,l,d,S,R){if(D(r,Uint8Array)&&(r=u.from(r,r.offset,r.byteLength)),!u.isBuffer(r))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof r);if(l===void 0&&(l=0),d===void 0&&(d=r?r.length:0),S===void 0&&(S=0),R===void 0&&(R=this.length),0>l||d>r.length||0>S||R>this.length)throw new RangeError("out of range index");if(S>=R&&l>=d)return 0;if(S>=R)return-1;if(l>=d)return 1;if(l>>>=0,d>>>=0,S>>>=0,R>>>=0,this===r)return 0;for(var N=R-S,P=d-l,Q=y(N,P),et=this.slice(S,R),G=r.slice(l,d),K=0;K<Q;++K)if(et[K]!==G[K]){N=et[K],P=G[K];break}return N<P?-1:P<N?1:0},u.prototype.includes=function(r,l,d){return this.indexOf(r,l,d)!==-1},u.prototype.indexOf=function(r,l,d){return I(this,r,l,d,!0)},u.prototype.lastIndexOf=function(r,l,d){return I(this,r,l,d,!1)},u.prototype.write=function(r,l,d,S){if(l===void 0)S="utf8",d=this.length,l=0;else if(d===void 0&&typeof l=="string")S=l,d=this.length,l=0;else if(isFinite(l))l>>>=0,isFinite(d)?(d>>>=0,S===void 0&&(S="utf8")):(S=d,d=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var R=this.length-l;if((d===void 0||d>R)&&(d=R),0<r.length&&(0>d||0>l)||l>this.length)throw new RangeError("Attempt to write outside buffer bounds");S||(S="utf8");for(var N=!1;;)switch(S){case"hex":return k(this,r,l,d);case"utf8":case"utf-8":return A(this,r,l,d);case"ascii":return F(this,r,l,d);case"latin1":case"binary":return B(this,r,l,d);case"base64":return H(this,r,l,d);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y(this,r,l,d);default:if(N)throw new TypeError("Unknown encoding: "+S);S=(""+S).toLowerCase(),N=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},u.prototype.slice=function(r,l){var d=this.length;r=~~r,l=l===void 0?d:~~l,0>r?(r+=d,0>r&&(r=0)):r>d&&(r=d),0>l?(l+=d,0>l&&(l=0)):l>d&&(l=d),l<r&&(l=r);var S=this.subarray(r,l);return S.__proto__=u.prototype,S},u.prototype.readUIntLE=function(r,l,d){r>>>=0,l>>>=0,d||rt(r,l,this.length);for(var S=this[r],R=1,N=0;++N<l&&(R*=256);)S+=this[r+N]*R;return S},u.prototype.readUIntBE=function(r,l,d){r>>>=0,l>>>=0,d||rt(r,l,this.length);for(var S=this[r+--l],R=1;0<l&&(R*=256);)S+=this[r+--l]*R;return S},u.prototype.readUInt8=function(r,l){return r>>>=0,l||rt(r,1,this.length),this[r]},u.prototype.readUInt16LE=function(r,l){return r>>>=0,l||rt(r,2,this.length),this[r]|this[r+1]<<8},u.prototype.readUInt16BE=function(r,l){return r>>>=0,l||rt(r,2,this.length),this[r]<<8|this[r+1]},u.prototype.readUInt32LE=function(r,l){return r>>>=0,l||rt(r,4,this.length),(this[r]|this[r+1]<<8|this[r+2]<<16)+16777216*this[r+3]},u.prototype.readUInt32BE=function(r,l){return r>>>=0,l||rt(r,4,this.length),16777216*this[r]+(this[r+1]<<16|this[r+2]<<8|this[r+3])},u.prototype.readIntLE=function(r,l,d){r>>>=0,l>>>=0,d||rt(r,l,this.length);for(var S=this[r],R=1,N=0;++N<l&&(R*=256);)S+=this[r+N]*R;return R*=128,S>=R&&(S-=i(2,8*l)),S},u.prototype.readIntBE=function(r,l,d){r>>>=0,l>>>=0,d||rt(r,l,this.length);for(var S=l,R=1,N=this[r+--S];0<S&&(R*=256);)N+=this[r+--S]*R;return R*=128,N>=R&&(N-=i(2,8*l)),N},u.prototype.readInt8=function(r,l){return r>>>=0,l||rt(r,1,this.length),128&this[r]?-1*(255-this[r]+1):this[r]},u.prototype.readInt16LE=function(r,l){r>>>=0,l||rt(r,2,this.length);var d=this[r]|this[r+1]<<8;return 32768&d?4294901760|d:d},u.prototype.readInt16BE=function(r,l){r>>>=0,l||rt(r,2,this.length);var d=this[r+1]|this[r]<<8;return 32768&d?4294901760|d:d},u.prototype.readInt32LE=function(r,l){return r>>>=0,l||rt(r,4,this.length),this[r]|this[r+1]<<8|this[r+2]<<16|this[r+3]<<24},u.prototype.readInt32BE=function(r,l){return r>>>=0,l||rt(r,4,this.length),this[r]<<24|this[r+1]<<16|this[r+2]<<8|this[r+3]},u.prototype.readFloatLE=function(r,l){return r>>>=0,l||rt(r,4,this.length),q.read(this,r,!0,23,4)},u.prototype.readFloatBE=function(r,l){return r>>>=0,l||rt(r,4,this.length),q.read(this,r,!1,23,4)},u.prototype.readDoubleLE=function(r,l){return r>>>=0,l||rt(r,8,this.length),q.read(this,r,!0,52,8)},u.prototype.readDoubleBE=function(r,l){return r>>>=0,l||rt(r,8,this.length),q.read(this,r,!1,52,8)},u.prototype.writeUIntLE=function(r,l,d,S){if(r=+r,l>>>=0,d>>>=0,!S){var R=i(2,8*d)-1;Z(this,r,l,d,R,0)}var N=1,P=0;for(this[l]=255&r;++P<d&&(N*=256);)this[l+P]=255&r/N;return l+d},u.prototype.writeUIntBE=function(r,l,d,S){if(r=+r,l>>>=0,d>>>=0,!S){var R=i(2,8*d)-1;Z(this,r,l,d,R,0)}var N=d-1,P=1;for(this[l+N]=255&r;0<=--N&&(P*=256);)this[l+N]=255&r/P;return l+d},u.prototype.writeUInt8=function(r,l,d){return r=+r,l>>>=0,d||Z(this,r,l,1,255,0),this[l]=255&r,l+1},u.prototype.writeUInt16LE=function(r,l,d){return r=+r,l>>>=0,d||Z(this,r,l,2,65535,0),this[l]=255&r,this[l+1]=r>>>8,l+2},u.prototype.writeUInt16BE=function(r,l,d){return r=+r,l>>>=0,d||Z(this,r,l,2,65535,0),this[l]=r>>>8,this[l+1]=255&r,l+2},u.prototype.writeUInt32LE=function(r,l,d){return r=+r,l>>>=0,d||Z(this,r,l,4,4294967295,0),this[l+3]=r>>>24,this[l+2]=r>>>16,this[l+1]=r>>>8,this[l]=255&r,l+4},u.prototype.writeUInt32BE=function(r,l,d){return r=+r,l>>>=0,d||Z(this,r,l,4,4294967295,0),this[l]=r>>>24,this[l+1]=r>>>16,this[l+2]=r>>>8,this[l+3]=255&r,l+4},u.prototype.writeIntLE=function(r,l,d,S){if(r=+r,l>>>=0,!S){var R=i(2,8*d-1);Z(this,r,l,d,R-1,-R)}var N=0,P=1,Q=0;for(this[l]=255&r;++N<d&&(P*=256);)0>r&&Q===0&&this[l+N-1]!==0&&(Q=1),this[l+N]=255&(r/P>>0)-Q;return l+d},u.prototype.writeIntBE=function(r,l,d,S){if(r=+r,l>>>=0,!S){var R=i(2,8*d-1);Z(this,r,l,d,R-1,-R)}var N=d-1,P=1,Q=0;for(this[l+N]=255&r;0<=--N&&(P*=256);)0>r&&Q===0&&this[l+N+1]!==0&&(Q=1),this[l+N]=255&(r/P>>0)-Q;return l+d},u.prototype.writeInt8=function(r,l,d){return r=+r,l>>>=0,d||Z(this,r,l,1,127,-128),0>r&&(r=255+r+1),this[l]=255&r,l+1},u.prototype.writeInt16LE=function(r,l,d){return r=+r,l>>>=0,d||Z(this,r,l,2,32767,-32768),this[l]=255&r,this[l+1]=r>>>8,l+2},u.prototype.writeInt16BE=function(r,l,d){return r=+r,l>>>=0,d||Z(this,r,l,2,32767,-32768),this[l]=r>>>8,this[l+1]=255&r,l+2},u.prototype.writeInt32LE=function(r,l,d){return r=+r,l>>>=0,d||Z(this,r,l,4,2147483647,-2147483648),this[l]=255&r,this[l+1]=r>>>8,this[l+2]=r>>>16,this[l+3]=r>>>24,l+4},u.prototype.writeInt32BE=function(r,l,d){return r=+r,l>>>=0,d||Z(this,r,l,4,2147483647,-2147483648),0>r&&(r=4294967295+r+1),this[l]=r>>>24,this[l+1]=r>>>16,this[l+2]=r>>>8,this[l+3]=255&r,l+4},u.prototype.writeFloatLE=function(r,l,d){return Yt(this,r,l,!0,d)},u.prototype.writeFloatBE=function(r,l,d){return Yt(this,r,l,!1,d)},u.prototype.writeDoubleLE=function(r,l,d){return Kt(this,r,l,!0,d)},u.prototype.writeDoubleBE=function(r,l,d){return Kt(this,r,l,!1,d)},u.prototype.copy=function(r,l,d,S){if(!u.isBuffer(r))throw new TypeError("argument should be a Buffer");if(d||(d=0),S||S===0||(S=this.length),l>=r.length&&(l=r.length),l||(l=0),0<S&&S<d&&(S=d),S===d||r.length===0||this.length===0)return 0;if(0>l)throw new RangeError("targetStart out of bounds");if(0>d||d>=this.length)throw new RangeError("Index out of range");if(0>S)throw new RangeError("sourceEnd out of bounds");S>this.length&&(S=this.length),r.length-l<S-d&&(S=r.length-l+d);var R=S-d;if(this===r&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(l,d,S);else if(this===r&&d<l&&l<S)for(var N=R-1;0<=N;--N)r[N+l]=this[N+d];else Uint8Array.prototype.set.call(r,this.subarray(d,S),l);return R},u.prototype.fill=function(r,l,d,S){if(typeof r=="string"){if(typeof l=="string"?(S=l,l=0,d=this.length):typeof d=="string"&&(S=d,d=this.length),S!==void 0&&typeof S!="string")throw new TypeError("encoding must be a string");if(typeof S=="string"&&!u.isEncoding(S))throw new TypeError("Unknown encoding: "+S);if(r.length===1){var R=r.charCodeAt(0);(S==="utf8"&&128>R||S==="latin1")&&(r=R)}}else typeof r=="number"&&(r&=255);if(0>l||this.length<l||this.length<d)throw new RangeError("Out of range index");if(d<=l)return this;l>>>=0,d=d===void 0?this.length:d>>>0,r||(r=0);var N;if(typeof r=="number")for(N=l;N<d;++N)this[N]=r;else{var P=u.isBuffer(r)?r:u.from(r,S),Q=P.length;if(Q===0)throw new TypeError('The value "'+r+'" is invalid for argument "value"');for(N=0;N<d-l;++N)this[N+l]=P[N%Q]}return this};var w=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,o("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:9}],4:[function(o,c,a){(function(h){(function(){function y(){let u;try{u=a.storage.getItem("debug")}catch{}return!u&&typeof h!="undefined"&&"env"in h&&(u=h.env.DEBUG),u}a.formatArgs=function(u){if(u[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+u[0]+(this.useColors?"%c ":" ")+"+"+c.exports.humanize(this.diff),!this.useColors)return;const f="color: "+this.color;u.splice(1,0,f,"color: inherit");let g=0,p=0;u[0].replace(/%[a-zA-Z%]/g,C=>{C==="%%"||(g++,C==="%c"&&(p=g))}),u.splice(p,0,f)},a.save=function(u){try{u?a.storage.setItem("debug",u):a.storage.removeItem("debug")}catch{}},a.load=y,a.useColors=function(){return!!(typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))||!(typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},a.storage=function(){try{return localStorage}catch{}}(),a.destroy=(()=>{let u=!1;return()=>{u||(u=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),a.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],a.log=console.debug||console.log||(()=>{}),c.exports=o("./common")(a);const{formatters:b}=c.exports;b.j=function(u){try{return JSON.stringify(u)}catch(f){return"[UnexpectedJSONParseError]: "+f.message}}}).call(this)}).call(this,o("_process"))},{"./common":5,_process:12}],5:[function(o,c){c.exports=function(a){function h(u){function f(...C){if(!f.enabled)return;const x=f,L=+new Date,M=L-(g||L);x.diff=M,x.prev=g,x.curr=L,g=L,C[0]=h.coerce(C[0]),typeof C[0]!="string"&&C.unshift("%O");let m=0;C[0]=C[0].replace(/%([a-zA-Z%])/g,(v,T)=>{if(v==="%%")return"%";m++;const E=h.formatters[T];if(typeof E=="function"){const I=C[m];v=E.call(x,I),C.splice(m,1),m--}return v}),h.formatArgs.call(x,C),(x.log||h.log).apply(x,C)}let g,p=null;return f.namespace=u,f.useColors=h.useColors(),f.color=h.selectColor(u),f.extend=y,f.destroy=h.destroy,Object.defineProperty(f,"enabled",{enumerable:!0,configurable:!1,get:()=>p===null?h.enabled(u):p,set:C=>{p=C}}),typeof h.init=="function"&&h.init(f),f}function y(u,f){const g=h(this.namespace+(typeof f=="undefined"?":":f)+u);return g.log=this.log,g}function b(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}return h.debug=h,h.default=h,h.coerce=function(u){return u instanceof Error?u.stack||u.message:u},h.disable=function(){const u=[...h.names.map(b),...h.skips.map(b).map(f=>"-"+f)].join(",");return h.enable(""),u},h.enable=function(u){h.save(u),h.names=[],h.skips=[];let f;const g=(typeof u=="string"?u:"").split(/[\s,]+/),p=g.length;for(f=0;f<p;f++)g[f]&&(u=g[f].replace(/\*/g,".*?"),u[0]==="-"?h.skips.push(new RegExp("^"+u.substr(1)+"$")):h.names.push(new RegExp("^"+u+"$")))},h.enabled=function(u){if(u[u.length-1]==="*")return!0;let f,g;for(f=0,g=h.skips.length;f<g;f++)if(h.skips[f].test(u))return!1;for(f=0,g=h.names.length;f<g;f++)if(h.names[f].test(u))return!0;return!1},h.humanize=o("ms"),h.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(a).forEach(u=>{h[u]=a[u]}),h.names=[],h.skips=[],h.formatters={},h.selectColor=function(u){let f=0;for(let g=0;g<u.length;g++)f=(f<<5)-f+u.charCodeAt(g),f|=0;return h.colors[s(f)%h.colors.length]},h.enable(h.load()),h}},{ms:11}],6:[function(o,c){function a(h,y){for(const b in y)Object.defineProperty(h,b,{value:y[b],enumerable:!0,configurable:!0});return h}c.exports=function(h,y,b){if(!h||typeof h=="string")throw new TypeError("Please pass an Error to err-code");b||(b={}),typeof y=="object"&&(b=y,y=""),y&&(b.code=y);try{return a(h,b)}catch{b.message=h.message,b.stack=h.stack;const f=function(){};return f.prototype=Object.create(Object.getPrototypeOf(h)),a(new f,b)}}},{}],7:[function(o,c){function a(k){console&&console.warn&&console.warn(k)}function h(){h.init.call(this)}function y(k){if(typeof k!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof k)}function b(k){return k._maxListeners===void 0?h.defaultMaxListeners:k._maxListeners}function u(k,A,F,B){var H,Y,J;if(y(F),Y=k._events,Y===void 0?(Y=k._events=Object.create(null),k._eventsCount=0):(Y.newListener!==void 0&&(k.emit("newListener",A,F.listener?F.listener:F),Y=k._events),J=Y[A]),J===void 0)J=Y[A]=F,++k._eventsCount;else if(typeof J=="function"?J=Y[A]=B?[F,J]:[J,F]:B?J.unshift(F):J.push(F),H=b(k),0<H&&J.length>H&&!J.warned){J.warned=!0;var it=new Error("Possible EventEmitter memory leak detected. "+J.length+" "+(A+" listeners added. Use emitter.setMaxListeners() to increase limit"));it.name="MaxListenersExceededWarning",it.emitter=k,it.type=A,it.count=J.length,a(it)}return k}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function g(k,A,F){var B={fired:!1,wrapFn:void 0,target:k,type:A,listener:F},H=f.bind(B);return H.listener=F,B.wrapFn=H,H}function p(k,A,F){var B=k._events;if(B===void 0)return[];var H=B[A];return H===void 0?[]:typeof H=="function"?F?[H.listener||H]:[H]:F?M(H):x(H,H.length)}function C(k){var A=this._events;if(A!==void 0){var F=A[k];if(typeof F=="function")return 1;if(F!==void 0)return F.length}return 0}function x(k,A){for(var F=Array(A),B=0;B<A;++B)F[B]=k[B];return F}function L(k,A){for(;A+1<k.length;A++)k[A]=k[A+1];k.pop()}function M(k){for(var A=Array(k.length),F=0;F<A.length;++F)A[F]=k[F].listener||k[F];return A}function m(k,A,F){typeof k.on=="function"&&_(k,"error",A,F)}function _(k,A,F,B){if(typeof k.on=="function")B.once?k.once(A,F):k.on(A,F);else if(typeof k.addEventListener=="function")k.addEventListener(A,function H(Y){B.once&&k.removeEventListener(A,H),F(Y)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof k)}var v,T=typeof Reflect=="object"?Reflect:null,E=T&&typeof T.apply=="function"?T.apply:function(k,A,F){return Function.prototype.apply.call(k,A,F)};v=T&&typeof T.ownKeys=="function"?T.ownKeys:Object.getOwnPropertySymbols?function(k){return Object.getOwnPropertyNames(k).concat(Object.getOwnPropertySymbols(k))}:function(k){return Object.getOwnPropertyNames(k)};var I=Number.isNaN||function(k){return k!==k};c.exports=h,c.exports.once=function(k,A){return new Promise(function(F,B){function H(J){k.removeListener(A,Y),B(J)}function Y(){typeof k.removeListener=="function"&&k.removeListener("error",H),F([].slice.call(arguments))}_(k,A,Y,{once:!0}),A!=="error"&&m(k,H,{once:!0})})},h.EventEmitter=h,h.prototype._events=void 0,h.prototype._eventsCount=0,h.prototype._maxListeners=void 0;var U=10;Object.defineProperty(h,"defaultMaxListeners",{enumerable:!0,get:function(){return U},set:function(k){if(typeof k!="number"||0>k||I(k))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+k+".");U=k}}),h.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=function(k){if(typeof k!="number"||0>k||I(k))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+k+".");return this._maxListeners=k,this},h.prototype.getMaxListeners=function(){return b(this)},h.prototype.emit=function(k){for(var A=[],F=1;F<arguments.length;F++)A.push(arguments[F]);var B=k==="error",H=this._events;if(H!==void 0)B=B&&H.error===void 0;else if(!B)return!1;if(B){var Y;if(0<A.length&&(Y=A[0]),Y instanceof Error)throw Y;var J=new Error("Unhandled error."+(Y?" ("+Y.message+")":""));throw J.context=Y,J}var it=H[k];if(it===void 0)return!1;if(typeof it=="function")E(it,this,A);else for(var pt=it.length,W=x(it,pt),F=0;F<pt;++F)E(W[F],this,A);return!0},h.prototype.addListener=function(k,A){return u(this,k,A,!1)},h.prototype.on=h.prototype.addListener,h.prototype.prependListener=function(k,A){return u(this,k,A,!0)},h.prototype.once=function(k,A){return y(A),this.on(k,g(this,k,A)),this},h.prototype.prependOnceListener=function(k,A){return y(A),this.prependListener(k,g(this,k,A)),this},h.prototype.removeListener=function(k,A){var F,B,H,Y,J;if(y(A),B=this._events,B===void 0)return this;if(F=B[k],F===void 0)return this;if(F===A||F.listener===A)--this._eventsCount==0?this._events=Object.create(null):(delete B[k],B.removeListener&&this.emit("removeListener",k,F.listener||A));else if(typeof F!="function"){for(H=-1,Y=F.length-1;0<=Y;Y--)if(F[Y]===A||F[Y].listener===A){J=F[Y].listener,H=Y;break}if(0>H)return this;H===0?F.shift():L(F,H),F.length===1&&(B[k]=F[0]),B.removeListener!==void 0&&this.emit("removeListener",k,J||A)}return this},h.prototype.off=h.prototype.removeListener,h.prototype.removeAllListeners=function(k){var A,F,B;if(F=this._events,F===void 0)return this;if(F.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):F[k]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete F[k]),this;if(arguments.length===0){var H,Y=Object.keys(F);for(B=0;B<Y.length;++B)H=Y[B],H!=="removeListener"&&this.removeAllListeners(H);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(A=F[k],typeof A=="function")this.removeListener(k,A);else if(A!==void 0)for(B=A.length-1;0<=B;B--)this.removeListener(k,A[B]);return this},h.prototype.listeners=function(k){return p(this,k,!0)},h.prototype.rawListeners=function(k){return p(this,k,!1)},h.listenerCount=function(k,A){return typeof k.listenerCount=="function"?k.listenerCount(A):C.call(k,A)},h.prototype.listenerCount=C,h.prototype.eventNames=function(){return 0<this._eventsCount?v(this._events):[]}},{}],8:[function(o,c){c.exports=function(){if(typeof globalThis=="undefined")return null;var a={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return a.RTCPeerConnection?a:null}},{}],9:[function(o,c,a){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */a.read=function(h,y,b,u,f){var g,p,C=8*f-u-1,x=(1<<C)-1,L=x>>1,M=-7,m=b?f-1:0,_=b?-1:1,v=h[y+m];for(m+=_,g=v&(1<<-M)-1,v>>=-M,M+=C;0<M;g=256*g+h[y+m],m+=_,M-=8);for(p=g&(1<<-M)-1,g>>=-M,M+=u;0<M;p=256*p+h[y+m],m+=_,M-=8);if(g===0)g=1-L;else{if(g===x)return p?NaN:(v?-1:1)*(1/0);p+=i(2,u),g-=L}return(v?-1:1)*p*i(2,g-u)},a.write=function(h,y,b,u,f,g){var p,C,x,L=Math.LN2,M=Math.log,m=8*g-f-1,_=(1<<m)-1,v=_>>1,T=f===23?i(2,-24)-i(2,-77):0,E=u?0:g-1,I=u?1:-1,U=0>y||y===0&&0>1/y?1:0;for(y=s(y),isNaN(y)||y===1/0?(C=isNaN(y)?1:0,p=_):(p=n(M(y)/L),1>y*(x=i(2,-p))&&(p--,x*=2),y+=1<=p+v?T/x:T*i(2,1-v),2<=y*x&&(p++,x/=2),p+v>=_?(C=0,p=_):1<=p+v?(C=(y*x-1)*i(2,f),p+=v):(C=y*i(2,v-1)*i(2,f),p=0));8<=f;h[b+E]=255&C,E+=I,C/=256,f-=8);for(p=p<<f|C,m+=f;0<m;h[b+E]=255&p,E+=I,p/=256,m-=8);h[b+E-I]|=128*U}},{}],10:[function(o,c){c.exports=typeof Object.create=="function"?function(a,h){h&&(a.super_=h,a.prototype=Object.create(h.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}))}:function(a,h){if(h){a.super_=h;var y=function(){};y.prototype=h.prototype,a.prototype=new y,a.prototype.constructor=a}}},{}],11:[function(o,c){var a=Math.round;function h(f){if(f+="",!(100<f.length)){var g=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(f);if(g){var p=parseFloat(g[1]),C=(g[2]||"ms").toLowerCase();return C==="years"||C==="year"||C==="yrs"||C==="yr"||C==="y"?315576e5*p:C==="weeks"||C==="week"||C==="w"?6048e5*p:C==="days"||C==="day"||C==="d"?864e5*p:C==="hours"||C==="hour"||C==="hrs"||C==="hr"||C==="h"?36e5*p:C==="minutes"||C==="minute"||C==="mins"||C==="min"||C==="m"?6e4*p:C==="seconds"||C==="second"||C==="secs"||C==="sec"||C==="s"?1e3*p:C==="milliseconds"||C==="millisecond"||C==="msecs"||C==="msec"||C==="ms"?p:void 0}}}function y(f){var g=s(f);return 864e5<=g?a(f/864e5)+"d":36e5<=g?a(f/36e5)+"h":6e4<=g?a(f/6e4)+"m":1e3<=g?a(f/1e3)+"s":f+"ms"}function b(f){var g=s(f);return 864e5<=g?u(f,g,864e5,"day"):36e5<=g?u(f,g,36e5,"hour"):6e4<=g?u(f,g,6e4,"minute"):1e3<=g?u(f,g,1e3,"second"):f+" ms"}function u(f,g,p,C){return a(f/p)+" "+C+(g>=1.5*p?"s":"")}c.exports=function(f,g){g=g||{};var p=typeof f;if(p=="string"&&0<f.length)return h(f);if(p==="number"&&isFinite(f))return g.long?b(f):y(f);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(f))}},{}],12:[function(o,c){function a(){throw new Error("setTimeout has not been defined")}function h(){throw new Error("clearTimeout has not been defined")}function y(T){if(C===setTimeout)return setTimeout(T,0);if((C===a||!C)&&setTimeout)return C=setTimeout,setTimeout(T,0);try{return C(T,0)}catch{try{return C.call(null,T,0)}catch{return C.call(this,T,0)}}}function b(T){if(x===clearTimeout)return clearTimeout(T);if((x===h||!x)&&clearTimeout)return x=clearTimeout,clearTimeout(T);try{return x(T)}catch{try{return x.call(null,T)}catch{return x.call(this,T)}}}function u(){_&&M&&(_=!1,M.length?m=M.concat(m):v=-1,m.length&&f())}function f(){if(!_){var T=y(u);_=!0;for(var E=m.length;E;){for(M=m,m=[];++v<E;)M&&M[v].run();v=-1,E=m.length}M=null,_=!1,b(T)}}function g(T,E){this.fun=T,this.array=E}function p(){}var C,x,L=c.exports={};(function(){try{C=typeof setTimeout=="function"?setTimeout:a}catch{C=a}try{x=typeof clearTimeout=="function"?clearTimeout:h}catch{x=h}})();var M,m=[],_=!1,v=-1;L.nextTick=function(T){var E=Array(arguments.length-1);if(1<arguments.length)for(var I=1;I<arguments.length;I++)E[I-1]=arguments[I];m.push(new g(T,E)),m.length!==1||_||y(f)},g.prototype.run=function(){this.fun.apply(null,this.array)},L.title="browser",L.browser=!0,L.env={},L.argv=[],L.version="",L.versions={},L.on=p,L.addListener=p,L.once=p,L.off=p,L.removeListener=p,L.removeAllListeners=p,L.emit=p,L.prependListener=p,L.prependOnceListener=p,L.listeners=function(){return[]},L.binding=function(){throw new Error("process.binding is not supported")},L.cwd=function(){return"/"},L.chdir=function(){throw new Error("process.chdir is not supported")},L.umask=function(){return 0}},{}],13:[function(o,c){(function(a){(function(){/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let h;c.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window=="undefined"?a:window):y=>(h||(h=Promise.resolve())).then(y).catch(b=>setTimeout(()=>{throw b},0))}).call(this)}).call(this,typeof kt=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:kt)},{}],14:[function(o,c){(function(a,h){(function(){var y=o("safe-buffer").Buffer,b=h.crypto||h.msCrypto;c.exports=b&&b.getRandomValues?function(u,f){if(u>4294967295)throw new RangeError("requested too many random bytes");var g=y.allocUnsafe(u);if(0<u)if(65536<u)for(var p=0;p<u;p+=65536)b.getRandomValues(g.slice(p,p+65536));else b.getRandomValues(g);return typeof f=="function"?a.nextTick(function(){f(null,g)}):g}:function(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}}).call(this)}).call(this,o("_process"),typeof kt=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:kt)},{_process:12,"safe-buffer":30}],15:[function(o,c){function a(p,C){p.prototype=Object.create(C.prototype),p.prototype.constructor=p,p.__proto__=C}function h(p,C,x){function L(m,_,v){return typeof C=="string"?C:C(m,_,v)}x||(x=Error);var M=function(m){function _(v,T,E){return m.call(this,L(v,T,E))||this}return a(_,m),_}(x);M.prototype.name=x.name,M.prototype.code=p,g[p]=M}function y(p,C){if(Array.isArray(p)){var x=p.length;return p=p.map(function(L){return L+""}),2<x?"one of ".concat(C," ").concat(p.slice(0,x-1).join(", "),", or ")+p[x-1]:x===2?"one of ".concat(C," ").concat(p[0]," or ").concat(p[1]):"of ".concat(C," ").concat(p[0])}return"of ".concat(C," ").concat(p+"")}function b(p,C,x){return p.substr(!x||0>x?0:+x,C.length)===C}function u(p,C,x){return(x===void 0||x>p.length)&&(x=p.length),p.substring(x-C.length,x)===C}function f(p,C,x){return typeof x!="number"&&(x=0),!(x+C.length>p.length)&&p.indexOf(C,x)!==-1}var g={};h("ERR_INVALID_OPT_VALUE",function(p,C){return'The value "'+C+'" is invalid for option "'+p+'"'},TypeError),h("ERR_INVALID_ARG_TYPE",function(p,C,x){var L;typeof C=="string"&&b(C,"not ")?(L="must not be",C=C.replace(/^not /,"")):L="must be";var M;if(u(p," argument"))M="The ".concat(p," ").concat(L," ").concat(y(C,"type"));else{var m=f(p,".")?"property":"argument";M='The "'.concat(p,'" ').concat(m," ").concat(L," ").concat(y(C,"type"))}return M+=". Received type ".concat(typeof x),M},TypeError),h("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),h("ERR_METHOD_NOT_IMPLEMENTED",function(p){return"The "+p+" method is not implemented"}),h("ERR_STREAM_PREMATURE_CLOSE","Premature close"),h("ERR_STREAM_DESTROYED",function(p){return"Cannot call "+p+" after a stream was destroyed"}),h("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),h("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),h("ERR_STREAM_WRITE_AFTER_END","write after end"),h("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),h("ERR_UNKNOWN_ENCODING",function(p){return"Unknown encoding: "+p},TypeError),h("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),c.exports.codes=g},{}],16:[function(o,c){(function(a){(function(){function h(L){return this instanceof h?(f.call(this,L),g.call(this,L),this.allowHalfOpen=!0,void(L&&(L.readable===!1&&(this.readable=!1),L.writable===!1&&(this.writable=!1),L.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",y))))):new h(L)}function y(){this._writableState.ended||a.nextTick(b,this)}function b(L){L.end()}var u=Object.keys||function(L){var M=[];for(var m in L)M.push(m);return M};c.exports=h;var f=o("./_stream_readable"),g=o("./_stream_writable");o("inherits")(h,f);for(var p,C=u(g.prototype),x=0;x<C.length;x++)p=C[x],h.prototype[p]||(h.prototype[p]=g.prototype[p]);Object.defineProperty(h.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(h.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(h.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(h.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(L){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=L,this._writableState.destroyed=L)}})}).call(this)}).call(this,o("_process"))},{"./_stream_readable":18,"./_stream_writable":20,_process:12,inherits:10}],17:[function(o,c){function a(y){return this instanceof a?void h.call(this,y):new a(y)}c.exports=a;var h=o("./_stream_transform");o("inherits")(a,h),a.prototype._transform=function(y,b,u){u(null,y)}},{"./_stream_transform":19,inherits:10}],18:[function(o,c){(function(a,h){(function(){function y(w){return $t.from(w)}function b(w){return $t.isBuffer(w)||w instanceof rt}function u(w,r,l){return typeof w.prependListener=="function"?w.prependListener(r,l):void(w._events&&w._events[r]?Array.isArray(w._events[r])?w._events[r].unshift(l):w._events[r]=[l,w._events[r]]:w.on(r,l))}function f(w,r,l){pt=pt||o("./_stream_duplex"),w=w||{},typeof l!="boolean"&&(l=r instanceof pt),this.objectMode=!!w.objectMode,l&&(this.objectMode=this.objectMode||!!w.readableObjectMode),this.highWaterMark=Le(this,w,"readableHighWaterMark",l),this.buffer=new Ie,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=w.emitClose!==!1,this.autoDestroy=!!w.autoDestroy,this.destroyed=!1,this.defaultEncoding=w.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,w.encoding&&(!vt&&(vt=o("string_decoder/").StringDecoder),this.decoder=new vt(w.encoding),this.encoding=w.encoding)}function g(w){if(pt=pt||o("./_stream_duplex"),!(this instanceof g))return new g(w);var r=this instanceof pt;this._readableState=new f(w,this,r),this.readable=!0,w&&(typeof w.read=="function"&&(this._read=w.read),typeof w.destroy=="function"&&(this._destroy=w.destroy)),_t.call(this)}function p(w,r,l,d,S){W("readableAddChunk",r);var R=w._readableState;if(r===null)R.reading=!1,m(w,R);else{var N;if(S||(N=x(R,r)),N)j(w,N);else if(!(R.objectMode||r&&0<r.length))d||(R.reading=!1,T(w,R));else if(typeof r=="string"||R.objectMode||Object.getPrototypeOf(r)===$t.prototype||(r=y(r)),d)R.endEmitted?j(w,new O):C(w,R,r,!0);else if(R.ended)j(w,new Et);else{if(R.destroyed)return!1;R.reading=!1,R.decoder&&!l?(r=R.decoder.write(r),R.objectMode||r.length!==0?C(w,R,r,!1):T(w,R)):C(w,R,r,!1)}}return!R.ended&&(R.length<R.highWaterMark||R.length===0)}function C(w,r,l,d){r.flowing&&r.length===0&&!r.sync?(r.awaitDrain=0,w.emit("data",l)):(r.length+=r.objectMode?1:l.length,d?r.buffer.unshift(l):r.buffer.push(l),r.needReadable&&_(w)),T(w,r)}function x(w,r){var l;return b(r)||typeof r=="string"||r===void 0||w.objectMode||(l=new Ct("chunk",["string","Buffer","Uint8Array"],r)),l}function L(w){return 1073741824<=w?w=1073741824:(w--,w|=w>>>1,w|=w>>>2,w|=w>>>4,w|=w>>>8,w|=w>>>16,w++),w}function M(w,r){return 0>=w||r.length===0&&r.ended?0:r.objectMode?1:w===w?(w>r.highWaterMark&&(r.highWaterMark=L(w)),w<=r.length?w:r.ended?r.length:(r.needReadable=!0,0)):r.flowing&&r.length?r.buffer.head.data.length:r.length}function m(w,r){if(W("onEofChunk"),!r.ended){if(r.decoder){var l=r.decoder.end();l&&l.length&&(r.buffer.push(l),r.length+=r.objectMode?1:l.length)}r.ended=!0,r.sync?_(w):(r.needReadable=!1,!r.emittedReadable&&(r.emittedReadable=!0,v(w)))}}function _(w){var r=w._readableState;W("emitReadable",r.needReadable,r.emittedReadable),r.needReadable=!1,r.emittedReadable||(W("emitReadable",r.flowing),r.emittedReadable=!0,a.nextTick(v,w))}function v(w){var r=w._readableState;W("emitReadable_",r.destroyed,r.length,r.ended),!r.destroyed&&(r.length||r.ended)&&(w.emit("readable"),r.emittedReadable=!1),r.needReadable=!r.flowing&&!r.ended&&r.length<=r.highWaterMark,B(w)}function T(w,r){r.readingMore||(r.readingMore=!0,a.nextTick(E,w,r))}function E(w,r){for(;!r.reading&&!r.ended&&(r.length<r.highWaterMark||r.flowing&&r.length===0);){var l=r.length;if(W("maybeReadMore read 0"),w.read(0),l===r.length)break}r.readingMore=!1}function I(w){return function(){var r=w._readableState;W("pipeOnDrain",r.awaitDrain),r.awaitDrain&&r.awaitDrain--,r.awaitDrain===0&&ge(w,"data")&&(r.flowing=!0,B(w))}}function U(w){var r=w._readableState;r.readableListening=0<w.listenerCount("readable"),r.resumeScheduled&&!r.paused?r.flowing=!0:0<w.listenerCount("data")&&w.resume()}function k(w){W("readable nexttick read 0"),w.read(0)}function A(w,r){r.resumeScheduled||(r.resumeScheduled=!0,a.nextTick(F,w,r))}function F(w,r){W("resume",r.reading),r.reading||w.read(0),r.resumeScheduled=!1,w.emit("resume"),B(w),r.flowing&&!r.reading&&w.read(0)}function B(w){var r=w._readableState;for(W("flow",r.flowing);r.flowing&&w.read()!==null;);}function H(w,r){if(r.length===0)return null;var l;return r.objectMode?l=r.buffer.shift():!w||w>=r.length?(l=r.decoder?r.buffer.join(""):r.buffer.length===1?r.buffer.first():r.buffer.concat(r.length),r.buffer.clear()):l=r.buffer.consume(w,r.decoder),l}function Y(w){var r=w._readableState;W("endReadable",r.endEmitted),r.endEmitted||(r.ended=!0,a.nextTick(J,r,w))}function J(w,r){if(W("endReadableNT",w.endEmitted,w.length),!w.endEmitted&&w.length===0&&(w.endEmitted=!0,r.readable=!1,r.emit("end"),w.autoDestroy)){var l=r._writableState;(!l||l.autoDestroy&&l.finished)&&r.destroy()}}function it(w,r){for(var l=0,d=w.length;l<d;l++)if(w[l]===r)return l;return-1}c.exports=g;var pt;g.ReadableState=f;var W;o("events").EventEmitter;var ge=function(w,r){return w.listeners(r).length},_t=o("./internal/streams/stream"),$t=o("buffer").Buffer,rt=h.Uint8Array||function(){},Z=o("util");W=Z&&Z.debuglog?Z.debuglog("stream"):function(){};var vt,Yt,Kt,Ie=o("./internal/streams/buffer_list"),ee=o("./internal/streams/destroy"),ne=o("./internal/streams/state"),Le=ne.getHighWaterMark,Qt=o("../errors").codes,Ct=Qt.ERR_INVALID_ARG_TYPE,Et=Qt.ERR_STREAM_PUSH_AFTER_EOF,D=Qt.ERR_METHOD_NOT_IMPLEMENTED,O=Qt.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;o("inherits")(g,_t);var j=ee.errorOrDestroy,q=["error","close","destroy","pause","resume"];Object.defineProperty(g.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(w){this._readableState&&(this._readableState.destroyed=w)}}),g.prototype.destroy=ee.destroy,g.prototype._undestroy=ee.undestroy,g.prototype._destroy=function(w,r){r(w)},g.prototype.push=function(w,r){var l,d=this._readableState;return d.objectMode?l=!0:typeof w=="string"&&(r=r||d.defaultEncoding,r!==d.encoding&&(w=$t.from(w,r),r=""),l=!0),p(this,w,r,!1,l)},g.prototype.unshift=function(w){return p(this,w,null,!0,!1)},g.prototype.isPaused=function(){return this._readableState.flowing===!1},g.prototype.setEncoding=function(w){vt||(vt=o("string_decoder/").StringDecoder);var r=new vt(w);this._readableState.decoder=r,this._readableState.encoding=this._readableState.decoder.encoding;for(var l=this._readableState.buffer.head,d="";l!==null;)d+=r.write(l.data),l=l.next;return this._readableState.buffer.clear(),d!==""&&this._readableState.buffer.push(d),this._readableState.length=d.length,this},g.prototype.read=function(w){W("read",w),w=parseInt(w,10);var r=this._readableState,l=w;if(w!==0&&(r.emittedReadable=!1),w===0&&r.needReadable&&((r.highWaterMark===0?0<r.length:r.length>=r.highWaterMark)||r.ended))return W("read: emitReadable",r.length,r.ended),r.length===0&&r.ended?Y(this):_(this),null;if(w=M(w,r),w===0&&r.ended)return r.length===0&&Y(this),null;var d=r.needReadable;W("need readable",d),(r.length===0||r.length-w<r.highWaterMark)&&(d=!0,W("length less than watermark",d)),r.ended||r.reading?(d=!1,W("reading or ended",d)):d&&(W("do read"),r.reading=!0,r.sync=!0,r.length===0&&(r.needReadable=!0),this._read(r.highWaterMark),r.sync=!1,!r.reading&&(w=M(l,r)));var S;return S=0<w?H(w,r):null,S===null?(r.needReadable=r.length<=r.highWaterMark,w=0):(r.length-=w,r.awaitDrain=0),r.length===0&&(!r.ended&&(r.needReadable=!0),l!==w&&r.ended&&Y(this)),S!==null&&this.emit("data",S),S},g.prototype._read=function(){j(this,new D("_read()"))},g.prototype.pipe=function(w,r){function l(ye,we){W("onunpipe"),ye===G&&we&&we.hasUnpiped===!1&&(we.hasUnpiped=!0,S())}function d(){W("onend"),w.end()}function S(){W("cleanup"),w.removeListener("close",P),w.removeListener("finish",Q),w.removeListener("drain",me),w.removeListener("error",N),w.removeListener("unpipe",l),G.removeListener("end",d),G.removeListener("end",et),G.removeListener("data",R),xe=!0,K.awaitDrain&&(!w._writableState||w._writableState.needDrain)&&me()}function R(ye){W("ondata");var we=w.write(ye);W("dest.write",we),we===!1&&((K.pipesCount===1&&K.pipes===w||1<K.pipesCount&&it(K.pipes,w)!==-1)&&!xe&&(W("false write response, pause",K.awaitDrain),K.awaitDrain++),G.pause())}function N(ye){W("onerror",ye),et(),w.removeListener("error",N),ge(w,"error")===0&&j(w,ye)}function P(){w.removeListener("finish",Q),et()}function Q(){W("onfinish"),w.removeListener("close",P),et()}function et(){W("unpipe"),G.unpipe(w)}var G=this,K=this._readableState;switch(K.pipesCount){case 0:K.pipes=w;break;case 1:K.pipes=[K.pipes,w];break;default:K.pipes.push(w)}K.pipesCount+=1,W("pipe count=%d opts=%j",K.pipesCount,r);var dt=(!r||r.end!==!1)&&w!==a.stdout&&w!==a.stderr,re=dt?d:et;K.endEmitted?a.nextTick(re):G.once("end",re),w.on("unpipe",l);var me=I(G);w.on("drain",me);var xe=!1;return G.on("data",R),u(w,"error",N),w.once("close",P),w.once("finish",Q),w.emit("pipe",G),K.flowing||(W("pipe resume"),G.resume()),w},g.prototype.unpipe=function(w){var r=this._readableState,l={hasUnpiped:!1};if(r.pipesCount===0)return this;if(r.pipesCount===1)return w&&w!==r.pipes?this:(w||(w=r.pipes),r.pipes=null,r.pipesCount=0,r.flowing=!1,w&&w.emit("unpipe",this,l),this);if(!w){var d=r.pipes,S=r.pipesCount;r.pipes=null,r.pipesCount=0,r.flowing=!1;for(var R=0;R<S;R++)d[R].emit("unpipe",this,{hasUnpiped:!1});return this}var N=it(r.pipes,w);return N===-1?this:(r.pipes.splice(N,1),r.pipesCount-=1,r.pipesCount===1&&(r.pipes=r.pipes[0]),w.emit("unpipe",this,l),this)},g.prototype.on=function(w,r){var l=_t.prototype.on.call(this,w,r),d=this._readableState;return w==="data"?(d.readableListening=0<this.listenerCount("readable"),d.flowing!==!1&&this.resume()):w=="readable"&&!d.endEmitted&&!d.readableListening&&(d.readableListening=d.needReadable=!0,d.flowing=!1,d.emittedReadable=!1,W("on readable",d.length,d.reading),d.length?_(this):!d.reading&&a.nextTick(k,this)),l},g.prototype.addListener=g.prototype.on,g.prototype.removeListener=function(w,r){var l=_t.prototype.removeListener.call(this,w,r);return w==="readable"&&a.nextTick(U,this),l},g.prototype.removeAllListeners=function(w){var r=_t.prototype.removeAllListeners.apply(this,arguments);return(w==="readable"||w===void 0)&&a.nextTick(U,this),r},g.prototype.resume=function(){var w=this._readableState;return w.flowing||(W("resume"),w.flowing=!w.readableListening,A(this,w)),w.paused=!1,this},g.prototype.pause=function(){return W("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(W("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},g.prototype.wrap=function(w){var r=this,l=this._readableState,d=!1;for(var S in w.on("end",function(){if(W("wrapped end"),l.decoder&&!l.ended){var N=l.decoder.end();N&&N.length&&r.push(N)}r.push(null)}),w.on("data",function(N){if(W("wrapped data"),l.decoder&&(N=l.decoder.write(N)),!(l.objectMode&&N==null)&&(l.objectMode||N&&N.length)){var P=r.push(N);P||(d=!0,w.pause())}}),w)this[S]===void 0&&typeof w[S]=="function"&&(this[S]=function(N){return function(){return w[N].apply(w,arguments)}}(S));for(var R=0;R<q.length;R++)w.on(q[R],this.emit.bind(this,q[R]));return this._read=function(N){W("wrapped _read",N),d&&(d=!1,w.resume())},this},typeof Symbol=="function"&&(g.prototype[Symbol.asyncIterator]=function(){return Yt===void 0&&(Yt=o("./internal/streams/async_iterator")),Yt(this)}),Object.defineProperty(g.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(g.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(g.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(w){this._readableState&&(this._readableState.flowing=w)}}),g._fromList=H,Object.defineProperty(g.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(g.from=function(w,r){return Kt===void 0&&(Kt=o("./internal/streams/from")),Kt(g,w,r)})}).call(this)}).call(this,o("_process"),typeof kt=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:kt)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/async_iterator":21,"./internal/streams/buffer_list":22,"./internal/streams/destroy":23,"./internal/streams/from":25,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,events:7,inherits:10,"string_decoder/":31,util:2}],19:[function(o,c){function a(L,M){var m=this._transformState;m.transforming=!1;var _=m.writecb;if(_===null)return this.emit("error",new g);m.writechunk=null,m.writecb=null,M!=null&&this.push(M),_(L);var v=this._readableState;v.reading=!1,(v.needReadable||v.length<v.highWaterMark)&&this._read(v.highWaterMark)}function h(L){return this instanceof h?(x.call(this,L),this._transformState={afterTransform:a.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,L&&(typeof L.transform=="function"&&(this._transform=L.transform),typeof L.flush=="function"&&(this._flush=L.flush)),void this.on("prefinish",y)):new h(L)}function y(){var L=this;typeof this._flush!="function"||this._readableState.destroyed?b(this,null,null):this._flush(function(M,m){b(L,M,m)})}function b(L,M,m){if(M)return L.emit("error",M);if(m!=null&&L.push(m),L._writableState.length)throw new C;if(L._transformState.transforming)throw new p;return L.push(null)}c.exports=h;var u=o("../errors").codes,f=u.ERR_METHOD_NOT_IMPLEMENTED,g=u.ERR_MULTIPLE_CALLBACK,p=u.ERR_TRANSFORM_ALREADY_TRANSFORMING,C=u.ERR_TRANSFORM_WITH_LENGTH_0,x=o("./_stream_duplex");o("inherits")(h,x),h.prototype.push=function(L,M){return this._transformState.needTransform=!1,x.prototype.push.call(this,L,M)},h.prototype._transform=function(L,M,m){m(new f("_transform()"))},h.prototype._write=function(L,M,m){var _=this._transformState;if(_.writecb=m,_.writechunk=L,_.writeencoding=M,!_.transforming){var v=this._readableState;(_.needTransform||v.needReadable||v.length<v.highWaterMark)&&this._read(v.highWaterMark)}},h.prototype._read=function(){var L=this._transformState;L.writechunk===null||L.transforming?L.needTransform=!0:(L.transforming=!0,this._transform(L.writechunk,L.writeencoding,L.afterTransform))},h.prototype._destroy=function(L,M){x.prototype._destroy.call(this,L,function(m){M(m)})}},{"../errors":15,"./_stream_duplex":16,inherits:10}],20:[function(o,c){(function(a,h){(function(){function y(D){var O=this;this.next=null,this.entry=null,this.finish=function(){Y(O,D)}}function b(D){return W.from(D)}function u(D){return W.isBuffer(D)||D instanceof ge}function f(){}function g(D,O,j){J=J||o("./_stream_duplex"),D=D||{},typeof j!="boolean"&&(j=O instanceof J),this.objectMode=!!D.objectMode,j&&(this.objectMode=this.objectMode||!!D.writableObjectMode),this.highWaterMark=rt(this,D,"writableHighWaterMark",j),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var q=D.decodeStrings===!1;this.decodeStrings=!q,this.defaultEncoding=D.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(w){T(O,w)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=D.emitClose!==!1,this.autoDestroy=!!D.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new y(this)}function p(D){J=J||o("./_stream_duplex");var O=this instanceof J;return O||Et.call(p,this)?(this._writableState=new g(D,this,O),this.writable=!0,D&&(typeof D.write=="function"&&(this._write=D.write),typeof D.writev=="function"&&(this._writev=D.writev),typeof D.destroy=="function"&&(this._destroy=D.destroy),typeof D.final=="function"&&(this._final=D.final)),void pt.call(this)):new p(D)}function C(D,O){var j=new Le;Ct(D,j),a.nextTick(O,j)}function x(D,O,j,q){var w;return j===null?w=new ne:typeof j!="string"&&!O.objectMode&&(w=new vt("chunk",["string","Buffer"],j)),!w||(Ct(D,w),a.nextTick(q,w),!1)}function L(D,O,j){return D.objectMode||D.decodeStrings===!1||typeof O!="string"||(O=W.from(O,j)),O}function M(D,O,j,q,w,r){if(!j){var l=L(O,q,w);q!==l&&(j=!0,w="buffer",q=l)}var d=O.objectMode?1:q.length;O.length+=d;var S=O.length<O.highWaterMark;if(S||(O.needDrain=!0),O.writing||O.corked){var R=O.lastBufferedRequest;O.lastBufferedRequest={chunk:q,encoding:w,isBuf:j,callback:r,next:null},R?R.next=O.lastBufferedRequest:O.bufferedRequest=O.lastBufferedRequest,O.bufferedRequestCount+=1}else m(D,O,!1,d,q,w,r);return S}function m(D,O,j,q,w,r,l){O.writelen=q,O.writecb=l,O.writing=!0,O.sync=!0,O.destroyed?O.onwrite(new ee("write")):j?D._writev(w,O.onwrite):D._write(w,r,O.onwrite),O.sync=!1}function _(D,O,j,q,w){--O.pendingcb,j?(a.nextTick(w,q),a.nextTick(B,D,O),D._writableState.errorEmitted=!0,Ct(D,q)):(w(q),D._writableState.errorEmitted=!0,Ct(D,q),B(D,O))}function v(D){D.writing=!1,D.writecb=null,D.length-=D.writelen,D.writelen=0}function T(D,O){var j=D._writableState,q=j.sync,w=j.writecb;if(typeof w!="function")throw new Kt;if(v(j),O)_(D,j,q,O,w);else{var r=k(j)||D.destroyed;r||j.corked||j.bufferProcessing||!j.bufferedRequest||U(D,j),q?a.nextTick(E,D,j,r,w):E(D,j,r,w)}}function E(D,O,j,q){j||I(D,O),O.pendingcb--,q(),B(D,O)}function I(D,O){O.length===0&&O.needDrain&&(O.needDrain=!1,D.emit("drain"))}function U(D,O){O.bufferProcessing=!0;var j=O.bufferedRequest;if(D._writev&&j&&j.next){var q=O.bufferedRequestCount,w=Array(q),r=O.corkedRequestsFree;r.entry=j;for(var l=0,d=!0;j;)w[l]=j,j.isBuf||(d=!1),j=j.next,l+=1;w.allBuffers=d,m(D,O,!0,O.length,w,"",r.finish),O.pendingcb++,O.lastBufferedRequest=null,r.next?(O.corkedRequestsFree=r.next,r.next=null):O.corkedRequestsFree=new y(O),O.bufferedRequestCount=0}else{for(;j;){var S=j.chunk,R=j.encoding,N=j.callback,P=O.objectMode?1:S.length;if(m(D,O,!1,P,S,R,N),j=j.next,O.bufferedRequestCount--,O.writing)break}j===null&&(O.lastBufferedRequest=null)}O.bufferedRequest=j,O.bufferProcessing=!1}function k(D){return D.ending&&D.length===0&&D.bufferedRequest===null&&!D.finished&&!D.writing}function A(D,O){D._final(function(j){O.pendingcb--,j&&Ct(D,j),O.prefinished=!0,D.emit("prefinish"),B(D,O)})}function F(D,O){O.prefinished||O.finalCalled||(typeof D._final!="function"||O.destroyed?(O.prefinished=!0,D.emit("prefinish")):(O.pendingcb++,O.finalCalled=!0,a.nextTick(A,D,O)))}function B(D,O){var j=k(O);if(j&&(F(D,O),O.pendingcb===0&&(O.finished=!0,D.emit("finish"),O.autoDestroy))){var q=D._readableState;(!q||q.autoDestroy&&q.endEmitted)&&D.destroy()}return j}function H(D,O,j){O.ending=!0,B(D,O),j&&(O.finished?a.nextTick(j):D.once("finish",j)),O.ended=!0,D.writable=!1}function Y(D,O,j){var q=D.entry;for(D.entry=null;q;){var w=q.callback;O.pendingcb--,w(j),q=q.next}O.corkedRequestsFree.next=D}c.exports=p;var J;p.WritableState=g;var it={deprecate:o("util-deprecate")},pt=o("./internal/streams/stream"),W=o("buffer").Buffer,ge=h.Uint8Array||function(){},_t=o("./internal/streams/destroy"),$t=o("./internal/streams/state"),rt=$t.getHighWaterMark,Z=o("../errors").codes,vt=Z.ERR_INVALID_ARG_TYPE,Yt=Z.ERR_METHOD_NOT_IMPLEMENTED,Kt=Z.ERR_MULTIPLE_CALLBACK,Ie=Z.ERR_STREAM_CANNOT_PIPE,ee=Z.ERR_STREAM_DESTROYED,ne=Z.ERR_STREAM_NULL_VALUES,Le=Z.ERR_STREAM_WRITE_AFTER_END,Qt=Z.ERR_UNKNOWN_ENCODING,Ct=_t.errorOrDestroy;o("inherits")(p,pt),g.prototype.getBuffer=function(){for(var D=this.bufferedRequest,O=[];D;)O.push(D),D=D.next;return O},function(){try{Object.defineProperty(g.prototype,"buffer",{get:it.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var Et;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(Et=Function.prototype[Symbol.hasInstance],Object.defineProperty(p,Symbol.hasInstance,{value:function(D){return!!Et.call(this,D)||this===p&&D&&D._writableState instanceof g}})):Et=function(D){return D instanceof this},p.prototype.pipe=function(){Ct(this,new Ie)},p.prototype.write=function(D,O,j){var q=this._writableState,w=!1,r=!q.objectMode&&u(D);return r&&!W.isBuffer(D)&&(D=b(D)),typeof O=="function"&&(j=O,O=null),r?O="buffer":!O&&(O=q.defaultEncoding),typeof j!="function"&&(j=f),q.ending?C(this,j):(r||x(this,q,D,j))&&(q.pendingcb++,w=M(this,q,r,D,O,j)),w},p.prototype.cork=function(){this._writableState.corked++},p.prototype.uncork=function(){var D=this._writableState;D.corked&&(D.corked--,!D.writing&&!D.corked&&!D.bufferProcessing&&D.bufferedRequest&&U(this,D))},p.prototype.setDefaultEncoding=function(D){if(typeof D=="string"&&(D=D.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((D+"").toLowerCase())))throw new Qt(D);return this._writableState.defaultEncoding=D,this},Object.defineProperty(p.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(p.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),p.prototype._write=function(D,O,j){j(new Yt("_write()"))},p.prototype._writev=null,p.prototype.end=function(D,O,j){var q=this._writableState;return typeof D=="function"?(j=D,D=null,O=null):typeof O=="function"&&(j=O,O=null),D!=null&&this.write(D,O),q.corked&&(q.corked=1,this.uncork()),q.ending||H(this,q,j),this},Object.defineProperty(p.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(p.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(D){this._writableState&&(this._writableState.destroyed=D)}}),p.prototype.destroy=_t.destroy,p.prototype._undestroy=_t.undestroy,p.prototype._destroy=function(D,O){O(D)}}).call(this)}).call(this,o("_process"),typeof kt=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:kt)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/destroy":23,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,inherits:10,"util-deprecate":32}],21:[function(o,c){(function(a){(function(){function h(I,U,k){return U in I?Object.defineProperty(I,U,{value:k,enumerable:!0,configurable:!0,writable:!0}):I[U]=k,I}function y(I,U){return{value:I,done:U}}function b(I){var U=I[C];if(U!==null){var k=I[v].read();k!==null&&(I[m]=null,I[C]=null,I[x]=null,U(y(k,!1)))}}function u(I){a.nextTick(b,I)}function f(I,U){return function(k,A){I.then(function(){return U[M]?void k(y(void 0,!0)):void U[_](k,A)},A)}}var g,p=o("./end-of-stream"),C=Symbol("lastResolve"),x=Symbol("lastReject"),L=Symbol("error"),M=Symbol("ended"),m=Symbol("lastPromise"),_=Symbol("handlePromise"),v=Symbol("stream"),T=Object.getPrototypeOf(function(){}),E=Object.setPrototypeOf((g={get stream(){return this[v]},next:function(){var I=this,U=this[L];if(U!==null)return Promise.reject(U);if(this[M])return Promise.resolve(y(void 0,!0));if(this[v].destroyed)return new Promise(function(B,H){a.nextTick(function(){I[L]?H(I[L]):B(y(void 0,!0))})});var k,A=this[m];if(A)k=new Promise(f(A,this));else{var F=this[v].read();if(F!==null)return Promise.resolve(y(F,!1));k=new Promise(this[_])}return this[m]=k,k}},h(g,Symbol.asyncIterator,function(){return this}),h(g,"return",function(){var I=this;return new Promise(function(U,k){I[v].destroy(null,function(A){return A?void k(A):void U(y(void 0,!0))})})}),g),T);c.exports=function(I){var U,k=Object.create(E,(U={},h(U,v,{value:I,writable:!0}),h(U,C,{value:null,writable:!0}),h(U,x,{value:null,writable:!0}),h(U,L,{value:null,writable:!0}),h(U,M,{value:I._readableState.endEmitted,writable:!0}),h(U,_,{value:function(A,F){var B=k[v].read();B?(k[m]=null,k[C]=null,k[x]=null,A(y(B,!1))):(k[C]=A,k[x]=F)},writable:!0}),U));return k[m]=null,p(I,function(A){if(A&&A.code!=="ERR_STREAM_PREMATURE_CLOSE"){var F=k[x];return F!==null&&(k[m]=null,k[C]=null,k[x]=null,F(A)),void(k[L]=A)}var B=k[C];B!==null&&(k[m]=null,k[C]=null,k[x]=null,B(y(void 0,!0))),k[M]=!0}),I.on("readable",u.bind(null,k)),k}}).call(this)}).call(this,o("_process"))},{"./end-of-stream":24,_process:12}],22:[function(o,c){function a(m,_){var v=Object.keys(m);if(Object.getOwnPropertySymbols){var T=Object.getOwnPropertySymbols(m);_&&(T=T.filter(function(E){return Object.getOwnPropertyDescriptor(m,E).enumerable})),v.push.apply(v,T)}return v}function h(m){for(var _,v=1;v<arguments.length;v++)_=arguments[v]==null?{}:arguments[v],v%2?a(Object(_),!0).forEach(function(T){y(m,T,_[T])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(_)):a(Object(_)).forEach(function(T){Object.defineProperty(m,T,Object.getOwnPropertyDescriptor(_,T))});return m}function y(m,_,v){return _ in m?Object.defineProperty(m,_,{value:v,enumerable:!0,configurable:!0,writable:!0}):m[_]=v,m}function b(m,_){if(!(m instanceof _))throw new TypeError("Cannot call a class as a function")}function u(m,_){for(var v,T=0;T<_.length;T++)v=_[T],v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(m,v.key,v)}function f(m,_,v){return _&&u(m.prototype,_),v&&u(m,v),m}function g(m,_,v){C.prototype.copy.call(m,_,v)}var p=o("buffer"),C=p.Buffer,x=o("util"),L=x.inspect,M=L&&L.custom||"inspect";c.exports=function(){function m(){b(this,m),this.head=null,this.tail=null,this.length=0}return f(m,[{key:"push",value:function(_){var v={data:_,next:null};0<this.length?this.tail.next=v:this.head=v,this.tail=v,++this.length}},{key:"unshift",value:function(_){var v={data:_,next:this.head};this.length===0&&(this.tail=v),this.head=v,++this.length}},{key:"shift",value:function(){if(this.length!==0){var _=this.head.data;return this.head=this.length===1?this.tail=null:this.head.next,--this.length,_}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(_){if(this.length===0)return"";for(var v=this.head,T=""+v.data;v=v.next;)T+=_+v.data;return T}},{key:"concat",value:function(_){if(this.length===0)return C.alloc(0);for(var v=C.allocUnsafe(_>>>0),T=this.head,E=0;T;)g(T.data,v,E),E+=T.data.length,T=T.next;return v}},{key:"consume",value:function(_,v){var T;return _<this.head.data.length?(T=this.head.data.slice(0,_),this.head.data=this.head.data.slice(_)):_===this.head.data.length?T=this.shift():T=v?this._getString(_):this._getBuffer(_),T}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(_){var v=this.head,T=1,E=v.data;for(_-=E.length;v=v.next;){var I=v.data,U=_>I.length?I.length:_;if(E+=U===I.length?I:I.slice(0,_),_-=U,_===0){U===I.length?(++T,this.head=v.next?v.next:this.tail=null):(this.head=v,v.data=I.slice(U));break}++T}return this.length-=T,E}},{key:"_getBuffer",value:function(_){var v=C.allocUnsafe(_),T=this.head,E=1;for(T.data.copy(v),_-=T.data.length;T=T.next;){var I=T.data,U=_>I.length?I.length:_;if(I.copy(v,v.length-_,0,U),_-=U,_===0){U===I.length?(++E,this.head=T.next?T.next:this.tail=null):(this.head=T,T.data=I.slice(U));break}++E}return this.length-=E,v}},{key:M,value:function(_,v){return L(this,h({},v,{depth:0,customInspect:!1}))}}]),m}()},{buffer:3,util:2}],23:[function(o,c){(function(a){(function(){function h(u,f){b(u,f),y(u)}function y(u){u._writableState&&!u._writableState.emitClose||u._readableState&&!u._readableState.emitClose||u.emit("close")}function b(u,f){u.emit("error",f)}c.exports={destroy:function(u,f){var g=this,p=this._readableState&&this._readableState.destroyed,C=this._writableState&&this._writableState.destroyed;return p||C?(f?f(u):u&&(this._writableState?!this._writableState.errorEmitted&&(this._writableState.errorEmitted=!0,a.nextTick(b,this,u)):a.nextTick(b,this,u)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(u||null,function(x){!f&&x?g._writableState?g._writableState.errorEmitted?a.nextTick(y,g):(g._writableState.errorEmitted=!0,a.nextTick(h,g,x)):a.nextTick(h,g,x):f?(a.nextTick(y,g),f(x)):a.nextTick(y,g)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(u,f){var g=u._readableState,p=u._writableState;g&&g.autoDestroy||p&&p.autoDestroy?u.destroy(f):u.emit("error",f)}}}).call(this)}).call(this,o("_process"))},{_process:12}],24:[function(o,c){function a(f){var g=!1;return function(){if(!g){g=!0;for(var p=arguments.length,C=Array(p),x=0;x<p;x++)C[x]=arguments[x];f.apply(this,C)}}}function h(){}function y(f){return f.setHeader&&typeof f.abort=="function"}function b(f,g,p){if(typeof g=="function")return b(f,null,g);g||(g={}),p=a(p||h);var C=g.readable||g.readable!==!1&&f.readable,x=g.writable||g.writable!==!1&&f.writable,L=function(){f.writable||m()},M=f._writableState&&f._writableState.finished,m=function(){x=!1,M=!0,C||p.call(f)},_=f._readableState&&f._readableState.endEmitted,v=function(){C=!1,_=!0,x||p.call(f)},T=function(U){p.call(f,U)},E=function(){var U;return C&&!_?(f._readableState&&f._readableState.ended||(U=new u),p.call(f,U)):x&&!M?(f._writableState&&f._writableState.ended||(U=new u),p.call(f,U)):void 0},I=function(){f.req.on("finish",m)};return y(f)?(f.on("complete",m),f.on("abort",E),f.req?I():f.on("request",I)):x&&!f._writableState&&(f.on("end",L),f.on("close",L)),f.on("end",v),f.on("finish",m),g.error!==!1&&f.on("error",T),f.on("close",E),function(){f.removeListener("complete",m),f.removeListener("abort",E),f.removeListener("request",I),f.req&&f.req.removeListener("finish",m),f.removeListener("end",L),f.removeListener("close",L),f.removeListener("finish",m),f.removeListener("end",v),f.removeListener("error",T),f.removeListener("close",E)}}var u=o("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;c.exports=b},{"../../../errors":15}],25:[function(o,c){c.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],26:[function(o,c){function a(M){var m=!1;return function(){m||(m=!0,M.apply(void 0,arguments))}}function h(M){if(M)throw M}function y(M){return M.setHeader&&typeof M.abort=="function"}function b(M,m,_,v){v=a(v);var T=!1;M.on("close",function(){T=!0}),p===void 0&&(p=o("./end-of-stream")),p(M,{readable:m,writable:_},function(I){return I?v(I):(T=!0,void v())});var E=!1;return function(I){if(!T)return E?void 0:(E=!0,y(M)?M.abort():typeof M.destroy=="function"?M.destroy():void v(I||new L("pipe")))}}function u(M){M()}function f(M,m){return M.pipe(m)}function g(M){return M.length&&typeof M[M.length-1]=="function"?M.pop():h}var p,C=o("../../../errors").codes,x=C.ERR_MISSING_ARGS,L=C.ERR_STREAM_DESTROYED;c.exports=function(){for(var M=arguments.length,m=Array(M),_=0;_<M;_++)m[_]=arguments[_];var v=g(m);if(Array.isArray(m[0])&&(m=m[0]),2>m.length)throw new x("streams");var T,E=m.map(function(I,U){var k=U<m.length-1;return b(I,k,0<U,function(A){T||(T=A),A&&E.forEach(u),k||(E.forEach(u),v(T))})});return m.reduce(f)}},{"../../../errors":15,"./end-of-stream":24}],27:[function(o,c){function a(y,b,u){return y.highWaterMark==null?b?y[u]:null:y.highWaterMark}var h=o("../../../errors").codes.ERR_INVALID_OPT_VALUE;c.exports={getHighWaterMark:function(y,b,u,f){var g=a(b,f,u);if(g!=null){if(!(isFinite(g)&&n(g)===g)||0>g){var p=f?u:"highWaterMark";throw new h(p,g)}return n(g)}return y.objectMode?16:16384}}},{"../../../errors":15}],28:[function(o,c){c.exports=o("events").EventEmitter},{events:7}],29:[function(o,c,a){a=c.exports=o("./lib/_stream_readable.js"),a.Stream=a,a.Readable=a,a.Writable=o("./lib/_stream_writable.js"),a.Duplex=o("./lib/_stream_duplex.js"),a.Transform=o("./lib/_stream_transform.js"),a.PassThrough=o("./lib/_stream_passthrough.js"),a.finished=o("./lib/internal/streams/end-of-stream.js"),a.pipeline=o("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,"./lib/_stream_writable.js":20,"./lib/internal/streams/end-of-stream.js":24,"./lib/internal/streams/pipeline.js":26}],30:[function(o,c,a){function h(f,g){for(var p in f)g[p]=f[p]}function y(f,g,p){return u(f,g,p)}/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var b=o("buffer"),u=b.Buffer;u.from&&u.alloc&&u.allocUnsafe&&u.allocUnsafeSlow?c.exports=b:(h(b,a),a.Buffer=y),y.prototype=Object.create(u.prototype),h(u,y),y.from=function(f,g,p){if(typeof f=="number")throw new TypeError("Argument must not be a number");return u(f,g,p)},y.alloc=function(f,g,p){if(typeof f!="number")throw new TypeError("Argument must be a number");var C=u(f);return g===void 0?C.fill(0):typeof p=="string"?C.fill(g,p):C.fill(g),C},y.allocUnsafe=function(f){if(typeof f!="number")throw new TypeError("Argument must be a number");return u(f)},y.allocUnsafeSlow=function(f){if(typeof f!="number")throw new TypeError("Argument must be a number");return b.SlowBuffer(f)}},{buffer:3}],31:[function(o,c,a){function h(E){if(!E)return"utf8";for(var I;;)switch(E){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return E;default:if(I)return;E=(""+E).toLowerCase(),I=!0}}function y(E){var I=h(E);if(typeof I!="string"&&(v.isEncoding===T||!T(E)))throw new Error("Unknown encoding: "+E);return I||E}function b(E){this.encoding=y(E);var I;switch(this.encoding){case"utf16le":this.text=C,this.end=x,I=4;break;case"utf8":this.fillLast=p,I=4;break;case"base64":this.text=L,this.end=M,I=3;break;default:return this.write=m,void(this.end=_)}this.lastNeed=0,this.lastTotal=0,this.lastChar=v.allocUnsafe(I)}function u(E){return 127>=E?0:E>>5==6?2:E>>4==14?3:E>>3==30?4:E>>6==2?-1:-2}function f(E,I,U){var k=I.length-1;if(k<U)return 0;var A=u(I[k]);return 0<=A?(0<A&&(E.lastNeed=A-1),A):--k<U||A===-2?0:(A=u(I[k]),0<=A?(0<A&&(E.lastNeed=A-2),A):--k<U||A===-2?0:(A=u(I[k]),0<=A?(0<A&&(A===2?A=0:E.lastNeed=A-3),A):0))}function g(E,I){if((192&I[0])!=128)return E.lastNeed=0,"\uFFFD";if(1<E.lastNeed&&1<I.length){if((192&I[1])!=128)return E.lastNeed=1,"\uFFFD";if(2<E.lastNeed&&2<I.length&&(192&I[2])!=128)return E.lastNeed=2,"\uFFFD"}}function p(E){var I=this.lastTotal-this.lastNeed,U=g(this,E);return U===void 0?this.lastNeed<=E.length?(E.copy(this.lastChar,I,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(E.copy(this.lastChar,I,0,E.length),void(this.lastNeed-=E.length)):U}function C(E,I){if((E.length-I)%2==0){var U=E.toString("utf16le",I);if(U){var k=U.charCodeAt(U.length-1);if(55296<=k&&56319>=k)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=E[E.length-2],this.lastChar[1]=E[E.length-1],U.slice(0,-1)}return U}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=E[E.length-1],E.toString("utf16le",I,E.length-1)}function x(E){var I=E&&E.length?this.write(E):"";if(this.lastNeed){var U=this.lastTotal-this.lastNeed;return I+this.lastChar.toString("utf16le",0,U)}return I}function L(E,I){var U=(E.length-I)%3;return U==0?E.toString("base64",I):(this.lastNeed=3-U,this.lastTotal=3,U==1?this.lastChar[0]=E[E.length-1]:(this.lastChar[0]=E[E.length-2],this.lastChar[1]=E[E.length-1]),E.toString("base64",I,E.length-U))}function M(E){var I=E&&E.length?this.write(E):"";return this.lastNeed?I+this.lastChar.toString("base64",0,3-this.lastNeed):I}function m(E){return E.toString(this.encoding)}function _(E){return E&&E.length?this.write(E):""}var v=o("safe-buffer").Buffer,T=v.isEncoding||function(E){switch(E=""+E,E&&E.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};a.StringDecoder=b,b.prototype.write=function(E){if(E.length===0)return"";var I,U;if(this.lastNeed){if(I=this.fillLast(E),I===void 0)return"";U=this.lastNeed,this.lastNeed=0}else U=0;return U<E.length?I?I+this.text(E,U):this.text(E,U):I||""},b.prototype.end=function(E){var I=E&&E.length?this.write(E):"";return this.lastNeed?I+"\uFFFD":I},b.prototype.text=function(E,I){var U=f(this,E,I);if(!this.lastNeed)return E.toString("utf8",I);this.lastTotal=U;var k=E.length-(U-this.lastNeed);return E.copy(this.lastChar,0,k),E.toString("utf8",I,k)},b.prototype.fillLast=function(E){return this.lastNeed<=E.length?(E.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(E.copy(this.lastChar,this.lastTotal-this.lastNeed,0,E.length),void(this.lastNeed-=E.length))}},{"safe-buffer":30}],32:[function(o,c){(function(a){(function(){function h(y){try{if(!a.localStorage)return!1}catch{return!1}var b=a.localStorage[y];return b!=null&&(b+"").toLowerCase()==="true"}c.exports=function(y,b){function u(){if(!f){if(h("throwDeprecation"))throw new Error(b);h("traceDeprecation")?console.trace(b):console.warn(b),f=!0}return y.apply(this,arguments)}if(h("noDeprecation"))return y;var f=!1;return u}}).call(this)}).call(this,typeof kt=="undefined"?typeof self=="undefined"?typeof window=="undefined"?{}:window:self:kt)},{}],"/":[function(o,c){function a(M){return M.replace(/a=ice-options:trickle\s\n/g,"")}function h(M){console.warn(M)}/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const y=o("debug")("simple-peer"),b=o("get-browser-rtc"),u=o("randombytes"),f=o("readable-stream"),g=o("queue-microtask"),p=o("err-code"),{Buffer:C}=o("buffer"),x=65536;class L extends f.Duplex{constructor(m){if(m=Object.assign({allowHalfOpen:!1},m),super(m),this._id=u(4).toString("hex").slice(0,7),this._debug("new peer %o",m),this.channelName=m.initiator?m.channelName||u(20).toString("hex"):null,this.initiator=m.initiator||!1,this.channelConfig=m.channelConfig||L.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},L.config,m.config),this.offerOptions=m.offerOptions||{},this.answerOptions=m.answerOptions||{},this.sdpTransform=m.sdpTransform||(_=>_),this.streams=m.streams||(m.stream?[m.stream]:[]),this.trickle=m.trickle===void 0||m.trickle,this.allowHalfTrickle=m.allowHalfTrickle!==void 0&&m.allowHalfTrickle,this.iceCompleteTimeout=m.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=m.wrtc&&typeof m.wrtc=="object"?m.wrtc:b(),!this._wrtc)throw p(typeof window=="undefined"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(_){return void this.destroy(p(_,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=_=>{this._onIceCandidate(_)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(_=>{this.destroy(p(_,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=_=>{this._setupData(_)},this.streams&&this.streams.forEach(_=>{this.addStream(_)}),this._pc.ontrack=_=>{this._onTrack(_)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(m){if(!this.destroying){if(this.destroyed)throw p(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof m=="string")try{m=JSON.parse(m)}catch{m={}}this._debug("signal()"),m.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),m.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(m.transceiverRequest.kind,m.transceiverRequest.init)),m.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(m.candidate):this._pendingCandidates.push(m.candidate)),m.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(m)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(_=>{this._addIceCandidate(_)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(_=>{this.destroy(p(_,"ERR_SET_REMOTE_DESCRIPTION"))}),m.sdp||m.candidate||m.renegotiate||m.transceiverRequest||this.destroy(p(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(m){const _=new this._wrtc.RTCIceCandidate(m);this._pc.addIceCandidate(_).catch(v=>{!_.address||_.address.endsWith(".local")?h("Ignoring unsupported ICE candidate."):this.destroy(p(v,"ERR_ADD_ICE_CANDIDATE"))})}send(m){if(!this.destroying){if(this.destroyed)throw p(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(m)}}addTransceiver(m,_){if(!this.destroying){if(this.destroyed)throw p(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(m,_),this._needsNegotiation()}catch(v){this.destroy(p(v,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:m,init:_}})}}addStream(m){if(!this.destroying){if(this.destroyed)throw p(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),m.getTracks().forEach(_=>{this.addTrack(_,m)})}}addTrack(m,_){if(this.destroying)return;if(this.destroyed)throw p(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const v=this._senderMap.get(m)||new Map;let T=v.get(_);if(!T)T=this._pc.addTrack(m,_),v.set(_,T),this._senderMap.set(m,v),this._needsNegotiation();else throw T.removed?p(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):p(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(m,_,v){if(this.destroying)return;if(this.destroyed)throw p(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const T=this._senderMap.get(m),E=T?T.get(v):null;if(!E)throw p(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");_&&this._senderMap.set(_,T),E.replaceTrack==null?this.destroy(p(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK")):E.replaceTrack(_)}removeTrack(m,_){if(this.destroying)return;if(this.destroyed)throw p(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const v=this._senderMap.get(m),T=v?v.get(_):null;if(!T)throw p(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{T.removed=!0,this._pc.removeTrack(T)}catch(E){E.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(T):this.destroy(p(E,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(m){if(!this.destroying){if(this.destroyed)throw p(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),m.getTracks().forEach(_=>{this.removeTrack(_,m)})}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,g(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw p(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(m){this._destroy(m,()=>{})}_destroy(m,_){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",m&&(m.message||m)),g(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",m&&(m.message||m)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,m&&this.emit("error",m),this.emit("close"),_()}))}_setupData(m){if(!m.channel)return this.destroy(p(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=m.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=x),this.channelName=this._channel.label,this._channel.onmessage=v=>{this._onChannelMessage(v)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=v=>{const T=v.error instanceof Error?v.error:new Error(`Datachannel error: ${v.message} ${v.filename}:${v.lineno}:${v.colno}`);this.destroy(p(T,"ERR_DATA_CHANNEL"))};let _=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(_&&this._onChannelClose(),_=!0):_=!1},5e3)}_read(){}_write(m,_,v){if(this.destroyed)return v(p(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(m)}catch(T){return this.destroy(p(T,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>x?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=v):v(null)}else this._debug("write before connect"),this._chunk=m,this._cb=v}_onFinish(){if(!this.destroyed){const m=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?m():this.once("connect",m)}}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(m=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(m.sdp=a(m.sdp)),m.sdp=this.sdpTransform(m.sdp);const _=()=>{if(!this.destroyed){const v=this._pc.localDescription||m;this._debug("signal"),this.emit("signal",{type:v.type,sdp:v.sdp})}};this._pc.setLocalDescription(m).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?_():this.once("_iceComplete",_))}).catch(v=>{this.destroy(p(v,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(m=>{this.destroy(p(m,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(m=>{m.mid||!m.sender.track||m.requested||(m.requested=!0,this.addTransceiver(m.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(m=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(m.sdp=a(m.sdp)),m.sdp=this.sdpTransform(m.sdp);const _=()=>{if(!this.destroyed){const v=this._pc.localDescription||m;this._debug("signal"),this.emit("signal",{type:v.type,sdp:v.sdp}),this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(m).then(()=>{this.destroyed||(this.trickle||this._iceComplete?_():this.once("_iceComplete",_))}).catch(v=>{this.destroy(p(v,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(m=>{this.destroy(p(m,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(p(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const m=this._pc.iceConnectionState,_=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",m,_),this.emit("iceStateChange",m,_),(m==="connected"||m==="completed")&&(this._pcReady=!0,this._maybeReady()),m==="failed"&&this.destroy(p(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),m==="closed"&&this.destroy(p(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(m){const _=v=>(Object.prototype.toString.call(v.values)==="[object Array]"&&v.values.forEach(T=>{Object.assign(v,T)}),v);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(v=>{const T=[];v.forEach(E=>{T.push(_(E))}),m(null,T)},v=>m(v)):0<this._pc.getStats.length?this._pc.getStats(v=>{if(this.destroyed)return;const T=[];v.result().forEach(E=>{const I={};E.names().forEach(U=>{I[U]=E.stat(U)}),I.id=E.id,I.type=E.type,I.timestamp=E.timestamp,T.push(_(I))}),m(null,T)},v=>m(v)):m(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const m=()=>{this.destroyed||this.getStats((_,v)=>{if(this.destroyed)return;_&&(v=[]);const T={},E={},I={};let U=!1;v.forEach(A=>{(A.type==="remotecandidate"||A.type==="remote-candidate")&&(T[A.id]=A),(A.type==="localcandidate"||A.type==="local-candidate")&&(E[A.id]=A),(A.type==="candidatepair"||A.type==="candidate-pair")&&(I[A.id]=A)});const k=A=>{U=!0;let F=E[A.localCandidateId];F&&(F.ip||F.address)?(this.localAddress=F.ip||F.address,this.localPort=+F.port):F&&F.ipAddress?(this.localAddress=F.ipAddress,this.localPort=+F.portNumber):typeof A.googLocalAddress=="string"&&(F=A.googLocalAddress.split(":"),this.localAddress=F[0],this.localPort=+F[1]),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let B=T[A.remoteCandidateId];B&&(B.ip||B.address)?(this.remoteAddress=B.ip||B.address,this.remotePort=+B.port):B&&B.ipAddress?(this.remoteAddress=B.ipAddress,this.remotePort=+B.portNumber):typeof A.googRemoteAddress=="string"&&(B=A.googRemoteAddress.split(":"),this.remoteAddress=B[0],this.remotePort=+B[1]),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(v.forEach(A=>{A.type==="transport"&&A.selectedCandidatePairId&&k(I[A.selectedCandidatePairId]),(A.type==="googCandidatePair"&&A.googActiveConnection==="true"||(A.type==="candidatepair"||A.type==="candidate-pair")&&A.selected)&&k(A)}),!U&&(!Object.keys(I).length||Object.keys(E).length))return void setTimeout(m,100);if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(F){return this.destroy(p(F,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const A=this._cb;this._cb=null,A(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};m()}_onInterval(){this._cb&&this._channel&&!(this._channel.bufferedAmount>x)&&this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(m=>{this._pc.removeTrack(m),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(m){this.destroyed||(m.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:m.candidate.candidate,sdpMLineIndex:m.candidate.sdpMLineIndex,sdpMid:m.candidate.sdpMid}}):!m.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),m.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(m){if(this.destroyed)return;let _=m.data;_ instanceof ArrayBuffer&&(_=C.from(_)),this.push(_)}_onChannelBufferedAmountLow(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const m=this._cb;this._cb=null,m(null)}}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(m){this.destroyed||m.streams.forEach(_=>{this._debug("on track"),this.emit("track",m.track,_),this._remoteTracks.push({track:m.track,stream:_}),this._remoteStreams.some(v=>v.id===_.id)||(this._remoteStreams.push(_),g(()=>{this._debug("on stream"),this.emit("stream",_)}))})}_debug(){const m=[].slice.call(arguments);m[0]="["+this._id+"] "+m[0],y.apply(null,m)}}L.WEBRTC_SUPPORT=!!b(),L.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},L.channelConfig={},c.exports=L},{buffer:3,debug:4,"err-code":6,"get-browser-rtc":8,"queue-microtask":13,randombytes:14,"readable-stream":29}]},{},[])("/")})})(gi);var Kc=gi.exports;const Nr=0,Mr=1,mi=2,yi=(e,t)=>{V(e,Nr);const n=ul(t);st(e,n)},wi=(e,t,n)=>{V(e,Mr),st(e,ll(t,n))},Qc=(e,t,n)=>wi(t,n,at(e)),bi=(e,t,n)=>{try{sl(t,at(e),n)}catch(s){console.error("Caught error while handling a Yjs update",s)}},Gc=(e,t)=>{V(e,mi),st(e,t)},zc=bi,Jc=(e,t,n,s)=>{const i=$(e);switch(i){case Nr:Qc(e,t,n);break;case Mr:bi(e,n,s);break;case mi:zc(e,n,s);break;default:throw new Error("Unknown message type")}return i},Qn=3e4;class Xc extends Sn{constructor(t){super(),this.doc=t,this.clientID=t.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const n=qt();this.getLocalState()!==null&&Qn/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const s=[];this.meta.forEach((i,o)=>{o!==this.clientID&&Qn<=n-i.lastUpdated&&this.states.has(o)&&s.push(o)}),s.length>0&&rr(this,s,"timeout")},xt(Qn/10)),t.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){const n=this.clientID,s=this.meta.get(n),i=s===void 0?0:s.clock+1,o=this.states.get(n);t===null?this.states.delete(n):this.states.set(n,t),this.meta.set(n,{clock:i,lastUpdated:qt()});const c=[],a=[],h=[],y=[];t===null?y.push(n):o==null?t!=null&&c.push(n):(a.push(n),Me(o,t)||h.push(n)),(c.length>0||h.length>0||y.length>0)&&this.emit("change",[{added:c,updated:h,removed:y},"local"]),this.emit("update",[{added:c,updated:a,removed:y},"local"])}setLocalStateField(t,n){const s=this.getLocalState();s!==null&&this.setLocalState({...s,[t]:n})}getStates(){return this.states}}const rr=(e,t,n)=>{const s=[];for(let i=0;i<t.length;i++){const o=t[i];if(e.states.has(o)){if(e.states.delete(o),o===e.clientID){const c=e.meta.get(o);e.meta.set(o,{clock:c.clock+1,lastUpdated:qt()})}s.push(o)}}s.length>0&&(e.emit("change",[{added:[],updated:[],removed:s},n]),e.emit("update",[{added:[],updated:[],removed:s},n]))},vn=(e,t,n=e.states)=>{const s=t.length,i=ht();V(i,s);for(let o=0;o<s;o++){const c=t[o],a=n.get(c)||null,h=e.meta.get(c).clock;V(i,c),V(i,h),Dt(i,JSON.stringify(a))}return nt(i)},Zc=(e,t,n)=>{const s=Ut(t),i=qt(),o=[],c=[],a=[],h=[],y=$(s);for(let b=0;b<y;b++){const u=$(s);let f=$(s);const g=JSON.parse(Bt(s)),p=e.meta.get(u),C=e.states.get(u),x=p===void 0?0:p.clock;(x<f||x===f&&g===null&&e.states.has(u))&&(g===null?u===e.clientID&&e.getLocalState()!=null?f++:e.states.delete(u):e.states.set(u,g),e.meta.set(u,{clock:f,lastUpdated:i}),p===void 0&&g!==null?o.push(u):p!==void 0&&g===null?h.push(u):g!==null&&(Me(g,C)||a.push(u),c.push(u)))}(o.length>0||a.length>0||h.length>0)&&e.emit("change",[{added:o,updated:a,removed:h},n]),(o.length>0||c.length>0||h.length>0)&&e.emit("update",[{added:o,updated:c,removed:h},n])},ta=(e,t)=>{const n=zn(e).buffer,s=zn(t).buffer;return crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveKey"]).then(i=>crypto.subtle.deriveKey({name:"PBKDF2",salt:s,iterations:1e5,hash:"SHA-256"},i,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]))},_i=(e,t)=>{if(!t)return ur(e);const n=crypto.getRandomValues(new Uint8Array(12));return crypto.subtle.encrypt({name:"AES-GCM",iv:n},t,e).then(s=>{const i=ht();return Dt(i,"AES-GCM"),st(i,n),st(i,new Uint8Array(s)),nt(i)})},ea=(e,t)=>{const n=ht();return Ce(n,e),_i(nt(n),t)},vi=(e,t)=>{if(!t)return ur(e);const n=Ut(e);Bt(n)!=="AES-GCM"&&Oo(ke("Unknown encryption algorithm"));const i=at(n),o=at(n);return crypto.subtle.decrypt({name:"AES-GCM",iv:i},t,o).then(c=>new Uint8Array(c))},na=(e,t)=>vi(e,t).then(n=>ve(Ut(new Uint8Array(n)))),St=Ko("y-webrtc"),_e=0,Ci=3,We=1,Ur=4,Cn=new Map,le=new Map,Ei=e=>{let t=!0;e.webrtcConns.forEach(n=>{n.synced||(t=!1)}),(!t&&e.synced||t&&!e.synced)&&(e.synced=t,e.provider.emit("synced",[{synced:t}]),St("synced ",gt,e.name,Zt," with all peers"))},Si=(e,t,n)=>{const s=Ut(t),i=ht(),o=$(s);if(e===void 0)return null;const c=e.awareness,a=e.doc;let h=!1;switch(o){case _e:{V(i,_e);const y=Jc(s,i,a,e);y===Mr&&!e.synced&&n(),y===Nr&&(h=!0);break}case Ci:V(i,We),st(i,vn(c,Array.from(c.getStates().keys()))),h=!0;break;case We:Zc(c,at(s),e);break;case Ur:{const y=ce(s)===1,b=Bt(s);if(b!==e.peerId&&(e.bcConns.has(b)&&!y||!e.bcConns.has(b)&&y)){const u=[],f=[];y?(e.bcConns.add(b),f.push(b)):(e.bcConns.delete(b),u.push(b)),e.provider.emit("peers",[{added:f,removed:u,webrtcPeers:Array.from(e.webrtcConns.keys()),bcPeers:Array.from(e.bcConns)}]),ki(e)}break}default:return console.error("Unable to compute message"),i}return h?i:null},ra=(e,t)=>{const n=e.room;return St("received message from ",gt,e.remotePeerId,In," (",n.name,")",Zt,$e),Si(n,t,()=>{e.synced=!0,St("synced ",gt,n.name,Zt," with ",gt,e.remotePeerId),Ei(n)})},Gn=(e,t)=>{St("send message to ",gt,e.remotePeerId,Zt,In," (",e.room.name,")",$e);try{e.peer.send(nt(t))}catch{}},sa=(e,t)=>{St("broadcast message in ",gt,e.name,Zt),e.webrtcConns.forEach(n=>{try{n.peer.send(t)}catch{}})};class as{constructor(t,n,s,i){St("establishing connection to ",gt,s),this.room=i,this.remotePeerId=s,this.closed=!1,this.connected=!1,this.synced=!1,this.peer=new Kc({initiator:n,...i.provider.peerOpts}),this.peer.on("signal",o=>{Fr(t,i,{to:s,from:i.peerId,type:"signal",signal:o})}),this.peer.on("connect",()=>{St("connected to ",gt,s),this.connected=!0;const c=i.provider.doc,a=i.awareness,h=ht();V(h,_e),yi(h,c),Gn(this,h);const y=a.getStates();if(y.size>0){const b=ht();V(b,We),st(b,vn(a,Array.from(y.keys()))),Gn(this,b)}}),this.peer.on("close",()=>{this.connected=!1,this.closed=!0,i.webrtcConns.has(this.remotePeerId)&&(i.webrtcConns.delete(this.remotePeerId),i.provider.emit("peers",[{removed:[this.remotePeerId],added:[],webrtcPeers:Array.from(i.webrtcConns.keys()),bcPeers:Array.from(i.bcConns)}])),Ei(i),this.peer.destroy(),St("closed connection to ",gt,s),sr(i)}),this.peer.on("error",o=>{St("Error in connection to ",gt,s,": ",o),sr(i)}),this.peer.on("data",o=>{const c=ra(this,o);c!==null&&Gn(this,c)})}destroy(){this.peer.destroy()}}const Gt=(e,t)=>_i(t,e.key).then(n=>e.mux(()=>$c(e.name,n))),hs=(e,t)=>{e.bcconnected&&Gt(e,t),sa(e,t)},sr=e=>{Cn.forEach(t=>{t.connected&&(t.send({type:"subscribe",topics:[e.name]}),e.webrtcConns.size<e.provider.maxConns&&Fr(t,e,{type:"announce",from:e.peerId}))})},ki=e=>{if(e.provider.filterBcConns){const t=ht();V(t,Ur),je(t,1),Dt(t,e.peerId),Gt(e,nt(t))}};class ia{constructor(t,n,s,i){this.peerId=Ts(),this.doc=t,this.awareness=n.awareness,this.provider=n,this.synced=!1,this.name=s,this.key=i,this.webrtcConns=new Map,this.bcConns=new Set,this.mux=Yc(),this.bcconnected=!1,this._bcSubscriber=o=>vi(new Uint8Array(o),i).then(c=>this.mux(()=>{const a=Si(this,c,()=>{});a&&Gt(this,nt(a))})),this._docUpdateHandler=(o,c)=>{const a=ht();V(a,_e),Gc(a,o),hs(this,nt(a))},this._awarenessUpdateHandler=({added:o,updated:c,removed:a},h)=>{const y=o.concat(c).concat(a),b=ht();V(b,We),st(b,vn(this.awareness,y)),hs(this,nt(b))},this._beforeUnloadHandler=()=>{rr(this.awareness,[t.clientID],"window unload"),le.forEach(o=>{o.disconnect()})},typeof window!="undefined"?window.addEventListener("beforeunload",this._beforeUnloadHandler):typeof process!="undefined"&&process.on("exit",this._beforeUnloadHandler)}connect(){this.doc.on("update",this._docUpdateHandler),this.awareness.on("update",this._awarenessUpdateHandler),sr(this);const t=this.name;Wc(t,this._bcSubscriber),this.bcconnected=!0,ki(this);const n=ht();V(n,_e),yi(n,this.doc),Gt(this,nt(n));const s=ht();V(s,_e),wi(s,this.doc),Gt(this,nt(s));const i=ht();V(i,Ci),Gt(this,nt(i));const o=ht();V(o,We),st(o,vn(this.awareness,[this.doc.clientID])),Gt(this,nt(o))}disconnect(){Cn.forEach(n=>{n.connected&&n.send({type:"unsubscribe",topics:[this.name]})}),rr(this.awareness,[this.doc.clientID],"disconnect");const t=ht();V(t,Ur),je(t,0),Dt(t,this.peerId),Gt(this,nt(t)),Hc(this.name,this._bcSubscriber),this.bcconnected=!1,this.doc.off("update",this._docUpdateHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.webrtcConns.forEach(n=>n.destroy())}destroy(){this.disconnect(),typeof window!="undefined"?window.removeEventListener("beforeunload",this._beforeUnloadHandler):typeof process!="undefined"&&process.off("exit",this._beforeUnloadHandler)}}const oa=(e,t,n,s)=>{if(le.has(n))throw ke(`A Yjs Doc connected to room "${n}" already exists!`);const i=new ia(e,t,n,s);return le.set(n,i),i},Fr=(e,t,n)=>{t.key?ea(n,t.key).then(s=>{e.send({type:"publish",topic:t.name,data:Es(s)})}):e.send({type:"publish",topic:t.name,data:n})};class la extends Bc{constructor(t){super(t),this.providers=new Set,this.on("connect",()=>{St(`connected (${t})`);const n=Array.from(le.keys());this.send({type:"subscribe",topics:n}),le.forEach(s=>Fr(this,s,{type:"announce",from:s.peerId}))}),this.on("message",n=>{switch(n.type){case"publish":{const s=n.topic,i=le.get(s);if(i==null||typeof s!="string")return;const o=c=>{const a=i.webrtcConns,h=i.peerId;if(c==null||c.from===h||c.to!==void 0&&c.to!==h||i.bcConns.has(c.from))return;const y=a.has(c.from)?()=>{}:()=>i.provider.emit("peers",[{removed:[],added:[c.from],webrtcPeers:Array.from(i.webrtcConns.keys()),bcPeers:Array.from(i.bcConns)}]);switch(c.type){case"announce":a.size<i.provider.maxConns&&(bt(a,c.from,()=>new as(this,!0,c.from,i)),y());break;case"signal":c.to===h&&(bt(a,c.from,()=>new as(this,!1,c.from,i)).peer.signal(c.signal),y());break}};i.key?typeof n.data=="string"&&na(Ss(n.data),i.key).then(o):o(n.data)}}}),this.on("disconnect",()=>St(`disconnect (${t})`))}}class ca extends Sn{constructor(t,n,{signaling:s=["wss://signaling.yjs.dev","wss://y-webrtc-signaling-eu.herokuapp.com","wss://y-webrtc-signaling-us.herokuapp.com"],password:i=null,awareness:o=new Xc(n),maxConns:c=20+xt(Io()*15),filterBcConns:a=!0,peerOpts:h={}}={}){super(),this.roomName=t,this.doc=n,this.filterBcConns=a,this.awareness=o,this.shouldConnect=!1,this.signalingUrls=s,this.signalingConns=[],this.maxConns=c,this.peerOpts=h,this.key=i?ta(i,t):ur(null),this.room=null,this.key.then(y=>{this.room=oa(n,this,t,y),this.shouldConnect?this.room.connect():this.room.disconnect()}),this.connect(),this.destroy=this.destroy.bind(this),n.on("destroy",this.destroy)}get connected(){return this.room!==null&&this.shouldConnect}connect(){this.shouldConnect=!0,this.signalingUrls.forEach(t=>{const n=bt(Cn,t,()=>new la(t));this.signalingConns.push(n),n.providers.add(this)}),this.room&&this.room.connect()}disconnect(){this.shouldConnect=!1,this.signalingConns.forEach(t=>{t.providers.delete(this),t.providers.size===0&&(t.destroy(),Cn.delete(t.url))}),this.room&&this.room.disconnect()}destroy(){this.doc.off("destroy",this.destroy),this.key.then(()=>{this.room.destroy(),le.delete(this.roomName)}),super.destroy()}}const Ti=new Re;new ca("syncedstore-todos",Ti);const us=document.getElementById("root");if(us){const e=Ai(us),t=Lt.store({externs:[ji,di.impl({doc:Ti})],inspectors:[]});e.render(X(se.exports.StrictMode,{children:X(Ni,{store:t,children:X(Li,{basename:"/",children:Rt(xi,{children:[X(jr,{path:"/",element:X(cs,{})}),X(jr,{path:"/:filter",element:X(cs,{})})]})})})})),window.root=e}
//# sourceMappingURL=index.1ea952a8.js.map
