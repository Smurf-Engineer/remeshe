var it=Object.defineProperty,ut=Object.defineProperties;var dt=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var Ie=(n,o,r)=>o in n?it(n,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[o]=r,E=(n,o)=>{for(var r in o||(o={}))ke.call(o,r)&&Ie(n,r,o[r]);if(F)for(var r of F(o))xe.call(o,r)&&Ie(n,r,o[r]);return n},D=(n,o)=>ut(n,dt(o));var Me=(n,o)=>{var r={};for(var c in n)ke.call(n,c)&&o.indexOf(c)<0&&(r[c]=n[c]);if(n!=null&&F)for(var c of F(n))o.indexOf(c)<0&&xe.call(n,c)&&(r[c]=n[c]);return r};import{s as pt,f as lt,g as ft,h as gt,i as Ae,j as Ve,S as St,k as T,O as Ue,o as yt,r as C,R as vt,l as bt}from"./vendor.c1cd45af.js";const Lt=n=>n,A=Symbol("RemeshValuePlaceholder");let ht=0;function wt(n){var c;const o=ht++,r=d=>({type:"RemeshEventPayload",arg:d,Event:r});return r.type="RemeshEvent",r.eventId=o,r.eventName=n.name,r.owner=K(),r.inspectable="inspectable"in n&&(c=n.inspectable)!=null?c:!0,"impl"in n&&(r.impl=n.impl),r}const Rt=n=>J({name:n.name,impl:()=>n.default,inspectable:n.inspectable,compare:n.compare}),Et=n=>J({name:n.name,defer:!0,impl:o=>{throw new Error(`RemeshDeferState: use ${n.name} before setting state`)},inspectable:n.inspectable,compare:n.compare});let $t=0;const We=(n,o)=>Ae(n)&&Ae(o)?Ve(n,o):Array.isArray(n)&&Array.isArray(o)?Ve(n,o):n===o,J=n=>{var d,p,S;const o=$t++;let r=null;const c=v=>{if(v===void 0&&r)return r;const b={type:"RemeshStateItem",arg:v,State:c,new:g=>({type:"RemeshStateSetterPayload",stateItem:b,newState:g})};return v===void 0&&(r=b),b};return c.type="RemeshState",c.stateId=o,c.stateName=n.name,c.impl=n.impl,c.compare=(d=n.compare)!=null?d:We,c.owner=K(),c.inspectable=(p=n.inspectable)!=null?p:!0,c.defer=(S=n.defer)!=null?S:!1,c.query=Y({name:`${n.name}.Query`,inspectable:!1,impl:({get:v},b)=>v(c(b))}),c};let Dt=0;const Y=n=>{var d,p;const o=Dt++;let r=null;const c=S=>{if(S===void 0&&r)return r;const v={type:"RemeshQueryPayload",Query:c,arg:S};return S===void 0&&(r=v),v};return c.type="RemeshQuery",c.queryId=o,c.queryName=n.name,c.prepare=n.prepare,c.impl=n.impl,c.compare=(d=n.compare)!=null?d:We,c.owner=K(),c.inspectable=(p=n.inspectable)!=null?p:!0,c};let Ct=0;const ze=n=>{var c;const o=Ct++,r=d=>({type:"RemeshCommandPayload",arg:d,Command:r});return r.type="RemeshCommand",r.commandId=o,r.commandName=n.name,r.impl=n.impl,r.owner=K(),r.inspectable=(c=n.inspectable)!=null?c:!0,r};let Nt=0;const G=n=>{var c;const o=Nt++,r=d=>({type:"RemeshCommand$Payload",arg:d,Command$:r});return r.type="RemeshCommand$",r.command$Id=o,r.command$Name=n.name,r.impl=n.impl,r.owner=K(),r.inspectable=(c=n.inspectable)!=null?c:!0,r},Ke=n=>G({name:n.name,inspectable:n.inspectable,impl:(r,c)=>{if(!n.mode||n.mode==="switch")return c.pipe(pt(d=>n.impl(r,d)));if(n.mode==="merge")return c.pipe(lt(d=>n.impl(r,d)));if(n.mode==="concat")return c.pipe(ft(d=>n.impl(r,d)));if(n.mode==="exhaust")return c.pipe(gt(d=>n.impl(r,d)));throw new Error(`RemeshCommandAsync: invalid mode: ${n.mode}`)}});let Qt=0;const It=n=>{const o=r=>({type:"RemeshExternPayload",Extern:o,value:r});return o.externId=Qt++,o.externName=n.name,o.default=n.default,o};let kt=0;const Z=n=>{var c;let o=null;const r=d=>{if(d===void 0&&o)return o;const p={type:"RemeshDomainPayload",Domain:r,arg:d};return d===void 0&&(o=p),p};return r.type="RemeshDomain",r.domainId=kt++,r.domainName=n.name,r.impl=n.impl,r.inspectable=(c=n.inspectable)!=null?c:!0,r},K=Z({name:"DefaultDomain",impl:()=>({})}),Q={DomainCreated:"Domain::Created",DomainDestroyed:"Domain::Destroyed",DomainRestored:"Domain::Restored",StateCreated:"State::Created",StateUpdated:"State::Updated",StateDestroyed:"State::Destroyed",StateRestored:"State::Restored",QueryCreated:"Query::Created",QueryUpdated:"Query::Updated",QueryDestroyed:"Query::Destroyed",QueryRestored:"Query::Restored",EventEmitted:"Event::Emitted",CommandReceived:"Command::Received",Command$Received:"Command$::Received"},M=Z({name:"RemeshInspector",impl:n=>{const o=n.event({name:"RemeshDomainStorageEvent"}),r=n.event({name:"RemeshStateStorageEvent"}),c=n.event({name:"RemeshQueryStorageEvent"}),d=n.event({name:"RemeshEventEmitted"}),p=n.event({name:"RemeshCommandReceived"}),S=n.event({name:"RemeshCommand$Received"});return{event:{RemeshDomainStorageEvent:o,RemeshStateStorageEvent:r,RemeshQueryStorageEvent:c,RemeshEventEmittedEvent:d,RemeshCommandReceivedEvent:p,RemeshCommand$ReceivedEvent:S}}}}),U=n=>n.owner?n.owner.Domain.inspectable&&n.inspectable:n.inspectable,xt=n=>{var o;return((o=n.inspectors)!=null?o:[]).filter(r=>!!r).map(r=>{const p=n,{inspectors:c}=p,d=Me(p,["inspectors"]);return r(d)})},Mt=n=>{let o=null;const r=()=>(o||(o=xt(n)),o);return{destroyInspectors:()=>{if(o){for(const m of o)m.destroy();o=null}},inspectDomainStorage:(m,s)=>{if(U(s.Domain))for(const l of r()){const N=l.getDomain(M()).event.RemeshDomainStorageEvent({type:m,storage:s});l.emitEvent(N)}},inspectStateStorage:(m,s)=>{if(U(s.State))for(const l of r()){const N=l.getDomain(M()).event.RemeshStateStorageEvent({type:m,storage:s});l.emitEvent(N)}},inspectQueryStorage:(m,s)=>{if(U(s.Query))for(const l of r()){const N=l.getDomain(M()).event.RemeshQueryStorageEvent({type:m,storage:s});l.emitEvent(N)}},inspectEventEmitted:(m,s)=>{if(U(s.Event))for(const l of r()){const N=l.getDomain(M()).event.RemeshEventEmittedEvent({type:m,payload:s});l.emitEvent(N)}},inspectCommandReceived:(m,s)=>{if(U(s.Command))for(const l of r()){const N=l.getDomain(M()).event.RemeshCommandReceivedEvent({type:m,payload:s});l.emitEvent(N)}},inspectCommand$Received:(m,s)=>{if(U(s.Command$))for(const l of r()){const N=l.getDomain(M()).event.RemeshCommand$ReceivedEvent({type:m,payload:s});l.emitEvent(N)}}}};let z=0;const Le=n=>{const o=E({},n),r=Mt(o),c=new Set,d=new Set,p=new Set,S=new Map,v=new WeakMap,b=e=>{var t;for(const a of(t=o.externs)!=null?t:[])if(a.Extern===e)return a.value;return e.default},g=e=>{const t=v.get(e);if(t)return t;const a=b(e),i={id:z++,type:"RemeshExternStorage",Extern:e,currentValue:a};return v.set(e,i),i},m=e=>g(e).currentValue,s=new WeakMap,l=e=>{var f;const t=s.get(e);if(t)return t;const a=e.State.stateName,i=(f=JSON.stringify(e.arg))!=null?f:"",u=`State/${e.State.stateId}/${a}:${i}`;return s.set(e,u),u},I=e=>{var f;const t=s.get(e);if(t)return t;const a=e.Query.queryName,i=(f=JSON.stringify(e.arg))!=null?f:"",u=`Query/${e.Query.queryId}/${a}:${i}`;return s.set(e,u),u},N=e=>{var f;const t=s.get(e);if(t)return t;const a=e.Domain.domainName,i=(f=JSON.stringify(e.arg))!=null?f:"",u=`Domain/${e.Domain.domainId}/${a}:${i}`;return s.set(e,u),u},Je=e=>e.type==="RemeshStateItem"?l(e):e.type==="RemeshQueryPayload"?I(e):N(e),He=e=>{if(e.currentState===A)throw new Error(`${e.key} is not found`);return e.currentState},q=new WeakMap,P=(e,t)=>e.defer?A:e.impl(t),Xe=e=>{const t=$(e.State.owner),a=l(e),i=P(e.State,e.arg),u={id:z++,type:"RemeshStateStorage",State:e.State,arg:e.arg,key:a,currentState:i,downstreamSet:new Set};return t.stateMap.set(a,u),q.set(e,u),r.inspectStateStorage(Q.StateCreated,u),u},ee=e=>{const t=$(e.State.owner);t.stateMap.has(e.key)||(e.currentState=P(e.State,e.arg),t.stateMap.set(e.key,e),r.inspectStateStorage(Q.StateRestored,e))},j=e=>{const t=$(e.State.owner),a=l(e),i=t.stateMap.get(a);if(i)return i;const u=q.get(e);return u?(ee(u),u):Xe(e)},te=new WeakMap,Be=e=>{const t=$(e.owner),a=new T,i=new Ue(R=>{const h=a.subscribe(R);return f.refCount+=1,()=>{h.unsubscribe(),f.refCount-=1,p.add(f),L()}}),u=te.get(e),f=Object.assign(u!=null?u:{},{type:"RemeshEventStorage",Event:e,subject:a,observable:i,refCount:0});return t.eventMap.set(e,f),te.set(e,f),f},H=e=>{const a=$(e.owner).eventMap.get(e);return a||Be(e)},ne=new WeakMap,re=e=>{const t=new T,a=new Ue(i=>{const u=t.subscribe(i),f=e();return f.refCount+=1,()=>{u.unsubscribe(),f.refCount-=1,p.add(f),L()}});return{subject:t,observable:a}},oe=(e,t,a)=>{if(!e.prepare)return;const i=e.prepare(t,a);if(!!i){if(Array.isArray(i)){for(const u of i)X(u);return}X(i)}},Ye=e=>{const t=$(e.Query.owner),a=I(e),{subject:i,observable:u}=re(()=>R),f=new Set,R={id:z++,type:"RemeshQueryStorage",Query:e.Query,arg:e.arg,currentValue:A,key:a,upstreamSet:f,downstreamSet:new Set,subject:i,observable:u,refCount:0,status:"default",wipUpstreamSet:new Set},{Query:h}=e,y={get:x=>{if(R.upstreamSet!==f)return w.get(x);if(x.type==="RemeshStateItem"){const W=j(x);return R.upstreamSet.add(W),W.downstreamSet.add(R),w.get(x)}if(x.type==="RemeshQueryPayload"){const W=V(x);return R.upstreamSet.add(W),W.downstreamSet.add(R),w.get(x)}return w.get(x)},peek:w.peek,hasNoValue:w.hasNoValue};oe(h,y,e.arg);const k=h.impl(y,e.arg);return R.currentValue=k,t.queryMap.set(a,R),ne.set(e,R),r.inspectQueryStorage(Q.QueryCreated,R),R},se=e=>{const t=$(e.Query.owner);if(t.queryMap.has(e.key))return;const{subject:a,observable:i}=re(()=>e);e.status="default",e.subject=a,e.observable=i,t.queryMap.set(e.key,e);for(const u of e.upstreamSet)if(u.downstreamSet.add(e),u.type==="RemeshQueryStorage")se(u);else if(u.type==="RemeshStateStorage")ee(u);else throw new Error(`Unknown upstream: ${u}`);ve(e),r.inspectQueryStorage(Q.QueryRestored,e)},V=e=>{const t=$(e.Query.owner),a=I(e),i=t.queryMap.get(a);if(i)return i;const u=ne.get(e);return u?(se(u),u):Ye(e)},ae=new WeakMap,Ge=e=>{const t=$(e.owner),a=new T,i=a.asObservable(),u={id:z++,type:"RemeshCommand$Storage",Command$:e,subject:a,observable:i};return t.command$Map.set(e,u),ae.set(e,u),u},ce=e=>{const t=$(e.owner),a=t.command$Map.get(e);if(a)return a;const i=ae.get(e);if(i){const u=new T,f=u.asObservable();return i.subject=u,i.observable=f,i.subscription=void 0,t.command$Map.set(e,i),i}return Ge(e)},me=new WeakMap,Ze=e=>{const t=N(e),a=new Set,i=new Set,u={state:h=>{if("default"in h){const k=Rt(h);return k.owner=e,k.query.owner=e,k}if(!("impl"in h)){const k=Et(h);return k.owner=e,k.query.owner=e,k}const y=J(h);return y.owner=e,y.query.owner=e,y},query:h=>{const y=Y(h);return y.owner=e,y},event:h=>{const y=wt(h);return y.owner=e,y},command:h=>{const y=ze(h);return y.owner=e,y},command$:h=>{const y=G(h);return y.owner=e,i.add(y),f.running&&_(y),y},ignite:h=>{u.command$({name:"ignite",inspectable:!1,impl:y=>yt(h(y))})},commandAsync:h=>{const y=Ke(h);return y.owner=e,i.add(y),f.running&&_(y),y},getDomain:h=>{const y=$(h);return a.add(y),y.downstreamSet.add(f),y.domain},getExtern:h=>m(h)},f={id:z++,type:"RemeshDomainStorage",Domain:e.Domain,arg:e.arg,get domain(){return R},domainContext:u,domainPayload:e,key:t,command$Set:i,upstreamSet:a,downstreamSet:new Set,upstreamSubscriptionSet:new Set,domainSubscriptionSet:new Set,stateMap:new Map,queryMap:new Map,eventMap:new Map,command$Map:new Map,refCount:0,running:!1},R=e.Domain.impl(u,e.arg);return S.set(t,f),me.set(e,f),r.inspectDomainStorage(Q.DomainCreated,f),f},$=e=>{const t=N(e),a=S.get(t);if(a)return a;const i=me.get(e);if(i){i.running=!1,S.set(i.key,i);for(const u of i.upstreamSet)u.downstreamSet.add(i);return r.inspectDomainStorage(Q.DomainRestored,i),i}return Ze(e)},ie=e=>{const t=$(e.Query.owner);if(!!t.queryMap.has(e.key)){t.queryMap.delete(e.key),r.inspectQueryStorage(Q.QueryDestroyed,e);for(const a of e.upstreamSet)if(a.downstreamSet.delete(e),a.type==="RemeshQueryStorage")ue(a);else if(a.type==="RemeshStateStorage")pe(a);else throw new Error(`Unknown upstream in clearQueryStorageIfNeeded(..): ${a}`);e.subject.complete()}},ue=e=>{e.refCount===0&&e.downstreamSet.size===0&&ie(e)},de=e=>{const t=$(e.State.owner);!t.stateMap.has(e.key)||(r.inspectStateStorage(Q.StateDestroyed,e),t.stateMap.delete(e.key),e.downstreamSet.clear())},pe=e=>{e.downstreamSet.size===0&&de(e)},le=e=>{const t=$(e.Event.owner);e.subject.complete(),t.eventMap.delete(e.Event)},Oe=e=>{e.refCount===0&&le(e)},qe=e=>{var a;const t=$(e.Command$.owner);e.subject.complete(),(a=e.subscription)==null||a.unsubscribe(),e.subscription=void 0,t.command$Map.delete(e.Command$)},fe=e=>{r.inspectDomainStorage(Q.DomainDestroyed,e),je(e.domainSubscriptionSet),je(e.upstreamSubscriptionSet);for(const t of e.eventMap.values())le(t);for(const t of e.queryMap.values())ie(t);for(const t of e.stateMap.values())de(t);for(const t of e.command$Map.values())qe(t);e.upstreamSubscriptionSet.clear(),e.domainSubscriptionSet.clear(),e.downstreamSet.clear(),e.stateMap.clear(),e.queryMap.clear(),e.eventMap.clear(),e.running=!1,S.delete(e.key);for(const t of e.upstreamSet)t.downstreamSet.delete(e),ge(t)},ge=e=>{e.refCount===0&&e.downstreamSet.size===0&&e.domainSubscriptionSet.size===0&&fe(e)},Pe=e=>{const t=j(e);return He(t)},Se=e=>{const t=V(e),a=t.currentValue;if(a===A)throw new Error(`Query ${t.key} is not ready yet.`);return a},w={get:e=>{if(e.type==="RemeshStateItem")return Pe(e);if(e.type==="RemeshQueryPayload")return Se(e);throw new Error(`Unexpected input in ctx.get(..): ${e}`)},peek:e=>{if(e.type==="RemeshStateItem")return j(e).currentState;if(e.type==="RemeshQueryPayload")return V(e).currentValue;throw new Error(`Unexpected input in peek(..): ${e}`)},hasNoValue:e=>w.peek(e)===A,fromEvent:e=>H(e).observable,fromQuery:e=>V(e).observable},ye=e=>{if(e.wipUpstreamSet.size!==0){let a=!1;for(const i of e.wipUpstreamSet)i.type==="RemeshStateStorage"?a=!0:i.type==="RemeshQueryStorage"&&(i.status==="wip"&&ye(i),i.status==="updated"&&(a=!0));if(e.wipUpstreamSet.clear(),!a){e.status="default";return}}ve(e)?e.status="updated":e.status="default"},ve=e=>{const{Query:t}=e;for(const f of e.upstreamSet)f.downstreamSet.delete(e),f.downstreamSet.size===0&&p.add(f);const a=new Set;e.upstreamSet=a;const i={get:f=>{if(e.upstreamSet!==a)return w.get(f);if(f.type==="RemeshStateItem"){const R=j(f);return e.upstreamSet.add(R),R.downstreamSet.add(e),w.get(f)}if(f.type==="RemeshQueryPayload"){const R=V(f);return e.upstreamSet.add(R),R.downstreamSet.add(e),w.get(f)}return w.get(f)},peek:w.peek,hasNoValue:w.hasNoValue};oe(t,i,e.arg);const u=t.impl(i,e.arg);return e.currentValue!==A&&t.compare(e.currentValue,u)?!1:(e.currentValue=u,c.add(e),r.inspectQueryStorage(Q.QueryUpdated,e),!0)},L=()=>{if(p.size===0)return;const e=[...p];p.clear();for(const t of e)t.type==="RemeshDomainStorage"?ge(t):t.type==="RemeshEventStorage"?Oe(t):t.type==="RemeshQueryStorage"?ue(t):t.type==="RemeshStateStorage"&&pe(t);L()},be=()=>{if(c.size===0)return;const e=[...c];c.clear();for(const t of e)c.has(t)||t.subject.next(t.currentValue);be()},he=e=>{if(e.status="wip",e.downstreamSet.size>0)for(const t of e.downstreamSet)t.wipUpstreamSet.has(e)||(t.wipUpstreamSet.add(e),he(t));else d.add(e)},we=()=>{if(d.size===0)return;const e=[...d];d.clear();for(const t of e)ye(t);we()},Re=()=>{we(),be()},X=e=>{const t=j(e.stateItem);if(!(t.currentState!==A&&e.stateItem.State.compare(t.currentState,e.newState))){t.currentState=e.newState,r.inspectStateStorage(Q.StateUpdated,t);for(const a of t.downstreamSet)a.wipUpstreamSet.add(t),he(a)}},Ee=e=>{const{Event:t,arg:a}=e,i=H(t);if(r.inspectEventEmitted(Q.EventEmitted,e),t.impl){const u={get:w.get,peek:w.peek,hasNoValue:w.hasNoValue},f=t.impl(u,a);i.subject.next(f)}else i.subject.next(a)},$e=e=>{r.inspectCommandReceived(Q.CommandReceived,e);const{Command:t,arg:a}=e,i={get:w.get,peek:w.peek,hasNoValue:w.hasNoValue},u=t.impl(i,a);B(u)},De=(e,t)=>{e.add(t),t.add(()=>{e.delete(t)})},_=e=>{const t=ce(e);if(t.subscription)return;const a={get:w.get,peek:w.peek,hasNoValue:w.hasNoValue,fromEvent:w.fromEvent,fromQuery:w.fromQuery},u=e.impl(a,t.observable).subscribe(f=>{B(f),Re()});t.subscription=u},B=e=>{if(!!e){if(Array.isArray(e)){for(const t of e)B(t);return}if(e.type==="RemeshCommandPayload"){$e(e);return}else if(e.type==="RemeshEventPayload"){Ee(e);return}else if(e.type==="RemeshStateSetterPayload"){X(e);return}else if(e.type==="RemeshCommand$Payload"){Ce(e);return}throw new Error(`Unknown command output of ${e}`)}},Ce=e=>{r.inspectCommand$Received(Q.Command$Received,e);const{Command$:t,arg:a}=e,i=ce(t);_(t),i.subject.next(a)},et=(e,t)=>{De(e.domainSubscriptionSet,t),t.add(()=>{p.add(e),L()})},tt=(e,t)=>{const a=V(e);return a.observable.subscribe(t)},nt=(e,t)=>H(e).observable.subscribe(t),rt=e=>{const t={};for(const a in e.command){const i=e.command[a];t[a]=u=>Qe(i(u))}return t},ot=e=>{const t=$(e);if(t.domainOutput)return t.domainOutput;const a=t.domain,i=rt(a),u=D(E({},a),{command:i});return t.domainOutput=u,u},st=e=>{for(const t of e)_(t)},at=e=>{if(!e.running){e.running=!0;for(const t of e.upstreamSet){const a=Ne(t.domainPayload);De(e.upstreamSubscriptionSet,a)}st(e.command$Set)}},Ne=e=>{const t=$(e),a=new St;return et(t,a),at(t),a},ct=()=>{r.destroyInspectors();for(const e of S.values())fe(e);S.clear(),c.clear()},mt=e=>{Ee(e)},Qe=e=>{e.type==="RemeshCommandPayload"?($e(e),Re()):e.type==="RemeshCommand$Payload"&&Ce(e)};return{name:o.name,getDomain:ot,query:Se,emitEvent:mt,sendCommand:Qe,destroy:ct,subscribeQuery:tt,subscribeEvent:nt,subscribeDomain:Ne,getKey:Je}},je=n=>{for(const o of n)o.unsubscribe()},_e={domain:Z,extern:It,store:Le,state:J,query:Y,command:ze,command$:G,commandAsync:Ke},Fe=C.exports.createContext(null),At=()=>{const n=C.exports.useContext(Fe);if(n===null)throw new Error("You may forgot to add <RemeshRoot />");return n},O=()=>At().remeshStore,_t=n=>{const o=C.exports.useRef(n.store);o.current||(o.current=Le("options"in n?n.options:{}));const r=o.current,c=C.exports.useMemo(()=>({remeshStore:r}),[r]);return vt.createElement(Fe.Provider,{value:c},n.children)},Ft=function(n){Vt(n.Query.owner);const o=O(),r=C.exports.useRef(null),c=C.exports.useCallback(b=>(r.current=b,()=>{r.current=null}),[]),d=C.exports.useCallback(()=>o.query(n),[o,n]),p=bt.exports.useSyncExternalStore(c,d),S=C.exports.useRef(null),v=o.getKey(n);return C.exports.useEffect(()=>()=>{var b;(b=S.current)==null||b.unsubscribe(),S.current=null},[o,v]),C.exports.useEffect(()=>{S.current===null&&(S.current=o.subscribeQuery(n,()=>{var b;(b=r.current)==null||b.call(r)}))},[o,n]),p},Tt=function(n,o){const r=O(),c=C.exports.useRef(o);C.exports.useEffect(()=>{c.current=o}),C.exports.useEffect(()=>{const d=r.subscribeEvent(n,p=>{c.current(p)});return()=>{d.unsubscribe()}},[n,r])},Vt=function(n){const o=O(),r=C.exports.useRef(null),c=o.getDomain(n),d=o.getKey(n);return C.exports.useEffect(()=>()=>{var p;(p=r.current)==null||p.unsubscribe(),r.current=null},[o,d]),C.exports.useEffect(()=>{r.current===null&&(r.current=o.subscribeDomain(n))},[o,n]),c},Ut=n=>{const o=n.getHours().toString().padStart(2,"0"),r=n.getMinutes().toString().padStart(2,"0"),c=n.getSeconds().toString().padStart(2,"0"),d=n.getMilliseconds().toString().padStart(3,"0");return`${o}:${r}:${c}.${d}`},jt=()=>{const n=new Date;return Ut(n)},Te=n=>{const o=E({include:["state","domain","event","command","command$"]},n);return{onActive:(c,d)=>{var p;(p=o.exclude)!=null&&p.includes(c)||(o.include?o.include.includes(c)&&d():d())}}},Wt=()=>{if(typeof window!="undefined")return window.__REDUX_DEVTOOLS_EXTENSION__},Jt=n=>{const o=Wt();if(!!o)return r=>{var g;const c=Te(n),d=o.connect({name:r==null?void 0:r.name,features:{pause:!1,lock:!1,persist:!1,export:!1,import:!1,jump:!1,skip:!1,reorder:!1,dispatch:!1,test:!1}}),p=(m,s)=>{d.send(s,null)},S=_e.store({name:`RemeshReduxDevtools(${(g=r==null?void 0:r.name)!=null?g:""})`}),v=S.getDomain(M()),b=m=>{const s={domainId:m.Domain.domainId,domainName:m.Domain.domainName};return m.arg!==void 0?D(E({},s),{domainArg:m.arg}):s};return c.onActive("domain",()=>{S.subscribeEvent(v.event.RemeshDomainStorageEvent,m=>{const s=m.storage.Domain,l={type:`${m.type}::${s.domainName}`,domainId:s.domainId,domainName:s.domainName};m.storage.arg!==void 0?p(l.type,D(E({},l),{domainArg:m.storage.arg})):p(l.type,l)})}),c.onActive("state",()=>{S.subscribeEvent(v.event.RemeshStateStorageEvent,m=>{const s=m.storage.State,l={type:`${m.type}::${s.stateName}`,owner:b(s.owner),stateId:s.stateId,stateName:s.stateName,stateValue:m.storage.currentState};m.storage.arg!==void 0?p(l.type,D(E({},l),{stateArg:m.storage.arg})):p(l.type,l)})}),c.onActive("query",()=>{S.subscribeEvent(v.event.RemeshQueryStorageEvent,m=>{const s=m.storage.Query,l={type:`${m.type}::${s.queryName}`,owner:b(s.owner),queryId:s.queryId,queryName:s.queryName};m.storage.arg!==void 0?p(l.type,D(E({},l),{queryArg:m.storage.arg})):p(l.type,l)})}),c.onActive("command",()=>{S.subscribeEvent(v.event.RemeshCommandReceivedEvent,m=>{const s=m.payload.Command,l={type:`${m.type}::${s.commandName}`,owner:b(s.owner),commandId:s.commandId,commandName:s.commandName};m.payload.arg!==void 0?p(l.type,D(E({},l),{commandArg:m.payload.arg})):p(l.type,l)})}),c.onActive("command$",()=>{S.subscribeEvent(v.event.RemeshCommand$ReceivedEvent,m=>{const s=m.payload.Command$,l={type:`${m.type}::${s.command$Name}`,owner:b(s.owner),command$Id:s.command$Id,command$Name:s.command$Name};m.payload.arg!==void 0?p(l.type,D(E({},l),{command$Arg:m.payload.arg})):p(l.type,l)})}),c.onActive("event",()=>{S.subscribeEvent(v.event.RemeshEventEmittedEvent,m=>{const s=m.payload.Event,l={type:`${m.type}::${s.eventName}`,owner:b(s.owner),eventId:s.eventId,eventName:s.eventName};m.payload.arg!==void 0?p(l.type,D(E({},l),{eventArg:m.payload.arg})):p(l.type,l)})}),S}},Ht=n=>o=>{var b;const r=E({collapsed:!0},n),c=Te(r),d=(g,m)=>{if(r.collapsed){const s=g.split("::");console.groupCollapsed(`%c${s[0]}%c::%c${s[1]}%c::%c${s[2]}%c @ ${jt()}`,"color:#03A9F4; font-weight: bold","color:#9E9E9E; font-weight: bold","color:#4CAF50; font-weight: bold","color:#9E9E9E; font-weight: bold","color:#AA07DE; font-weight: bold","color:#9E9E9E; font-weight: lighter")}console.log(m),r.collapsed&&console.groupEnd()},p=_e.store(D(E({},o),{name:`RemeshLogger(${(b=o==null?void 0:o.name)!=null?b:""})`})),S=p.getDomain(M()),v=g=>{const m={domainId:g.Domain.domainId,domainName:g.Domain.domainName};return g.arg!==void 0?D(E({},m),{domainArg:g.arg}):m};return c.onActive("domain",()=>{p.subscribeEvent(S.event.RemeshDomainStorageEvent,g=>{const m=g.storage.Domain,s={type:`${g.type}::${m.domainName}`,domainId:m.domainId,domainName:m.domainName};g.storage.arg!==void 0?d(s.type,D(E({},s),{domainArg:g.storage.arg})):d(s.type,s)})}),c.onActive("state",()=>{p.subscribeEvent(S.event.RemeshStateStorageEvent,g=>{const m=g.storage.State,s={type:`${g.type}::${m.stateName}`,owner:v(m.owner),stateId:m.stateId,stateName:m.stateName,stateValue:g.storage.currentState};g.storage.arg!==void 0?d(s.type,D(E({},s),{stateArg:g.storage.arg})):d(s.type,s)})}),c.onActive("query",()=>{p.subscribeEvent(S.event.RemeshQueryStorageEvent,g=>{const m=g.storage.Query,s={type:`${g.type}::${m.queryName}`,owner:v(m.owner),queryId:m.queryId,queryName:m.queryName,queryValue:g.storage.currentValue};g.storage.arg!==void 0?d(s.type,D(E({},s),{queryArg:g.storage.arg})):d(s.type,s)})}),c.onActive("command",()=>{p.subscribeEvent(S.event.RemeshCommandReceivedEvent,g=>{const m=g.payload.Command,s={type:`${g.type}::${m.commandName}`,owner:v(m.owner),commandId:m.commandId,commandName:m.commandName};g.payload.arg!==void 0?d(s.type,D(E({},s),{commandArg:g.payload.arg})):d(s.type,s)})}),c.onActive("command$",()=>{p.subscribeEvent(S.event.RemeshCommand$ReceivedEvent,g=>{const m=g.payload.Command$,s={type:`${g.type}::${m.command$Name}`,owner:v(m.owner),command$Id:m.command$Id,command$Name:m.command$Name};g.payload.arg!==void 0?d(s.type,D(E({},s),{command$Arg:g.payload.arg})):d(s.type,s)})}),c.onActive("event",()=>{p.subscribeEvent(S.event.RemeshEventEmittedEvent,g=>{const m=g.payload.Event,s={type:`${g.type}::${m.eventName}`,owner:v(m.owner),eventId:m.eventId,eventName:m.eventName};g.payload.arg!==void 0?d(s.type,D(E({},s),{eventArg:g.payload.arg})):d(s.type,s)})}),p};export{_e as R,Ft as a,Jt as b,Ht as c,_t as d,Lt as e,Tt as f,Vt as u};
//# sourceMappingURL=remesh-logger.d0a302f9.js.map
