var X=Object.defineProperty,Z=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var k=(e,t,o)=>t in e?X(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,D=(e,t)=>{for(var o in t||(t={}))te.call(t,o)&&k(e,o,t[o]);if(b)for(var o of b(t))oe.call(t,o)&&k(e,o,t[o]);return e},Q=(e,t)=>Z(e,ee(t));import"./modulepreload-polyfill.b7f2da20.js";/* empty css              */import{x as w,y as ne,q as P,e as S,z as re,R as r,r as E,A as ae,B as q,c as le,H as se,C as ce,D as _}from"./vendor.20a99481.js";import{R as x,u as h,a as v,f as de,b as me,c as ue,d as ie}from"./remesh-logger.84358a20.js";import{L as pe}from"./list.d6f76b99.js";const H=x.extern({name:"Storage",default:{get:()=>{throw new Error("Not implemented")},set:()=>{throw new Error("Not implemented")},clear:()=>{throw new Error("Not implemented")}}}),Te=H({get:e=>w.getItem(e),set:async(e,t)=>{await w.setItem(e,t)},clear:e=>w.removeItem(e)}),ye=(e,t)=>{var u;const o=e.state({name:`${t.name}.TextState`,default:(u=t.default)!=null?u:""}),n=e.query({name:`${t.name}.InputQuery`,impl:({get:i})=>i(o())}),l=e.event({name:`${t.name}.TextChangedEvent`}),a=e.command({name:`${t.name}.setText`,impl:({get:i},T)=>{const y=i(o()),g=[o().new(T),l({previous:y,current:T})];return T===""?[...g,s({previous:y})]:g}}),s=e.event({name:`${t.name}.InputClearedEvent`}),d=e.command({name:`${t.name}.clearText`,impl:()=>a("")});return{query:{TextQuery:n},command:{setText:a,clearText:d},event:{TextChangedEvent:l,TextClearedEvent:s}}},Ee=(e,t)=>({listenTo:o=>({saveData:n=>({readData:l=>t({storageKey:e,TriggerEvent:o,saveData:n,readData:l})}),readData:n=>t({storageKey:e,TriggerEvent:o,saveData:l=>l,readData:n})})}),ve=(e,t)=>{const o=e.getExtern(H);e.command$({name:"readStorage",impl:()=>ne(o.get(t.storageKey)).pipe(P(n=>!!n),S(n=>t.readData(n)))}),e.command$({name:"writeStorage",impl:({fromEvent:n})=>n(t.TriggerEvent).pipe(re(l=>o.set(t.storageKey,t.saveData(l))),S(()=>null))})},F=(e,t)=>Ee(t,o=>ve(e,o)),he="remesh-example/todo-input",U=x.domain({name:"TodoInput",impl:e=>{const t=ye(e,{name:"TodoInput"}),o=t.query.TextQuery,n=t.event.TextChangedEvent,l=t.event.TextClearedEvent,a=t.command.setText,s=t.command.clearText;return F(e,he).listenTo(n).saveData(d=>d.current).readData(d=>a(d)),{query:{TodoInputQuery:o},command:{setTodoInput:a,clearTodoInput:s},event:{TodoInputChangedEvent:n,TodoInputClearedEvent:l}}}}),ge=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,o=e=="x"?t:t&3|8;return o.toString(16)}),xe="remesh-example/todo-list",A=e=>e.id,I=x.domain({name:"TodoList",impl:e=>{const t=pe(e,{name:"TodoList",key:A}),o=t.query.ItemListQuery,n=t.query.ItemQuery,l=t.query.KeyListQuery,a=t.event.ListChangedEvent,s=t.event.ItemAddedEvent,d=t.event.ItemUpdatedEvent,u=t.event.ItemDeletedEvent,i=t.event.FailedToAddItemEvent,T=t.event.FailedToUpdateItemEvent,y=t.command.setList,g=e.command({name:"TodoList.addTodo",impl:(c,m)=>{if(m==="")return i({reason:"Title cannot be empty"});const p={id:ge(),title:m,completed:!1};return t.command.addItem(p)}}),L=e.command({name:"TodoList.updateTodo",impl:(c,m)=>m.title===""?f(m.id):t.command.updateItem(m)}),f=t.command.deleteItem,N=e.query({name:"ActiveTodoListQuery",impl:({get:c})=>c(o()).filter(p=>!p.completed)}),R=e.query({name:"CompletedTodoListQuery",impl:({get:c})=>c(o()).filter(p=>p.completed)}),$=e.query({name:"ActiveTodoCountQuery",impl:({get:c})=>c(N()).length}),K=e.query({name:"CompletedTodoCountQuery",impl:({get:c})=>c(R()).length}),Y=e.query({name:"IsAllCompletedQuery",impl:({get:c})=>{const m=c(o());return m.length===0?!1:c(K())===m.length}}),V=e.command({name:"toggleTodo",impl:({get:c},m)=>{const p=c(n(m)),C=Q(D({},p),{completed:!p.completed});return t.command.updateItem(C)}}),W=e.command({name:"toggleAllTodos",impl:({get:c})=>{const m=c(o());if(m.length===0)return null;const C=c($())>0,j=m.map(J=>Q(D({},J),{completed:C}));return y(j)}}),z=e.command({name:"clearAllCompletedTodos",impl:({get:c})=>{const m=c(o());if(m.length===0)return null;const p=m.filter(C=>!C.completed);return y(p)}});return F(e,xe).listenTo(a).saveData(c=>c.current).readData(c=>y(c)),{query:{TodoQuery:n,TodoKeyListQuery:l,TodoListQuery:o,ActiveTodoListQuery:N,CompletedTodoListQuery:R,ActiveTodoCountQuery:$,CompletedTodoCountQuery:K,IsAllCompletedQuery:Y},command:{setTodoList:y,addTodo:g,updateTodo:L,deleteTodo:f,toggleTodo:V,toggleAllTodos:W,clearAllCompletedTodos:z},event:{TodoItemAddedEvent:s,TodoItemUpdatedEvent:d,TodoItemDeletedEvent:u,FailedToAddTodoEvent:i,FailedToUpdateTodoEvent:T,TodoListChangedEvent:a}}}});function B(e,t){return n=>{const l=Array.isArray(e)?e:[e];for(const a of l)n.key.toLowerCase()===a.toLowerCase()&&(n.preventDefault(),t(n,a))}}const fe=()=>{const e=h(U()),t=h(I()),o=v(e.query.TodoInputQuery()),n=a=>{e.command.setTodoInput(a.target.value)},l=B("Enter",()=>{t.command.addTodo(o)});return de(t.event.FailedToAddTodoEvent,a=>{alert(a.reason)}),r.createElement("header",{className:"header"},r.createElement("h1",null,"todos"),r.createElement("input",{className:"new-todo",placeholder:"What needs to be done?",value:o,onChange:n,onKeyDown:l}))},Ce=(e,t)=>{const o=e.state({name:`${t.name}.SwitchState`,default:t.default}),n=e.query({name:`${t.name}.SwitchQuery`,impl:({get:s})=>s(o())}),l=e.event({name:`${t.name}.SwitchedEvent`}),a=e.command({name:`${t.name}.switchTo`,impl:({get:s},d)=>{const u=s(o());return[o().new(d),l({previous:u,current:d})]}});return{query:{SwitchQuery:n},command:{switchTo:a},event:{SwitchedEvent:l}}},Ie="remesh-example/todo-filter",Le=e=>{if(e===void 0)return"all";switch(e){case"all":case"active":case"completed":return e;default:return"all"}},G=x.domain({name:"TodoFilter",impl:e=>{const t=Ce(e,{name:"TodoFilter",default:"all"}),o=t.query.SwitchQuery,n=t.event.SwitchedEvent,l=t.command.switchTo,a=e.command({name:"TodoFilter.setFilter",impl:(s,d)=>{const u=Le(d);return l(u)}});return F(e,Ie).listenTo(n).saveData(s=>s.current).readData(s=>a(s)),{query:{TodoFilterQuery:o},command:{setFilter:a,switchFilter:l},event:{TodoFilterChangedEvent:n}}}}),De=x.domain({name:"TodoApp",impl:e=>{const t=e.getDomain(U()),o=e.getDomain(I()),n=e.getDomain(G()),l=e.query({name:"FilteredTodoList",impl:({get:a})=>{const s=a(n.query.TodoFilterQuery());if(s==="all")return a(o.query.TodoListQuery()).map(A);if(s==="active")return a(o.query.ActiveTodoListQuery()).map(A);if(s==="completed")return a(o.query.CompletedTodoListQuery()).map(A);throw new Error(`Unknown filter: ${s}`)}});return e.command$({name:"clearTodoInputWhenSubmit",impl:({fromEvent:a,get:s})=>a(o.event.TodoItemAddedEvent).pipe(P(d=>s(t.query.TodoInputQuery())===d.item.title),S(()=>t.command.clearTodoInput()))}),{query:{FilteredTodoKeyListQuery:l},command:{},event:{}}}});function Qe(e){const[t,o]=E.exports.useState(e),n=E.exports.useCallback(l=>{o(l.target.value)},[]);return[t,n,o]}function Ae(e){const t=h(I()),o=v(t.query.TodoQuery(e.id)),[n,l]=E.exports.useState(!1),[a,s]=Qe(o.title),d=()=>{t.command.updateTodo(Q(D({},o),{title:a})),l(!1)},u=B(["Enter","Escape"],()=>{d()}),i=()=>{l(!0)},T=()=>{t.command.toggleTodo(o.id)},y=()=>{t.command.deleteTodo(o.id)},g=()=>{d()},L=E.exports.useRef(null);return E.exports.useEffect(()=>{var f;n&&((f=L.current)==null||f.focus())},[n]),r.createElement("li",{className:`${n&&"editing"} ${o.completed&&"completed"}`},r.createElement("div",{className:"view"},r.createElement("input",{type:"checkbox",className:"toggle",checked:o.completed,onChange:T}),r.createElement("label",{onDoubleClick:i},o.title),r.createElement("button",{className:"destroy",onClick:y})),n&&r.createElement("input",{ref:L,className:"edit",value:a,onChange:s,onKeyDown:u,onBlur:g}))}const we=()=>{const e=h(De()),t=v(e.query.FilteredTodoKeyListQuery());return console.log("render list"),r.createElement("section",{className:"main"},r.createElement(qe,null),r.createElement("ul",{className:"todo-list"},t.map(o=>r.createElement(Ae,{key:o,id:o}))))},qe=()=>{const e=h(I()),t=v(e.query.IsAllCompletedQuery()),o=()=>{e.command.toggleAllTodos()};return r.createElement(r.Fragment,null,r.createElement("input",{id:"toggle-all",type:"checkbox",className:"toggle-all",checked:t,onChange:o}),r.createElement("label",{htmlFor:"toggle-all"}))},Se=()=>{const e=h(I()),t=h(G()),o=v(t.query.TodoFilterQuery()),n=v(e.query.ActiveTodoCountQuery()),a=v(e.query.CompletedTodoCountQuery())>0,s=()=>{e.command.clearAllCompletedTodos()},d=i=>i.isActive?"selected":"",u=ae();return E.exports.useEffect(()=>{var T;const i=(T=u.filter)!=null?T:"all";i!==o&&t.command.setFilter(i)},[u,o]),r.createElement("footer",{className:"footer"},r.createElement("span",{className:"todo-count"},r.createElement("strong",null,n)," item",n!==1&&"s"," left"),r.createElement("ul",{className:"filters"},r.createElement("li",null,r.createElement(q,{to:"/",className:d},"All")),r.createElement("li",null,r.createElement(q,{to:"/active",className:d},"Active")),r.createElement("li",null,r.createElement(q,{to:"/completed",className:d},"Completed"))),a&&r.createElement("button",{className:"clear-completed",onClick:s},"Clear completed"))},O=()=>r.createElement("div",{className:"todoapp"},r.createElement(fe,null),r.createElement(we,null),r.createElement(Se,null)),M=document.getElementById("root");if(M){const e=le(M),t=x.store({externs:[Te],inspectors:[me(),ue()]});e.render(r.createElement(E.exports.StrictMode,null,r.createElement(ie,{store:t},r.createElement(se,{basename:"/"},r.createElement(ce,null,r.createElement(_,{path:"/",element:r.createElement(O,null)}),r.createElement(_,{path:"/:filter",element:r.createElement(O,null)}))))))}
//# sourceMappingURL=index.aaaccef9.js.map
