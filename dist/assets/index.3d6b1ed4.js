var X=Object.defineProperty,Z=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var k=(e,t,o)=>t in e?X(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,D=(e,t)=>{for(var o in t||(t={}))te.call(t,o)&&k(e,o,t[o]);if(b)for(var o of b(t))oe.call(t,o)&&k(e,o,t[o]);return e},w=(e,t)=>Z(e,ee(t));import"./modulepreload-polyfill.b7f2da20.js";/* empty css              */import{u as A,v as ne,n as P,e as F,w as ae,R as a,r as v,x as le,y as q,c as re,H as se,z as ce,A as _}from"./vendor.c1cd45af.js";import{R as x,u as g,a as h,f as de,b as me,c as ue,d as ie}from"./remesh-logger.d0a302f9.js";import{L as pe}from"./list.0d9e4950.js";const H=x.extern({name:"Storage",default:{get:()=>{throw new Error("Not implemented")},set:()=>{throw new Error("Not implemented")},clear:()=>{throw new Error("Not implemented")}}}),Te=H({get:e=>A.getItem(e),set:async(e,t)=>{await A.setItem(e,t)},clear:e=>A.removeItem(e)}),Ee=(e,t)=>{var u;const o=e.state({name:`${t.name}.TextState`,default:(u=t.default)!=null?u:""}),n=e.query({name:`${t.name}.TextQuery`,impl:({get:i})=>i(o())}),r=e.event({name:`${t.name}.TextChangedEvent`}),l=e.command({name:`${t.name}.setText`,impl:({get:i},T)=>{const E=i(o()),y=[o().new(T),r({previous:E,current:T})];return T===""?[...y,s({previous:E})]:y}}),s=e.event({name:`${t.name}.InputClearedEvent`}),d=e.command({name:`${t.name}.clearText`,impl:()=>l("")});return{query:{text:n},command:{setText:l,clearText:d},event:{TextChangedEvent:r,TextClearedEvent:s}}},ve=(e,t)=>({listenTo:o=>({saveData:n=>({readData:r=>t({storageKey:e,TriggerEvent:o,saveData:n,readData:r})}),readData:n=>t({storageKey:e,TriggerEvent:o,saveData:r=>r,readData:n})})}),he=(e,t)=>{const o=e.getExtern(H);e.command$({name:"readStorage",impl:()=>ne(o.get(t.storageKey)).pipe(P(n=>!!n),F(n=>t.readData(n)))}),e.command$({name:"writeStorage",impl:({fromEvent:n})=>n(t.TriggerEvent).pipe(ae(r=>o.set(t.storageKey,t.saveData(r))),F(()=>null))})},N=(e,t)=>ve(t,o=>he(e,o)),ge="remesh-example/todo-input",U=x.domain({name:"TodoInput",impl:e=>{const t=Ee(e,{name:"TodoInput"}),o=t.query.text,n=t.event.TextChangedEvent,r=t.event.TextClearedEvent,l=t.command.setText,s=t.command.clearText;return N(e,ge).listenTo(n).saveData(d=>d.current).readData(d=>l(d)),{query:{todoInput:o},command:{setTodoInput:l,clearTodoInput:s},event:{TodoInputChangedEvent:n,TodoInputClearedEvent:r}}}}),ye=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,o=e=="x"?t:t&3|8;return o.toString(16)}),xe="remesh-example/todo-list",S=e=>e.id,L=x.domain({name:"TodoList",impl:e=>{const t=pe(e,{name:"TodoList",key:S}),o=t.query.itemList,n=t.query.item,r=t.query.keyList,l=t.event.ListChangedEvent,s=t.event.ItemAddedEvent,d=t.event.ItemUpdatedEvent,u=t.event.ItemDeletedEvent,i=t.event.FailedToAddItemEvent,T=t.event.FailedToUpdateItemEvent,E=t.command.setList,y=e.command({name:"TodoList.addTodo",impl:(c,m)=>{if(m==="")return i({reason:"Title cannot be empty"});const p={id:ye(),title:m,completed:!1};return t.command.addItem(p)}}),I=e.command({name:"TodoList.updateTodo",impl:(c,m)=>m.title===""?f(m.id):t.command.updateItem(m)}),f=t.command.deleteItem,R=e.query({name:"ActiveTodoListQuery",impl:({get:c})=>c(o()).filter(p=>!p.completed)}),$=e.query({name:"CompletedTodoListQuery",impl:({get:c})=>c(o()).filter(p=>p.completed)}),K=e.query({name:"ActiveTodoCountQuery",impl:({get:c})=>c(R()).length}),Q=e.query({name:"CompletedTodoCountQuery",impl:({get:c})=>c($()).length}),Y=e.query({name:"IsAllCompletedQuery",impl:({get:c})=>{const m=c(o());return m.length===0?!1:c(Q())===m.length}}),V=e.command({name:"toggleTodo",impl:({get:c},m)=>{const p=c(n(m)),C=w(D({},p),{completed:!p.completed});return t.command.updateItem(C)}}),W=e.command({name:"toggleAllTodos",impl:({get:c})=>{const m=c(o());if(m.length===0)return null;const C=c(K())>0,j=m.map(J=>w(D({},J),{completed:C}));return E(j)}}),z=e.command({name:"clearAllCompletedTodos",impl:({get:c})=>{const m=c(o());if(m.length===0)return null;const p=m.filter(C=>!C.completed);return E(p)}});return N(e,xe).listenTo(l).saveData(c=>c.current).readData(c=>E(c)),{query:{todoState:n,todoKeyList:r,todoList:o,activeTodoList:R,completedTodoList:$,activeTodoCount:K,completedTodoCount:Q,isAllCompleted:Y},command:{setTodoList:E,addTodo:y,updateTodo:I,deleteTodo:f,toggleTodo:V,toggleAllTodos:W,clearAllCompletedTodos:z},event:{TodoItemAddedEvent:s,TodoItemUpdatedEvent:d,TodoItemDeletedEvent:u,FailedToAddTodoEvent:i,FailedToUpdateTodoEvent:T,TodoListChangedEvent:l}}}});function B(e,t){return n=>{const r=Array.isArray(e)?e:[e];for(const l of r)n.key.toLowerCase()===l.toLowerCase()&&(n.preventDefault(),t(n,l))}}const fe=()=>{const e=g(U()),t=g(L()),o=h(e.query.todoInput()),n=l=>{e.command.setTodoInput(l.target.value)},r=B("Enter",()=>{t.command.addTodo(o)});return de(t.event.FailedToAddTodoEvent,l=>{alert(l.reason)}),a.createElement("header",{className:"header"},a.createElement("h1",null,"todos"),a.createElement("input",{className:"new-todo",placeholder:"What needs to be done?",value:o,onChange:n,onKeyDown:r}))},Ce=(e,t)=>{const o=e.state({name:`${t.name}.SwitchState`,default:t.default}),n=e.query({name:`${t.name}.SwitchStateQuery`,impl:({get:s})=>s(o())}),r=e.event({name:`${t.name}.SwitchedEvent`}),l=e.command({name:`${t.name}.switchTo`,impl:({get:s},d)=>{const u=s(o());return[o().new(d),r({previous:u,current:d})]}});return{query:{switchState:n},command:{switchTo:l},event:{SwitchedEvent:r}}},Le="remesh-example/todo-filter",Ie=e=>{if(e===void 0)return"all";switch(e){case"all":case"active":case"completed":return e;default:return"all"}},G=x.domain({name:"TodoFilter",impl:e=>{const t=Ce(e,{name:"TodoFilter",default:"all"}),o=t.query.switchState,n=t.event.SwitchedEvent,r=t.command.switchTo,l=e.command({name:"TodoFilter.setFilter",impl:(s,d)=>{const u=Ie(d);return r(u)}});return N(e,Le).listenTo(n).saveData(s=>s.current).readData(s=>l(s)),{query:{todoFilter:o},command:{setFilter:l,switchFilter:r},event:{TodoFilterChangedEvent:n}}}}),De=x.domain({name:"TodoApp",impl:e=>{const t=e.getDomain(U()),o=e.getDomain(L()),n=e.getDomain(G()),r=e.query({name:"FilteredTodoList",impl:({get:l})=>{const s=l(n.query.todoFilter());if(s==="all")return l(o.query.todoList()).map(S);if(s==="active")return l(o.query.activeTodoList()).map(S);if(s==="completed")return l(o.query.completedTodoList()).map(S);throw new Error(`Unknown filter: ${s}`)}});return e.command$({name:"clearTodoInputWhenSubmit",impl:({fromEvent:l,get:s})=>l(o.event.TodoItemAddedEvent).pipe(P(d=>s(t.query.todoInput())===d.item.title),F(()=>t.command.clearTodoInput()))}),{query:{FilteredTodoKeyListQuery:r},command:{},event:{}}}});function we(e){const[t,o]=v.exports.useState(e),n=v.exports.useCallback(r=>{o(r.target.value)},[]);return[t,n,o]}function Se(e){const t=g(L()),o=h(t.query.todoState(e.id)),[n,r]=v.exports.useState(!1),[l,s]=we(o.title),d=()=>{t.command.updateTodo(w(D({},o),{title:l})),r(!1)},u=B(["Enter","Escape"],()=>{d()}),i=()=>{r(!0)},T=()=>{t.command.toggleTodo(o.id)},E=()=>{t.command.deleteTodo(o.id)},y=()=>{d()},I=v.exports.useRef(null);return v.exports.useEffect(()=>{var f;n&&((f=I.current)==null||f.focus())},[n]),a.createElement("li",{className:`${n&&"editing"} ${o.completed&&"completed"}`},a.createElement("div",{className:"view"},a.createElement("input",{type:"checkbox",className:"toggle",checked:o.completed,onChange:T}),a.createElement("label",{onDoubleClick:i},o.title),a.createElement("button",{className:"destroy",onClick:E})),n&&a.createElement("input",{ref:I,className:"edit",value:l,onChange:s,onKeyDown:u,onBlur:y}))}const Ae=()=>{const e=g(De()),t=h(e.query.FilteredTodoKeyListQuery());return console.log("render list"),a.createElement("section",{className:"main"},a.createElement(qe,null),a.createElement("ul",{className:"todo-list"},t.map(o=>a.createElement(Se,{key:o,id:o}))))},qe=()=>{const e=g(L()),t=h(e.query.isAllCompleted()),o=()=>{e.command.toggleAllTodos()};return a.createElement(a.Fragment,null,a.createElement("input",{id:"toggle-all",type:"checkbox",className:"toggle-all",checked:t,onChange:o}),a.createElement("label",{htmlFor:"toggle-all"}))},Fe=()=>{const e=g(L()),t=g(G()),o=h(t.query.todoFilter()),n=h(e.query.activeTodoCount()),l=h(e.query.completedTodoCount())>0,s=()=>{e.command.clearAllCompletedTodos()},d=i=>i.isActive?"selected":"",u=le();return v.exports.useEffect(()=>{var T;const i=(T=u.filter)!=null?T:"all";i!==o&&t.command.setFilter(i)},[u,o]),a.createElement("footer",{className:"footer"},a.createElement("span",{className:"todo-count"},a.createElement("strong",null,n)," item",n!==1&&"s"," left"),a.createElement("ul",{className:"filters"},a.createElement("li",null,a.createElement(q,{to:"/",className:d},"All")),a.createElement("li",null,a.createElement(q,{to:"/active",className:d},"Active")),a.createElement("li",null,a.createElement(q,{to:"/completed",className:d},"Completed"))),l&&a.createElement("button",{className:"clear-completed",onClick:s},"Clear completed"))},O=()=>a.createElement("div",{className:"todoapp"},a.createElement(fe,null),a.createElement(Ae,null),a.createElement(Fe,null)),M=document.getElementById("root");if(M){const e=re(M),t=x.store({externs:[Te],inspectors:[me(),ue()]});e.render(a.createElement(v.exports.StrictMode,null,a.createElement(ie,{store:t},a.createElement(se,{basename:"/"},a.createElement(ce,null,a.createElement(_,{path:"/",element:a.createElement(O,null)}),a.createElement(_,{path:"/:filter",element:a.createElement(O,null)}))))))}
//# sourceMappingURL=index.3d6b1ed4.js.map
