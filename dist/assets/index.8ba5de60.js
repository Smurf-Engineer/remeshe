import"./modulepreload-polyfill.b7f2da20.js";import{v as R,w as b,c as x,R as t,r as i}from"./vendor.20a99481.js";import{R as C,b as I,c as P,d as v,u as E,g as D,a as N,h as g}from"./remesh-logger.84358a20.js";import{L as _}from"./list.d6f76b99.js";const k=(...e)=>(s,a)=>a.pipe(R(...e)),M=(...e)=>(s,a)=>a.pipe(b(...e)),d=e=>new Promise(s=>setTimeout(s,e)),Q=C.domain({name:"test",impl:e=>{const s=e.state({name:"CountState",default:0}),a=e.query({name:"CountIncreQuery",impl:async({get:n})=>{const r=n(s());return await d(1e3),r+1}}),m=e.query({name:"CountDecreQuery",impl:async({get:n})=>{const r=n(s());return await d(1e3),r-1}}),y=e.query({name:"CountDoubleQuery",impl:async({get:n})=>{const r=await n(s());return await d(1e3),r*2}}),l=e.query({name:"CountQuery",scheduler:k(0),impl:async({get:n})=>{const[r,c,o]=await Promise.all([n(a()),n(m()),n(y())]);return{incre:r,decre:c,double:o}}}),u=e.query({name:"UnwrappedCountQuery",scheduler:M(0),impl:({unwrap:n})=>n(l())}),w=e.command({name:"incre",impl:({get:n})=>{const r=n(s());return s().new(r+1)}}),S=e.command({name:"decre",impl:({get:n})=>{const r=n(s());return s().new(r-1)}}),p=_(e,{name:"PaginationListState",key:n=>`${n.offset}-${n.pageSize}`,default:[{offset:0,pageSize:10}]}),h=e.query({name:"UsersQuery",impl:async(n,r)=>await(await fetch(`https://api.github.com/users?since=${r.offset}&per_page=${r.pageSize}`)).json()}),q=e.query({name:"UserListQuery",impl:async({get:n})=>{const r=n(p.query.ItemListQuery());return(await Promise.all(r.map(o=>n(h(o))))).flat(Number.POSITIVE_INFINITY)}}),L=e.query({name:"NextPaginationQuery",impl:async({get:n})=>{const r=n(p.query.ItemListQuery());if(r.length===0)return{offset:0,pageSize:10};const c=r[r.length-1],o=await n(h(c));return{offset:o[o.length-1].id+1,pageSize:c.pageSize}}}),U=e.command({name:"loadMoreUsers",impl:({},n)=>p.command.addItem(n)});return{query:{CountQuery:l,UnwrappedCountQuery:u,UserListQuery:q,NextPaginationQuery:L},command:{incre:w,decre:S,loadMoreUsers:U}}}}),T=()=>{const e=E(Q()),s=D(e.query.CountQuery()),a=N(e.query.UnwrappedCountQuery());return t.createElement("div",null,t.createElement("h3",null,"Commands"),t.createElement("button",{onClick:()=>e.command.incre()},"Increment")," ",t.createElement("button",{onClick:()=>e.command.decre()},"Decrement"),t.createElement("div",null,t.createElement("h3",null,"Async Query"),t.createElement("pre",null,JSON.stringify(s,null,2))),t.createElement("div",null,t.createElement("h3",null,"Unwrapped Query"),t.createElement("pre",null,JSON.stringify(a,null,2))),t.createElement("div",null,t.createElement("h3",null,"Suspense Query"),t.createElement(i.exports.Suspense,{fallback:"loading..."},t.createElement($,null))),t.createElement("div",null,t.createElement("h3",null,"User List Query"),t.createElement(i.exports.Suspense,{fallback:"loading..."},t.createElement(z,null))))},z=()=>{const[e,s]=i.exports.useTransition(),a=E(Q()),m=g(a.query.UserListQuery()),y=g(a.query.NextPaginationQuery()),l=()=>{s(()=>{a.command.loadMoreUsers(y)})};return console.log("pending",e),t.createElement(t.Fragment,null,t.createElement("button",{onClick:l},"load more"),t.createElement("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"space-around"}},m.map(u=>t.createElement("div",{style:{width:100,margin:10},key:u.html_url},t.createElement("img",{style:{width:100},src:u.avatar_url}),t.createElement("p",null,t.createElement("a",{href:u.html_url},u.login))))))},$=()=>{const e=E(Q()),s=g(e.query.CountQuery());return t.createElement("pre",null,JSON.stringify(s,null,2))},f=document.getElementById("root");if(f){const e=x(f),s=C.store({inspectors:[I(),P({include:["command","query","event","domain","command$","state"]})]});e.render(t.createElement(i.exports.StrictMode,null,t.createElement(v,{store:s},t.createElement(T,null)),","))}
//# sourceMappingURL=index.8ba5de60.js.map
