var We=Object.defineProperty,He=Object.defineProperties;var Je=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var de=(e,n,r)=>n in e?We(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,q=(e,n)=>{for(var r in n||(n={}))pe.call(n,r)&&de(e,r,n[r]);if(V)for(var r of V(n))ye.call(n,r)&&de(e,r,n[r]);return e},X=(e,n)=>He(e,Je(n));var fe=(e,n)=>{var r={};for(var a in e)pe.call(e,a)&&n.indexOf(a)<0&&(r[a]=e[a]);if(e!=null&&V)for(var a of V(e))n.indexOf(a)<0&&ye.call(e,a)&&(r[a]=e[a]);return r};import"./modulepreload-polyfill.b7f2da20.js";import{s as ve,m as Ge,c as Pe,e as Ze,i as ge,b as _e,S as H,O as Se,d as et,r as F,a as o,f as he,g as be,h as tt,o as nt,N as rt,j as at,p as ot,k as we,t as st,R as ct}from"./vendor.c7f4f184.js";let lt=0;const ut=e=>{const n=lt++,r=a=>({type:"RemeshEventPayload",arg:a,Event:r});return r.type="RemeshEvent",r.eventId=n,r.eventName=e.name,r.impl=e.impl,r},mt=e=>Re({name:e.name,impl:()=>e.default,compare:e.compare});let it=0;const Qe=(e,n)=>ge(e)&&ge(n)?_e(e,n):e===n,Re=e=>{var c;const n=it++;let r=null;const a=f=>{if(f===void 0&&r)return r;const p={type:"RemeshStateItem",arg:f,State:a,new:C=>({type:"RemeshStateSetterPayload",stateItem:p,newState:C})};return f===void 0&&(r=p),p};return a.type="RemeshState",a.stateId=n,a.stateName=e.name,a.impl=e.impl,a.compare=(c=e.compare)!=null?c:Qe,a.Query=De({name:`Query(${e.name})`,impl:({get:f},p)=>f(a(p))}),a};let dt=0;const De=e=>{var c;const n=dt++;let r=null;const a=f=>{if(f===void 0&&r)return r;const p={type:"RemeshQueryPayload",Query:a,arg:f};return f===void 0&&(r=p),p};return a.type="RemeshQuery",a.queryId=n,a.queryName=e.name,a.impl=e.impl,a.compare=(c=e.compare)!=null?c:Qe,a};let pt=0;const yt=e=>{const n=pt++,r=a=>({type:"RemeshCommandPayload",arg:a,Command:r});return r.type="RemeshCommand",r.commandId=n,r.commandName=e.name,r.impl=e.impl,r};let ft=0;const Ie=e=>{const n=ft++,r=a=>({type:"RemeshCommand$Payload",arg:a,Command$:r});return r.type="RemeshCommand$",r.command$Id=n,r.command$Name=e.name,r.impl=e.impl,r},gt=e=>Ie({name:e.name,impl:(r,a)=>{if(!e.mode||e.mode==="switch")return a.pipe(ve(c=>e.impl(r,c)));if(e.mode==="merge")return a.pipe(Ge(c=>e.impl(r,c)));if(e.mode==="concat")return a.pipe(Pe(c=>e.impl(r,c)));if(e.mode==="exhaust")return a.pipe(Ze(c=>e.impl(r,c)));throw new Error(`RemeshCommandAsync: invalid mode: ${e.mode}`)}});let St=0;const ht=e=>{const n=r=>({type:"RemeshExternPayload",Extern:n,value:r});return n.externId=St++,n.externName=e.name,n.default=e.default,n};let bt=0;const ke=e=>{let n=null;const r=a=>{if(a===void 0&&n)return n;const c={type:"RemeshDomainPayload",Domain:r,arg:a};return a===void 0&&(n=c),c};return Object.assign(r,{type:"RemeshDomain",domainId:bt++,domainName:e.name,impl:e.impl}),r},wt=e=>e,j=ke({name:"DefaultDomain",impl:()=>({})}),$e=e=>{const n=new Set,r=new Map,a=new Map,c=new Set,f=t=>{var s;for(const l of(s=e.externs)!=null?s:[])if(l.Extern===t)return l.value;return t.default},p=t=>{const s=a.get(t);if(s)return s;const l=f(t),m={type:"RemeshExternStorage",Extern:t,currentValue:l};return a.set(t,m),p(t)},C=t=>p(t).currentValue,g=new WeakMap,d=t=>{var E;const s=g.get(t);if(s)return s;const l=t.State.stateName,m=(E=JSON.stringify(t.arg))!=null?E:"",x=`State/${t.State.stateId}/${l}/${m}`;return g.set(t,x),x},u=t=>{var E;const s=g.get(t);if(s)return s;const l=t.Query.queryName,m=(E=JSON.stringify(t.arg))!=null?E:"",x=`Query/${t.Query.queryId}/${l}/${m}`;return g.set(t,x),x},w=t=>t.type==="RemeshStateItem"?d(t):t.type==="RemeshQueryPayload"?u(t):h(t),S=t=>{var x;const s=Q((x=t.State.owner)!=null?x:j()),l=d(t),m=s.stateMap.get(l);return m||(s.stateMap.set(l,{type:"RemeshStateStorage",State:t.State,arg:t.arg,key:l,currentState:t.State.impl(t.arg),downstreamSet:new Set}),S(t))},b=t=>{var I;const s=Q((I=t.owner)!=null?I:j()),l=s.eventMap.get(t);if(l)return l;const m=new H,x=new Se(N=>{const B=m.subscribe(N);return E.refCount+=1,()=>{B.unsubscribe(),E.refCount-=1,c.add(E),Y()}}),E={type:"RemeshEventStorage",Event:t,subject:m,observable:x,refCount:0};return s.eventMap.set(t,E),b(t)},y=t=>{var ie;const s=Q((ie=t.Query.owner)!=null?ie:j()),l=u(t),m=s.queryMap.get(l);if(m)return m;const x=new H,E=new Se(M=>{const z=x.subscribe(M);return L.refCount+=1,()=>{z.unsubscribe(),L.refCount-=1,c.add(L),Y()}}),I=new Set,N=new Set,{Query:B}=t,R={get:M=>{if(M.type==="RemeshStateItem"){const z=S(M);return I.add(z),$.get(M)}if(M.type==="RemeshQueryPayload"){const z=y(M);return I.add(z),$.get(M)}return $.get(M)}},v=B.impl(R,t.arg),L={type:"RemeshQueryStorage",Query:t.Query,arg:t.arg,currentValue:v,key:l,upstreamSet:I,downstreamSet:N,subject:x,observable:E,refCount:0};for(const M of I)M.downstreamSet.add(L);return s.queryMap.set(l,L),L},i=t=>{var I;const s=Q((I=t.owner)!=null?I:j()),l=s.command$Map.get(t);if(l)return l;const m=new H,x=m.asObservable(),E={type:"RemeshCommand$Storage",Command$:t,subject:m,observable:x};return s.command$Map.set(t,E),E},h=t=>{var E;const s=g.get(t);if(s)return s;const l=t.Domain.domainName,m=(E=JSON.stringify(t.arg))!=null?E:"",x=`Domain/${t.Domain.domainId}/${l}/${m}`;return g.set(t,x),x},Q=t=>{const s=h(t),l=r.get(s);if(l)return l;let m=!1;const x=new Set,E=new Set,I={state:R=>{if(m)throw new Error("Unexpected calling domain.state(..) asynchronously");if("default"in R){const L=mt(R);return L.owner=t,L}const v=Re(R);return v.owner=t,v},query:R=>{if(m)throw new Error("Unexpected calling domain.query(..) asynchronously");const v=De(R);return v.owner=t,v},event:R=>{if(m)throw new Error("Unexpected calling domain.event(..) asynchronously");const v=ut(R);return v.owner=t,v},command:R=>{if(m)throw new Error("Unexpected calling domain.command(..) asynchronously");const v=yt(R);return v.owner=t,v},command$:R=>{if(m)throw new Error("Unexpected calling domain.command$(..) asynchronously");const v=Ie(R);return v.owner=t,E.add(v),v},commandAsync:R=>{if(m)throw new Error("Unexpected calling domain.command$(..) asynchronously");const v=gt(R);return v.owner=t,E.add(v),v},module:R=>{if(m)throw new Error("Unexpected calling domain.module(..) asynchronously");return R(I)},getDomain:R=>{const v=Q(R);return x.add(v),v.domain},getExtern:R=>C(R)},N=t.Domain.impl(I,t.arg);m=!0;const B={type:"RemeshDomainStorage",Domain:t.Domain,arg:t.arg,domain:N,domainPayload:t,key:s,command$Set:E,upstreamSet:x,downstreamSet:new Set,upstreamSubscriptionSet:new Set,domainSubscriptionSet:new Set,stateMap:new Map,queryMap:new Map,eventMap:new Map,command$Map:new Map,refCount:0,running:!1};r.set(s,B);for(const R of x)R.downstreamSet.add(B);return Q(t)},k=t=>{var l;const s=Q((l=t.Query.owner)!=null?l:j());t.subject.complete(),s.queryMap.delete(t.key);for(const m of t.upstreamSet)if(m.downstreamSet.delete(t),m.type==="RemeshQueryStorage")K(m);else if(m.type==="RemeshStateStorage")O(m);else throw new Error(`Unknown upstream in clearQueryStorageIfNeeded(..): ${m}`)},K=t=>{t.refCount===0&&t.downstreamSet.size===0&&k(t)},A=t=>{var l;const s=Q((l=t.State.owner)!=null?l:j());s.stateMap.has(t.key)&&console.log("delete",t.key),s.stateMap.delete(t.key)},O=t=>{t.downstreamSet.size===0&&A(t)},P=t=>{var l;const s=Q((l=t.Event.owner)!=null?l:j());t.subject.complete(),s.eventMap.delete(t.Event)},qe=t=>{t.refCount===0&&P(t)},Fe=t=>{var l,m;const s=Q((l=t.Command$.owner)!=null?l:j());t.subject.complete(),(m=t.subscription)==null||m.unsubscribe(),s.command$Map.delete(t.Command$)},Z=t=>{const s=[...t.upstreamSet];Ee(t.domainSubscriptionSet),Ee(t.upstreamSubscriptionSet);for(const l of t.eventMap.values())P(l);for(const l of t.queryMap.values())k(l);for(const l of t.stateMap.values())A(l);for(const l of t.command$Map.values())Fe(l);t.upstreamSubscriptionSet.clear(),t.domainSubscriptionSet.clear(),t.downstreamSet.clear(),t.upstreamSet.clear(),t.stateMap.clear(),t.queryMap.clear(),t.eventMap.clear(),r.delete(t.key);for(const l of s)l.downstreamSet.delete(t),_(l)},_=t=>{t.refCount===0&&t.downstreamSet.size===0&&t.domainSubscriptionSet.size===0&&Z(t)},Le=t=>S(t).currentState,ee=t=>y(t).currentValue,$={get:t=>{if(t.type==="RemeshStateItem")return Le(t);if(t.type==="RemeshQueryPayload")return ee(t);throw new Error(`Unexpected input in ctx.get(..): ${t}`)},fromEvent:t=>b(t).observable,fromQuery:t=>y(t).observable},te=t=>{const{Query:s}=t;for(const E of t.upstreamSet)E.downstreamSet.delete(t),E.downstreamSet.size===0&&c.add(E);t.upstreamSet.clear();const l={get:E=>{if(E.type==="RemeshStateItem"){const I=E,N=S(I);return t.upstreamSet.add(N),N.downstreamSet.add(t),$.get(I)}if(E.type==="RemeshQueryPayload"){const I=E,N=y(I);return t.upstreamSet.add(N),N.downstreamSet.add(t),$.get(I)}return $.get(E)}},m=s.impl(l,t.arg);if(!s.compare(t.currentValue,m)){t.currentValue=m,n.add(t);for(const E of[...t.downstreamSet])te(E)}},ne=()=>{if(c.size===0)return;const t=[...c];c.clear();for(const s of t)s.type==="RemeshDomainStorage"?_(s):s.type==="RemeshEventStorage"?qe(s):s.type==="RemeshQueryStorage"?K(s):s.type==="RemeshStateStorage"&&O(s);ne()},Ue=()=>{re(),ne()},re=()=>{if(n.size===0)return;const t=[...n];n.clear();for(const s of t)n.has(s)||s.subject.next(s.currentValue);re()},Y=()=>{Ue()},Ke=t=>{const s=S(t.stateItem);if(!t.stateItem.State.compare(s.currentState,t.newState)){s.arg=t.stateItem.arg,s.key=d(t.stateItem),s.currentState=t.newState;for(const m of[...s.downstreamSet])te(m);Y()}},ae=t=>{const{Event:s,arg:l}=t,m=b(s);if(s.impl){const x={get:$.get},E=s.impl(x,l);m.subject.next(E)}else m.subject.next(l)},oe=t=>{const{Command:s,arg:l}=t,m={get:$.get},x=s.impl(m,l);W(x)},se=(t,s)=>{t.add(s),s.add(()=>{t.delete(s)})},ce=t=>{const s=i(t);if(s.subscription)return;const l={get:$.get,fromEvent:$.fromEvent,fromQuery:$.fromQuery},m=t.impl(l,s.observable).subscribe(W);s.subscription=m},W=t=>{if(Array.isArray(t)){for(const s of t)W(s);return}if(t.type==="RemeshCommandPayload"){oe(t);return}else if(t.type==="RemeshEventPayload"){ae(t);return}else if(t.type==="RemeshStateSetterPayload"){Ke(t);return}else if(t.type==="RemeshCommand$Payload"){le(t);return}throw new Error(`Unknown command output of ${t}`)},le=t=>{const{Command$:s,arg:l}=t,m=i(s);ce(s),m.subject.next(l)},je=(t,s)=>{se(t.domainSubscriptionSet,s),s.add(()=>{c.add(t),Y()})},Te=(t,s)=>y(t).observable.subscribe(s),Ae=(t,s)=>b(t).observable.subscribe(s),Oe=t=>{const s={};for(const l in t.command){const m=t.command[l];s[l]=x=>me(m(x))}return s},Be=t=>{const s=Q(t);if(s.domainOutput)return s.domainOutput;const l=s.domain,m=Oe(l),x=X(q({},l),{command:m});return s.domainOutput=x,x},ze=t=>{for(const s of t)ce(s);t.clear()},Ye=t=>{if(!t.running){t.running=!0;for(const s of t.upstreamSet){const l=ue(s.domainPayload);se(t.upstreamSubscriptionSet,l)}ze(t.command$Set)}},ue=t=>{const s=Q(t),l=new et;return je(s,l),Ye(s),l},Ve=()=>{for(const t of r.values())Z(t);r.clear(),n.clear()},Xe=t=>{ae(t)},me=t=>{t.type==="RemeshCommandPayload"?oe(t):t.type==="RemeshCommand$Payload"&&le(t)};return{name:e.name,getDomain:Be,query:ee,emitEvent:Xe,emitCommand:me,destroy:Ve,subscribeQuery:Te,subscribeEvent:Ae,subscribeDomain:ue,getKey:w}},Ee=e=>{for(const n of e)n.unsubscribe()},T={domain:ke,module:wt,extern:ht,store:$e},Ne=F.exports.createContext(null),Et=()=>{const e=F.exports.useContext(Ne);if(e===null)throw new Error("You may forgot to add <RemeshRoot />");return e},Me=()=>Et().remeshStore,Ct=e=>{const n=F.exports.useRef(null);return n.current===null&&(e.store?n.current={remeshStore:e.store}:n.current={remeshStore:$e(q({name:"RemeshStore"},e.options))}),F.exports.useEffect(()=>()=>{var r;(r=n.current)==null||r.remeshStore.destroy()},[]),o.createElement(Ne.Provider,{value:n.current},e.children)},D=function(e){const n=Me(),[r,a]=F.exports.useState(()=>n.query(e)),c=F.exports.useRef(null);return F.exports.useEffect(()=>()=>{var f;(f=c.current)==null||f.unsubscribe(),c.current=null},[n,n.getKey(e)]),F.exports.useEffect(()=>{c.current===null&&(c.current=n.subscribeQuery(e,a))},[n,e]),r},U=function(e){const n=Me(),r=n.getDomain(e);return F.exports.useEffect(()=>{const a=n.subscribeDomain(e);return()=>{a.unsubscribe()}},[n,e]),r},xt=T.domain({name:"Counter",impl:e=>{const n=e.state({name:"CounterState",default:0}),r=e.command({name:"increCommand",impl:({get:a})=>{const c=a(n());return n().new(c+1)}});return{query:{CounterQuery:n.Query},command:{incre:r}}}}),vt=()=>{const e=U(xt()),n=D(e.query.CounterQuery()),r=()=>{e.command.incre()};return o.createElement("div",{style:{width:400,border:"1px solid #eaeaea",boxSizing:"border-box",padding:10}},o.createElement("h2",null,"Counter"),o.createElement("input",{type:"number",readOnly:!0,value:n}),o.createElement("label",null,o.createElement("button",{onClick:r},"Count ")," "))},Qt=T.domain({name:"TemperatureConverter",impl:e=>{const n=e.state({name:"CelsiusState",default:""}),r=e.state({name:"FahrenheitState",default:""}),a=e.command({name:"resetBoth",impl:()=>[n().new(""),r().new("")]}),c=e.command({name:"updateCelsius",impl:({},p)=>{if(p==="")return a();const C=parseFloat(p);if(Number.isNaN(C))return n().new(p);const g=C*(9/5)+32;return[n().new(p),r().new(g.toString())]}}),f=e.command({name:"updateFahrenheit",impl:({},p)=>{if(p==="")return a();const C=parseFloat(p);if(Number.isNaN(C))return r().new(p);const g=(C-32)*(5/9);return[n().new(g.toString()),r().new(p)]}});return{query:{CelsiusQuery:n.Query,FahrenheitQuery:r.Query},command:{updateCelsius:c,updateFahrenheit:f}}}}),Rt=()=>{const e=U(Qt()),n=D(e.query.CelsiusQuery()),r=D(e.query.FahrenheitQuery()),a=f=>{e.command.updateCelsius(f.target.value)},c=f=>{e.command.updateFahrenheit(f.target.value)};return o.createElement("div",{style:{border:"1px solid #eaeaea",boxSizing:"border-box",padding:10}},o.createElement("h2",null,"Temperature Converter"),o.createElement("div",null,o.createElement("input",{type:"text",value:n,onChange:a}),o.createElement("label",{htmlFor:""},"Celsius"),"=",o.createElement("input",{type:"text",value:r,onChange:c}),o.createElement("label",{htmlFor:""},"Fahrenheit")))},Ce=e=>{const n=e.split(".");if(n.length!==3)return null;const r=new Date(`${n[2]}.${n[1]}.${n[0]}`);return r.toString()==="Invalid Date"?null:r},xe=e=>{const n=e.toLocaleDateString().split("/");return`${n[2]}.${n[1]}.${n[0]}`},Dt=(e,n)=>e.getFullYear()!==n.getFullYear()?e.getFullYear()-n.getFullYear():e.getMonth()!==n.getMonth()?e.getMonth()-n.getMonth():e.getDate()-n.getDate(),It=T.domain({name:"FlightBooker",impl:e=>{const n=e.state({name:"OptionState",default:"one-way"}),r=e.state({name:"StartDateInputState",default:xe(new Date)}),a=e.state({name:"EndDateInputState",default:xe(new Date)}),c=e.query({name:"StartDateQuery",impl:({get:u})=>{const w=u(r());return Ce(w)}}),f=e.query({name:"EndDateQuery",impl:({get:u})=>{const w=u(a());return Ce(w)}}),p=e.command({name:"updateOption",impl:({},u)=>n().new(u)}),C=e.command({name:"updateStartDate",impl:({},u)=>r().new(u)}),g=e.command({name:"updateEndDate",impl:({},u)=>a().new(u)});return{query:{StatusQuery:e.query({name:"StatusQuery",impl:({get:u})=>{const w=u(n()),S=u(c()),b=u(f()),y=S?"valid":"invalid",i=w==="return"?b?"valid":"invalid":"disabled",h=w==="one-way"?S?"enabled":"disabled":!!S&&!!b&&Dt(S,b)<=0?"enabled":"disabled";return{startDate:y,endDate:i,bookButton:h}}}),OptionQuery:n.Query,StartDateQuery:c,EndDateQuery:f,StartDateInput:r.Query,EndDateInput:a.Query},command:{updateOption:p,updateStartDate:C,updateEndDate:g}}}}),kt=()=>{const e=U(It()),n=D(e.query.OptionQuery()),r=D(e.query.StatusQuery()),a=D(e.query.StartDateInput()),c=D(e.query.EndDateInput()),f=d=>{e.command.updateOption(d.target.value)},p=d=>{e.command.updateStartDate(d.target.value)},C=d=>{e.command.updateEndDate(d.target.value)},g=()=>{r.bookButton==="enabled"&&alert(n==="one-way"?`You have booked a one-way flight on ${a}`:`You have booked return flight from ${a} to ${c}`)};return o.createElement("div",{style:{width:400,border:"1px solid #eaeaea",boxSizing:"border-box",padding:10}},o.createElement("h2",null,"Flight Booker"),o.createElement("div",null,o.createElement("select",{value:n,onChange:f},o.createElement("option",{value:"one-way"},"One-way flight"),o.createElement("option",{value:"return"},"Return flight"))),o.createElement("div",null,o.createElement("input",{type:"text",style:{backgroundColor:r.startDate==="invalid"?"red":""},value:a,onChange:p})),o.createElement("div",null,o.createElement("input",{type:"text",style:{backgroundColor:r.endDate==="invalid"?"red":""},disabled:r.endDate==="disabled",value:c,onChange:C})),o.createElement("div",null,o.createElement("button",{disabled:r.bookButton==="disabled",onClick:g},"Book")))},$t=T.domain({name:"timer",impl:e=>{const n=e.state({name:"duration",default:15e3}),r=e.state({name:"elapsed",default:0}),a=e.event({name:"StartEvent"}),c=e.event({name:"StopEvent"}),f=e.command({name:"updateElapsed",impl:({get:g},d)=>{const u=g(n()),w=g(r());return w>u?c():r().new(w+d)}}),p=e.command({name:"updateDuration",impl:({get:g},d)=>{const u=g(r());return d>u?[n().new(d),a()]:n().new(d)}}),C=e.command({name:"resetElapsed",impl:({})=>[r().new(0),a()]});return e.command$({name:"updateElapsed$",impl:({fromEvent:g})=>{const u=he(g(a).pipe(be(1)),g(c).pipe(be(0))).pipe(tt()).pipe(ve(w=>w===0?rt:at().pipe(ot(),we(([S,b])=>b.elapsed-S.elapsed),we(S=>f(S)),st(g(c)))));return he(u,nt(a()))}}),{query:{DurationQuery:n.Query,ElapsedQuery:r.Query},command:{resetElapsed:C,updateDuration:p}}}}),Nt=()=>{const e=U($t()),n=D(e.query.ElapsedQuery()),r=D(e.query.DurationQuery()),a=f=>{const p=parseInt(f.target.value,10);isNaN(p)||e.command.updateDuration(p)},c=()=>{e.command.resetElapsed()};return o.createElement("div",{style:{width:400,border:"1px solid #eaeaea",boxSizing:"border-box",padding:10}},o.createElement("h2",null,"Timer"),o.createElement("div",{style:{display:"flex"}},o.createElement("label",{style:{marginRight:10,whiteSpace:"nowrap"}},"Elapsed Timer:"),o.createElement("div",{style:{width:"100%"}},o.createElement("span",{style:{display:"inline-block",height:10,background:"green",width:`${Math.min(n/r,1)*100}%`,verticalAlign:"middle",borderRadius:5}}))),o.createElement("div",null,n>r?(r/1e3).toFixed(1):(n/1e3).toFixed(1),"s"),o.createElement("div",{style:{display:"flex"}},o.createElement("label",{style:{width:100,marginRight:10}},"Duration:"),o.createElement("input",{style:{width:"100%"},type:"range",min:0,max:3e4,value:r,onChange:a})),o.createElement("div",null,o.createElement("button",{style:{width:"100% "},onClick:c},"Reset Timer")))},Mt=e=>T.module(n=>{const r=n.state({name:`${e.name}.KeyListState`,default:[]}),a=n.state({name:`${e.name}.ItemState`,impl:d=>e.createItem(d)}),c=n.query({name:`${e.name}.ItemListQuery`,impl:({get:d})=>d(r()).map(u=>d(a(u)))}),f=n.command({name:`${e.name}.setList`,impl:({},d)=>{const u=d.map(e.getKey);return[r().new(u),...d.map(w=>a(e.getKey(w)).new(w))]}}),p=n.command({name:`${e.name}.addItem`,impl:({get:d},u)=>{const w=d(r()),S=e.getKey(u);return w.includes(S)?[]:[r().new(w.concat(S)),a(S).new(u)]}}),C=n.command({name:`${e.name}.removeItem`,impl:({get:d},u)=>{const S=d(r()).filter(b=>b!==u);return r().new(S)}}),g=n.command({name:`${e.name}.updateItem`,impl:({get:d},u)=>{const w=e.getKey(u);return d(r()).includes(w)?a(w).new(u):p(u)}});return{command:{setList:f,addItem:p,removeItem:C,updateItem:g},query:{KeyListQuery:r.Query,ItemQuery:a.Query,ItemListQuery:c}}}),J=e=>{const c=e,{onOuterClick:n}=c,r=fe(c,["onOuterClick"]),a=o.useRef(null);return F.exports.useEffect(()=>{const f=p=>{a.current&&!a.current.contains(p.target)&&(n==null||n(p))};return document.addEventListener("click",f),()=>{document.removeEventListener("click",f)}},[]),o.createElement("div",q({ref:a},r))},qt=T.domain({name:"CRUD",impl:e=>{let n=0;const r=e.module(Mt({name:"Name",getKey:b=>b.id,createItem:b=>({id:b,name:"",surname:""})})),a=e.state({name:"FilterPrefix",default:""}),c=e.command({name:"updateFilterPrefix",impl:({},b)=>a().new(b)}),f=e.state({name:"Created",default:{name:"",surname:""}}),p=e.command({name:"UpdateCreated",impl:({get:b},y)=>{const i=b(f());return f().new(q(q({},i),y))}}),C=e.state({name:"Selected",default:null}),g=e.command({name:"Select",impl:({get:b},y)=>{if(y===null)return C().new(null);const i=b(r.query.ItemQuery(y));return C().new(i)}}),d=e.command({name:"UpdateSelectedName",impl:({get:b},y)=>{const i=b(C());return i===null?[]:C().new(q(q({},i),y))}}),u=e.query({name:"FilteredListQuery",impl:({get:b})=>{const y=b(a()),i=b(r.query.ItemListQuery());return y===""?i:i.filter(h=>h.surname.startsWith(y))}}),w=e.command({name:"SyncSelected",impl:({get:b})=>{const y=b(C());return y===null?[]:r.command.updateItem(y)}}),S=e.command({name:"CreateNameItem",impl:({get:b})=>{const y=b(f()),i=q({id:`${n++}`},y);return[r.command.addItem(i),p({name:"",surname:""})]}});return{query:X(q({},r.query),{FilteredListQuery:u,SelectedQuery:C.Query,FilterPrefixQuery:a.Query,CreatedQuery:f.Query}),command:X(q({},r.command),{updateFilterPrefix:c,selectItem:g,updateCreated:p,updateSelectedName:d,createNameItem:S,syncSelected:w})}}}),Ft=()=>{const e=U(qt()),n=D(e.query.FilteredListQuery()),r=D(e.query.FilterPrefixQuery()),a=D(e.query.CreatedQuery()),c=D(e.query.SelectedQuery()),f=S=>{e.command.updateFilterPrefix(S.target.value)},p=S=>{e.command.selectItem(S)},C=S=>{c?e.command.updateSelectedName({name:S.target.value}):e.command.updateCreated({name:S.target.value})},g=S=>{c?e.command.updateSelectedName({surname:S.target.value}):e.command.updateCreated({surname:S.target.value})},d=()=>{c===null&&e.command.createNameItem()},u=()=>{c&&e.command.syncSelected()},w=()=>{c&&(e.command.removeItem(c.id),e.command.selectItem(null))};return o.createElement(J,{style:{width:400,border:"1px solid #eaeaea",boxSizing:"border-box",padding:10},onOuterClick:()=>{p(null)}},o.createElement("h2",null,"CRUD"),o.createElement("div",null,o.createElement("label",{htmlFor:""},"Filter prefix"),o.createElement("input",{type:"text",value:r,onChange:f})),o.createElement("div",{style:{display:"flex"}},o.createElement("div",{style:{width:"50%",height:100,border:"1px solid #eaeaea",overflow:"scroll"}},n.map(S=>{const b=S.name+", "+S.surname;return o.createElement("div",{key:S.id,style:{background:(c==null?void 0:c.id)===S.id?"blue":"",color:(c==null?void 0:c.id)===S.id?"white":""},onClick:()=>{p(S.id)}},b)})),o.createElement("div",{style:{width:"50%",padding:10}},o.createElement("div",null,o.createElement("label",null,"Name:"),o.createElement("input",{type:"text",value:c?c.name:a.name,onChange:C})),o.createElement("div",null,o.createElement("label",null,"Surname:"),o.createElement("input",{type:"text",value:c?c.surname:a.surname,onChange:g}))),o.createElement("div",null,o.createElement("button",{disabled:c!==null,style:{marginRight:10},onClick:d},"Create"),o.createElement("button",{disabled:c===null,style:{marginRight:10},onClick:u},"Update"),o.createElement("button",{disabled:c===null,style:{marginRight:10},onClick:w},"Delete"))))},Lt=T.domain({name:"CircleDrawer",impl:e=>{const n=e.state({name:"HistoryState",default:{items:[],currentIndex:-1}}),r=e.command({name:"recordHistoryState",impl:({get:i},h)=>{const Q=i(n()),k=Q.items.slice(0,Q.currentIndex+1);if(h.action==="adjust-circle"){const O=k[k.length-1];O.action==="adjust-circle"&&O.index===h.index&&k.pop()}const K=[...k,h],A=K.length-1;return n().new({items:K,currentIndex:A})}}),a=e.state({name:"DrawState",default:{circles:[]}}),c=e.command({name:"undo",impl:({get:i})=>{const h=i(n()),Q=i(p()),k=h.currentIndex-1;return!Q||k<0?[a().new({circles:[]}),n().new({items:h.items,currentIndex:-1})]:[a().new(h.items[k].state),n().new({items:h.items,currentIndex:k})]}}),f=e.command({name:"redo",impl:({get:i})=>{const h=i(n());if(!i(C()))return[];const k=h.currentIndex+1;return[a().new(h.items[k].state),n().new({items:h.items,currentIndex:k})]}}),p=e.query({name:"CanUndoQuery",impl:({get:i})=>i(n()).currentIndex>=0}),C=e.query({name:"CanRedoQuery",impl:({get:i})=>{const h=i(n());return h.currentIndex<h.items.length-1}}),g=e.state({name:"SelectedIndexState",default:-1}),d=e.command({name:"setSelectedIndex",impl:({},i)=>g().new(i)}),u=e.query({name:"SelectedCircleInfoQuery",impl:({get:i})=>{const h=i(g()),Q=i(a()).circles;return h===-1?null:{index:h,circle:Q[h]}}}),w=e.command({name:"draw",impl:({get:i},h)=>{const k={circles:[...i(a()).circles,{position:h.position,diameter:h.diameter}]};return[a().new(k),r({action:"add-circle",state:k})]}}),S=e.command({name:"adjust",impl:({get:i},h)=>{const K={circles:i(a()).circles.map((A,O)=>O===h.index?{position:A.position,diameter:h.diameter}:A)};return[a().new(K),r({action:"adjust-circle",index:h.index,state:K})]}}),b=e.state({name:"TooltipsState",default:{type:"default"}}),y=e.command({name:"updateTooltips",impl:({},i)=>b().new(i)});return{query:{HistoryQuery:n.Query,DrawQuery:a.Query,TooltipsQuery:b.Query,SelectedIndexQuery:g.Query,SelectedCircleInfoQuery:u,CanUndoQuery:p,CanRedoQuery:C},command:{draw:w,adjust:S,updateTooltips:y,undo:c,redo:f,setSelectedIndex:d}}}}),Ut=(e,n)=>{const{x:r,y:a}=e,{diameter:c,position:f}=n,{x:p,y:C}=f,g=c/2,d=r-p,u=a-C;return d*d+u*u<g*g},Kt=()=>{var b;const e=U(Lt()),n=D(e.query.DrawQuery()),r=D(e.query.TooltipsQuery()),a=D(e.query.SelectedCircleInfoQuery()),c=D(e.query.CanUndoQuery()),f=D(e.query.CanRedoQuery()),p=y=>{const i=n.circles.find(Q=>Ut(y,Q));return i?{index:n.circles.indexOf(i),circle:i}:null},C=y=>{y.preventDefault();const i={x:y.pageX,y:y.pageY},h=p(i);h&&(e.command.setSelectedIndex(h.index),e.command.updateTooltips({type:"show-tips",index:h.index,circle:h.circle,pageX:y.pageX,pageY:y.pageY}))},g=y=>{if(r.type!=="default")return;const i={x:y.pageX,y:y.pageY};p(i)||e.command.draw({position:i,diameter:30})},d=y=>{if(r.type!=="default")return;const i={x:y.pageX,y:y.pageY},h=p(i);h?e.command.setSelectedIndex(h.index):e.command.setSelectedIndex(-1)},u=()=>{r.type==="show-tips"&&e.command.updateTooltips({type:"open-slider",index:r.index,circle:r.circle,pageX:r.pageX,pageY:r.pageY})},w=()=>{e.command.updateTooltips({type:"default"})},S=y=>{const i=parseInt(y.target.value,10);a&&!isNaN(i)&&e.command.adjust({index:a.index,diameter:i})};return o.createElement("div",{style:{border:"1px solid #eaeaea",boxSizing:"border-box",padding:10}},o.createElement("h2",null,"Circle Drawer"),o.createElement("div",{style:{width:400,textAlign:"center",padding:10}},o.createElement("button",{onClick:()=>e.command.undo(),style:{margin:"0 10px"},disabled:!c},"Undo"),o.createElement("button",{onClick:()=>e.command.redo(),style:{margin:"0 10px"},disabled:!f},"Redo")),o.createElement("div",{style:{width:400,height:400,border:"1px solid #eaeaea",boxSizing:"border-box",overflow:"hidden"},onClick:g,onMouseMove:d},n.circles.map((y,i)=>o.createElement("div",{key:y.position.x+"-"+y.position.y+"-"+y.diameter,style:{position:"absolute",left:y.position.x-y.diameter/2,top:y.position.y-y.diameter/2,width:y.diameter,height:y.diameter,borderRadius:y.diameter/2,border:"1px solid #666",backgroundColor:(a==null?void 0:a.index)===i?"#eaeaea":""},onContextMenu:C}))),r.type==="show-tips"&&o.createElement(J,{style:{position:"absolute",left:r.pageX,top:r.pageY,zIndex:100,background:"#fff",border:"1px solid #666",padding:10},onOuterClick:w,onClick:u},"Adjust Diameter"),r.type==="open-slider"&&o.createElement(J,{style:{position:"absolute",left:r.pageX,top:r.pageY,background:"#fff",border:"1px solid #666",zIndex:100,padding:10},onOuterClick:w,onClick:u},o.createElement("p",null,"Adjust Diameter"),o.createElement("div",null,o.createElement("input",{type:"range",value:(b=a==null?void 0:a.circle.diameter)!=null?b:"",min:1,max:150,onChange:S}))))},G=T.domain({name:"Cells",impl:e=>{const n=e.state({name:"RowKeyListState",default:[0,1,2,3,4,5,6,7,8,9].map(String)}),r=e.state({name:"ColumnKeyListState",default:["A","B","C","D","E","F","G","H","I","J"]}),a=e.state({name:"CellState",impl:()=>({content:{type:"text",text:""},isEditing:!1})}),c=e.query({name:"CellQuery",impl:({get:g},d)=>{const u=g(a(d));if(u.content.type==="text")return{type:"text",isEditing:u.isEditing,content:u.content.text,displayContent:u.content.text};if(u.content.type==="formula"){const w=Ot(u.content.formula),S=b=>Number(g(c(b)).displayContent);return{type:"formula",isEditing:u.isEditing,content:u.content.formula,displayContent:w(S)}}throw new Error("Unknown cell type")}}),f=e.command({name:"selectCell",impl:({get:g},d)=>{const u=g(a(d));return a(d).new({content:u.content,isEditing:!0})}}),p=e.command({name:"unselectCell",impl:({get:g},d)=>{const u=g(a(d));return a(d).new({content:u.content,isEditing:!1})}}),C=e.command({name:"setCellContent",impl:({get:g},{key:d,input:u})=>{const w=g(a(d));return u.startsWith("=")?a(d).new({content:{type:"formula",formula:u},isEditing:w.isEditing}):a(d).new({content:{type:"text",text:u},isEditing:w.isEditing})}});return{query:{CellQuery:c,ColumnKeyListQuery:r.Query,RowKeyListQuery:n.Query},command:{selectCell:f,unselectCell:p,setCellContent:C}}}}),jt=()=>{const e=U(G()),n=D(e.query.ColumnKeyListQuery()),r=D(e.query.RowKeyListQuery());return o.createElement("div",null,o.createElement("h2",null,"Cells"),o.createElement("table",{style:{borderCollapse:"collapse",border:"1px solid #bbb",textAlign:"center"}},o.createElement("thead",null,o.createElement("tr",{style:{backgroundColor:"#f6f6f6"}},o.createElement("th",{style:{width:30,display:"block"}}),n.map(a=>o.createElement("th",{key:a,style:{maxWidth:80,border:"1px solid #bbb"}},a)))),o.createElement("tbody",null,r.map(a=>o.createElement("tr",{key:a},o.createElement(Tt,{rowKey:a,columnKeyList:n}))))))},Tt=({columnKeyList:e,rowKey:n})=>{const r=U(G());return o.createElement(o.Fragment,null,o.createElement("td",{style:{width:30,border:"1px solid #bbb",backgroundColor:"#f6f6f6"}},n),e.map(a=>{const c=`${a}${n}`;return o.createElement("td",{key:c,style:{maxWidth:80,minWidth:80,border:"1px solid #bbb",overflow:"hidden"},onClick:()=>{r.command.selectCell(c)}},o.createElement(At,{cellKey:c}))}))},At=({cellKey:e})=>{const n=U(G()),r=D(n.query.CellQuery(e)),a=c=>{n.command.setCellContent({key:e,input:c.target.value})};return o.createElement(o.Fragment,null,r.isEditing&&o.createElement("input",{style:{width:"100%",height:"100%",backgroundColor:"transparent",boxSizing:"border-box",textAlign:"center"},value:r.content,onChange:a,onBlur:()=>{r.isEditing&&n.command.unselectCell(e)},autoFocus:!0}),!r.isEditing&&r.displayContent)},Ot=e=>n=>{try{const r=e.slice(1).replace(/\w\d+/g,c=>`get('${c}')`);return new Function("get",`return (${r}).toString()`)(n)}catch{return"-"}},Bt=()=>o.createElement("div",null,o.createElement("h1",null,"7GUIs in React/Remesh/TypeScript"),o.createElement("p",null,"This is a live version of an implementation (source) of 7GUIs with React, TypeScript and Remesh."),o.createElement("hr",null),o.createElement(vt,null),o.createElement("hr",null),o.createElement(Rt,null),o.createElement("hr",null),o.createElement(kt,null),o.createElement("hr",null),o.createElement(Nt,null),o.createElement("hr",null),o.createElement(Ft,null),o.createElement("hr",null),o.createElement(Kt,null),o.createElement("hr",null),o.createElement(jt,null));ct.render(o.createElement(o.StrictMode,null,o.createElement(Ct,null,o.createElement(Bt,null))),document.getElementById("root"));
