var X=Object.defineProperty,Z=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var _=(t,e,o)=>e in t?X(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,D=(t,e)=>{for(var o in e||(e={}))te.call(e,o)&&_(t,o,e[o]);if(b)for(var o of b(e))oe.call(e,o)&&_(t,o,e[o]);return t},Q=(t,e)=>Z(t,ee(e));import"./modulepreload-polyfill.b7f2da20.js";/* empty css              */import{l as A,n as ne,y as P,e as S,q as re,R as r,r as v,u as ae,v as q,c as le,H as se,w as ce,x as k}from"./vendor.b676472e.js";import{R as x,u as g,a as h,e as de,b as me,c as ue,d as ie}from"./remesh-logger.8971c43c.js";import{L as pe}from"./list.16051539.js";const H=x.extern({name:"Storage",default:{get:()=>{throw new Error("Not implemented")},set:()=>{throw new Error("Not implemented")},clear:()=>{throw new Error("Not implemented")}}}),Te=H({get:t=>A.getItem(t),set:async(t,e)=>{await A.setItem(t,e)},clear:t=>A.removeItem(t)}),ye=(t,e)=>{var u;const o=t.state({name:`${e.name}.TextState`,default:(u=e.default)!=null?u:""}),n=t.query({name:`${e.name}.InputQuery`,impl:({get:i})=>i(o())}),l=t.event({name:`${e.name}.TextChangedEvent`}),a=t.command({name:`${e.name}.setText`,impl:({get:i},T)=>{const y=i(o()),E=[o().new(T),l({previous:y,current:T})];return T===""?[...E,s({previous:y})]:E}}),s=t.event({name:`${e.name}.InputClearedEvent`}),m=t.command({name:`${e.name}.clearText`,impl:()=>a("")});return{query:{TextQuery:n},command:{setText:a,clearText:m},event:{TextChangedEvent:l,TextClearedEvent:s}}},Ee=(t,e)=>({listenTo:o=>({saveData:n=>({readData:l=>e({storageKey:t,TriggerEvent:o,saveData:n,readData:l})}),readData:n=>e({storageKey:t,TriggerEvent:o,saveData:l=>l,readData:n})})}),ve=(t,e)=>{const o=t.getExtern(H);t.command$({name:"readStorage",impl:()=>ne(o.get(e.storageKey)).pipe(P(n=>!!n),S(n=>e.readData(n)))}),t.command$({name:"writeStorage",impl:({fromEvent:n})=>n(e.TriggerEvent).pipe(re(l=>o.set(e.storageKey,e.saveData(l))),S(()=>null))})},F=(t,e)=>Ee(e,o=>ve(t,o)),he="remesh-example/todo-input",U=x.domain({name:"TodoInput",impl:t=>{const e=ye(t,{name:"TodoInput"}),o=e.query.TextQuery,n=e.event.TextChangedEvent,l=e.event.TextClearedEvent,a=e.command.setText,s=e.command.clearText;return F(t,he).listenTo(n).saveData(m=>m.current).readData(m=>a(m)),{query:{TodoInputQuery:o},command:{setTodoInput:a,clearTodoInput:s},event:{TodoInputChangedEvent:n,TodoInputClearedEvent:l}}}}),ge=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Math.random()*16|0,o=t=="x"?e:e&3|8;return o.toString(16)}),xe="remesh-example/todo-list",w=t=>t.id,I=x.domain({name:"TodoList",impl:t=>{const e=pe(t,{name:"TodoList",key:w}),o=e.query.ItemListQuery,n=e.query.ItemQuery,l=e.query.KeyListQuery,a=e.event.ListChangedEvent,s=e.event.ItemAddedEvent,m=e.event.ItemUpdatedEvent,u=e.event.ItemDeletedEvent,i=e.event.FailedToAddItemEvent,T=e.event.FailedToUpdateItemEvent,y=e.command.setList,E=t.command({name:"TodoList.addTodo",impl:(c,d)=>{if(d==="")return i({reason:"Title cannot be empty"});const p={id:ge(),title:d,completed:!1};return e.command.addItem(p)}}),f=t.command({name:"TodoList.updateTodo",impl:(c,d)=>d.title===""?L(d.id):e.command.updateItem(d)}),L=e.command.deleteItem,N=t.query({name:"ActiveTodoListQuery",impl:({get:c})=>c(o()).filter(p=>!p.completed)}),R=t.query({name:"CompletedTodoListQuery",impl:({get:c})=>c(o()).filter(p=>p.completed)}),$=t.query({name:"ActiveTodoCountQuery",impl:({get:c})=>c(N()).length}),K=t.query({name:"CompletedTodoCountQuery",impl:({get:c})=>c(R()).length}),Y=t.query({name:"IsAllCompletedQuery",impl:({get:c})=>{const d=c(o());return d.length===0?!1:c(K())===d.length}}),V=t.command({name:"toggleTodo",impl:({get:c},d)=>{const p=c(n(d)),C=Q(D({},p),{completed:!p.completed});return e.command.updateItem(C)}}),W=t.command({name:"toggleAllTodos",impl:({get:c})=>{const d=c(o());if(d.length===0)return null;const C=c($())>0,z=d.map(J=>Q(D({},J),{completed:C}));return y(z)}}),j=t.command({name:"clearAllCompletedTodos",impl:({get:c})=>{const d=c(o());if(d.length===0)return null;const p=d.filter(C=>!C.completed);return y(p)}});return F(t,xe).listenTo(a).saveData(c=>c.current).readData(c=>y(c)),{query:{TodoQuery:n,TodoKeyListQuery:l,TodoListQuery:o,ActiveTodoListQuery:N,CompletedTodoListQuery:R,ActiveTodoCountQuery:$,CompletedTodoCountQuery:K,IsAllCompletedQuery:Y},command:{setTodoList:y,addTodo:E,updateTodo:f,deleteTodo:L,toggleTodo:V,toggleAllTodos:W,clearAllCompletedTodos:j},event:{TodoItemAddedEvent:s,TodoItemUpdatedEvent:m,TodoItemDeletedEvent:u,FailedToAddTodoEvent:i,FailedToUpdateTodoEvent:T,TodoListChangedEvent:a}}}});function B(t,e){return n=>{const l=Array.isArray(t)?t:[t];for(const a of l)n.key.toLowerCase()===a.toLowerCase()&&(n.preventDefault(),e(n,a))}}const fe=()=>{const t=g(U()),e=g(I()),o=h(t.query.TodoInputQuery()),n=a=>{t.command.setTodoInput(a.target.value)},l=B("Enter",()=>{e.command.addTodo(o)});return de(e.event.FailedToAddTodoEvent,a=>{alert(a.reason)}),r.createElement("header",{className:"header"},r.createElement("h1",null,"todos"),r.createElement("input",{className:"new-todo",placeholder:"What needs to be done?",value:o,onChange:n,onKeyDown:l}))},Ce=(t,e)=>{const o=t.state({name:`${e.name}.SwitchState`,default:e.default}),n=t.query({name:`${e.name}.SwitchQuery`,impl:({get:s})=>s(o())}),l=t.event({name:`${e.name}.SwitchedEvent`}),a=t.command({name:`${e.name}.switchTo`,impl:({get:s},m)=>{const u=s(o());return[o().new(m),l({previous:u,current:m})]}});return{query:{SwitchQuery:n},command:{switchTo:a},event:{SwitchedEvent:l}}},Ie="remesh-example/todo-filter",Le=t=>{if(t===void 0)return"all";switch(t){case"all":case"active":case"completed":return t;default:return"all"}},G=x.domain({name:"TodoFilter",impl:t=>{const e=Ce(t,{name:"TodoFilter",default:"all"}),o=e.query.SwitchQuery,n=e.event.SwitchedEvent,l=e.command.switchTo,a=t.command({name:"TodoFilter.setFilter",impl:(s,m)=>{const u=Le(m);return l(u)}});return F(t,Ie).listenTo(n).saveData(s=>s.current).readData(s=>a(s)),{query:{TodoFilterQuery:o},command:{setFilter:a,switchFilter:l},event:{TodoFilterChangedEvent:n}}}}),De=x.domain({name:"TodoApp",impl:t=>{const e=t.getDomain(U()),o=t.getDomain(I()),n=t.getDomain(G()),l=t.query({name:"FilteredTodoList",impl:({get:a})=>{const s=a(n.query.TodoFilterQuery());if(s==="all")return a(o.query.TodoListQuery()).map(w);if(s==="active")return a(o.query.ActiveTodoListQuery()).map(w);if(s==="completed")return a(o.query.CompletedTodoListQuery()).map(w);throw new Error(`Unknown filter: ${s}`)}});return t.command$({name:"clearTodoInputWhenSubmit",impl:({fromEvent:a,get:s})=>a(o.event.TodoItemAddedEvent).pipe(P(m=>s(e.query.TodoInputQuery())===m.item.title),S(()=>e.command.clearTodoInput()))}),{query:{FilteredTodoKeyListQuery:l},command:{},event:{}}}});function Qe(t){const[e,o]=v.exports.useState(t),n=v.exports.useCallback(l=>{o(l.target.value)},[]);return[e,n,o]}function we(t){const e=g(I()),o=h(e.query.TodoQuery(t.id)),[n,l]=v.exports.useState(!1),[a,s]=Qe(o.title),m=B(["Enter","Escape"],(f,L)=>{L==="Enter"&&e.command.updateTodo(Q(D({},o),{title:a})),l(!1)}),u=()=>{l(!0)},i=()=>{e.command.toggleTodo(o.id)},T=()=>{e.command.deleteTodo(o.id)},y=()=>{l(!1)},E=v.exports.useRef(null);return v.exports.useEffect(()=>{var f;n&&((f=E.current)==null||f.focus())},[n]),r.createElement("li",{className:`${n&&"editing"} ${o.completed&&"completed"}`},r.createElement("div",{className:"view"},r.createElement("input",{type:"checkbox",className:"toggle",checked:o.completed,onChange:i}),r.createElement("label",{onDoubleClick:u},o.title),r.createElement("button",{className:"destroy",onClick:T})),n&&r.createElement("input",{ref:E,className:"edit",value:a,onChange:s,onKeyDown:m,onBlur:y}))}const Ae=()=>{const t=g(De()),e=g(I()),o=h(t.query.FilteredTodoKeyListQuery()),n=h(e.query.IsAllCompletedQuery()),l=()=>{e.command.toggleAllTodos()};return console.log("render list"),r.createElement("section",{className:"main"},r.createElement("input",{id:"toggle-all",type:"checkbox",className:"toggle-all",checked:n,onChange:l}),r.createElement("label",{htmlFor:"toggle-all"}),r.createElement("ul",{className:"todo-list"},o.map(a=>r.createElement(we,{key:a,id:a}))))},qe=()=>{const t=g(I()),e=g(G()),o=h(e.query.TodoFilterQuery()),n=h(t.query.ActiveTodoCountQuery()),a=h(t.query.CompletedTodoCountQuery())>0,s=()=>{t.command.clearAllCompletedTodos()},m=i=>i.isActive?"selected":"",u=ae();return v.exports.useEffect(()=>{var T;const i=(T=u.filter)!=null?T:"all";i!==o&&e.command.setFilter(i)},[u,o]),r.createElement("footer",{className:"footer"},r.createElement("span",{className:"todo-count"},r.createElement("strong",null,n)," item",n!==1&&"s"," left"),r.createElement("ul",{className:"filters"},r.createElement("li",null,r.createElement(q,{to:"/",className:m},"All")),r.createElement("li",null,r.createElement(q,{to:"/active",className:m},"Active")),r.createElement("li",null,r.createElement(q,{to:"/completed",className:m},"Completed"))),a&&r.createElement("button",{className:"clear-completed",onClick:s},"Clear completed"))},O=()=>r.createElement("div",{className:"todoapp"},r.createElement(fe,null),r.createElement(Ae,null),r.createElement(qe,null)),M=document.getElementById("root");if(M){const t=le(M),e=x.store({externs:[Te],inspectors:[me(),ue()]});t.render(r.createElement(v.exports.StrictMode,null,r.createElement(ie,{store:e},r.createElement(se,{basename:"/"},r.createElement(ce,null,r.createElement(k,{path:"/",element:r.createElement(O,null)}),r.createElement(k,{path:"/:filter",element:r.createElement(O,null)}))))))}
