var ft=Object.defineProperty,gt=Object.defineProperties;var St=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var Ve=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var Ae=(t,o,r)=>o in t?ft(t,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[o]=r,E=(t,o)=>{for(var r in o||(o={}))Ve.call(o,r)&&Ae(t,r,o[r]);if(H)for(var r of H(o))je.call(o,r)&&Ae(t,r,o[r]);return t},$=(t,o)=>gt(t,St(o));var Ue=(t,o)=>{var r={};for(var s in t)Ve.call(t,s)&&o.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&H)for(var s of H(t))o.indexOf(s)<0&&je.call(t,s)&&(r[s]=t[s]);return r};import{s as ze,f as yt,g as ht,h as vt,i as We,j as Ke,O as te,k as wt,e as bt,S as Rt,l as _,r as C,R as Et,n as Dt}from"./vendor.526a8a9f.js";const Xt=t=>t,A=Symbol("RemeshValuePlaceholder");let $t=0;function Ct(t){var s;const o=$t++,r=d=>({type:"RemeshEventPayload",arg:d,Event:r});return r.type="RemeshEvent",r.eventId=o,r.eventName=t.name,r.owner=L(),r.inspectable="inspectable"in t&&(s=t.inspectable)!=null?s:!0,"impl"in t&&(r.impl=t.impl),r}const Qt=t=>X({name:t.name,impl:()=>t.default,inspectable:t.inspectable,compare:t.compare}),Nt=t=>X({name:t.name,defer:!0,impl:o=>{throw new Error(`RemeshDeferState: use ${t.name} before setting state`)},inspectable:t.inspectable,compare:t.compare});let kt=0;const Fe=(t,o)=>We(t)&&We(o)?Ke(t,o):Array.isArray(t)&&Array.isArray(o)?Ke(t,o):t===o,X=t=>{var d,p,S;const o=kt++;let r=null;const s=w=>{if(w===void 0&&r)return r;const b={type:"RemeshStateItem",arg:w,State:s,new:g=>({type:"RemeshStateSetterPayload",stateItem:b,newState:g})};return w===void 0&&(r=b),b};return s.type="RemeshState",s.stateId=o,s.stateName=t.name,s.impl=t.impl,s.compare=(d=t.compare)!=null?d:Fe,s.owner=L(),s.inspectable=(p=t.inspectable)!=null?p:!0,s.defer=(S=t.defer)!=null?S:!1,s.Query=ne({name:`${t.name}.Query`,inspectable:!1,impl:({get:w},b)=>w(s(b))}),s};let xt=0;const ne=t=>{var d,p;const o=xt++;let r=null;const s=S=>{if(S===void 0&&r)return r;const w={type:"RemeshQueryPayload",Query:s,arg:S};return S===void 0&&(r=w),w};return s.type="RemeshQuery",s.queryId=o,s.queryName=t.name,s.prepare=t.prepare,s.impl=t.impl,s.compare=(d=t.compare)!=null?d:Fe,s.owner=L(),s.inspectable=(p=t.inspectable)!=null?p:!0,s.scheduler=t.scheduler,s};let Mt=0;const Le=t=>{var s;const o=Mt++,r=d=>({type:"RemeshCommandPayload",arg:d,Command:r});return r.type="RemeshCommand",r.commandId=o,r.commandName=t.name,r.impl=t.impl,r.owner=L(),r.inspectable=(s=t.inspectable)!=null?s:!0,r};let It=0;const re=t=>{var s;const o=It++,r=d=>({type:"RemeshCommand$Payload",arg:d,Command$:r});return r.type="RemeshCommand$",r.command$Id=o,r.command$Name=t.name,r.impl=t.impl,r.owner=L(),r.inspectable=(s=t.inspectable)!=null?s:!0,r},Te=t=>re({name:t.name,inspectable:t.inspectable,impl:(r,s)=>{if(!t.mode||t.mode==="switch")return s.pipe(ze(d=>t.impl(r,d)));if(t.mode==="merge")return s.pipe(yt(d=>t.impl(r,d)));if(t.mode==="concat")return s.pipe(ht(d=>t.impl(r,d)));if(t.mode==="exhaust")return s.pipe(vt(d=>t.impl(r,d)));throw new Error(`RemeshCommandAsync: invalid mode: ${t.mode}`)}});let At=0;const Vt=t=>{const o=r=>({type:"RemeshExternPayload",Extern:o,value:r});return o.externId=At++,o.externName=t.name,o.default=t.default,o};let jt=0;const oe=t=>{var s;let o=null;const r=d=>{if(d===void 0&&o)return o;const p={type:"RemeshDomainPayload",Domain:r,arg:d};return d===void 0&&(o=p),p};return r.type="RemeshDomain",r.domainId=jt++,r.domainName=t.name,r.impl=t.impl,r.inspectable=(s=t.inspectable)!=null?s:!0,r},L=oe({name:"DefaultDomain",impl:()=>({})}),N={DomainCreated:"Domain::Created",DomainDestroyed:"Domain::Destroyed",DomainRestored:"Domain::Restored",StateCreated:"State::Created",StateUpdated:"State::Updated",StateDestroyed:"State::Destroyed",StateRestored:"State::Restored",QueryCreated:"Query::Created",QueryUpdated:"Query::Updated",QueryDestroyed:"Query::Destroyed",QueryRestored:"Query::Restored",EventEmitted:"Event::Emitted",CommandReceived:"Command::Received",Command$Received:"Command$::Received"},V=oe({name:"RemeshInspector",impl:t=>{const o=t.event({name:"RemeshDomainStorageEvent"}),r=t.event({name:"RemeshStateStorageEvent"}),s=t.event({name:"RemeshQueryStorageEvent"}),d=t.event({name:"RemeshEventEmitted"}),p=t.event({name:"RemeshCommandReceived"}),S=t.event({name:"RemeshCommand$Received"});return{event:{RemeshDomainStorageEvent:o,RemeshStateStorageEvent:r,RemeshQueryStorageEvent:s,RemeshEventEmittedEvent:d,RemeshCommandReceivedEvent:p,RemeshCommand$ReceivedEvent:S}}}}),U=t=>t.owner?t.owner.Domain.inspectable&&t.inspectable:t.inspectable,Ut=t=>{var o;return((o=t.inspectors)!=null?o:[]).filter(r=>!!r).map(r=>{const p=t,{inspectors:s}=p,d=Ue(p,["inspectors"]);return r(d)})},Wt=t=>{let o=null;const r=()=>(o||(o=Ut(t)),o);return{destroyInspectors:()=>{if(o){for(const a of o)a.destroy();o=null}},inspectDomainStorage:(a,m)=>{if(U(m.Domain))for(const f of r()){const k=f.getDomain(V()).event.RemeshDomainStorageEvent({type:a,storage:m});f.emitEvent(k)}},inspectStateStorage:(a,m)=>{if(U(m.State))for(const f of r()){const k=f.getDomain(V()).event.RemeshStateStorageEvent({type:a,storage:m});f.emitEvent(k)}},inspectQueryStorage:(a,m)=>{if(U(m.Query))for(const f of r()){const k=f.getDomain(V()).event.RemeshQueryStorageEvent({type:a,storage:m});f.emitEvent(k)}},inspectEventEmitted:(a,m)=>{if(U(m.Event))for(const f of r()){const k=f.getDomain(V()).event.RemeshEventEmittedEvent({type:a,payload:m});f.emitEvent(k)}},inspectCommandReceived:(a,m)=>{if(U(m.Command))for(const f of r()){const k=f.getDomain(V()).event.RemeshCommandReceivedEvent({type:a,payload:m});f.emitEvent(k)}},inspectCommand$Received:(a,m)=>{if(U(m.Command$))for(const f of r()){const k=f.getDomain(V()).event.RemeshCommand$ReceivedEvent({type:a,payload:m});f.emitEvent(k)}}}},ee=new WeakMap,Kt=t=>{if(ee.has(t))return ee.get(t);let o=null;const r=new te(s=>{if(o){s.next(o),s.complete();return}const d=F(t);if(d.type!=="pending"){o=d,s.next(d),s.complete();return}s.next({type:"pending"}),t.then(p=>{const S={type:"resolved",value:p};o=S,s.next(S),s.complete()},p=>{const S={type:"rejected",error:p};o=S,s.next(S),s.complete()})});return ee.set(t,r),r},W=new WeakMap,F=function(t){return W.has(t)||(W.set(t,{type:"pending"}),t.then(o=>{W.set(t,{type:"resolved",value:o})},o=>{o instanceof Error?W.set(t,{type:"rejected",error:o}):W.set(t,{type:"rejected",error:new Error(o)})})),W.get(t)};let z=0;const Je=t=>{const o=E({},t),r=Wt(o),s=new Set,d=new Map,p=new Set,S=new WeakMap,w=e=>{var n;for(const c of(n=o.externs)!=null?n:[])if(c.Extern===e)return c.value;return e.default},b=e=>{const n=S.get(e);if(n)return n;const c=w(e),u={id:z++,type:"RemeshExternStorage",Extern:e,currentValue:c};return S.set(e,u),u},g=e=>b(e).currentValue,a=new WeakMap,m=e=>{var l;const n=a.get(e);if(n)return n;const c=e.State.stateName,u=(l=JSON.stringify(e.arg))!=null?l:"",i=`State/${e.State.stateId}/${c}:${u}`;return a.set(e,i),i},f=e=>{var l;const n=a.get(e);if(n)return n;const c=e.Query.queryName,u=(l=JSON.stringify(e.arg))!=null?l:"",i=`Query/${e.Query.queryId}/${c}:${u}`;return a.set(e,i),i},I=e=>{var l;const n=a.get(e);if(n)return n;const c=e.Domain.domainName,u=(l=JSON.stringify(e.arg))!=null?l:"",i=`Domain/${e.Domain.domainId}/${c}:${u}`;return a.set(e,i),i},k=e=>e.type==="RemeshStateItem"?m(e):e.type==="RemeshQueryPayload"?f(e):I(e),Ge=e=>{if(e.currentState===A)throw new Error(`${e.key} is not found`);return e.currentState},se=new WeakMap,Ze=e=>{const n=D(e.State.owner),c=m(e),u=e.State.defer?A:e.State.impl(e.arg),i={id:z++,type:"RemeshStateStorage",State:e.State,arg:e.arg,key:c,currentState:u,downstreamSet:new Set};return n.stateMap.set(c,i),se.set(e,i),r.inspectStateStorage(N.StateCreated,i),i},ae=e=>{const n=D(e.State.owner);n.stateMap.has(e.key)||(n.stateMap.set(e.key,e),r.inspectStateStorage(N.StateRestored,e))},K=e=>{const n=D(e.State.owner),c=m(e),u=n.stateMap.get(c);if(u)return u;const i=se.get(e);return i?(ae(i),i):Ze(e)},ce=new WeakMap,Oe=e=>{const n=D(e.owner),c=new _,u=new te(R=>{const v=c.subscribe(R);return l.refCount+=1,()=>{v.unsubscribe(),l.refCount-=1,p.add(l),T()}}),i=ce.get(e),l=Object.assign(i!=null?i:{},{type:"RemeshEventStorage",Event:e,subject:c,observable:u,refCount:0});return n.eventMap.set(e,l),ce.set(e,l),l},Y=e=>{const c=D(e.owner).eventMap.get(e);return c||Oe(e)},me=new WeakMap,ue=e=>{const n=new _,c=new te(u=>{const i=n.subscribe(u),l=e();return l.refCount+=1,()=>{i.unsubscribe(),l.refCount-=1,p.add(l),T()}});return{subject:n,observable:c}},ie=(e,n,c)=>{if(!e.prepare)return;const u=e.prepare(n,c);if(!!u){if(Array.isArray(u)){for(const i of u)q(i);return}q(u)}},de=e=>{if(!e.Query.scheduler)return;const n=new _;e.schedulerSubject=n;const c={get:y.get,get unwrap(){return y.unwrap.bind(c)},peek:y.peek,hasNoValue:y.hasNoValue,fromEvent:y.fromEvent,fromQuery:y.fromQuery};e.Query.scheduler(c,n.asObservable()).subscribe(()=>{$e(e),O()})},qe=e=>{const n=D(e.Query.owner),c=f(e),{subject:u,observable:i}=ue(()=>R),l=new Set,R={id:z++,type:"RemeshQueryStorage",Query:e.Query,arg:e.arg,currentValue:A,key:c,upstreamSet:l,downstreamSet:new Set,subject:u,observable:i,refCount:0},{Query:v}=e;de(R);const h={get:x=>{if(R.upstreamSet!==l)return y.get(x);if(x.type==="RemeshStateItem"){const M=K(x);return R.upstreamSet.add(M),M.downstreamSet.add(R),y.get(x)}if(x.type==="RemeshQueryPayload"){const M=j(x);return R.upstreamSet.add(M),M.downstreamSet.add(R),y.get(x)}return y.get(x)},get unwrap(){return y.unwrap.bind(h)},peek:y.peek,hasNoValue:y.hasNoValue};ie(v,h,e.arg);const Q=v.impl(h,e.arg);return Q instanceof Promise&&F(Q),R.currentValue=Q,n.queryMap.set(c,R),me.set(e,R),r.inspectQueryStorage(N.QueryCreated,R),R},pe=e=>{const n=D(e.Query.owner);if(n.queryMap.has(e.key))return;const{subject:c,observable:u}=ue(()=>e);e.subject=c,e.observable=u,n.queryMap.set(e.key,e),de(e);for(const i of e.upstreamSet)if(i.downstreamSet.add(e),i.type==="RemeshQueryStorage")pe(i);else if(i.type==="RemeshStateStorage")ae(i);else throw new Error(`Unknown upstream: ${i}`);r.inspectQueryStorage(N.QueryRestored,e),Z(e)},j=e=>{const n=D(e.Query.owner),c=f(e),u=n.queryMap.get(c);if(u)return u;const i=me.get(e);return i?(pe(i),i):qe(e)},le=new WeakMap,Pe=e=>{const n=D(e.owner),c=new _,u=c.asObservable(),i={id:z++,type:"RemeshCommand$Storage",Command$:e,subject:c,observable:u};return n.command$Map.set(e,i),le.set(e,i),i},fe=e=>{const n=D(e.owner),c=n.command$Map.get(e);if(c)return c;const u=le.get(e);if(u){const i=new _,l=i.asObservable();return u.subject=i,u.observable=l,u.subscription=void 0,n.command$Map.set(e,u),u}return Pe(e)},ge=new WeakMap,et=e=>{const n=I(e),c=new Set,u=new Set,i={state:v=>{if("default"in v){const Q=Qt(v);return Q.owner=e,Q.Query.owner=e,Q}if(!("impl"in v)){const Q=Nt(v);return Q.owner=e,Q.Query.owner=e,Q}const h=X(v);return h.owner=e,h.Query.owner=e,h},query:v=>{const h=ne(v);return h.owner=e,h},event:v=>{const h=Ct(v);return h.owner=e,h},command:v=>{const h=Le(v);return h.owner=e,h},command$:v=>{const h=re(v);return h.owner=e,u.add(h),l.running&&J(h),h},commandAsync:v=>{const h=Te(v);return h.owner=e,u.add(h),l.running&&J(h),h},getDomain:v=>{const h=D(v);return c.add(h),h.domain},getExtern:v=>g(v)},l={id:z++,type:"RemeshDomainStorage",Domain:e.Domain,arg:e.arg,get domain(){return R},domainContext:i,domainPayload:e,key:n,command$Set:u,upstreamSet:c,downstreamSet:new Set,upstreamSubscriptionSet:new Set,domainSubscriptionSet:new Set,stateMap:new Map,queryMap:new Map,eventMap:new Map,command$Map:new Map,refCount:0,running:!1},R=e.Domain.impl(i,e.arg);d.set(n,l),ge.set(e,l),r.inspectDomainStorage(N.DomainCreated,l);for(const v of c)v.downstreamSet.add(l);return l},D=e=>{const n=I(e),c=d.get(n);if(c)return c;const u=ge.get(e);if(u){u.running=!1,d.set(u.key,u);for(const i of u.upstreamSet)i.downstreamSet.add(u);return r.inspectDomainStorage(N.DomainRestored,u),u}return et(e)},Se=e=>{var c;const n=D(e.Query.owner);if(!!n.queryMap.has(e.key)){n.queryMap.delete(e.key),r.inspectQueryStorage(N.QueryDestroyed,e);for(const u of e.upstreamSet)if(u.downstreamSet.delete(e),u.type==="RemeshQueryStorage")ye(u);else if(u.type==="RemeshStateStorage")ve(u);else throw new Error(`Unknown upstream in clearQueryStorageIfNeeded(..): ${u}`);(c=e.schedulerSubject)==null||c.complete(),e.subject.complete()}},ye=e=>{e.refCount===0&&e.downstreamSet.size===0&&Se(e)},he=e=>{const n=D(e.State.owner);!n.stateMap.has(e.key)||(r.inspectStateStorage(N.StateDestroyed,e),n.stateMap.delete(e.key),e.downstreamSet.clear())},ve=e=>{e.downstreamSet.size===0&&he(e)},we=e=>{const n=D(e.Event.owner);e.subject.complete(),n.eventMap.delete(e.Event)},tt=e=>{e.refCount===0&&we(e)},nt=e=>{var c;const n=D(e.Command$.owner);e.subject.complete(),(c=e.subscription)==null||c.unsubscribe(),e.subscription=void 0,n.command$Map.delete(e.Command$)},be=e=>{r.inspectDomainStorage(N.DomainDestroyed,e),_e(e.domainSubscriptionSet),_e(e.upstreamSubscriptionSet);for(const n of e.eventMap.values())we(n);for(const n of e.queryMap.values())Se(n);for(const n of e.stateMap.values())he(n);for(const n of e.command$Map.values())nt(n);e.upstreamSubscriptionSet.clear(),e.domainSubscriptionSet.clear(),e.downstreamSet.clear(),e.stateMap.clear(),e.queryMap.clear(),e.eventMap.clear(),e.running=!1,d.delete(e.key);for(const n of e.upstreamSet)n.downstreamSet.delete(e),Re(n)},Re=e=>{e.refCount===0&&e.downstreamSet.size===0&&e.domainSubscriptionSet.size===0&&be(e)},rt=e=>{const n=K(e);return Ge(n)},Ee=e=>{const n=j(e),c=n.currentValue;if(c===A)throw new Error(`Query ${n.key} is not ready yet.`);return c},G=new WeakMap,De=e=>{const n=j(e);if(G.has(n))return G.get(n);const u=D(e.Query.owner).domainContext,i=y.get(e),l=F(i),R=u.state({name:`${e.Query.queryName}.UnwrappedState`,inspectable:!1,default:l}),v=u.query({name:`${e.Query.queryName}.UnwrappedQuery`,inspectable:!1,impl:({get:x})=>x(R())}),h=u.command({name:`${e.Query.queryName}.updateUnwrappedState`,inspectable:!1,impl:(x,M)=>R().new(M)});u.command$({name:`${e.Query.queryName}.UnwrappedCommand$`,inspectable:!1,impl:({fromQuery:x,get:M})=>x(e).pipe(wt(M(e)),ze(Kt),bt(h))});const Q=v();return G.set(n,Q),Q},y={get:e=>{if(e.type==="RemeshStateItem")return rt(e);if(e.type==="RemeshQueryPayload")return Ee(e);throw new Error(`Unexpected input in ctx.get(..): ${e}`)},unwrap(e){const n=De(e);return this.get(n)},peek:e=>{if(e.type==="RemeshStateItem")return K(e).currentState;if(e.type==="RemeshQueryPayload")return j(e).currentValue;throw new Error(`Unexpected input in peek(..): ${e}`)},hasNoValue:e=>y.peek(e)===A,fromEvent:e=>Y(e).observable,fromQuery:e=>j(e).observable},Z=e=>{if(e.schedulerSubject)if(e.currentValue!==A)e.schedulerSubject.next(e.currentValue);else throw new Error(`Query ${e.key} is not ready yet.`);else $e(e)},$e=e=>{const{Query:n}=e;for(const l of e.upstreamSet)l.downstreamSet.delete(e),l.downstreamSet.size===0&&p.add(l);const c=new Set;e.upstreamSet=c;const u={get:l=>{if(e.upstreamSet!==c)return y.get(l);if(l.type==="RemeshStateItem"){const R=K(l);return e.upstreamSet.add(R),R.downstreamSet.add(e),y.get(l)}if(l.type==="RemeshQueryPayload"){const R=j(l);return e.upstreamSet.add(R),R.downstreamSet.add(e),y.get(l)}return y.get(l)},get unwrap(){return y.unwrap.bind(u)},peek:y.peek,hasNoValue:y.hasNoValue};ie(n,u,e.arg);const i=n.impl(u,e.arg);if(!(e.currentValue!==A&&n.compare(e.currentValue,i))){e.currentValue=i,i instanceof Promise&&F(i),s.add(e),r.inspectQueryStorage(N.QueryUpdated,e);for(const l of[...e.downstreamSet])Z(l)}},T=()=>{if(p.size===0)return;const e=[...p];p.clear();for(const n of e)n.type==="RemeshDomainStorage"?Re(n):n.type==="RemeshEventStorage"?tt(n):n.type==="RemeshQueryStorage"?ye(n):n.type==="RemeshStateStorage"&&ve(n);T()},Ce=()=>{if(s.size===0)return;const e=[...s];s.clear();for(const n of e)s.has(n)||n.subject.next(n.currentValue);Ce()},O=()=>{Ce()},q=e=>{const n=K(e.stateItem);if(!(n.currentState!==A&&e.stateItem.State.compare(n.currentState,e.newState))){n.currentState=e.newState,r.inspectStateStorage(N.StateUpdated,n);for(const c of[...n.downstreamSet])Z(c)}},Qe=e=>{const{Event:n,arg:c}=e,u=Y(n);if(r.inspectEventEmitted(N.EventEmitted,e),n.impl){const i={get:y.get,get unwrap(){return y.unwrap.bind(i)},peek:y.peek,hasNoValue:y.hasNoValue},l=n.impl(i,c);u.subject.next(l)}else u.subject.next(c)},Ne=e=>{r.inspectCommandReceived(N.CommandReceived,e);const{Command:n,arg:c}=e,u={get:y.get,get unwrap(){return y.unwrap.bind(u)},peek:y.peek,hasNoValue:y.hasNoValue},i=n.impl(u,c);P(i)},ke=(e,n)=>{e.add(n),n.add(()=>{e.delete(n)})},J=e=>{const n=fe(e);if(n.subscription)return;const c={get:y.get,get unwrap(){return y.unwrap.bind(c)},peek:y.peek,hasNoValue:y.hasNoValue,fromEvent:y.fromEvent,fromQuery:y.fromQuery},i=e.impl(c,n.observable).subscribe(l=>{P(l),O()});n.subscription=i},P=e=>{if(!!e){if(Array.isArray(e)){for(const n of e)P(n);return}if(e.type==="RemeshCommandPayload"){Ne(e);return}else if(e.type==="RemeshEventPayload"){Qe(e);return}else if(e.type==="RemeshStateSetterPayload"){q(e);return}else if(e.type==="RemeshCommand$Payload"){xe(e);return}throw new Error(`Unknown command output of ${e}`)}},xe=e=>{r.inspectCommand$Received(N.Command$Received,e);const{Command$:n,arg:c}=e,u=fe(n);J(n),u.subject.next(c)},ot=(e,n)=>{ke(e.domainSubscriptionSet,n),n.add(()=>{p.add(e),T()})},st=(e,n)=>{const c=j(e);return c.observable.subscribe(n)},at=(e,n)=>Y(e).observable.subscribe(n),ct=e=>{const n={};for(const c in e.command){const u=e.command[c];n[c]=i=>Ie(u(i))}return n},mt=e=>{const n=D(e);if(n.domainOutput)return n.domainOutput;const c=n.domain,u=ct(c),i=$(E({},c),{command:u});return n.domainOutput=i,i},ut=e=>{for(const n of e)J(n)},it=e=>{if(!e.running){e.running=!0;for(const n of e.upstreamSet){const c=Me(n.domainPayload);ke(e.upstreamSubscriptionSet,c)}ut(e.command$Set)}},Me=e=>{const n=D(e),c=new Rt;return ot(n,c),it(n),c},dt=()=>{r.destroyInspectors();for(const e of d.values())be(e);d.clear(),s.clear()},pt=e=>{Qe(e)},Ie=e=>{e.type==="RemeshCommandPayload"?(Ne(e),O()):e.type==="RemeshCommand$Payload"&&xe(e)},lt=e=>y.unwrap(e);return{name:o.name,getDomain:mt,query:Ee,unwrap:lt,getUnwrappedQueryPayload:De,emitEvent:pt,sendCommand:Ie,destroy:dt,subscribeQuery:st,subscribeEvent:at,subscribeDomain:Me,getKey:k}},_e=t=>{for(const o of t)o.unsubscribe()},He={domain:oe,extern:Vt,store:Je,state:X,query:ne,command:Le,command$:re,commandAsync:Te},Xe=C.exports.createContext(null),_t=()=>{const t=C.exports.useContext(Xe);if(t===null)throw new Error("You may forgot to add <RemeshRoot />");return t},B=()=>_t().remeshStore,Bt=t=>{const o=C.exports.useRef(t.store);o.current||(o.current=Je("options"in t?t.options:{}));const r=o.current,s=C.exports.useMemo(()=>({remeshStore:r}),[r]);return Et.createElement(Xe.Provider,{value:s},t.children)},Be=function(t){zt(t.Query.owner);const o=B(),r=C.exports.useRef(null),s=C.exports.useCallback(b=>(r.current=b,()=>{r.current=null}),[]),d=C.exports.useCallback(()=>o.query(t),[o,t]),p=Dt.exports.useSyncExternalStore(s,d),S=C.exports.useRef(null),w=o.getKey(t);return C.exports.useEffect(()=>()=>{var b;(b=S.current)==null||b.unsubscribe(),S.current=null},[o,w]),C.exports.useEffect(()=>{S.current===null&&(S.current=o.subscribeQuery(t,()=>{var b;(b=r.current)==null||b.call(r)}))},[o,t]),p},Yt=function(t){const r=B().getUnwrappedQueryPayload(t);return Be(r)},Gt=function(t){const o=Be(t),r=F(o);if(r.type==="pending")throw o;if(r.type==="rejected")throw r.error;return r.value},Zt=function(t,o){const r=B(),s=C.exports.useRef(o);C.exports.useEffect(()=>{s.current=o}),C.exports.useEffect(()=>{const d=r.subscribeEvent(t,p=>{s.current(p)});return()=>{d.unsubscribe()}},[t,r])},zt=function(t){const o=B(),r=C.exports.useRef(null),s=o.getDomain(t),d=o.getKey(t);return C.exports.useEffect(()=>()=>{var p;(p=r.current)==null||p.unsubscribe(),r.current=null},[o,d]),C.exports.useEffect(()=>{r.current===null&&(r.current=o.subscribeDomain(t))},[o,t]),s},Ft=t=>{const o=t.getHours().toString().padStart(2,"0"),r=t.getMinutes().toString().padStart(2,"0"),s=t.getSeconds().toString().padStart(2,"0"),d=t.getMilliseconds().toString().padStart(3,"0");return`${o}:${r}:${s}.${d}`},Lt=()=>{const t=new Date;return Ft(t)},Ye=t=>{const o=E({include:["state","domain","event","command","command$"]},t);return{onActive:(s,d)=>{var p;(p=o.exclude)!=null&&p.includes(s)||(o.include?o.include.includes(s)&&d():d())}}},Tt=()=>{if(typeof window!="undefined")return window.__REDUX_DEVTOOLS_EXTENSION__},Ot=t=>{const o=Tt();if(!!o)return r=>{var g;const s=Ye(t),d=o.connect({name:r==null?void 0:r.name,features:{pause:!1,lock:!1,persist:!1,export:!1,import:!1,jump:!1,skip:!1,reorder:!1,dispatch:!1,test:!1}}),p=(a,m)=>{d.send(m,null)},S=He.store({name:`RemeshReduxDevtools(${(g=r==null?void 0:r.name)!=null?g:""})`}),w=S.getDomain(V()),b=a=>{const m={domainId:a.Domain.domainId,domainName:a.Domain.domainName};return a.arg!==void 0?$(E({},m),{domainArg:a.arg}):m};return s.onActive("domain",()=>{S.subscribeEvent(w.event.RemeshDomainStorageEvent,a=>{const m=a.storage.Domain,f={type:`${a.type}::${m.domainName}`,domainId:m.domainId,domainName:m.domainName};a.storage.arg!==void 0?p(f.type,$(E({},f),{domainArg:a.storage.arg})):p(f.type,f)})}),s.onActive("state",()=>{S.subscribeEvent(w.event.RemeshStateStorageEvent,a=>{const m=a.storage.State,f={type:`${a.type}::${m.stateName}`,owner:b(m.owner),stateId:m.stateId,stateName:m.stateName,stateValue:a.storage.currentState};a.storage.arg!==void 0?p(f.type,$(E({},f),{stateArg:a.storage.arg})):p(f.type,f)})}),s.onActive("query",()=>{S.subscribeEvent(w.event.RemeshQueryStorageEvent,a=>{const m=a.storage.Query,f={type:`${a.type}::${m.queryName}`,owner:b(m.owner),queryId:m.queryId,queryName:m.queryName};a.storage.arg!==void 0?p(f.type,$(E({},f),{queryArg:a.storage.arg})):p(f.type,f)})}),s.onActive("command",()=>{S.subscribeEvent(w.event.RemeshCommandReceivedEvent,a=>{const m=a.payload.Command,f={type:`${a.type}::${m.commandName}`,owner:b(m.owner),commandId:m.commandId,commandName:m.commandName};a.payload.arg!==void 0?p(f.type,$(E({},f),{commandArg:a.payload.arg})):p(f.type,f)})}),s.onActive("command$",()=>{S.subscribeEvent(w.event.RemeshCommand$ReceivedEvent,a=>{const m=a.payload.Command$,f={type:`${a.type}::${m.command$Name}`,owner:b(m.owner),command$Id:m.command$Id,command$Name:m.command$Name};a.payload.arg!==void 0?p(f.type,$(E({},f),{command$Arg:a.payload.arg})):p(f.type,f)})}),s.onActive("event",()=>{S.subscribeEvent(w.event.RemeshEventEmittedEvent,a=>{const m=a.payload.Event,f={type:`${a.type}::${m.eventName}`,owner:b(m.owner),eventId:m.eventId,eventName:m.eventName};a.payload.arg!==void 0?p(f.type,$(E({},f),{eventArg:a.payload.arg})):p(f.type,f)})}),S}},qt=t=>o=>{var b;const r=E({collapsed:!0},t),s=Ye(r),d=(g,a)=>{if(r.collapsed){const m=g.split("::");console.groupCollapsed(`%c${m[0]}%c::%c${m[1]}%c::%c${m[2]}%c @ ${Lt()}`,"color:#03A9F4; font-weight: bold","color:#9E9E9E; font-weight: bold","color:#4CAF50; font-weight: bold","color:#9E9E9E; font-weight: bold","color:#AA07DE; font-weight: bold","color:#9E9E9E; font-weight: lighter")}console.log(a),r.collapsed&&console.groupEnd()},p=He.store($(E({},o),{name:`RemeshLogger(${(b=o==null?void 0:o.name)!=null?b:""})`})),S=p.getDomain(V()),w=g=>{const a={domainId:g.Domain.domainId,domainName:g.Domain.domainName};return g.arg!==void 0?$(E({},a),{domainArg:g.arg}):a};return s.onActive("domain",()=>{p.subscribeEvent(S.event.RemeshDomainStorageEvent,g=>{const a=g.storage.Domain,m={type:`${g.type}::${a.domainName}`,domainId:a.domainId,domainName:a.domainName};g.storage.arg!==void 0?d(m.type,$(E({},m),{domainArg:g.storage.arg})):d(m.type,m)})}),s.onActive("state",()=>{p.subscribeEvent(S.event.RemeshStateStorageEvent,g=>{const a=g.storage.State,m={type:`${g.type}::${a.stateName}`,owner:w(a.owner),stateId:a.stateId,stateName:a.stateName,stateValue:g.storage.currentState};g.storage.arg!==void 0?d(m.type,$(E({},m),{stateArg:g.storage.arg})):d(m.type,m)})}),s.onActive("query",()=>{p.subscribeEvent(S.event.RemeshQueryStorageEvent,g=>{const a=g.storage.Query,m={type:`${g.type}::${a.queryName}`,owner:w(a.owner),queryId:a.queryId,queryName:a.queryName,queryValue:g.storage.currentValue};g.storage.arg!==void 0?d(m.type,$(E({},m),{queryArg:g.storage.arg})):d(m.type,m)})}),s.onActive("command",()=>{p.subscribeEvent(S.event.RemeshCommandReceivedEvent,g=>{const a=g.payload.Command,m={type:`${g.type}::${a.commandName}`,owner:w(a.owner),commandId:a.commandId,commandName:a.commandName};g.payload.arg!==void 0?d(m.type,$(E({},m),{commandArg:g.payload.arg})):d(m.type,m)})}),s.onActive("command$",()=>{p.subscribeEvent(S.event.RemeshCommand$ReceivedEvent,g=>{const a=g.payload.Command$,m={type:`${g.type}::${a.command$Name}`,owner:w(a.owner),command$Id:a.command$Id,command$Name:a.command$Name};g.payload.arg!==void 0?d(m.type,$(E({},m),{command$Arg:g.payload.arg})):d(m.type,m)})}),s.onActive("event",()=>{p.subscribeEvent(S.event.RemeshEventEmittedEvent,g=>{const a=g.payload.Event,m={type:`${g.type}::${a.eventName}`,owner:w(a.owner),eventId:a.eventId,eventName:a.eventName};g.payload.arg!==void 0?d(m.type,$(E({},m),{eventArg:g.payload.arg})):d(m.type,m)})}),p};export{He as R,Be as a,Ot as b,qt as c,Bt as d,Xt as e,Zt as f,Yt as g,Gt as h,zt as u};
//# sourceMappingURL=remesh-logger.c94c594f.js.map
